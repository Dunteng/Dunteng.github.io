<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>js里判断变量是数组还是对象的四种方法</title>
      <link href="/2020/04/01/ArrayOrObject.html"/>
      <url>/2020/04/01/ArrayOrObject.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="方法一：constructor"><a href="#方法一：constructor" class="headerlink" title="方法一：constructor"></a>方法一：constructor</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(arr.constructor === <span class="built_in">Array</span>)</span><br><span class="line"><span class="built_in">console</span>.log(obj.constructor === <span class="built_in">Array</span>);</span><br></pre></td></tr></table></figure><p><a href="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570897037168.png" target="_blank" rel="noopener"><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570897037168.png" alt="1570897037168"></a></p><h2 id="方法二：instanceof"><a href="#方法二：instanceof" class="headerlink" title="方法二：instanceof"></a>方法二：instanceof</h2><p><a href="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570897168419.png" target="_blank" rel="noopener"><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570897168419.png" alt="1570897168419"></a></p><h2 id="方法三：Array-isArray"><a href="#方法三：Array-isArray" class="headerlink" title="方法三：Array.isArray()"></a>方法三：Array.isArray()</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = []  </span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125; </span><br><span class="line"></span><br><span class="line"><span class="built_in">Array</span>.isArray(arr)<span class="comment">//true</span></span><br><span class="line"><span class="built_in">Array</span>.isArray(obj)<span class="comment">//false</span></span><br></pre></td></tr></table></figure><h2 id="方法四：Object-prototype-toString-call"><a href="#方法四：Object-prototype-toString-call" class="headerlink" title="方法四：Object.prototype.toString().call()"></a>方法四：Object.prototype.toString().call()</h2><p><a href="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570897447379.png" target="_blank" rel="noopener"><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570897447379.png" alt="1570897447379"></a></p><p>第1种和第2方法在跨域时会失效，当你在多个frame中来回穿梭的时候，由于每个iframe都有一套自己的执行环境，跨frame实例化的对象彼此是不共享原型链的，因此导致上述检测代码失效。</p>]]></content>
      
      
      <categories>
          
          <category> 面试题 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深克隆</title>
      <link href="/2020/03/20/deepClone.html"/>
      <url>/2020/03/20/deepClone.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="浅克隆"><a href="#浅克隆" class="headerlink" title="浅克隆"></a>浅克隆</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  name: <span class="string">'abc'</span>,</span><br><span class="line">  age: <span class="number">18</span>,</span><br><span class="line">  sex: <span class="string">'male'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clone</span>(<span class="params">origin, target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> target = target || &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> origin) &#123;</span><br><span class="line">    target[key] = origin[key]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> newObj = clone(obj);</span><br></pre></td></tr></table></figure><p><a href="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570935515334.png" target="_blank" rel="noopener"><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570935515334.png" alt="1570935515334"></a></p><p><strong>浅克隆的原始值属性更改，另一个对象不受影响。但是引用值属性一改就全都改了。</strong></p><p><a href="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570936074035.png" target="_blank" rel="noopener"><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570936074035.png" alt="1570936074035"></a></p><p>为了避免这个问题就需要进行<strong>深度克隆</strong></p><p><br><br></p><h2 id="深克隆"><a href="#深克隆" class="headerlink" title="深克隆"></a>深克隆</h2><ol><li>判断克隆对象，若为原始值（值类型）和null，直接返回</li><li>判断克隆对象是对象类型还是数组类型，分别<code>result={}</code>和<code>result=[]</code></li><li>遍历克隆对象，<code>obj.hasOwnProperty(key)</code>判断是非原型属性的，进行递归克隆</li><li>返回结果result</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 判断克隆对象，若为值类型和null，直接返回</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> obj != <span class="string">'object'</span> || obj == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result = &#123;&#125;;</span><br><span class="line">    <span class="comment">// 2. 判断克隆对象是对象类型还是数组类型，分别result=&#123;&#125;和result=[]</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.toString.call(obj) == <span class="string">'[object, Array]'</span>) &#123;</span><br><span class="line">        result = [];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        result = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 遍历克隆对象，obj.hasOwnProperty(key)判断是非原型属性的，进行递归克隆</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="keyword">if</span> (obj.hasOwnProperty(key)) &#123;</span><br><span class="line">            result[key] = deepClone(obj[key]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. 返回结果result</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试用例</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    name: <span class="string">'xi'</span>,</span><br><span class="line">    age: <span class="number">20</span>,</span><br><span class="line">    address: &#123;</span><br><span class="line">        con: <span class="string">'cn'</span>,</span><br><span class="line">        no: [<span class="number">11</span>, <span class="number">1</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    hobbies: [<span class="string">'dance'</span>, <span class="number">666</span>, &#123; <span class="attr">kk</span>: <span class="number">5</span> &#125;],</span><br><span class="line">    eat: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="number">666</span>); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="JSON深克隆"><a href="#JSON深克隆" class="headerlink" title="JSON深克隆"></a>JSON深克隆</h2><p>还可以使用 JSON 来实现深度克隆：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> objStr = <span class="built_in">JSON</span>.stringify(obj);</span><br><span class="line"><span class="keyword">var</span> result = <span class="built_in">JSON</span>.parse(Str);</span><br></pre></td></tr></table></figure><p>但是json克隆<strong>无法克隆方法</strong>。</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rem适配和vw适配</title>
      <link href="/2020/03/12/mobile.html"/>
      <url>/2020/03/12/mobile.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="什么是适配？"><a href="#什么是适配？" class="headerlink" title="什么是适配？"></a>什么是适配？</h2><p>适配：在不同尺寸的手机设备上，页面相对性的达到合理的展示（自适应）或者保持统一效果的等比缩放（看起来差不多）</p><p> 适配的方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1、百分比适配</span><br><span class="line"></span><br><span class="line">2、viewport缩放</span><br><span class="line"></span><br><span class="line">3、DPR缩放</span><br><span class="line"></span><br><span class="line">4、rem适配</span><br><span class="line"></span><br><span class="line">5、vw、vh适配</span><br></pre></td></tr></table></figure><h2 id="百分比适配"><a href="#百分比适配" class="headerlink" title="百分比适配"></a>百分比适配</h2><p>width：宽度的百分比是相对于父盒子width内容宽的比。没有父盒子就是相对于浏览器的宽。<br>height：高度的百分比是相对于父盒子height内容高的比。<br>padding、margin：padding和margin不管任何方向百分比都是相对于父盒子width内容宽的比。<br>border：不能书写百分数</p><p>子盒子如果绝对定位，width百分比参考的是距离最近，且有定位的父盒子的width（算上padding.）；<br>height百分比参考的是距离最近，且有定位的父盒子的height（算上padding.）；<br>padding,margin百分比参考的是距离最近，且有定位的父盒子的width（算上padding.）；</p><h2 id="viewport缩放适配"><a href="#viewport缩放适配" class="headerlink" title="viewport缩放适配"></a>viewport缩放适配</h2><p>把所有机型的设备独立像素（CSS像素）设置成一致的。</p><p>比如说，一张设计图是按照iPhone6设计的，iPhone6的分辨率是750x1334，其设备独立像素（CSS像素）就是375x667，那么如果项目网页只想在iPhone6这种分辨率的设备里使用的话，我们代码中像素直接按照设计稿那样给定像素大小就行了。但是这样子的页面放到了其他分辨率、其他设备独立像素（CSS像素）的设备中去的时候，页面就乱套了，比如iPhone6 plus的分辨率是828x1472（设备独立像素（CSS像素）是414x736）。</p><p>这时候，如果能将所有机型的设备独立像素（CSS像素）都设置为一致的，比如全设置为iPhone6的375x667，然后代码样式按照375x667的设计稿去给大小，这样网页在所有机型设备中都能做到适配。</p><p>1、viewport需要通过js动态的设置（不能直接把device的值设置成数值）</p><p>2、通过设置比例（初始比例以及缩放比例），把宽度缩放成一致的</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>上面代码中的initial-scale就是缩放比，缩放比=css像素/viewport视口宽度。</p><p>为了把所有机型的设备独立像素（CSS像素）设置成一致的，就需要设置 initial-scale 的大小。若我们想把所有机型的CSS像素都设置为<strong>iPhone6的标准（375x667）</strong>，通过公式：<strong>缩放比=css像素宽度/viewport视口宽度</strong>，我们已知viewport视口宽度375，只要获取到当前机型的CSS像素宽度就可以知道缩放比  initial-scale 到底要设置为多少了。而当前机型的CSS像素宽度实际上就是html标签的宽度。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1,user-scalable=no,minimum-scale=1,maximum-scale=1"</span> <span class="attr">id</span>=<span class="string">"view"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">body&#123;</span></span><br><span class="line"><span class="undefined">margin: 0;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="css"><span class="selector-class">.box</span> <span class="selector-tag">div</span>&#123;</span></span><br><span class="line"><span class="css"><span class="comment">/* width: 25%; */</span></span></span><br><span class="line"><span class="css"><span class="selector-tag">width</span>: 93<span class="selector-class">.75px</span>;</span></span><br><span class="line"><span class="undefined">height: 100px;</span></span><br><span class="line"><span class="undefined">float: left;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="css"><span class="selector-class">.box</span> <span class="selector-tag">div</span><span class="selector-pseudo">:nth-child(1)</span>&#123;</span></span><br><span class="line"><span class="undefined">background: red;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="css"><span class="selector-class">.box</span> <span class="selector-tag">div</span><span class="selector-pseudo">:nth-child(2)</span>&#123;</span></span><br><span class="line"><span class="undefined">background: green;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="css"><span class="selector-class">.box</span> <span class="selector-tag">div</span><span class="selector-pseudo">:nth-child(3)</span>&#123;</span></span><br><span class="line"><span class="undefined">background: blue;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="css"><span class="selector-class">.box</span> <span class="selector-tag">div</span><span class="selector-pseudo">:nth-child(4)</span>&#123;</span></span><br><span class="line"><span class="undefined">background: yellow;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="comment">// 注意这里的script标签必须放在&lt;head&gt;标签里面</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="actionscript"><span class="comment">//获取css像素（viewport没有缩放）</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> curWidth=<span class="built_in">document</span>.documentElement.clientWidth;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> curWidth=<span class="built_in">window</span>.innerWidth;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> curWidth=<span class="built_in">window</span>.screen.width;<span class="comment">// 最好用这个</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="built_in">console</span>.log(curWidth);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> targetWidth=<span class="number">375</span>;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> scale=curWidth/targetWidth;</span></span><br><span class="line"><span class="javascript"><span class="built_in">console</span>.log(scale);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> view=<span class="built_in">document</span>.getElementById(<span class="string">'view'</span>);</span></span><br><span class="line"><span class="javascript"><span class="built_in">console</span>.log(view.content);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">view.content=<span class="string">'initial-scale='</span>+scale+<span class="string">',user-scalable=no,minimum-scale='</span>+scale+<span class="string">',maximum-scale='</span>+scale+<span class="string">''</span>;</span></span><br><span class="line"><span class="undefined">&#125;)();</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure><p>若实现没有写<code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no&quot;&gt;</code></p><p>则采用如下代码👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">        *iphone 6plus</span></span><br><span class="line"><span class="comment">        *原来的尺寸                            414</span></span><br><span class="line"><span class="comment">        *要变成的尺寸（以iPhone 6为基准）375    375</span></span><br><span class="line"><span class="comment">        *比例                                  414/375</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       <span class="keyword">var</span> curWidth = <span class="built_in">window</span>.screen.width; <span class="comment">//iphone 6plus为414px</span></span><br><span class="line">       <span class="keyword">var</span> targetWidth = <span class="number">375</span>;</span><br><span class="line">       <span class="keyword">var</span> scale = curWidth/targetWidth;</span><br><span class="line">       <span class="keyword">var</span> meta = <span class="built_in">document</span>.createElement(<span class="string">"meta"</span>);</span><br><span class="line">       meta.name = <span class="string">"viewport"</span>;</span><br><span class="line">       meta.content = <span class="string">'initial-scale='</span>+scale+<span class="string">',minimum-scale='</span>+scale+<span class="string">',maximum-scale='</span>+scale+<span class="string">''</span>;</span><br><span class="line">       <span class="built_in">document</span>.head.appendChild(meta);</span><br><span class="line">   &#125;)()</span><br></pre></td></tr></table></figure><p>缺点：</p><ol><li>就像在viewport设置宽度的时候，可以把宽度设置成一个固定值一样，会出现所有的设备看上去都是同样的大小，没有分别了，不太好，厂商特意做出各种大小的手机，还要弄成一样，那人家买大屏机有什么意义</li><li>算出的的值在一些有小数的情况下可能会出现误差</li></ol><h2 id="DPR缩放适配"><a href="#DPR缩放适配" class="headerlink" title="DPR缩放适配"></a>DPR缩放适配</h2><p>根据dpr的值，把视口进行缩放，缩放到物理像素，也就是把css像素的值设置成物理像素，让所有的设备都变成一个css像素对应一个设备像素。比如<strong>iPhone6，设备像素是750x1334，设备独立像素（CSS像素）是375x667</strong>，我们就把视口进行缩放，让设备独立像素也变成750x1334，从而一个css像素对应一个设备像素。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> meta=<span class="built_in">document</span>.querySelector(<span class="string">'meta[name="viewport"]'</span>);</span><br><span class="line"> <span class="keyword">var</span> scale=<span class="number">1</span>/<span class="built_in">window</span>.devicePixelRatio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!meta)&#123;</span><br><span class="line"><span class="comment">//这个条件成立说明用户没有写meta标签，我需要创建一个</span></span><br><span class="line">meta=<span class="built_in">document</span>.createElement(<span class="string">'meta'</span>);</span><br><span class="line">meta.name=<span class="string">'viewport'</span>;</span><br><span class="line">meta.content=<span class="string">'width=device-width,initial-scale='</span>+scale+<span class="string">',user-scalable=no,minimum-scale='</span>+scale+<span class="string">',maximum-scale='</span>+scale+<span class="string">''</span>;</span><br><span class="line"><span class="built_in">document</span>.head.appendChild(meta);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">meta.setAttribute(<span class="string">'content'</span>,<span class="string">'width=device-width,initial-scale='</span>+scale+<span class="string">',user-scalable=no,minimum-scale='</span>+scale+<span class="string">',maximum-scale='</span>+scale+<span class="string">''</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>缺点：</p><ul><li>宽度还是需要用百分比，感觉没什么卵用。</li></ul><h2 id="rem适配"><a href="#rem适配" class="headerlink" title="rem适配"></a>rem适配</h2><p>讲rem之前先来回顾一下em。</p><p>em 作为font-size的单位时，其代表父元素的字体大小，作为其他属性单位时，代表自身字体大小          </p><p> 1、chrom下有最小字体限制，必需为12px，所以这个值不能小于12</p><p> 2、如果两个一样的元素，但是里面字体不一样，那就不能统一设置了。或者元素字体变化了，就又要统一设置一遍</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.em</span>&#123;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">30px</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#000</span>;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">10em</span>;<span class="comment">/* 1em=30px 作为其他属性单位时，代表自身字体大小 */</span></span><br><span class="line"><span class="attribute">height</span>: <span class="number">10em</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.em</span> <span class="selector-tag">p</span>&#123;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">2em</span>;<span class="comment">/* 1em=30px 作为font-size的单位时，其代表父元素的字体大小*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>rem   CSS3新增的一个相对单位，是相对于根元素的字体大小，即html的字体大小；</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span>&#123;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.rem</span>&#123;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">10rem</span>;<span class="comment">/* 1rem=20px; */</span></span><br><span class="line"><span class="attribute">height</span>: <span class="number">10rem</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>rem适配的原理：把所有的设备的宽度都分成相同的若干列，再计算元素宽度所占的份数</p><p>rem适配，如果可以根据不同机型的屏幕宽度（设备独立像素CSS像素）确定根节点html的字体大小（即一列的宽度），而1rem就等于html节点的字体大小（1rem即为一列的宽），进而在构造页面的时候可以把设计稿中的宽度 / 1rem所代表的px的值，从而得出具体多少rem（即元素宽度所占的份数）从而达到适配。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1、元素适配的宽度（算出来的）</span></span><br><span class="line"><span class="comment">=元素所占的列数*一列的宽</span></span><br><span class="line"><span class="comment">=元素所占的列数*1rem</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">2、元素在设计稿里的宽度（量出来的）</span></span><br><span class="line"><span class="comment">3、列数（随便给的）</span></span><br><span class="line"><span class="comment">100</span></span><br><span class="line"><span class="comment">4、一列的宽度（算出来的）</span></span><br><span class="line"><span class="comment">=屏幕实际的宽度（css像素）/列数</span></span><br><span class="line"><span class="comment">一列的宽度就是1rem</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">5、元素实际占的列数（算出来的）</span></span><br><span class="line"><span class="comment">=元素设计稿里的宽/一列的宽</span></span><br><span class="line"><span class="comment">=元素设计稿里的宽/1rem</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment">var colWidth=屏幕实际的宽度（css像素）/100;</span></span><br><span class="line"><span class="comment">50*colWidth//50列所占的宽</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> colWidth=<span class="number">0</span>;<span class="comment">//一列的宽</span></span><br><span class="line"><span class="keyword">var</span> col=<span class="number">100</span>;<span class="comment">//列数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//分别算出iphone5与iphone6里面一列的宽度</span></span><br><span class="line">colWidth=<span class="number">375</span>/<span class="number">100</span>;<span class="comment">//3.75pxiphone6</span></span><br><span class="line">colWidth=<span class="number">320</span>/<span class="number">100</span>;<span class="comment">//3.2pxiphone5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//假如一个div需要占10列，算出div的分别在两个手机里的宽度</span></span><br><span class="line"><span class="keyword">var</span> divWidth=<span class="number">0</span>;<span class="comment">//div的宽度</span></span><br><span class="line">divWidth=<span class="number">10</span>*<span class="number">3.75</span>;<span class="comment">//37.5pxiphone6里div的宽度</span></span><br><span class="line">divWidth=<span class="number">10</span>*<span class="number">3.2</span>;<span class="comment">//32pxiphone5里div的宽度</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//根据设计稿里元素的宽算出来它所占的列数</span></span><br><span class="line"><span class="keyword">var</span> divWidth=<span class="number">50</span>;<span class="comment">//div在设计稿里实际的宽（量出来的）</span></span><br><span class="line"><span class="keyword">var</span> divCol=<span class="number">0</span>;<span class="comment">//要算出div所占的列数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//以iphone6为例，一列的宽为3.75px，那50px占多少列？</span></span><br><span class="line">divCol=<span class="number">50</span>/<span class="number">3.75</span>;<span class="comment">//13.333在iphone6里所占的列数</span></span><br><span class="line">divCol=<span class="number">50</span>/<span class="number">3.2</span>;<span class="comment">//15.625在iphone5里所占的列数</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//width: 10rem;实际切图时候给的值</span></span><br><span class="line"><span class="comment">//元素适配的宽度=元素所占的列数*一列的宽</span></span><br><span class="line"><span class="comment">//元素适配的宽度 =&gt; width</span></span><br><span class="line"><span class="comment">//元素所占的列数 =&gt; 10</span></span><br><span class="line"><span class="comment">//一列的宽 =&gt; rem</span></span><br><span class="line"><span class="comment">/* html&#123;</span></span><br><span class="line"><span class="comment">font-size:屏幕实际的宽度（css像素）/列数，即一列的宽度</span></span><br><span class="line"><span class="comment">&#125; */</span></span><br></pre></td></tr></table></figure><p>综上可知，rem适配的关键是确定根节点html的字体大小，即所谓的一列的宽度。有两种方式可以确定html的font-sitze，一种通过JS设置，另一种通过媒体查询进行设置。</p><h3 id="JS设置根节点font-size（简易版）"><a href="#JS设置根节点font-size（简易版）" class="headerlink" title="JS设置根节点font-size（简易版）"></a>JS设置根节点font-size（简易版）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">1、元素适配的宽度=元素所占的列数*1rem</span></span><br><span class="line"><span class="comment">2、一列的宽度=屏幕实际的宽度（css像素）/列数</span></span><br><span class="line"><span class="comment">3、元素实际占的列数=元素设计稿里的宽/1rem</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> html=<span class="built_in">document</span>.documentElement;<span class="comment">//html</span></span><br><span class="line"><span class="keyword">var</span> width=html.clientWidth;<span class="comment">//css像素</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(width);</span><br><span class="line"></span><br><span class="line">html.style.fontSize=width/<span class="number">16</span>+<span class="string">'px'</span>;<span class="comment">//把屏幕分成了16列，以iphone为例得出一个列的值为整数</span></span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//iphone5</span></span><br><span class="line"><span class="comment">//1rem=20px;一列的宽度</span></span><br><span class="line"><span class="comment">//80/1rem=80/20=4;元素实际占的列数</span></span><br><span class="line"><span class="comment">//4*1rem=4rem;元素适配的宽度</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//iphone6</span></span><br><span class="line"><span class="comment">//1rem=375/16=23.4375;一列的宽度</span></span><br><span class="line"><span class="comment">//4*1rem=4*23.4375=93.75;元素适配的宽度</span></span><br><span class="line"><span class="comment">//4*93.75=375;css的宽度</span></span><br></pre></td></tr></table></figure><p>这里再多说一嘴关于切图的事，一般设计稿都是按照设备像素大小进行设计的（为了保证图片高清），切图得到的像素大小要先处以设备的DPR，再进行rem的换算。比如IPhone6的设计稿量出来一个div的宽是200px，则代码中给的px是200/DPR=200/2=100px，否则过大，然后再用这个100px进行rem的换算。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//真正切图时候的方法!!!</span></span><br><span class="line"><span class="comment">//1、算rem，还是根据设备实际的设备独立像素css像素算</span></span><br><span class="line"><span class="comment">//2、量出一个元素在设计稿里的尺寸</span></span><br><span class="line"><span class="comment">//3、拿这个尺寸除以DPR值后，再去换算rem</span></span><br></pre></td></tr></table></figure><h3 id="JS设置根节点font-size（最优版）"><a href="#JS设置根节点font-size（最优版）" class="headerlink" title="JS设置根节点font-size（最优版）"></a>JS设置根节点font-size（最优版）</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">body&#123;</span></span><br><span class="line"><span class="undefined">margin: 0;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">div&#123;</span></span><br><span class="line"><span class="undefined">background: green;</span></span><br><span class="line"><span class="undefined">float: left;</span></span><br><span class="line"><span class="undefined">/* </span></span><br><span class="line"><span class="css">187<span class="selector-class">.5px</span></span></span><br><span class="line"><span class="undefined"> */</span></span><br><span class="line"><span class="css"> <span class="selector-tag">width</span>: 1<span class="selector-class">.875rem</span>;</span></span><br><span class="line"><span class="css"> <span class="selector-tag">height</span>: 1<span class="selector-class">.875rem</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">img&#123;</span></span><br><span class="line"><span class="css"><span class="selector-tag">width</span>: 7<span class="selector-class">.5rem</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">/**</span></span><br><span class="line"><span class="undefined">* 立即执行函数，确定根节点font-size的大小，这里以iPhone6的750宽度进行设置，</span></span><br><span class="line"><span class="undefined">* 最终html标签的font-size为50px，由于(clientWidth / designWidth)已经是0.5，所以</span></span><br><span class="line"><span class="undefined">* 在切图量出来的像素大小不必再除以DPR了，量出187.5px直接可以写1.875rem</span></span><br><span class="line"><span class="javascript">* @param &#123;<span class="built_in">Object</span>&#125; <span class="built_in">document</span> </span></span><br><span class="line"><span class="javascript">* @param &#123;<span class="built_in">Object</span>&#125; <span class="built_in">window</span></span></span><br><span class="line"><span class="undefined">* @param &#123;number=&#125; designWidth 设计稿中设备的物理像素宽度</span></span><br><span class="line"><span class="undefined">*/</span></span><br><span class="line"><span class="actionscript">(<span class="function"><span class="keyword">function</span> <span class="params">(doc, win, designWidth)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> html = doc.documentElement;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">refreshRem</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> clientWidth = html.clientWidth;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="keyword">if</span> (clientWidth &gt;= designWidth) &#123;<span class="comment">//给宽度一个最大值，如果设备的宽度已经超过设计稿的尺寸了，统一按一个值去算（传的第三个参数）</span></span></span><br><span class="line"><span class="actionscript">html.style.fontSize = <span class="string">'100px'</span>;</span></span><br><span class="line"><span class="actionscript">&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">html.style.fontSize = <span class="number">100</span> * (clientWidth / designWidth) + <span class="string">'px'</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">doc.addEventListener(<span class="string">'DOMContentLoaded'</span>, refreshRem);</span></span><br><span class="line"><span class="javascript">&#125;)(<span class="built_in">document</span>, <span class="built_in">window</span>, <span class="number">750</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/img_12.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这个方案有个比较爽的地方就是<strong>设计稿量出来多少，直接小数点前移两位即转化为rem的值</strong>。举个例子，有个div设计稿量出来宽度是187.5px，那么在代码中就应该为187.5/DPR=187.5/2=93.75px，而html的font-size为50px，也就是1rem=50px，那么93.75px=93.75/50=1.875rem，又绕回来了，直接小数点前移两位就得到rem的值。非常方便，免去了手动除以DPR的步骤。</p><h3 id="媒体查询置根节点font-size"><a href="#媒体查询置根节点font-size" class="headerlink" title="媒体查询置根节点font-size"></a>媒体查询置根节点font-size</h3><p>利用CSS3媒体查询来手动设置根节点的font-size，苏宁在用，不过我觉得有点low，不方便。</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">style</span>&gt;</span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">50px</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">24px</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">320px</span>) &#123;</span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>:<span class="number">21.33px</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">12px</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">360px</span>) &#123;</span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>:<span class="number">24px</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">12px</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">375px</span>) &#123;</span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>:<span class="number">25px</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">12px</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">384px</span>) &#123;</span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>:<span class="number">25.6px</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">14px</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">400px</span>) &#123;</span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>:<span class="number">26.67px</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">14px</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">414px</span>) &#123;</span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>:<span class="number">27.6px</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">14px</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">424px</span>) &#123;</span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>:<span class="number">28.27px</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">14px</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">480px</span>) &#123;</span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>:<span class="number">32px</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">15.36px</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">540px</span>) &#123;</span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>:<span class="number">36px</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">17.28px</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">720px</span>) &#123;</span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>:<span class="number">48px</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">23.04px</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">750px</span>) &#123;</span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>:<span class="number">50px</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">24px</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="hotcss适配"><a href="#hotcss适配" class="headerlink" title="hotcss适配"></a>hotcss适配</h3><p>作为一个移动端的项目，必须做好移动端适配，这里使用的方案是<a href="https://github.com/imochen/hotcss" target="_blank" rel="noopener">hotcss</a>，其原理和rem适配原理是一样的，只不过hotcss.js做得更加精细。下面以vue项目举例。</p><p>下载好hotcss文件夹，里面有hotcss.js和px2rem.scss两个文件。hotcss.js在main.js中引入。</p><p>另外将样式重置文件common.css放在assets文件夹中，然后在App.vue中引入。</p><p>px2rem.scss中：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">function</span> px2rem($px)&#123;</span><br><span class="line">@<span class="keyword">return</span> $px*<span class="number">320</span>/$designWidth/<span class="number">20</span> + rem;</span><br><span class="line">&#125;</span><br><span class="line">// 设置设计图的宽度</span><br><span class="line">$designWidth : 750;</span><br></pre></td></tr></table></figure><p>项目设计图的宽度就是750px。px2rem.scss就是<strong>一个函数</strong>，用于将px转为合适的rem，设计稿量出一个div宽度为200px，则不必再考虑转化为多少的rem，直接使用<code>width: px2rem(200)</code>即可。</p><h4 id="【补充】sass引入公共文件"><a href="#【补充】sass引入公共文件" class="headerlink" title="【补充】sass引入公共文件"></a>【补充】sass引入公共文件</h4><p>对于hotcss中的px2rem.scss文件，每个 .vue 文件都要手动引用它，这样很麻烦，所以我们需要只引用一次px2rem.scss就可以在所有的 .vue 文件中使用，那么要怎么做到呢？</p><p>看一下Vue Cli3的官网文档：<a href="https://cli.vuejs.org/zh/config/#css-requiremoduleextension" target="_blank" rel="noopener">文档一</a>， <a href="https://cli.vuejs.org/zh/guide/css.html#%E5%90%91%E9%A2%84%E5%A4%84%E7%90%86%E5%99%A8-loader-%E4%BC%A0%E9%80%92%E9%80%89%E9%A1%B9" target="_blank" rel="noopener">文档二</a></p><p>在项目根路径下新建文件 vue.config.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  css: &#123;</span><br><span class="line">    loaderOptions: &#123;</span><br><span class="line">      <span class="comment">// 给 sass-loader 传递选项</span></span><br><span class="line">      sass: &#123;</span><br><span class="line">        data: <span class="string">`@import "./src/lib/hotcss/px2rem.scss";`</span>  <span class="comment">//注意这个分号不能漏掉</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>配置完成之后，就可以保证所有的页面都可以使用这个px2rem.css而无需每个页面都手动引入。</p><p>每次修改了 vue.config.js 的时候，都要重新启动项目。</p><p>这里我踩了一个坑，在配置sass的时候<a href="https://blog.csdn.net/weixin_42590838/article/details/103800092" target="_blank" rel="noopener">漏了分号</a>。</p><h2 id="vw、vh适配"><a href="#vw、vh适配" class="headerlink" title="vw、vh适配"></a>vw、vh适配</h2><p>vw：Viewport’s width的简写，1vw等于视口宽度的1%<br>vh：Viewport’s height的简写，1vh等于视口高度的1%<br>vmin：取vw和vh中最小的值<br>vmax： 取vw和vh中最大的值<br>vmin 和 vmax 一般很少用到。</p><p>ios 8之前和Android 4.4之前的版本都不支持vw、vh适配，这也是其之前不火的原因，现在设备基本都是很新的系统版本了，除非要考虑很旧的版本的兼容，可以放心使用vw适配。</p><p>1vw浏览器会自动视为视口宽度的1%，其实就和我们手动将视口宽度（设备的宽度）都100列一个道理。</p><p>vw、vh适配一般有两种用法，分别是直接转为vw单位进行使用，另一种是通过vw设置根节点字体大小，页面里的尺寸依然使用rem。</p><h3 id="直接使用vw作为像素单位"><a href="#直接使用vw作为像素单位" class="headerlink" title="直接使用vw作为像素单位"></a>直接使用vw作为像素单位</h3><p>依旧以iPhone（750x1334）为例子，有：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">iphone6</span><br><span class="line"><span class="number">1</span>vw=<span class="number">375</span>/<span class="number">100</span>=<span class="number">3.75</span>px;</span><br><span class="line"></span><br><span class="line">设计稿（<span class="number">750</span>px规格）中要四个盒子平铺一行，则一个div的宽度为<span class="number">187.5</span>px，那么css代码给的px就应该为<span class="number">93.75</span>px, </span><br><span class="line"><span class="number">93.75</span>px/<span class="number">3.75</span>px=<span class="number">25</span>vw</span><br><span class="line">这时候只要给每个div宽度设为<span class="number">25</span>vw就可以实现四个盒子平铺一行，而且做到所有机型都适配</span><br><span class="line"></span><br><span class="line">（iphone6 plus的话则 <span class="number">1</span>vw=<span class="number">414</span>/<span class="number">100</span>=<span class="number">4.14</span>px; 其他机型同理）</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">body &#123;</span></span><br><span class="line"><span class="undefined">margin: 0 auto;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">div &#123;</span></span><br><span class="line"><span class="undefined">float: left;</span></span><br><span class="line"><span class="css"><span class="comment">/* width: 25%; */</span></span></span><br><span class="line"><span class="css"><span class="comment">/* width: 93.75px; */</span></span></span><br><span class="line"><span class="undefined">width: 25vw;</span></span><br><span class="line"><span class="undefined">background-color: red;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这样需要每次都手动去换算px转vm，这个过程很麻烦，我们可以模仿hotcss来通过一个函数来替我们换算，我采用scss预处理器来实现这个函数。</p><p>现在VSCode中安装两个插件Sass和EasySass，安装完成之后，每当我新建一个scss文件修改并保存之后都会自动生成对应的css文件。</p><p>新建index.scss文件：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@function vw(<span class="variable">$px</span>)&#123;</span><br><span class="line">    @return <span class="variable">$px</span> / 750 * 100vw;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: vw(<span class="number">187.5</span>);</span><br><span class="line">    <span class="attribute">background-color</span>: red;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>关键代码就是👇</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* $px是从设计稿量出的大小</span></span><br><span class="line"><span class="comment">* 这个750是默认设计稿是按照750px的物理像素设计的，若是640px的设计稿就换为640即可，其他同理</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">@function vw(<span class="variable">$px</span>)&#123;</span><br><span class="line">    @return <span class="variable">$px</span> / 750 * 100vw;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样，我们直接可以将从750px的设计稿中量出来的宽度187.5放入这个vw函数中，实现类似hotcss那样的便捷的使用。。生成的index.css内容如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">25vw</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: red;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其自动转为了合适的vm。因此随后的所有的宽度都可以使用vm()来进行适配。</p><h3 id="vw设置根节点字体大小，其他使用rem"><a href="#vw设置根节点字体大小，其他使用rem" class="headerlink" title="vw设置根节点字体大小，其他使用rem"></a>vw设置根节点字体大小，其他使用rem</h3><p>相比于前者，这种vw适配方案更加流行。</p><p>在iPhone6（750x1334）为基准的rem适配里，html的fontsize的值设为了50px，具体参见上文中的【JS设置根节点font-size（最优版）】，然后设计稿中量出来多少px，就将小数点前移两位即为对应的多少rem。那么我们可以将50px换为vw，在iPhone6中1vw = 375/100=3.75vw，则50px = 50/3.75=13.333333333333334vw。我们直接将html的fontsize设置为13.333333333333334vw，然后就可以做到所有机型都适配了。如下所示：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">html &#123;</span></span><br><span class="line"><span class="css"><span class="selector-tag">font-size</span>: 13<span class="selector-class">.333333333333334vw</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">body &#123;</span></span><br><span class="line"><span class="undefined">margin: 0 ;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">div &#123;</span></span><br><span class="line"><span class="undefined">float: left;</span></span><br><span class="line"><span class="css"><span class="selector-tag">width</span>: 1<span class="selector-class">.875rem</span>;</span></span><br><span class="line"><span class="undefined">background-color: red;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>相比之下省去了一大段设置html的fontsize大小的JS逻辑代码，更加便捷。</p><h3 id="存在的问题"><a href="#存在的问题" class="headerlink" title="存在的问题"></a>存在的问题</h3><h4 id="字体默认大小过大和图片错位"><a href="#字体默认大小过大和图片错位" class="headerlink" title="字体默认大小过大和图片错位"></a>字体默认大小过大和图片错位</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">html &#123;</span></span><br><span class="line"><span class="css"><span class="selector-tag">font-size</span>: 13<span class="selector-class">.333333333333334vw</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">body &#123;</span></span><br><span class="line"><span class="undefined">margin: 0;</span></span><br><span class="line"><span class="undefined">padding: 0;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">div &#123;</span></span><br><span class="line"><span class="undefined">width: 2rem;</span></span><br><span class="line"><span class="undefined">height: 2rem;</span></span><br><span class="line"><span class="undefined">background-color: red;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>你好<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://pic2.zhimg.com/80/v2-5d01e09f88352f967f5619cf1665c687_720w.png" alt=""></p><p>这时因为html的fontsize设置了大小，导致默认字体大小变大。同时这一设置还会造成图片错位的现象。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">html &#123;</span></span><br><span class="line"><span class="css"><span class="selector-tag">font-size</span>: 13<span class="selector-class">.333333333333334vw</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">body &#123;</span></span><br><span class="line"><span class="undefined">margin: 0;</span></span><br><span class="line"><span class="undefined">padding: 0;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">div &#123;</span></span><br><span class="line"><span class="undefined">width: 2rem;</span></span><br><span class="line"><span class="undefined">height: 2rem;</span></span><br><span class="line"><span class="undefined">background-color: red;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">div img &#123;</span></span><br><span class="line"><span class="css"><span class="selector-tag">width</span>: 0<span class="selector-class">.5rem</span>;</span></span><br><span class="line"><span class="css"><span class="selector-tag">height</span>: 0<span class="selector-class">.5rem</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://sponsor-static.segmentfault.com/169d32a59c16fd2f9aeed64f1face530.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://pic4.zhimg.com/80/v2-427dfc82c26c409f773bbd35bb12fc66_720w.png" alt=""></p><p>如上图所示，我并没有给img设置任何padding、margin或者定位等位置信息，它就是发生了错位。这时因为图片默认相对字体对齐，而我们在html中设置了字体大小是一个会非常大的值，所以图片也因此发生了错位。</p><p>解决办法就是<strong>在body中设置默认的字体大小为12px</strong>；这一就不会有上述的情况发生了。</p>]]></content>
      
      
      <categories>
          
          <category> 移动端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>viewport的设置</title>
      <link href="/2020/03/11/viewport.html"/>
      <url>/2020/03/11/viewport.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>给段简单的代码如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        body &#123;</span></span><br><span class="line"><span class="undefined">            margin: 0;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        div &#123;</span></span><br><span class="line"><span class="undefined">            width: 750px;</span></span><br><span class="line"><span class="undefined">            height: 100px;</span></span><br><span class="line"><span class="undefined">            background: green;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://pic2.zhimg.com/80/v2-c38116919c23f74cd95cda6fd13b0aa0_720w.png" alt=""></p><p>我们知道 iPhone6/7/8 的设备像素为750×1334，其 css 像素为375 × 667。那么上面这段代码给了 div 的宽度为750px，试图使这个div刚好铺满顶部。如果移动端中是以设备像素来显示的话，绿色部分应该铺满整个页面的顶部，如果移动端中式以 css 像素来显示的话，绿色部分不仅铺满了顶部还应该超出来显示滚动条。但是都没有。 </p><p>这是因为在移动端中移动端屏幕的宽度默认为980，但不同的型号也会不同。</p><p>所以上面的例子中，viewport的视口宽度其实是980，而我们设置的宽度为750，故没有铺满。我们可以通过<code>document.documentElement.clientWidth</code>方法获取到viewport的大小。</p><p><strong>若想一个网站在移动端设备网页显示正常，我们必须设置一个正确的viewport的值。viewport的值决定了移动端页面是否正常显示。</strong></p><p>我们可以使用<code>meta</code>标签来设置 viewport 的大小。平时<strong>默认和建议设置为</strong>：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">content</span>=<span class="string">"width=device-width,</span></span></span><br><span class="line"><span class="tag"><span class="string">               initial-scale=1,</span></span></span><br><span class="line"><span class="tag"><span class="string">               minimum-scale=1,</span></span></span><br><span class="line"><span class="tag"><span class="string">               maximum-scale=1,</span></span></span><br><span class="line"><span class="tag"><span class="string">               user-scalable=no"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>content视口里的相关设置:</p><ul><li>width：视口的宽度，值为一个正整数，或字符串device-width（<strong>设备的实际宽度–css像素</strong>，在iPhone6中这个device-width就是375）。不建议设置数字（安卓设备有些不支持）</li><li>height：视口的高度，一般不设置</li><li>user-scalable    是否允许用户进行页面缩放，值为no或yes，代表不允许与允许</li><li>initial-scale    页面初始缩放值，值为一个数字（可以带小数）。initial-scale缩放比=css像素/viewport宽度</li><li>minimum-scale    页面最小能够缩放的比例，值为一个数字（可以带小数）。</li><li>maximum-scale    页面最大能够缩放的比例，值为一个数字（可以带小数）。<br>​                        </li></ul><p>这时候，将div的宽设为375px，就可以刚好铺满顶部了。</p><p>注意：<br>  1、有的时候大家会见到同时写了不允许缩放，又写了最小与最大能够缩放的比例，那这样不是冲突了，为什么都已经写了不允许缩放了，还要写那些？<br>  ​    原因：<br>  ​        1、会有一些第三方的工具能够破坏user-scalable<br>  ​        2、像iphone5下还会有黑边<br>  ​        3、所以写全了，可以避免一些bug<br>  ​        2、ios10不支持user-scalable=no，后面事件解决（阻止document的touchstart的默认行为）<br>  ​                </p>]]></content>
      
      
      <categories>
          
          <category> 移动端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>图片压缩上传</title>
      <link href="/2020/03/10/%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9%E4%B8%8A%E4%BC%A0.html"/>
      <url>/2020/03/10/%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9%E4%B8%8A%E4%BC%A0.html</url>
      
        <content type="html"><![CDATA[<p>之前在做项目的时候经常遇到上传图片的问题，对于太大的图片，如果总时原图上传的话，速度很慢，同时也对服务器造成了较大压力。所以，若非要求原图上传，最好对图片进行一下压缩。</p><p>压缩图片我用的是第三方的工具库<a href="https://www.npmjs.com/package/canvas-resize" target="_blank" rel="noopener">canvas-resize</a>。其基本思路就是将原图片读取到内存，然后利用canvas画布重新画出来一个压缩后的图片。</p><h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br><span class="line">npm run build</span><br></pre></td></tr></table></figure><ul><li>支持AMD, CMD模块化的引入方式</li><li>也可通过外链</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">canvasResize(<span class="keyword">this</span>.files[<span class="number">0</span>], &#123;</span><br><span class="line">    crop: <span class="literal">false</span>,    <span class="comment">// 是否裁剪</span></span><br><span class="line">    quality: <span class="number">0.9</span>,   <span class="comment">// 压缩质量  0 - 1</span></span><br><span class="line">    rotate: <span class="number">0</span>,      <span class="comment">// 旋转角度 </span></span><br><span class="line">    callback(baseStr) &#123;  <span class="comment">//返回的结果是base64格式的图片</span></span><br><span class="line">      <span class="built_in">console</span>.log(baseStr.length)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h2 id="将canvas裁剪之后的base64转换为blob对象格式的上传文件"><a href="#将canvas裁剪之后的base64转换为blob对象格式的上传文件" class="headerlink" title="将canvas裁剪之后的base64转换为blob对象格式的上传文件"></a>将canvas裁剪之后的base64转换为blob对象格式的上传文件</h2><p>这个canvasResize将图片压缩后的格式的base64，然后拿这个base64格式的图片转为blob格式的图片。</p><p>编写一个将以base64的图片url数据转换为Blob的工具👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Utility.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将以base64的图片url数据转换为Blob</span></span><br><span class="line"><span class="comment">     * @param urlData String   用url方式表示的base64图片数据</span></span><br><span class="line"><span class="comment">     * @param type Object &#123; type: "image/png" &#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    convertBase64UrlToBlob(urlData, type) &#123;</span><br><span class="line">        <span class="keyword">var</span> bytes = <span class="built_in">window</span>.atob(urlData.split(<span class="string">','</span>)[<span class="number">1</span>]); <span class="comment">//去掉url的头，并转换为byte</span></span><br><span class="line">        <span class="comment">//处理异常,将ascii码小于0的转换为大于0</span></span><br><span class="line">        <span class="keyword">var</span> ab = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(bytes.length);</span><br><span class="line">        <span class="keyword">var</span> ia = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(ab);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; bytes.length; i++) &#123;</span><br><span class="line">            ia[i] = bytes.charCodeAt(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Blob([ab], type);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>我在sfa-vue项目中曾应用过的例子👇   </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">uploadImg() &#123;</span><br><span class="line">     <span class="comment">// console.log(this.$refs.file.files[0]);</span></span><br><span class="line">     <span class="keyword">let</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">     <span class="comment">// 拿到当前上传的图片</span></span><br><span class="line">     <span class="keyword">let</span> file = <span class="keyword">this</span>.$refs.file.files[<span class="number">0</span>];</span><br><span class="line">     <span class="comment">// 对当前上传的图片file，进行压缩后，callback返回一个base64的字符串</span></span><br><span class="line">     canvasResize(file, &#123;</span><br><span class="line">       crop: <span class="literal">false</span>, <span class="comment">// 裁剪参数</span></span><br><span class="line">       quality: <span class="number">0.7</span>, <span class="comment">// 压缩率， 0-1</span></span><br><span class="line">       rotate: <span class="number">0</span>, <span class="comment">// 是否旋转</span></span><br><span class="line">       callback: <span class="function"><span class="params">baseStr</span> =&gt;</span> &#123;</span><br><span class="line">         <span class="comment">// 返回的base64字符， 转换成Blob</span></span><br><span class="line">         <span class="keyword">let</span> fileBlob = Utility.convertBase64UrlToBlob(baseStr, &#123;</span><br><span class="line">           type: file.type</span><br><span class="line">         &#125;);</span><br><span class="line">         formData.append(<span class="string">"imgF"</span>, fileBlob);</span><br><span class="line">         service</span><br><span class="line">           .uploadImg(formData)</span><br><span class="line">           .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">             <span class="built_in">console</span>.log(res);</span><br><span class="line">             <span class="keyword">this</span>.imgs.push(&#123;</span><br><span class="line">               checked: <span class="literal">false</span>,</span><br><span class="line">               url: <span class="string">`<span class="subst">$&#123;process.env.VUE_APP_BASEURL&#125;</span><span class="subst">$&#123;res.data.img&#125;</span>`</span></span><br><span class="line">             &#125;);</span><br><span class="line">           &#125;)</span><br><span class="line">           .catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">             <span class="built_in">console</span>.log(<span class="string">"上传失败！"</span>);</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>经测试，一张120kb的图片使用压缩之后的图片大小为20kb左右。</p>]]></content>
      
      
      <categories>
          
          <category> 优化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 优化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS像素|物理像素|PPI|像素比</title>
      <link href="/2020/03/10/xiangsu.html"/>
      <url>/2020/03/10/xiangsu.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="物理像素（设备像素）"><a href="#物理像素（设备像素）" class="headerlink" title="物理像素（设备像素）"></a>物理像素（设备像素）</h2><p>物理像素也称为设备像素，指的是屏幕的物理像素，任何设备屏幕的物理像素的数量都是固定不变的，单位是pt（点）。如手机的分辨率，iPhone6分辨率是750x1334，即横向上有750个物理像素，750pt，纵向上有1334个物理像素，1334pt。</p><p>物理像素的值大小是固定的、绝对的。</p><h2 id="CSS像素"><a href="#CSS像素" class="headerlink" title="CSS像素"></a>CSS像素</h2><p>CSS像素又叫设备独立像素、逻辑像素。是CSS中使用的一个抽象的概念，单位是px。</p><p>CSS像素值是相对的，并不是绝对的，css像素是相对于设备像素决定的。这句话是什么意思呢？请往下看。</p><h3 id="一个CSS像素的大小不是固定的"><a href="#一个CSS像素的大小不是固定的" class="headerlink" title="一个CSS像素的大小不是固定的"></a>一个CSS像素的大小不是固定的</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">div &#123;</span></span><br><span class="line"><span class="undefined">background-color: red;</span></span><br><span class="line"><span class="undefined">width: 200px;</span></span><br><span class="line"><span class="undefined">height: 100px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这涉及到DPR像素的知识。</p><p>一般，在PC电脑设备上，一个CSS像素就对应一个设备像素，所以在PC端开发网页的时候，设计稿量出来的尺寸是多少，CSS样式就给多少像素。如下图所示👇</p><p><img src="https://pic3.zhimg.com/v2-31b4920935492efc8fe11ef74e2c695a_r.jpg" alt=""></p><p>但是，当我把浏览器放大两倍的时候，CSS样式依旧是200x100的宽高，但是通过截图软件可以看到这时的div实际的物理像素是400x200了。即，随着浏览器屏幕放大两倍后，<strong>1个CSS像素对应了2个物理像素</strong>。</p><p><img src="https://pic2.zhimg.com/v2-c401abecbad981f9f3dfe5ecbe5088e1_r.jpg" alt=""></p><h2 id="屏幕尺寸"><a href="#屏幕尺寸" class="headerlink" title="屏幕尺寸"></a>屏幕尺寸</h2><p>指的是屏幕对角线的长度，单位为英寸。</p><p>1英寸（inch）=2.54厘米（cm）</p><p><strong>屏幕尺寸 = 屏幕斜边的物理像素 / PPI</strong></p><p><img src="https://pic1.zhimg.com/v2-b699a4655faf10bf26af6bb81dd4f9cc_r.jpg" alt=""></p><h2 id="PPI-像素密度"><a href="#PPI-像素密度" class="headerlink" title="PPI 像素密度"></a>PPI 像素密度</h2><p>像素密度（PPI）指的是  每英寸上像素（设备像素物理像素）的数量，和 屏幕尺寸一样，涉及到的都是物理像素 </p><p>1、PPI的值越高，代表在一定尺寸的屏幕上像素数量越多，屏幕越清晰</p><p>2、它是一个定值，是一个固定的参数</p><p>3、<a href="https://www.sven.de/dpi/" target="_blank" rel="noopener">https://www.sven.de/dpi/</a></p><p>4、PPI=屏幕斜边的物理像素/屏幕尺寸</p><p>5、同一尺寸下，PPI提高了一倍，那像素会提高4倍</p><p><img src="https://pic3.zhimg.com/80/v2-5348d66128987f27c1fc7144abe813f6_720w.jpg" alt=""></p><p><img src="https://pic3.zhimg.com/v2-43b64ba6adb8a44b6eac00d48ac69392_b.png" alt=""></p><p>如果ppi变为原来的2倍，那么单位面积内设备像素会变为原来的4倍，</p><p>如果ppi变为原来的4倍，那么单位面积内设备像素会变为原来的16倍，</p><p>如果ppi变为原来的8倍，那么单位面积内设备像素会变为原来的64倍，</p><p>如果ppi变为原来的n倍，那么单位面积内设备像素会变为原来的n^2倍。</p><p>但是同样的，ppi每变大为原来的n倍，物理像素会增加为原来的n^2倍,同时每个物理像素的大小会缩小为原来的1/(n^2)倍，这就导致了下图的问题，原本在普通屏（30x30）正常显示的图片（分别率30x30）在高清屏（60x60）下缩小了👇</p><p><img src="https://pic4.zhimg.com/v2-63047d207a44511eb7895ac323f7d283_b.jpeg" alt=""></p><p>这时，如果把图片的宽高样式变为原来的两倍大小，图片就可以铺满整个网格了，但是这时候出现了另一个新问题——图片模糊了。怎么解决问题呢？最好的办法就是将图片一开始就做成高分别率的60x60，这样一来，当它在普通屏（30x30）显示的时候会自动缩小，缩小的图片倒更清晰了；当它在高清屏(60x60)显示的时候就正好铺满。</p><h2 id="DPR-像素比"><a href="#DPR-像素比" class="headerlink" title="DPR 像素比"></a>DPR 像素比</h2><p>DPR=物理像素/css像素，即一个CSS像素对应多少个物理像素。</p><p>可以通过<code>window.devicePixelRatio</code> 获取</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iphone6</span><br><span class="line">750 × 1334      设备像素，屏幕分辨率</span><br><span class="line">375 × 667       css像素</span><br><span class="line">2               像素比</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 移动端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动端 </tag>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搜索框封装组件如何也实现v-model同步data中的数据？</title>
      <link href="/2020/03/04/inputcomponentv-model.html"/>
      <url>/2020/03/04/inputcomponentv-model.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>面试的时候遇见过这个问题，在项目中也经常遇到。今天来做一下记录，搜索框封装组件如何也实现v-model同步data中的数据？</p><p>先来理解一下这个问题，首先看看普通的input搜索框的v-model的表现：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h1&gt;测试专用demo&lt;/h1&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; @input=&quot;test&quot; v-model=&quot;q&quot; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      q: &quot;&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    test(e) &#123;</span><br><span class="line">      //   console.log(e.target.value); // 其值实际上和q的值一样</span><br><span class="line">      console.log(this.q);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>上面这段代码执行的时候，当我们在input搜索框中进行输入的时候，都会随之修改<code>data</code>中的数据<code>q</code>，这就是<code>v-model</code>双向数据绑定的结果，非常方便。</p><p>那么当我将input封装进一个组件中，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// src/components/inputdemo.vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>然后引用这个组件，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h1&gt;测试专用demo&lt;/h1&gt;</span><br><span class="line">    &lt;!-- 这样子inputdemo的@input是触发不了的，我额外写了一个button来点击查看q的值 --&gt;</span><br><span class="line">    &lt;inputdemo v-model=&quot;q&quot; @input=&quot;test&quot;&gt;&lt;/inputdemo&gt;</span><br><span class="line">    &lt;button @click=&quot;test&quot;&gt;点击查看q的值&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import inputdemo from &quot;../components/inputdemo&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      q: &quot;&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    inputdemo</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    test() &#123;</span><br><span class="line">      console.log(this.q);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>像这样直接就在组件标签<code>&lt;inputdemo&gt;</code>中使用<code>v-model=&#39;q&#39;</code>企图像原生input那样做到双向数据绑定是不可以的。</p><p>那么应该怎么做才对？</p><ol><li>在inputdemo组件中的props里记录value，必须是value。</li><li>在inputdemo组件的input标签中绑定<code>:value=&quot;value&quot;</code></li><li>在inputdemo组件的input标签中添加事件<code>@input=&quot;$emit(&#39;input&#39;, $event.target.value)&quot;</code>，向调用者emit一个事件称为<code>input</code>，同时将<code>$event.target.value</code>作为参数传过去。</li></ol><p>这样就可以直接在组件标签<code>&lt;inputdemo&gt;</code>中使用<code>v-model=&#39;q&#39;</code>像原生input那样做到双向数据绑定。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// src/components/inputdemo.vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; :value=&quot;value&quot; @input=&quot;$emit(&apos;input&apos;, $event.target.value)&quot; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  props: [&quot;value&quot;],</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>参考文档：<a href="https://cn.vuejs.org/v2/guide/components-custom-events.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6%E7%9A%84-v-model" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/components-custom-events.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6%E7%9A%84-v-model</a></p>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>九、ESLint中用glob模式指定要检测的文件</title>
      <link href="/2020/03/03/ESLint%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B09.html"/>
      <url>/2020/03/03/ESLint%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B09.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>先来看看<a href="https://cn.eslint.org/docs/user-guide/configuring#configuration-based-on-glob-patterns" target="_blank" rel="noopener">官网文档</a>。</p><h2 id="匹配规则"><a href="#匹配规则" class="headerlink" title="匹配规则"></a>匹配规则</h2><p>所谓的 glob 模式是指 shell 所使用的简化了的正则表达式。星号（*）匹配零个或多个任意字符；[abc]匹配任何一个列在方括号中的字符（这个例子要么匹配一个 a，要么匹配一个 b，要么匹配一个 c）；问号（?）只匹配一个任意字符；如果在方括号中使用短划线分隔两个字符，表示所有在这两个字符范围内的都可以匹配（比如 [0-9] 表示匹配所有 0 到 9 的数字）。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">project-root</span><br><span class="line">├── app</span><br><span class="line">│   ├── lib</span><br><span class="line">│   │   ├── foo.js</span><br><span class="line">│   │   ├── fooSpec.js</span><br><span class="line">│   ├── components</span><br><span class="line">│   │   ├── bar.js</span><br><span class="line">│   │   ├── barSpec.js</span><br><span class="line">│   ├── .eslintrc.json</span><br><span class="line">├── server</span><br><span class="line">│   ├── server.js</span><br><span class="line">│   ├── serverSpec.js</span><br><span class="line">├── .eslintrc.json</span><br></pre></td></tr></table></figure><p>在 <code>app/.eslintrc.json</code> 文件中的配置定义了 <code>**/*Spec.js</code> glob 模式。该模式相对于 <code>app/.eslintrc.json</code> 的基准目录。因此，该模式匹配 <code>app/lib/fooSpec.js</code> 和 <code>app/components/barSpec.js</code>，但 <strong>不匹配</strong> <code>server/serverSpec.js</code>。如果你在项目根目录的 <code>.eslintrc.json</code> 文件中定义相同的模式，它将匹配所有三个 <code>*Spec</code> 文件。</p><h2 id="测试案例"><a href="#测试案例" class="headerlink" title="测试案例"></a>测试案例</h2><p><img src="https://pic3.zhimg.com/v2-1ab8e7cb630e32b155da71b0c65de0ba_r.jpg" alt=""></p><p><a href="https://pic3.zhimg.com/v2-1ab8e7cb630e32b155da71b0c65de0ba_r.jpg" target="_blank" rel="noopener">点击查看大图</a></p><p>在配置中使用 <code>overrides</code> 键进行glob的配置。</p><p>上图中<code>&#39;*.test.js&#39;</code>匹配到的文件有：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- app\components\button.test.js</span><br><span class="line">- app\lib\util.test.js</span><br></pre></td></tr></table></figure><p><code>&#39;test/**/*.js&#39;</code>匹配到的文件有：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- test\index.js</span><br><span class="line">- test\util\util.js</span><br></pre></td></tr></table></figure><p>excludedFiles键表示哪些匹配中的文件例外，<code>&#39;test/*/*.js&#39;</code>匹配到的文件是test\util\util.js，所以最终启用单引号规则的文件只有三个：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- app\components\button.test.js</span><br><span class="line">- app\lib\util.test.js</span><br><span class="line">- test\index.js</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ESLint </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ESLint </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>八、ESLint的extends和plugins</title>
      <link href="/2020/03/03/ESLint%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B08.html"/>
      <url>/2020/03/03/ESLint%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B08.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="extends属性介绍"><a href="#extends属性介绍" class="headerlink" title="extends属性介绍"></a>extends属性介绍</h2><p><code>extends</code> 属性值可以是：</p><ul><li>指定配置的字符串(配置文件的路径、可共享配置的名称、<code>eslint:recommended</code> 或 <code>eslint:all</code>)</li><li>字符串数组：每个配置继承它前面的配置</li></ul><p>ESLint递归地扩展配置，因此基本配置也可以具有 <code>extends</code> 属性。<code>extends</code> 属性中的相对路径和可共享配置名从配置文件中出现的位置解析。</p><p><code>rules</code> 属性可以做下面的任何事情以扩展（或覆盖）规则：</p><ul><li>启用额外的规则</li><li>改变继承的规则级别而不改变它的选项：<ul><li>基础配置：<code>&quot;eqeqeq&quot;: [&quot;error&quot;, &quot;allow-null&quot;]</code></li><li>派生的配置：<code>&quot;eqeqeq&quot;: &quot;warn&quot;</code></li><li>最后生成的配置：<code>&quot;eqeqeq&quot;: [&quot;warn&quot;, &quot;allow-null&quot;]</code></li></ul></li><li>覆盖基础配置中的规则的选项<ul><li>基础配置：<code>&quot;quotes&quot;: [&quot;error&quot;, &quot;single&quot;, &quot;avoid-escape&quot;]</code></li><li>派生的配置：<code>&quot;quotes&quot;: [&quot;error&quot;, &quot;single&quot;]</code></li><li>最后生成的配置：<code>&quot;quotes&quot;: [&quot;error&quot;, &quot;single&quot;]</code></li></ul></li></ul><h2 id="使用-quot-eslint-recommended-quot"><a href="#使用-quot-eslint-recommended-quot" class="headerlink" title="使用 &quot;eslint:recommended&quot;"></a>使用 <code>&quot;eslint:recommended&quot;</code></h2><p>值为 <code>&quot;eslint:recommended&quot;</code> 的 <code>extends</code> 属性启用一系列核心规则，这些规则报告一些常见问题，在 <a href="https://cn.eslint.org/docs/rules/" target="_blank" rel="noopener">规则页面</a> 中被标记为  。这个推荐的子集只能在 ESLint 主要版本进行更新。</p><p>如果你的配置集成了推荐的规则：在你升级到 ESLint 新的主版本之后，在你使用<a href="https://cn.eslint.org/docs/user-guide/command-line-interface#fix" target="_blank" rel="noopener">命令行</a>的 <code>--fix</code> 选项之前，检查一下报告的问题，这样你就知道一个新的可修复的推荐的规则将更改代码。</p><p><code>eslint --init</code> 命令可以创建一个配置，这样你就可以继承推荐的规则。</p><p>JavaScript 格式的一个配置文件的例子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="string">"extends"</span>: <span class="string">"eslint:recommended"</span>,</span><br><span class="line">    <span class="string">"rules"</span>: &#123;</span><br><span class="line">        <span class="comment">// enable additional rules</span></span><br><span class="line">        <span class="string">"indent"</span>: [<span class="string">"error"</span>, <span class="number">4</span>],</span><br><span class="line">        <span class="string">"linebreak-style"</span>: [<span class="string">"error"</span>, <span class="string">"unix"</span>],</span><br><span class="line">        <span class="string">"quotes"</span>: [<span class="string">"error"</span>, <span class="string">"double"</span>],</span><br><span class="line">        <span class="string">"semi"</span>: [<span class="string">"error"</span>, <span class="string">"always"</span>],</span><br><span class="line"></span><br><span class="line">        <span class="comment">// override default options for rules from base configurations</span></span><br><span class="line">        <span class="string">"comma-dangle"</span>: [<span class="string">"error"</span>, <span class="string">"always"</span>],</span><br><span class="line">        <span class="string">"no-cond-assign"</span>: [<span class="string">"error"</span>, <span class="string">"always"</span>],</span><br><span class="line"></span><br><span class="line">        <span class="comment">// disable rules from base configurations</span></span><br><span class="line">        <span class="string">"no-console"</span>: <span class="string">"off"</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="extends和plugins的区别"><a href="#extends和plugins的区别" class="headerlink" title="extends和plugins的区别"></a>extends和plugins的区别</h2><p>extends是针对rules做的规则说明,一般对js来说。而plugin不仅仅可以 对js做扩展，又可以 对除了js之外的做扩展，比如下文提到的react这种的。</p><h2 id="extends使用plugins中的配置"><a href="#extends使用plugins中的配置" class="headerlink" title="extends使用plugins中的配置"></a>extends使用plugins中的配置</h2><p><a href="https://cn.eslint.org/docs/developer-guide/working-with-plugins" target="_blank" rel="noopener">插件</a> 是一个 npm 包，通常输出规则。一些插件也可以输出一个或多个命名的 <a href="https://cn.eslint.org/docs/developer-guide/working-with-plugins#configs-in-plugins" target="_blank" rel="noopener">配置</a>。要确保这个包安装在 ESLint 能请求到的目录下。</p><p><code>plugins</code> <a href="https://cn.eslint.org/docs/user-guide/configuring#configuring-plugins" target="_blank" rel="noopener">属性值</a> 可以省略包名的前缀 <code>eslint-plugin-</code>。</p><p><code>extends</code> 属性值可以由以下组成：</p><ul><li><code>plugin:</code></li><li>包名 (省略了前缀，比如，<code>react</code>)</li><li><code>/</code></li><li>配置名称 (比如 <code>recommended</code>)</li></ul><p>JSON 格式的一个配置文件的例子：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"plugins"</span>: [</span><br><span class="line">        <span class="string">"react"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"extends"</span>: [</span><br><span class="line">        <span class="string">"eslint:recommended"</span>,</span><br><span class="line">        <span class="string">"plugin:react/recommended"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"rules"</span>: &#123;</span><br><span class="line">       <span class="attr">"no-set-state"</span>: <span class="string">"off"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="建立测试项目"><a href="#建立测试项目" class="headerlink" title="建立测试项目"></a>建立测试项目</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir lesson11</span><br><span class="line">$ cd lesson11</span><br><span class="line">$ yarn init -y&amp;&amp;yarn add -D eslint</span><br><span class="line">$ mkdir demo01</span><br><span class="line">$ cd demo01</span><br></pre></td></tr></table></figure><p>进行初始化，<code>npx eslint --init</code>，这次选择了react框架，所以也要<code>yarn add react react-dom</code>安装一下react。</p><p><img src="https://pic3.zhimg.com/v2-8eb637d959dbd6dc2b5ead56d2fa1852_r.jpg" alt=""></p><p>👆注意这里就安装了一个eslint-plugin-react插件。</p><p>看一下配置文件eslintrc.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="string">"env"</span>: &#123;</span><br><span class="line">        <span class="string">"browser"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"es6"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"extends"</span>: [</span><br><span class="line">        <span class="string">"eslint:recommended"</span>,</span><br><span class="line">        <span class="string">"plugin:react/recommended"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"globals"</span>: &#123;</span><br><span class="line">        <span class="string">"Atomics"</span>: <span class="string">"readonly"</span>,</span><br><span class="line">        <span class="string">"SharedArrayBuffer"</span>: <span class="string">"readonly"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"parserOptions"</span>: &#123;</span><br><span class="line">        <span class="string">"ecmaFeatures"</span>: &#123;</span><br><span class="line">            <span class="string">"jsx"</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"ecmaVersion"</span>: <span class="number">2018</span>,</span><br><span class="line">        <span class="string">"sourceType"</span>: <span class="string">"module"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"plugins"</span>: [</span><br><span class="line">        <span class="string">"react"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"rules"</span>: &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>看看这个eslintrc.js文件中的：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">"plugins": [</span><br><span class="line">    <span class="string">"react"</span></span><br><span class="line">],</span><br><span class="line">"extends": [</span><br><span class="line">    "eslint:recommended",</span><br><span class="line">    <span class="string">"plugin:react/recommended"</span></span><br><span class="line">],</span><br></pre></td></tr></table></figure><p>这样就是extends使用了插件plugins中的配置。<code>plugins</code> <a href="https://cn.eslint.org/docs/user-guide/configuring#configuring-plugins" target="_blank" rel="noopener">属性值</a> 可以省略包名的前缀 <code>eslint-plugin-</code>。</p><p>新建一个文件/src/app.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDom <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"></span><br><span class="line">ReactDom.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>))</span><br></pre></td></tr></table></figure><p>这段代码引用了react但是并没有使用该React变量。用<code>npx eslint ./src</code>进行检测，不会报错。但是如果将extends属性中的”plugin:react/recommended”删去，再进行eslint检测，就会发现报错了<strong>error  ‘React’ is defined but never used  no-unused-vars</strong>。</p><p>这就是<strong>extends使用了插件plugins中的配置</strong>所达到效果的一个小栗子。</p>]]></content>
      
      
      <categories>
          
          <category> ESLint </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ESLint </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>七、理解ESLint中的globals</title>
      <link href="/2020/03/02/ESLint%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B07.html"/>
      <url>/2020/03/02/ESLint%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B07.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>关于eslint的配置文件中的env，先来看一下<a href="https://cn.eslint.org/docs/user-guide/configuring#specifying-globals" target="_blank" rel="noopener">官方文档</a>。</p><p>新建测试项目，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir lesson07</span><br><span class="line">$ cd lesson07</span><br><span class="line">$ yarn init -y&amp;&amp;yarn add -D eslint</span><br></pre></td></tr></table></figure><p>同样的进行初始化，<code>npx eslint --init</code>。</p><p>新建一个文件/src/index.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(serverData);</span><br></pre></td></tr></table></figure><p>然后<code>npx eslint ./src</code>进行eslint检测，报错<strong>error  ‘serverData’ is not defined  no-undef</strong>。当访问当前源文件内未定义的变量时，<a href="https://cn.eslint.org/docs/rules/no-undef" target="_blank" rel="noopener">no-undef</a> 规则将发出警告。如果你想在一个源文件里使用全局变量，推荐你在 ESLint 中定义这些全局变量，这样 ESLint 就不会发出警告了。你可以使用注释或在配置文件中定义全局变量。</p><h2 id="注释定义globals"><a href="#注释定义globals" class="headerlink" title="注释定义globals"></a>注释定义globals</h2><p>直接在代码最上方使用注释，如下所示👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* global serverData */</span></span><br><span class="line"><span class="built_in">console</span>.log(serverData);</span><br></pre></td></tr></table></figure><p>这样是只读的，代码中serverData不能被修改，会报错<strong>error  Read-only global ‘serverData’ should not be modified  no-global-assign</strong>。若想要serverData可以被修改，则如下所示👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* global serverData: writable */</span></span><br><span class="line">serverData = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.log(serverData);</span><br></pre></td></tr></table></figure><h2 id="eslintrc配置文件定义globals"><a href="#eslintrc配置文件定义globals" class="headerlink" title="eslintrc配置文件定义globals"></a>eslintrc配置文件定义globals</h2><p>注释定义globals不适合大型项目开发，文件多的情况下不适用，宜直接在eslintrc配置文件中定义。</p><p>要在配置文件中配置全局变量，请将 <code>globals</code> 配置属性设置为一个对象，该对象包含以你希望使用的每个全局变量。对于每个全局变量键，将对应的值设置为 <code>&quot;writable&quot;</code> 以允许重写变量，或 <code>&quot;readonly&quot;</code> 不允许重写变量。</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">"globals": &#123;</span><br><span class="line">    "serverData": "writable",</span><br><span class="line">    "Atomics": "readonly",</span><br><span class="line">    "SharedArrayBuffer": "readonly"</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ESLint </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ESLint </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>六、理解ESLint中的env</title>
      <link href="/2020/03/02/ESLint%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B06.html"/>
      <url>/2020/03/02/ESLint%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B06.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>关于eslint的配置文件中的env，先来看一下<a href="https://cn.eslint.org/docs/user-guide/configuring#specifying-environments" target="_blank" rel="noopener">官方文档</a>。</p><h2 id="env中的browser和node"><a href="#env中的browser和node" class="headerlink" title="env中的browser和node"></a>env中的browser和node</h2><p>新建测试项目，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir lesson03</span><br><span class="line">$ cd lesson03</span><br><span class="line">$ yarn init -y&amp;&amp;yarn add -D eslint</span><br></pre></td></tr></table></figure><p>同样的进行初始化，<code>npx eslint --init</code>并只选定browser环境。</p><p>在eslintrc.json文件中可以看到：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">"env": &#123;</span><br><span class="line">    "browser": true,</span><br><span class="line">    "es6": true</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>接下来我新建一个文件/src/index.js，内容如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.version = <span class="string">'0.0.1'</span>;</span><br></pre></td></tr></table></figure><p>就是这么简单一行代码，然后用eslint来检测一下，执行<code>npx eslint ./src</code>可以看到，并没有报错。</p><p>然后我把代码改为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">global.version = <span class="string">'0.0.1'</span>;</span><br></pre></td></tr></table></figure><p>在执行<code>npx eslint ./src</code>可以看到，报错了，提示  <strong>error  ‘global’ is not defined  no-undef</strong>，因为在浏览器中，是没有global这个全局变量的只有window，global变量是node环境里的。</p><p>那么我手动改写一下eslintrc.json，添加上<code>&quot;node&quot;: true,</code>：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">"env": &#123;</span><br><span class="line">    "browser": true,</span><br><span class="line">    "node": true,</span><br><span class="line">    "es6": true</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>这时候再进行eslint的检测就不会出现报错了，因为eslint配置中已经支持了浏览器环境和node环境。</p><p>类似的我们可以在env中配置<code>jquery</code> 、<code>mongo</code> 等环境。</p>]]></content>
      
      
      <categories>
          
          <category> ESLint </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ESLint </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>五、文件中配置ESLint的方式</title>
      <link href="/2020/03/02/ESLint%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B05.html"/>
      <url>/2020/03/02/ESLint%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B05.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="eslintrc文件的三种格式"><a href="#eslintrc文件的三种格式" class="headerlink" title="eslintrc文件的三种格式"></a>eslintrc文件的三种格式</h2><p>之前我们在学习eslint的时候，每次执行完命令<code>npx eslint --init</code>后都会在项目中生成一个eslint的配置文件，它可以是json格式，也可以是js格式，也可以是yml文件格式。</p><p><img src="https://pic2.zhimg.com/80/v2-2da2460879e4683a7fac713d39c6586d_720w.jpg" alt=""></p><p>三种格式如下👇</p><p><img src="https://pic3.zhimg.com/v2-bd2c903e3b5889d5d96417a597b6cf46_r.jpg" alt=""></p><p><a href="https://pic3.zhimg.com/v2-bd2c903e3b5889d5d96417a597b6cf46_r.jpg" target="_blank" rel="noopener">（点击查看大图）</a></p><h2 id="在package-json文件中配置"><a href="#在package-json文件中配置" class="headerlink" title="在package.json文件中配置"></a>在package.json文件中配置</h2><p>除了使用eslintrc文件进行配置，还可以直接在package.json文件中进行配置：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"lesson06"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"MIT"</span>,</span><br><span class="line">  <span class="attr">"eslintConfig"</span>: &#123;</span><br><span class="line">    <span class="attr">"env"</span>: &#123;</span><br><span class="line">      <span class="attr">"es6"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">"node"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"extends"</span>: <span class="string">"eslint:recommended"</span>,</span><br><span class="line">    <span class="attr">"globals"</span>: &#123;</span><br><span class="line">      <span class="attr">"Atomics"</span>: <span class="string">"readonly"</span>,</span><br><span class="line">      <span class="attr">"SharedArrayBuffer"</span>: <span class="string">"readonly"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"parserOptions"</span>: &#123;</span><br><span class="line">      <span class="attr">"ecmaVersion"</span>: <span class="number">2018</span>,</span><br><span class="line">      <span class="attr">"sourceType"</span>: <span class="string">"module"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"rules"</span>: &#123;</span><br><span class="line">      <span class="attr">"no-console"</span>: <span class="string">"warn"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"eslint"</span>: <span class="string">"^6.8.0"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实际上就是吧eslintrc.json中的内容复制粘贴到package.json的<code>eslintConfig</code>属性中。这样就OK了。</p><h2 id="使用注释语法来配置"><a href="#使用注释语法来配置" class="headerlink" title="使用注释语法来配置"></a>使用注释语法来配置</h2><p><a href="https://cn.eslint.org/docs/user-guide/configuring#using-configuration-comments" target="_blank" rel="noopener">https://cn.eslint.org/docs/user-guide/configuring#using-configuration-comments</a></p><p>main.js:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint no-console:off, no-extra-semi: warn */</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">666</span>);</span><br></pre></td></tr></table></figure><p>就像这样在代码最上方用注释的方法进行eslint的规则设置。</p><p>这种方法只对当前文件有效。这是优先级最高的配置方法。</p><p>以上就是五种配置ESLint的方式。</p>]]></content>
      
      
      <categories>
          
          <category> ESLint </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ESLint </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>四、ESLint的层叠配置</title>
      <link href="/2020/03/02/ESLint%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B04.html"/>
      <url>/2020/03/02/ESLint%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B04.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>所谓的层叠配置就是为不同文件夹(目录)配置不同的规则。<a href="https://cn.eslint.org/docs/user-guide/configuring#configuration-cascading-and-hierarchy" target="_blank" rel="noopener">官网文档</a></p><h2 id="层叠配置"><a href="#层叠配置" class="headerlink" title="层叠配置"></a>层叠配置</h2><p>当使用 <code>.eslintrc.*</code> 和 <code>package.json</code>文件的配置时，你可以利用层叠配置。例如，假如你有以下结构：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">your-project</span><br><span class="line">├── .eslintrc</span><br><span class="line">├── lib</span><br><span class="line">│ └── source.js</span><br><span class="line">└─┬ tests</span><br><span class="line">  ├── .eslintrc</span><br><span class="line">  └── test.js</span><br></pre></td></tr></table></figure><p>层叠配置使用离要检测的文件最近的 <code>.eslintrc</code>文件作为最高优先级，然后才是父目录里的配置文件，等等。当你在这个项目中允许 ESLint 时，<code>lib/</code> 下面的所有文件将使用项目根目录里的 <code>.eslintrc</code> 文件作为它的配置文件。当 ESLint 遍历到 <code>test/</code> 目录，<code>your-project/.eslintrc</code> 之外，它还会用到 <code>your-project/tests/.eslintrc</code>。所以 <code>your-project/tests/test.js</code> 是基于它的目录层次结构中的两个<code>.eslintrc</code> 文件的组合，并且离的最近的一个优先。通过这种方式，你可以有项目级 ESLint 设置，也有覆盖特定目录的 ESLint 设置。</p><p>同样的，如果在根目录的 <code>package.json</code> 文件中有一个 <code>eslintConfig</code> 字段，其中的配置将使用于所有子目录，但是当 <code>tests</code> 目录下的 <code>.eslintrc</code> 文件中的规则与之发生冲突时，就会覆盖它。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">your-project</span><br><span class="line">├── package.json</span><br><span class="line">├── lib</span><br><span class="line">│ └── source.js</span><br><span class="line">└─┬ tests</span><br><span class="line">  ├── .eslintrc</span><br><span class="line">  └── test.js</span><br></pre></td></tr></table></figure><p>如果同一目录下 <code>.eslintrc</code> 和 <code>package.json</code> 同时存在，<code>.eslintrc</code> 优先级高会被使用，<code>package.json</code> 文件将不会被使用。</p><p><strong>注意：</strong>如果在你的主目录下有一个自定义的配置文件 (<code>~/.eslintrc</code>) ，如果没有其它配置文件时它才会被使用。因为个人配置将适用于用户目录下的所有目录和文件，包括第三方的代码，当 ESLint 运行时可能会导致问题。</p><h2 id="建立测试项目"><a href="#建立测试项目" class="headerlink" title="建立测试项目"></a>建立测试项目</h2><p>今天来好好学学ESLint的配置文件及其信息。</p><p>老样子，先建立项目：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir lesson05</span><br><span class="line">$ cd lesson05</span><br><span class="line">$ yarn init -y&amp;&amp;yarn add -D eslint  </span><br><span class="line">$ npx eslint --init</span><br></pre></td></tr></table></figure><p>然后项目树状图如下👇</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">│  .eslintrc.json</span><br><span class="line">└─src</span><br><span class="line">    │  main.js</span><br><span class="line">    │  </span><br><span class="line">    ├─lib</span><br><span class="line">    │      .eslintrc.json</span><br><span class="line">    │      lib.util.js</span><br><span class="line">    │      </span><br><span class="line">    └─test</span><br><span class="line">            .eslintrc.json</span><br><span class="line">            test.util.js</span><br></pre></td></tr></table></figure><p>main.js文件、lib.util.js文件和test.util.js文件都使用了<code>console.log</code>语句，但是本项目中的三个eslint配置文件分别对<code>no-console</code>启用了不同的规则：</p><ul><li>.eslintrc.json：             “no-console”: “error”</li><li>src\lib.eslintrc.json：  “no-console”: “warn”</li><li>src\test.eslintrc.json：”no-console”: “off”</li></ul><p>执行命令<code>npx eslint ./src</code>，结果如下👇</p><p><img src="https://pic1.zhimg.com/v2-18163618077369a65e406040af4451dc_r.jpg" alt=""></p><p>三个文件都使用了<code>console</code>语句，但是只有一个error，一个warning。正式因为这种eslint的层叠配置起了作用。</p>]]></content>
      
      
      <categories>
          
          <category> ESLint </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ESLint </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>三、理解ESLint的rules</title>
      <link href="/2020/03/02/ESLint%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03.html"/>
      <url>/2020/03/02/ESLint%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>关于eslint的配置文件中的rules，先来看一下<a href="https://cn.eslint.org/docs/rules/" target="_blank" rel="noopener">官方文档</a>，这里面详尽的记录了所有的规则。这些规则是怎么起作用的？遇到报错信息应该如何解决？</p><h2 id="建立测试项目"><a href="#建立测试项目" class="headerlink" title="建立测试项目"></a>建立测试项目</h2><p>老样子，先建立项目：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir lesson04</span><br><span class="line">$ cd lesson04</span><br><span class="line">$ yarn init -y&amp;&amp;yarn add -D eslint</span><br></pre></td></tr></table></figure><p>同样的进行初始化，<code>npx eslint --init</code></p><p><img src="https://pic2.zhimg.com/v2-e2b9e9850eb804c8362098285a229351_r.jpg" alt=""></p><p>这次的配置比之前两次的多了些。可以看到package.json多了好几个依赖，顺便配置一些script👇</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"lesson04"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"MIT"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"eslint"</span>: <span class="string">"eslint ./src"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"eslint"</span>: <span class="string">"^6.8.0"</span>,</span><br><span class="line">    <span class="attr">"eslint-config-standard"</span>: <span class="string">"^14.1.0"</span>,</span><br><span class="line">    <span class="attr">"eslint-plugin-import"</span>: <span class="string">"^2.20.1"</span>,</span><br><span class="line">    <span class="attr">"eslint-plugin-node"</span>: <span class="string">"^11.0.0"</span>,</span><br><span class="line">    <span class="attr">"eslint-plugin-promise"</span>: <span class="string">"^4.2.1"</span>,</span><br><span class="line">    <span class="attr">"eslint-plugin-standard"</span>: <span class="string">"^4.0.1"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ESLint配置信息"><a href="#ESLint配置信息" class="headerlink" title="ESLint配置信息"></a>ESLint配置信息</h2><p>eslint的配置信息在init的时候可以选择以什么格式保存，可以是js文件也可以是json文件还可以是yaml文件。这次我选了json文件，于是会生成.eslintrc.json。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"env"</span>: &#123;</span><br><span class="line">        <span class="attr">"browser"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"es6"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"node"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"extends"</span>: [</span><br><span class="line">        <span class="string">"standard"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"globals"</span>: &#123;</span><br><span class="line">        <span class="attr">"Atomics"</span>: <span class="string">"readonly"</span>,</span><br><span class="line">        <span class="attr">"SharedArrayBuffer"</span>: <span class="string">"readonly"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"parserOptions"</span>: &#123;</span><br><span class="line">        <span class="attr">"ecmaVersion"</span>: <span class="number">2018</span>,</span><br><span class="line">        <span class="attr">"sourceType"</span>: <span class="string">"module"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"rules"</span>: &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://cn.eslint.org/docs/user-guide/configuring" target="_blank" rel="noopener">官网配置</a>有个大概的说明：</p><ul><li><strong>Environments</strong> - 指定脚本的运行环境。每种环境都有一组特定的预定义全局变量。</li><li><strong>Globals</strong> - 脚本在执行期间访问的额外的全局变量。</li><li><strong>Rules</strong> - 启用的规则及其各自的错误级别。比如”no-console”: “off”</li></ul><h2 id="建立测试代码"><a href="#建立测试代码" class="headerlink" title="建立测试代码"></a>建立测试代码</h2><p>新建/src/test.js测试文件，代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"hello world"</span>);</span><br></pre></td></tr></table></figure><p>执行命令<code>yarn eslint</code>，发现一下子报了三个ERROR👇</p><p><img src="https://pic4.zhimg.com/v2-b56cd2dcd030eb39c3594e4f693d0e47_r.jpg" alt=""></p><ul><li>错误一：字符串必须使用单引号</li><li>错误二：多余的分号  （这家伙走简洁风格的，不加分号）</li><li>错误三：代码最后必须多出一行空行  （真的很严格）</li></ul><h3 id="遵循规则"><a href="#遵循规则" class="headerlink" title="遵循规则"></a>遵循规则</h3><p>行，那就改呗👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'hello world'</span>)</span><br></pre></td></tr></table></figure><p>这样就不报错了，ESLint真的很严格。</p><p>这样手动去修改太麻烦了，可以使用<a href="https://cn.eslint.org/docs/user-guide/command-line-interface#fixing-problems" target="_blank" rel="noopener">命令行</a>的 <code>--fix</code> 选项用来自动修复规则所报告的问题👇</p><p>命令行<code>yarn eslint --fix</code>，执行之后，ESLint会自动帮我们修改好代码，就不会报错了。</p><h3 id="关闭规则"><a href="#关闭规则" class="headerlink" title="关闭规则"></a>关闭规则</h3><p>上面的代码例子报了三个错误，我们除了按照它的规则去修改代码，还可以关闭其规则，在eslint配置文件中的rules里进行配置。</p><p>在来看一遍报错信息👇</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1:13  error  Strings must use singlequote                   quotes</span><br><span class="line">1:27  error  Extra semicolon                                semi</span><br><span class="line">1:28  error  Newline required at end of file but not found  eol-last</span><br></pre></td></tr></table></figure><p>quotes、semi、eol-last都设置为off就可以关闭这些规则了：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">"rules": &#123;</span><br><span class="line">    "space-before-function-paren": "off",</span><br><span class="line">    "eol-last": "off",</span><br><span class="line">    "quotes": "off",</span><br><span class="line">    "semi": "off"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>之后再运行代码就不会报错了。</p><p>以上就是rules的大致用法，更多的rules详见官网，如果想配置一个团队使用的rules，就一定要对其非常熟悉，否则的话使用recommended的rules就够用了。</p>]]></content>
      
      
      <categories>
          
          <category> ESLint </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ESLint </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>二、ESLint的console报错是怎么回事？</title>
      <link href="/2020/03/01/ESLint%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02.html"/>
      <url>/2020/03/01/ESLint%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="console报错"><a href="#console报错" class="headerlink" title="console报错"></a>console报错</h2><p>事实上在新版本中已经不存在了，但对于初学者来说是很常见的而且会觉得很奇怪（如果使用的是较早版本），同时这个问题解决起来也非常之容易，所以我们还是来说一下这个问题，以此为契机展开对eslint配置的学习。</p><p><img src="https://pic1.zhimg.com/v2-69b1f00cbb690f5cbfd23c5ff1ebb08c_r.jpg" alt=""></p><p>​                        (在新版本中no-console已经被取消默认了)</p><p>先建立项目：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir lesson03</span><br><span class="line">$ cd lesson03</span><br><span class="line">$ yarn init -y&amp;&amp;yarn add -D eslint</span><br></pre></td></tr></table></figure><p>同样的进行初始化，<code>npx eslint --init</code></p><p>这次配置文件我选择用json格式。</p><p>很多时候我们使用eslint会报<code>console</code>有错误。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/test.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">123</span>)</span><br></pre></td></tr></table></figure><p><img src="https://pic2.zhimg.com/v2-776898592ed6e8c2cb89cbb21883d94d_r.jpg" alt=""></p><p>这究竟是怎么回事？</p><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>原因是eslint的配置中使用的是<code>&quot;extends&quot;: &quot;eslint:recommended&quot;,</code>的推荐配置，它会默认console语句报错。怎么办？</p><p>修改规则，添加<code>&quot;no-console&quot;: &quot;off&quot;</code>即可👇</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"env"</span>: &#123;</span><br><span class="line">        <span class="attr">"browser"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"es6"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"node"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"extends"</span>: <span class="string">"eslint:recommended"</span>,</span><br><span class="line">    <span class="attr">"globals"</span>: &#123;</span><br><span class="line">        <span class="attr">"Atomics"</span>: <span class="string">"readonly"</span>,</span><br><span class="line">        <span class="attr">"SharedArrayBuffer"</span>: <span class="string">"readonly"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"parserOptions"</span>: &#123;</span><br><span class="line">        <span class="attr">"ecmaVersion"</span>: <span class="number">2018</span>,</span><br><span class="line">        <span class="attr">"sourceType"</span>: <span class="string">"module"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"rules"</span>: &#123;</span><br><span class="line">        <span class="attr">"no-console"</span>: <span class="string">"off"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>之后再<code>npx eslint ./src/test.js</code>就不会报错了。</p><h2 id="ESlint检测整个项目"><a href="#ESlint检测整个项目" class="headerlink" title="ESlint检测整个项目"></a>ESlint检测整个项目</h2><p>这部分和上面讲的console报错就没关系了，我借个楼插个队。</p><p>我们要检测一个js文件就要使用命令<code>npx eslint ./src/xxx.js</code>来进行检测，如果要检测src下的文件夹components下的文件index.js，这条指令就变成了<code>npx eslint ./src/components/index.js</code>，这很麻烦。</p><p>能不能使用<code>npx eslint ./src/*.js</code>来企图检测src下的所有文件？不行，这条命令只能检测到src下一层的所有js文件，<code>./src/components/index.js</code>处于src的下一层的下一层，检测不到。</p><p><strong>我们可以直接使用命令<code>npx eslint ./src</code>来检测，这样就能检测到src下的所有层级的所有js文件了。</strong></p><p>同样的，可以将该命令配置在package.json：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"lesson03"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="string">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="string">"license"</span>: <span class="string">"MIT"</span>,</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"eslint"</span>: <span class="string">"eslint ./src"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"eslint"</span>: <span class="string">"^6.8.0"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://pic1.zhimg.com/80/v2-285ae5bd6d1df7aadaa9db1f19297460_720w.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> ESLint </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ESLint </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一、ESLint学习之初试</title>
      <link href="/2020/03/01/ESLint%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html"/>
      <url>/2020/03/01/ESLint%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>中文官网：<a href="http://eslint.cn/" target="_blank" rel="noopener">http://eslint.cn/</a></p><p>ESLint 是一个开源的 JavaScript 代码检查工具，由 Nicholas C. Zakas 于<strong>2013年</strong>6月创建。</p><p>JavaScript 是一个动态的弱类型语言，在开发中比较容易出错。因为没有编译程序，为了寻找 JavaScript 代码错误通常需要在执行过程中不断调试。<strong>像 ESLint可以让程序员在编码的过程中发现问题而不是在执行的过程中。</strong></p><p>ESLint 使用 Node.js 编写。</p><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul><li>ESLint 的所有规则都被设计成可拔插的，可以开启或关闭（没有什么可以被认为“太重要所以不能关闭”）。</li><li>你可以在使用过程中自定义规则。</li><li>每条规则都可以将结果设置成警告或者错误。</li><li>通过丰富文档减少沟通成本</li></ul><p>参考：<a href="http://eslint.cn/docs/about/" target="_blank" rel="noopener">http://eslint.cn/docs/about/</a></p><h2 id="第一个ESLint的配置"><a href="#第一个ESLint的配置" class="headerlink" title="第一个ESLint的配置"></a>第一个ESLint的配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir lesson02</span><br><span class="line">$ cd lesson02</span><br><span class="line">$ yarn init -y  //选择yarn包管理进行项目初始化，你当然也可以使用npm</span><br><span class="line">$ yarn add -D eslint  // 安装</span><br><span class="line">$ npx eslint  //可以查看所有的指令</span><br></pre></td></tr></table></figure><p>运行命令<code>npx eslint --init</code>，（注意，使用win命令行执行，用git bash会报错）进行运行配置初始化向导。你最好是使用<code>npx</code>，否则的话你要这样做：<code>$ ./node_modules/eslint/bin/eslint.js</code>，这样就非常麻烦。使用npx可以很方便的做到，关于npx的更多用法详见<a href="https://www.ruanyifeng.com/blog/2019/02/npx.html" target="_blank" rel="noopener">阮一峰npx</a>。</p><p>之后进行一些初始化的配置👇</p><p><img src="https://pic4.zhimg.com/v2-ae1cf63de62df067fdd9ffcd62297163_r.jpg" alt=""></p><p>完成之后会多出来一个.eslintc.js文件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="string">"env"</span>: &#123;</span><br><span class="line">        <span class="string">"browser"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"es6"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"node"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"extends"</span>: <span class="string">"eslint:recommended"</span>,</span><br><span class="line">    <span class="string">"globals"</span>: &#123;</span><br><span class="line">        <span class="string">"Atomics"</span>: <span class="string">"readonly"</span>,</span><br><span class="line">        <span class="string">"SharedArrayBuffer"</span>: <span class="string">"readonly"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"parserOptions"</span>: &#123;</span><br><span class="line">        <span class="string">"ecmaVersion"</span>: <span class="number">2018</span>,</span><br><span class="line">        <span class="string">"sourceType"</span>: <span class="string">"module"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"rules"</span>: &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>新建一个/src/test.js文件，然后通过命令<code>npx eslint test.js</code>来进行eslint的语法检测👇</p><p>可以发现，在编写的过程中就已经提示有错误信息，说’a’ is assigned a value but never used.eslint(no-unused-vars)，即变量a被声明分配了空间资源但从未被使用过。然后用命令<code>npx eslint test.js</code>来进行eslint的语法检测，显示同样的错误。</p><p><img src="https://pic2.zhimg.com/v2-142a4fd620368870985bcf9352ff53e9_r.jpg" alt=""></p><p><img src="https://pic2.zhimg.com/v2-d3295c1bc67d021180688dd8faf742d5_r.jpg" alt=""></p><p>在该js文件中使用<code>console.log</code>也会报错。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//test.js</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">123</span>;</span><br><span class="line">a = a + <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>这样也会报错，a’ is assigned a value but never used.eslint(no-unused-vars)。eslint真的很严格。那我再改一下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">123</span>;</span><br><span class="line">a = a + <span class="number">2</span>;</span><br><span class="line">alert(a)</span><br></pre></td></tr></table></figure><p>这下就不报错了。</p><p>类似的我再新建一个/src/util.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果我想测试所有的js文件，那么我可以使用<code>*.js</code>来代替一个一个的文件名字，像下面这样👇</p><p><img src="https://pic2.zhimg.com/80/v2-76a22135704440b4dd0a2db7e7480fe9_720w.png" alt=""></p><p>我还可以在package.json文件中配置好eslint的检测指令👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"lesson02"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="string">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="string">"license"</span>: <span class="string">"MIT"</span>,</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"eslint"</span>: <span class="string">"eslint ./src/*.js"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"eslint"</span>: <span class="string">"^6.8.0"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在命令行执行<code>yarn eslint</code>就可以进行测试：</p><p><img src="https://pic1.zhimg.com/80/v2-b4193b97071e7f2753cebe1a6fc51b4f_720w.png" alt=""></p><p>这样，我们就完成了一个简单的eslint的检测。</p>]]></content>
      
      
      <categories>
          
          <category> ESLint </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ESLint </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>博客更换next主题</title>
      <link href="/2020/02/06/%E5%8D%9A%E5%AE%A2%E6%9B%B4%E6%8D%A2next%E4%B8%BB%E9%A2%98%E5%8F%8A%E5%85%B6%E9%85%8D%E7%BD%AE.html"/>
      <url>/2020/02/06/%E5%8D%9A%E5%AE%A2%E6%9B%B4%E6%8D%A2next%E4%B8%BB%E9%A2%98%E5%8F%8A%E5%85%B6%E9%85%8D%E7%BD%AE.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>之前一直用的anchor主题，每个页面都有一个大的背景图，虽然好看，但是加载图片很慢我实在受不了了。改邪归正使用next主题。</p><h2 id="安装Next"><a href="#安装Next" class="headerlink" title="安装Next"></a>安装Next</h2><h3 id="下载主题"><a href="#下载主题" class="headerlink" title="下载主题"></a>下载主题</h3><p>在博客根目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/iissnan/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure><h3 id="启用主题"><a href="#启用主题" class="headerlink" title="启用主题"></a>启用主题</h3><p>修改站点配置文件_config.yml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Extensions</span><br><span class="line">## Plugins: https://hexo.io/plugins/</span><br><span class="line">## Themes: https://hexo.io/themes/</span><br><span class="line">theme: next</span><br></pre></td></tr></table></figure><h3 id="验证主题"><a href="#验证主题" class="headerlink" title="验证主题"></a>验证主题</h3><p>启用主题后，先清除缓存</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br></pre></td></tr></table></figure><p>启用Hexo本地站点，验证主题</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo s --debug</span><br></pre></td></tr></table></figure><h2 id="主题设定"><a href="#主题设定" class="headerlink" title="主题设定"></a>主题设定</h2><h3 id="选择皮肤"><a href="#选择皮肤" class="headerlink" title="选择皮肤"></a>选择皮肤</h3><ul><li>Muse - 默认 Scheme，这是 NexT 最初的版本，黑白主调，大量留白</li><li>Mist - Muse 的紧凑版本，整洁有序的单栏外观</li><li>Pisces - 双栏 Scheme，小家碧玉似的清新</li></ul><p>可以在主题配置文件进行切换，把注释#去除即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#scheme: Muse</span><br><span class="line">#scheme: Mist</span><br><span class="line">scheme: Pisces</span><br></pre></td></tr></table></figure><h3 id="设置语言"><a href="#设置语言" class="headerlink" title="设置语言"></a>设置语言</h3><p>在站点配置文件，设置language</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">language: zh-Hans</span><br><span class="line"># 注意不要设置为zh-CN，这是无效的。（坑点</span><br></pre></td></tr></table></figure><h3 id="修改主题颜色"><a href="#修改主题颜色" class="headerlink" title="修改主题颜色"></a>修改主题颜色</h3><p>Next的配色文件是</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">\Hexo\themes\next\source\css\_variables\base.styl</span><br><span class="line">1</span><br></pre></td></tr></table></figure><p>里边是现有的配色方案，自定义的话只要修改一下参数的定义值就好了。我把默认的黑色改成了一个 浅青色：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// $black-deep   = #222 原本的黑色</span><br><span class="line">$black-deep   = #C0D3C8</span><br></pre></td></tr></table></figure><p><img src="https://pic2.zhimg.com/v2-8d4d74d009d5263641b9072d00384021_r.jpg" alt=""></p><h3 id="设置网站icon"><a href="#设置网站icon" class="headerlink" title="设置网站icon"></a>设置网站icon</h3><p>把图标放在<code>/themes/next/source/images</code>里，并且修改主题配置文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">favicon:</span><br><span class="line">  small: /images/icon1.png</span><br><span class="line">  medium: /images/icon1.png</span><br><span class="line">  apple_touch_icon: /images/dahuangmao-06.png</span><br><span class="line">  safari_pinned_tab: /images/logo.svg</span><br></pre></td></tr></table></figure><h3 id="设置菜单"><a href="#设置菜单" class="headerlink" title="设置菜单"></a>设置菜单</h3><p>菜单配置包括三个部分，第一是菜单项（名称和链接），第二是菜单项的显示文本，第三是菜单项对应的图标。 NexT 使用的是 Font Awesome 提供的图标， <a href="https://fontawesome.com/?from=io" target="_blank" rel="noopener">Font Awesome</a> 提供了 600+ 的图标，可以满足绝大的多数的场景，同时无须担心在 Retina 屏幕下 图标模糊的问题。</p><p>主题配置文件</p><p><strong>设定菜单内容</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">menu:</span><br><span class="line">  home: / || home</span><br><span class="line">  about: /about/ || user</span><br><span class="line">  tags: /tags/ || tags</span><br><span class="line">  categories: /categories/ || th</span><br><span class="line">  #commonweal: /404.html</span><br></pre></td></tr></table></figure><p>【注意】：这里是一个<strong>坑点</strong>，很多文章甚至官网都写着可以把<code>|| home</code>、<code>|| user</code>等去掉，但是这是不能去掉的，去掉的话就无法正确显示小图标了。官网也坑人。</p><blockquote><p>若你的站点运行在子目录中，请将链接前缀的 / 去掉</p></blockquote><p>NexT 默认的菜单项有（标注 ！的项表示需要手动创建这个页面）：</p><table><thead><tr><th>键值</th><th>设定值</th><th>显示文本（简体中文）</th></tr></thead><tbody><tr><td>home</td><td>home: /</td><td>主页</td></tr><tr><td>archives</td><td>archives: /archives</td><td>归档页</td></tr><tr><td>categories</td><td>categories: /categories</td><td>分类页！</td></tr><tr><td>tags</td><td>tags: /tags</td><td>标签页！</td></tr><tr><td>about</td><td>about: /about</td><td>关于页面！</td></tr><tr><td>commonweal</td><td>commonweal: /404.html</td><td>公益 404！</td></tr></tbody></table><p><strong>设置菜单项的显示文本</strong></p><p>在第一步中设置的菜单的名称并不直接用于界面上的展示。Hexo 在生成的时候将使用 这个名称查找对应的语言翻译，并提取显示文本。这些翻译文本放置在 NexT 主题目录下的 languages/{language}.yml （{language} 为你所使用的语言）。</p><p>以简体中文为例，若你需要添加一个菜单项，比如 something。那么就需要修改简体中文对应的翻译文件 languages/zh-Hans.yml，在 menu 字段下添加一项：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">menu:</span><br><span class="line">  home: 首页</span><br><span class="line">  archives: 归档</span><br><span class="line">  categories: 分类</span><br><span class="line">  tags: 标签</span><br><span class="line">  about: 关于</span><br><span class="line">  search: 搜索</span><br><span class="line">  commonweal: 公益404</span><br><span class="line">  something: 有料</span><br></pre></td></tr></table></figure><p><strong>设定菜单项的图标</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">menu_icons:</span><br><span class="line">  enable: true</span><br><span class="line">  # Icon Mapping.</span><br><span class="line">  home: home</span><br><span class="line">  about: user</span><br><span class="line">  categories: th</span><br><span class="line">  tags: tags</span><br><span class="line">  archives: archive</span><br><span class="line">  commonweal: heartbeat</span><br></pre></td></tr></table></figure><h3 id="创建分类"><a href="#创建分类" class="headerlink" title="创建分类"></a>创建分类</h3><h4 id="生成分类页"><a href="#生成分类页" class="headerlink" title="生成分类页"></a>生成分类页</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new page categories</span><br></pre></td></tr></table></figure><p>成功后进入文件，打开后默认</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 文章分类</span><br><span class="line">date: 2017-05-27 13:47:40</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>添加type</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 文章分类</span><br><span class="line">date: 2017-05-27 13:47:40</span><br><span class="line">type: &quot;categories&quot;</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>保存 关闭</p><h3 id="创建标签"><a href="#创建标签" class="headerlink" title="创建标签"></a>创建标签</h3><h4 id="生成标签页"><a href="#生成标签页" class="headerlink" title="生成标签页"></a>生成标签页</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new page tags</span><br></pre></td></tr></table></figure><p>成功后进入文件，打开后默认</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 标签</span><br><span class="line">date: 2017-05-27 13:47:40</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>添加type</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 分类</span><br><span class="line">date: 2017-05-27 13:47:40</span><br><span class="line">type: &quot;tags&quot;</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>保存 关闭</p><h3 id="创建新文章"><a href="#创建新文章" class="headerlink" title="创建新文章"></a>创建新文章</h3><p>在每篇博文的最顶端如下设置：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 博客更换next主题</span><br><span class="line">date: 2020-02-06</span><br><span class="line">tags:</span><br><span class="line">- hexo</span><br><span class="line">- 博客配置</span><br><span class="line">categories:</span><br><span class="line">- 博客配置</span><br><span class="line">top: true</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>注意categories只有一个，tags允许多个。之前用anchor主题的时候，设置tags是用方括号括起来的，在next主题里是无效的，必须像上面这样设置，注意英文符号和空格。</p><h3 id="设置头像"><a href="#设置头像" class="headerlink" title="设置头像"></a>设置头像</h3><p>编辑 主题配置文件，修改字段 avatar</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">放置在 source/images/ 目录下 </span><br><span class="line">配置为：avatar: /images/avatar.png</span><br></pre></td></tr></table></figure><h3 id="设置作者昵称"><a href="#设置作者昵称" class="headerlink" title="设置作者昵称"></a>设置作者昵称</h3><p>编辑 站点配置文件，设置 author 为你的昵称。</p><h3 id="站点描述"><a href="#站点描述" class="headerlink" title="站点描述"></a>站点描述</h3><p>编辑 站点配置文件，设置 description 字段为你的站点描述。站点描述可以是你喜欢的一句签名:)</p><h3 id="百度统计"><a href="#百度统计" class="headerlink" title="百度统计"></a>百度统计</h3><p>设置百度统计后可以查看本站的访问数据。</p><ul><li>登录 <a href="http://tongji.baidu.com/" target="_blank" rel="noopener">百度统计</a>， 定位到站点的代码获取页面</li><li>复制 <code>hm.js?</code> 后面那串统计脚本 id，如： <img src="https://theme-next.iissnan.com/uploads/five-minutes-setup/analytics-baidu-id.png" alt="img"></li><li>编辑 主题配置文件， 修改字段 <code>baidu_analytics</code> 字段，值设置成你的百度统计脚本 id。</li></ul><h3 id="侧边栏社交链接"><a href="#侧边栏社交链接" class="headerlink" title="侧边栏社交链接"></a>侧边栏社交链接</h3><p>主题配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">social:</span><br><span class="line">  GitHub: https://github.com/dunteng || github</span><br><span class="line">  E-mail: mailto:2568678437@qq.com || envelope</span><br><span class="line">  Instagram: https://instagram.com/dunteng_lin || instagram</span><br><span class="line">  </span><br><span class="line"># Social Icons</span><br><span class="line">social_icons:</span><br><span class="line">  enable: true</span><br><span class="line">  # Icon Mappings</span><br><span class="line">  GitHub: github</span><br><span class="line">  Twitter: twitter</span><br><span class="line">  微博: weibo</span><br></pre></td></tr></table></figure><p>注意要去掉social,social icons的注释！！以及enable要设置为true。</p><p>这里又有一个<strong>坑点</strong>，<code>social</code>配置中<code>|| github</code>等不可去掉，否则无法正常显示图标。</p><h3 id="腾讯公益404页面"><a href="#腾讯公益404页面" class="headerlink" title="腾讯公益404页面"></a>腾讯公益404页面</h3><p>使用方法，新建 404.html 页面，放到主题的 source 目录下，内容如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8;&quot;/&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge,chrome=1&quot; /&gt;</span><br><span class="line">    &lt;meta name=&quot;robots&quot; content=&quot;all&quot; /&gt;</span><br><span class="line">    &lt;meta name=&quot;robots&quot; content=&quot;index,follow&quot;/&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;https://qzone.qq.com/gy/404/style/404style.css&quot;&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;script type=&quot;text/plain&quot; src=&quot;http://www.qq.com/404/search_children.js&quot;</span><br><span class="line">            charset=&quot;utf-8&quot; homePageUrl=&quot;/&quot;</span><br><span class="line">            homePageName=&quot;回到我的主页&quot;&gt;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;https://qzone.qq.com/gy/404/data.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;https://qzone.qq.com/gy/404/page.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h3 id="站点建立时间"><a href="#站点建立时间" class="headerlink" title="站点建立时间"></a>站点建立时间</h3><p>这个时间将在站点的底部显示，例如 © 2017 - 2019。 编辑 主题配置文件，字段 since。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">footer:</span><br><span class="line">  since: 2013</span><br></pre></td></tr></table></figure><h3 id="站内搜索"><a href="#站内搜索" class="headerlink" title="站内搜索"></a>站内搜索</h3><p>启用本地搜索的方法很简单，先安装 <code>hexo-generator-search</code>。</p><p>注意不是 <code>hexo-generator-searchdb</code>，前者来自于 wzpan/hexo-generator-search，而后者来自于 theme-next/hexo-generator-searchdb。后者已经一年多没有更新了，而前者还在更新，并且增加了仅搜索标题的功能。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn install hexo-generator-search</span><br></pre></td></tr></table></figure><p>然后在主题配置文件里，启用本地搜索功能：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">local_search:</span><br><span class="line"> enable: true</span><br><span class="line"> # if auto, trigger search by changing input</span><br><span class="line"> # if manual, trigger search by pressing enter key or search button</span><br><span class="line"> trigger: auto</span><br><span class="line"> # show top n results per article, show all results by setting to -1</span><br><span class="line"> top_n_per_article: -1</span><br></pre></td></tr></table></figure><p>然后重新生成页面：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure><p>即可查看更改。</p><p>其实如果没有其它的需要的话，到这里就可以了，默认配置就已经足够用了。</p><p>参考文章：<a href="https://wangjiezhe.com/posts/2018-10-29-Hexo-NexT-2/" target="_blank" rel="noopener">https://wangjiezhe.com/posts/2018-10-29-Hexo-NexT-2/</a></p><h3 id="Valine评论功能"><a href="#Valine评论功能" class="headerlink" title="Valine评论功能"></a>Valine评论功能</h3><p>后面了解到一款国人开发的评论系统叫Valine用的是LeanCloud作为数据库，洁面很简洁，不像来必力那样花哨只是单纯的评论，简洁到没有后台！！！删除和管理评论只能直接操作数据库。<br> 这里写下为Hexo-Next模板添加Valine的过程和坑点。<br> 1.Next模板要5.14及以上（免去自己手动修改的麻烦）。不是这个版本的可以考虑升级或者自己手动修改，修改教程在 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fiissnan%2Fhexo-theme-next%2Fpull%2F1983" target="_blank" rel="noopener">https://github.com/iissnan/hexo-theme-next/pull/1983</a><br> 2.注册LeanCloud并创建一个开发版应用（免费）</p><p><img src="https:////upload-images.jianshu.io/upload_images/4109786-db52b8ea81a285e0.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/596/format/webp" alt="img"></p><p> 3.在LeanCloud -&gt; 存储 -&gt; 创建Class -&gt; 无限制的Class（坑点1）</p><p> class名称为：Comment</p><p><img src="https:////upload-images.jianshu.io/upload_images/4109786-6846e60c8f4f72e3.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/594/format/webp" alt="img"></p><p>LeanCloud创建Class</p><p>4.在LeanCloud-设置-把除数据存储其他选项都关闭。</p><p><img src="https:////upload-images.jianshu.io/upload_images/4109786-9a3440a275690e77.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/565/format/webp" alt="img"></p><p>LeanCloud设置</p><p> 安全域名中添加域名，一定要注意格式（坑点2）</p><p>例如：<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.nobige.cn%2F" target="_blank" rel="noopener">https://www.nobige.cn:443</a></p><p><img src="https://pic3.zhimg.com/80/v2-dc06c4fbe78620ec529decc8d5193d8a_720w.jpg" alt="img"></p><p>5.在Next模板下的<em>_config.yml</em>搜索<em>Valine</em>进行填写appid和appkey</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Valine.</span><br><span class="line"># You can get your appid and appkey from https://leancloud.cn</span><br><span class="line"># more info please open https://valine.js.org</span><br><span class="line">valine:</span><br><span class="line">  enable: true</span><br><span class="line">  appid: 你的appid</span><br><span class="line">  appkey: 你的appkey</span><br><span class="line">  notify: true # mail notifier , https://github.com/xCss/Valine/wiki</span><br><span class="line">  verify: false # Verification code</span><br><span class="line">  placeholder: 欢迎评论，请在上方留下你的昵称和邮箱以便收到我的回复通知~</span><br><span class="line">  avatar: retro</span><br><span class="line">  guest_info: nick,mail # custom comment header</span><br><span class="line">  pageSize: 10 # pagination size</span><br></pre></td></tr></table></figure><p>Next _config.yml</p><p>如果要开启email通知除了修改<em>_config.yml</em>文件之外还要将LeanCloud -&gt; 设置邮件模板 -&gt; <em>用于重置密码的邮件主题</em>进行修改</p><p><img src="https:////upload-images.jianshu.io/upload_images/4109786-8bd8a493cd24ae3e.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/430/format/webp" alt="img"></p><p>LeanCloud设置邮件模板</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">你在&#123;&#123;appname&#125;&#125; 的评论收到了新的回复</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hi, &#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">你在 &#123;&#123;appname&#125;&#125; 的评论收到了新的回复，请点击查看：</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"你的网址首页链接"</span> <span class="attr">style</span>=<span class="string">"display: inline-block; padding: 10px 20px; border-radius: 4px; background-color: #3090e4; color: #fff; text-decoration: none;"</span>&gt;</span>马上查看<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>建议将自带的CDN改成第三方CDN，为啥？？？10+s的加载那酸爽是在是过瘾。<br> 文件目录：next/layout/_third-party/comments/valine.swig</p><blockquote><p>//cdn.jsdelivr.net/npm/valine/dist/Valine.min.js</p></blockquote><p>官方的CDN是</p><blockquote><p>//unpkg.com/valine/dist/Valine.min.js</p></blockquote><p><em>更多高级用法请到官网查看 <a href="https://valine.js.org/" target="_blank" rel="noopener">https://valine.js.org/</a></em></p><h3 id="置顶功能"><a href="#置顶功能" class="headerlink" title="置顶功能"></a>置顶功能</h3><p>目前已经有修改后支持置顶的仓库，可以直接用以下命令安装。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm uninstall hexo-generator-index --save</span><br><span class="line">$ npm install hexo-generator-index-pin-top --save</span><br></pre></td></tr></table></figure><p>然后在需要置顶的文章的<code>Front-matter</code>中加上<code>top: true</code>即可。比如下面这篇文章：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 我的2018总结</span><br><span class="line">tags:</span><br><span class="line">  - 随笔</span><br><span class="line">categories:</span><br><span class="line">  - 随笔</span><br><span class="line">abbrlink: 58a24148</span><br><span class="line">date: 2018-12-31 11:45:59</span><br><span class="line">top: true</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>到目前为止，置顶功能已经可以实现了。所有相关博文到这边就结束了。</p><p>不过置顶的文章显示在最上面之后，如果没有明确的置顶标志，是不是感觉有点怪怪的呢？</p><p>打开：<code>/themes/next/layout/_macro</code>目录下的<code>post.swig</code>文件，定位到<code>&lt;div class=&quot;post-meta&quot;&gt;</code>标签下，插入如下代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if post.top %&#125;</span><br><span class="line">    &lt;i class=&quot;fa fa-thumb-tack&quot;&gt;&lt;/i&gt;</span><br><span class="line">    &lt;font color=&quot;green&quot;&gt;置顶&lt;/font&gt;</span><br><span class="line">    &lt;span class=&quot;post-meta-divider&quot;&gt;|&lt;/span&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><h3 id="删除底部页脚"><a href="#删除底部页脚" class="headerlink" title="删除底部页脚"></a>删除底部页脚</h3><p>找到<code>/themes/next/layout/_partials/footer.swig文件</code><br> 内容如下:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"copyright"</span> &gt;</span></span><br><span class="line">  &#123;% set current = date(Date.now(), "YYYY") %&#125;</span><br><span class="line">  © &#123;% if theme.since and theme.since != current %&#125; &#123;&#123; theme.since &#125;&#125; - &#123;% endif %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">itemprop</span>=<span class="string">"copyrightYear"</span>&gt;</span>&#123;&#123; current &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"with-love"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-heart"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"author"</span> <span class="attr">itemprop</span>=<span class="string">"copyrightHolder"</span>&gt;</span>&#123;&#123; config.author &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"powered-by"</span>&gt;</span></span><br><span class="line">  &#123;&#123; __('footer.powered', '<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"theme-link"</span> <span class="attr">href</span>=<span class="string">"https://hexo.io"</span>&gt;</span>Hexo<span class="tag">&lt;/<span class="name">a</span>&gt;</span>') &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"theme-info"</span>&gt;</span></span><br><span class="line">  &#123;&#123; __('footer.theme') &#125;&#125; -</span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"theme-link"</span> <span class="attr">href</span>=<span class="string">"https://github.com/iissnan/hexo-theme-next"</span>&gt;</span></span><br><span class="line">    NexT.&#123;&#123; theme.scheme &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>删除class 为powered-by的div和theme-info的div即可</p><h3 id="显示页脚运行时间"><a href="#显示页脚运行时间" class="headerlink" title="显示页脚运行时间"></a>显示页脚运行时间</h3><ul><li>在 \themes\next\layout_partials\footer.swig 增加</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#123;%- if config.symbols_count_time.total_time %&#125;</span><br><span class="line"></span><br><span class="line">--- 增加 ---</span><br><span class="line">&lt;div id=&quot;sitetime&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script language=javascript&gt;</span><br><span class="line">function siteTime()&#123;</span><br><span class="line">window.setTimeout(&quot;siteTime()&quot;, 1000);</span><br><span class="line">var seconds = 1000;</span><br><span class="line">var minutes = seconds * 60;</span><br><span class="line">var hours = minutes * 60;</span><br><span class="line">var days = hours * 24;</span><br><span class="line">var years = days * 365;</span><br><span class="line">var today = new Date();</span><br><span class="line">var todayYear = today.getFullYear();</span><br><span class="line">var todayMonth = today.getMonth()+1;</span><br><span class="line">var todayDate = today.getDate();</span><br><span class="line">var todayHour = today.getHours();</span><br><span class="line">var todayMinute = today.getMinutes();</span><br><span class="line">var todaySecond = today.getSeconds();</span><br><span class="line">/* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)</span><br><span class="line">year - 作为date对象的年份，为4位年份值</span><br><span class="line">month - 0-11之间的整数，做为date对象的月份</span><br><span class="line">day - 1-31之间的整数，做为date对象的天数</span><br><span class="line">hours - 0(午夜24点)-23之间的整数，做为date对象的小时数</span><br><span class="line">minutes - 0-59之间的整数，做为date对象的分钟数</span><br><span class="line">seconds - 0-59之间的整数，做为date对象的秒数</span><br><span class="line">microseconds - 0-999之间的整数，做为date对象的毫秒数 */</span><br><span class="line">var t1 = Date.UTC(2017,08,12,15,15,47); //建站时间</span><br><span class="line">var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);</span><br><span class="line">var diff = t2-t1;</span><br><span class="line">var diffYears = Math.floor(diff/years);</span><br><span class="line">var diffDays = Math.floor((diff/days)-diffYears*365);</span><br><span class="line">var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);</span><br><span class="line">var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);</span><br><span class="line">var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);</span><br><span class="line">document.getElementById(&quot;sitetime&quot;).innerHTML=&quot; 已运行&quot;+diffYears+&quot; 年 &quot;+diffDays+&quot; 天 &quot;+diffHours+&quot; 小时 &quot;+diffMinutes+&quot; 分钟 &quot;+diffSeconds+&quot; 秒&quot;;</span><br><span class="line">&#125;</span><br><span class="line">siteTime();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">--- 增加 ---</span><br><span class="line"></span><br><span class="line">&#123;%- if theme.footer.powered.enable %&#125;</span><br></pre></td></tr></table></figure><h3 id="阅读全文"><a href="#阅读全文" class="headerlink" title="阅读全文"></a>阅读全文</h3><ul><li>在文章加</li><li>修改 主题配置文件 -&gt; auto_excerpt -&gt; length</li></ul><p><br><br></p><h3 id="404页面"><a href="#404页面" class="headerlink" title="404页面"></a>404页面</h3><p>原来小小的举动也可以为公益事业献出自己的一份爱心，何乐而不为呢？</p><p>-新建 404.html 页面，放到主题的 source 目录下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8;&quot;/&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge,chrome=1&quot; /&gt;</span><br><span class="line">  &lt;meta name=&quot;robots&quot; content=&quot;all&quot; /&gt;</span><br><span class="line">  &lt;meta name=&quot;robots&quot; content=&quot;index,follow&quot;/&gt;</span><br><span class="line">  &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;https://qzone.qq.com/gy/404/style/404style.css&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;script type=&quot;text/plain&quot; src=&quot;http://www.qq.com/404/search_children.js&quot;</span><br><span class="line">          charset=&quot;utf-8&quot; homePageUrl=&quot;/&quot;</span><br><span class="line">          homePageName=&quot;回到我的主页&quot;&gt;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">  &lt;script src=&quot;https://qzone.qq.com/gy/404/data.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;script src=&quot;https://qzone.qq.com/gy/404/page.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>【参考文章】：</p><ul><li><a href="http://super-wei.top/2019/01/24/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/%E9%85%8D%E7%BD%AEnext%E4%B8%BB%E9%A2%98/" target="_blank" rel="noopener">配置next主题 from super-wei.top</a></li><li><a href="http://super-wei.top/2019/08/24/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/Next7.x%E5%8D%87%E7%BA%A7%E5%8F%8A%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE/" target="_blank" rel="noopener">Next7.x升级及相关配置 from super-wei.top</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 博客配置 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> 博客配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>判断一个数据的具体类型的方法</title>
      <link href="/2020/02/02/objectPrototypetoStringcall.html"/>
      <url>/2020/02/02/objectPrototypetoStringcall.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>常常遇到要判断一个数据是对象还是数组的问题，抽象出来就是判断一个数据的具体类型的问题。要用到一个<code>Object.prototype.toString().call(instance).slice(8,-1)</code>，这个也可以看作是call()的一个常见应用。</p><p><img src="https://pic1.zhimg.com/v2-c96d39cc1e86c3b920c2851cbdfb93bc_r.jpg" alt=""></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/getTypes.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 用于判断一个对象的类型</span></span><br><span class="line">    getTypes: <span class="function"><span class="keyword">function</span> (<span class="params">instance</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(instance).slice(<span class="number">8</span>, <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>这很好用，封装起来，项目里直接使用。</p>]]></content>
      
      
      <categories>
          
          <category> 面试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 面试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端需要知道的计算机网络知识</title>
      <link href="/2020/01/20/%E5%89%8D%E7%AB%AF%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86.html"/>
      <url>/2020/01/20/%E5%89%8D%E7%AB%AF%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="浏览器背后"><a href="#浏览器背后" class="headerlink" title="浏览器背后"></a>浏览器背后</h2><p><img src="https://pic2.zhimg.com/v2-93c68a1fc30c635c9e4b97ca5e18b499_r.jpg" alt=""></p><h3 id="浏览器的一个请求从发起到返回经历了什么"><a href="#浏览器的一个请求从发起到返回经历了什么" class="headerlink" title="浏览器的一个请求从发起到返回经历了什么"></a>浏览器的一个请求从发起到返回经历了什么</h3><p><img src="https://pic2.zhimg.com/v2-4c9ec3ec18a7b1da6b88b5c2b2c69179_r.jpg" alt=""></p><ol><li>浏览器中输入url，拆分解析出域名domain，将域名发送给DNS服务器</li><li>DNS服务器会根据域名查询出对应的IP地址，将IP地址返回给浏览器</li><li>浏览器在收到IP地址之后，就知道向哪个地址发起请求。TCP三次握手连接建立后，按照http网络协议发起http请求，这中间经过局域网、交换机、路由器、主干网络，最后到达服务端。</li><li>服务端一般是一个mvc架构，请求首先会进入Controller层，在controller中进行相关的逻辑处理和请求的分发，之后去调用model层，model层负责与数据交互，在与数据交互的过程中，model层会操作数据库（redis、mysql等）增删改查等，最终将页面数据通过view层返回给网络。这样，一个http response就从服务端返回给了浏览器。</li><li>接下来浏览器主要是做一个render渲染的过程，浏览器根据请求回来的html以及这个html关联的css、js去进行渲染。在渲染的过程中，会根据html形成对应的DOM树和CSS树，从而进行页面内容的渲染。</li></ol><h2 id="初识HTTP协议"><a href="#初识HTTP协议" class="headerlink" title="初识HTTP协议"></a>初识HTTP协议</h2><p><img src="https://pic3.zhimg.com/80/v2-7d9ed7e9624c7e7c90b902acbe9e9f74_hd.png" alt=""></p><ul><li>1990年10月HTTP协议被提出</li><li>1991年HTTP0.9诞生</li><li>1996年HTTP1.0发布</li><li>1997年HTTP1.1发布（目前最常用的版本）</li><li>2015年HTTP2.0发布（主要是HTTP1.x 的扩展，提高了传输性能，实现低延迟，高吞吐量；但是目前普及率不高，2019年底只有30%的网站在使用）</li><li>HTTP3.0 现在已经发布了，但尚未普及。了解一下<a href="https://www.jianshu.com/p/bb3eeb36b479" target="_blank" rel="noopener">QUIC协议</a></li></ul><h2 id="TCP-IP协议族与HTTP协议"><a href="#TCP-IP协议族与HTTP协议" class="headerlink" title="TCP/IP协议族与HTTP协议"></a>TCP/IP协议族与HTTP协议</h2><p>HTTP协议是构建在TCP/IP协议之上的，是TCP/IP协议的一个子集。为了更好的了解HTTP协议，我先来介绍一下TCP/IP 的相关知识。</p><p><strong>TCP/IP协议族</strong></p><ul><li>TCP/IP协议是一系列与互联网相关联的协议集合起来的总称</li><li>分层管理是TCP/IP协议的重要特征</li></ul><h3 id="TCP-IP分层"><a href="#TCP-IP分层" class="headerlink" title="TCP/IP分层"></a>TCP/IP分层</h3><p><img src="https://pic3.zhimg.com/80/v2-69209bed1ee0357a97f753bed6699a6f_hd.png" alt=""></p><p><img src="https://pic3.zhimg.com/80/v2-f597f8ef21ba2786b227137c77b083bf_hd.png" alt=""></p><p><img src="https://pic2.zhimg.com/80/v2-0435b49c6d1302c9dc9dc5deb7e80e6b_hd.png" alt=""></p><p>TCP协议是面向连接的，UDP协议是无连接的。TCP虽然可靠，但是因为需要建立连接，效率较低，而UDP则效率高，但可靠性低。</p><p><img src="https://pic3.zhimg.com/80/v2-4e1c011d189d5bfce6d144b17113a602_hd.png" alt=""></p><p><strong>网络层负责在众多的串数路线中选择一条供两台计算机直接通信。</strong></p><p><img src="https://pic2.zhimg.com/80/v2-b0007f9a7b3210ee36e0763e134d4f12_hd.png" alt=""></p><p>相关知识：<a href="https://blog.csdn.net/huangjin0507/article/details/51613561" target="_blank" rel="noopener">OSI七层与TCP/IP五层网络架构</a></p><h3 id="数据封装与数据传输"><a href="#数据封装与数据传输" class="headerlink" title="数据封装与数据传输"></a>数据封装与数据传输</h3><p><img src="https://pic4.zhimg.com/v2-f2574047a6fa34529b47e29c0d2930f3_r.jpg" alt=""></p><p><img src="https://pic1.zhimg.com/v2-a15aefbce7a4678a4532bc915b481e78_r.jpg" alt=""></p><p>基本可以理解为封装快递=》寄送快递=》拆快递的过程。</p><h3 id="TCP连接的建立和释放"><a href="#TCP连接的建立和释放" class="headerlink" title="TCP连接的建立和释放"></a>TCP连接的建立和释放</h3><p><img src="https://pic1.zhimg.com/v2-fcc64d38138c197aa0b71cc834ec31b4_r.jpg" alt=""></p><p><img src="https://pic3.zhimg.com/v2-01197f5ca4406f61486b978b3d9cbc66_r.jpg" alt=""></p><p><img src="https://pic3.zhimg.com/v2-b780796662bfe0496eb548a77fb89982_r.jpg" alt=""></p><p><img src="https://pic1.zhimg.com/v2-6ec75cd94fe041323576e90ce4599528_r.jpg" alt=""></p><ul><li><p><a href="https://www.bilibili.com/video/av69145968?from=search&amp;seid=9065169420287984816" target="_blank" rel="noopener">视频</a></p></li><li><p><img src="https://pic1.zhimg.com/v2-4884b016dafbd4acc5a90fe424c21cc0_r.jpg" alt="1571061079139"></p></li><li><p>客户端和服务器端的前两次握手其实就可以建立链接了，为什么还要进行第三次握手才能建立链接。因为有这种情况：第一次握手客户端传过去的数据因为网络阻塞等原因没能顺利传到服务器，那么服务器端就不会发送确认报文给客户端，由于存在一个<strong>超时重传</strong>的机制，客户端久久未收到服务器端的报文就会重新再发一次请求，好了，这次服务器端手里接收到了，也发回了确认报文给客户端，然后客户端发送一个确认报文给服务器端告诉服务器端”我收到你接受成功的消息了“，服务器就知道ok消息都传到了可以建立链接了。恰巧这时第一次未发送成功的请求终于不阻塞了传到了服务器端，但是这时已经不需要这条迟来的请求了，服务器通过第三次握手就知道了一切就绪就不会再接受重复的请求了。</p><p>还有一种说法：第一次握手，服务端知道了客户端的发送功能正常、自己服务端的接收功能正常，但不知道客户端的接收能力正常否，也不知道自己服务端的发送功能正常否，所以服务端向客户端发送请求，于是有了第二次握手；第二次握手时，客户端接收到了来自服务端的消息，知道了自己客户端的发送功能和接收功能都是正常的、服务端的接收功能和发送功能也是正常的，但是服务端这时候还没有全知道，所以要通知一下服务端，于是有了第三次握手；第三次握手时，服务端就知道了自己的发送功能和接收功能都是正常的，客户端的发送和接收功能也是正常的，可以开始数据传送了。</p></li><li><p><img src="https://pic3.zhimg.com/v2-7d69b34a7ba983f333cc68e67a100226_r.jpg" alt="1571061644203"></p></li><li><p>一开始客户端向服务端发送报文说我要关闭了，服务器端接收到报文知道客户端要关闭，于是就向客户端发送报文说收到你可以关闭，这时第一第二次挥手；服务器端发送完二次挥手的报文后，会等待一段时间(CLOSE-WAIT)，在这期间服务器端可能会有其他的发往客户端的报文，所以要等这些报文发完之后才进行第三次挥手；第三次挥手时服务器端向客户端发送报文告知客户端自己也要关闭了，客户端接收到了然后向服务器端发送一条报文告知我知道你要关闭了，这是第四次挥手。第四次挥手后客户端会等到一段时间(TIME-WAIT)再关闭，因为有这么一种情况：</p><ul><li>服务端在第三次挥手发送报文后，会等到接收到来自客户端的第四次挥手的报文之后才安心地关闭。但由于网路阻塞等不可控因素，客户端发送的第四次挥手的报文可能没有顺利传送到服务器端，服务器端会有一个超时重传的机制，它迟迟没有收到客户端的回应就会重新发送第三次挥手的报文，如果没有TIME-WAIT，客户端在收到三次挥手报文并发送第四次挥手报文后就直接关闭了，那么可能因为第四次挥手没有顺利传送到服务器端，而导致服务器端一直无法关闭。所以设置一个TIME-WAIT是很有必要的。</li></ul></li></ul><h2 id="DNS域名解析和CDN"><a href="#DNS域名解析和CDN" class="headerlink" title="DNS域名解析和CDN"></a>DNS域名解析和CDN</h2><p><img src="https://pic3.zhimg.com/80/v2-a60eea101f42897bdf6eeb0502a8736d_hd.png" alt=""></p><p><img src="https://images2015.cnblogs.com/blog/464291/201707/464291-20170703113844956-354755333.jpg" alt=""></p><p>[参考文章]</p><p><a href="https://www.cnblogs.com/crazylqy/p/7110357.html" target="_blank" rel="noopener">https://www.cnblogs.com/crazylqy/p/7110357.html</a></p><p><a href="https://juejin.im/entry/5ad011216fb9a028cd457f60" target="_blank" rel="noopener">https://juejin.im/entry/5ad011216fb9a028cd457f60</a></p><p>CDN(内容分发网络)作用于DNS域名解析之前，CDN决定分发了一个较近的站点给用户，接着再进行DNS域名解析。</p><h2 id="开发者工具查看http请求头响应头响应体"><a href="#开发者工具查看http请求头响应头响应体" class="headerlink" title="开发者工具查看http请求头响应头响应体"></a>开发者工具查看http请求头响应头响应体</h2><p><img src="https://pic1.zhimg.com/v2-e8349ab8b409d96ed7ad1675e1453734_r.jpg" alt=""></p><p><img src="https://pic2.zhimg.com/v2-6b6db1c200960278e4ffcd4fb4a9c505_r.jpg" alt=""></p><h2 id="HTTP协议五大特点"><a href="#HTTP协议五大特点" class="headerlink" title="HTTP协议五大特点"></a>HTTP协议五大特点</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- 支持客户端/服务器端模式（CS模式）</span><br><span class="line">- 简单快速</span><br><span class="line">- 灵活</span><br><span class="line">- 无连接</span><br><span class="line">- 无状态</span><br></pre></td></tr></table></figure><p>参考文章：<a href="https://blog.csdn.net/tennysonsky/article/details/44562435" target="_blank" rel="noopener">https://blog.csdn.net/tennysonsky/article/details/44562435</a></p><p><img src="https://pic4.zhimg.com/v2-ef2e130509c22c27f879d2d70b355ab3_r.jpg" alt=""></p><p><img src="https://pic3.zhimg.com/v2-82ce83612a98f400c1b3188e3be9a12a_r.jpg" alt=""></p><p><img src="https://pic4.zhimg.com/v2-0dbfe5d2315736de1b8325d4645de877_r.jpg" alt=""></p><p><img src="https://pic1.zhimg.com/v2-d3984ae80de4ac61ad8ff37a0441c310_r.jpg" alt=""></p><p><img src="https://pic1.zhimg.com/v2-3692646ea02e76164704f42993a1d5bc_r.jpg" alt=""></p><h2 id="URI和URL的区别与联系"><a href="#URI和URL的区别与联系" class="headerlink" title="URI和URL的区别与联系"></a>URI和URL的区别与联系</h2><p>参考文章：<a href="https://blog.csdn.net/u011240877/article/details/52052378" target="_blank" rel="noopener">https://blog.csdn.net/u011240877/article/details/52052378</a></p><p><img src="http://images2015.cnblogs.com/blog/591228/201601/591228-20160116223301225-1866838315.png" alt=""></p><p>URI： 一个紧凑的字符串用来标示抽象或物理资源</p><p>一个URI可以进一步被分为定位符、名字或者两者都是.。或者说URI可以分为URL和URN或者同时具备locators和names特性。</p><p>URL（统一资源定位器）是URI的子集，除了确定一个资源，还提供一种定位该资源的主要访问机制。</p><p>URN作用就好像一个人的名字，URL就像一个人的地址。</p><p>URN确定了东西的身份，URL提供了找到它的方式。</p><p>URL是URI的一种，但不是所有的URI都是URL。</p><p>URI和URL的最大差别是“访问机制”。</p><p>来看几个例子：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ftp://ftp.is.co.za/rfc/rfc1808.txt (*)</span><br><span class="line"></span><br><span class="line">http://www.ietf.org/rfc/rfc2396.txt (*)</span><br><span class="line"></span><br><span class="line">ldap://[2001:db8::7]/c=GB?objectClass?one (*)</span><br><span class="line"></span><br><span class="line">mailto:John.Doe@example.com (*)</span><br><span class="line"></span><br><span class="line">news:comp.infosystems.www.servers.unix (*)</span><br><span class="line"></span><br><span class="line">tel:+1-816-555-1212</span><br><span class="line"></span><br><span class="line">telnet://192.0.2.16:80/ (*)</span><br><span class="line"></span><br><span class="line">urn:oasis:names:specification:docbook:dtd:xml:4.1.2</span><br></pre></td></tr></table></figure><p>上述例子均为URI，其中<strong>带有*结尾的例子为URL</strong>，他们之间存在的共性是什么？不难发现，URL的例子复制粘贴到浏览器地址栏可以直接访问到资源，也就是说URL提供了访问机制，这是判断是否为URL的决定性因素。</p><p>总结：</p><p>关于URL和URI区别之争，其实并没有多大意义，因为URL就是URI。但对于一个标识符一个准确说法却是有考究上的帮助，当我们替代WEB地址时，哪个说法更为准确，通过了解到两者的包含的关系，URI毫无疑问是最保险的说法。要严谨请使用URI吧。而且，”URL”也正在被“弃用”。</p><h2 id="HTTP报文结构分析"><a href="#HTTP报文结构分析" class="headerlink" title="HTTP报文结构分析"></a>HTTP报文结构分析</h2><h3 id="请求报文"><a href="#请求报文" class="headerlink" title="请求报文"></a>请求报文</h3><p><img src="http://dl.iteye.com/upload/attachment/0069/3485/1a4e7e6a-6d7b-38f1-af8a-043140034c8f.jpg" alt=""></p><p><img src="https://pic2.zhimg.com/v2-17b1ca0ebef690c80048ed2047192bc5_r.jpg" alt=""></p><h3 id="HTTP报文头"><a href="#HTTP报文头" class="headerlink" title="HTTP报文头"></a>HTTP报文头</h3><p>HTTP报文头分为四类，分别是：</p><ul><li>通用报文头</li><li>请求报文头</li><li>响应报文头</li><li>实体报文头</li></ul><p>在HTTP/1.1里一共规范了47种<strong>报文头字段</strong></p><p><img src="https://pic4.zhimg.com/v2-4cb1d86b8082d06136f07d926d2215cb_r.jpg" alt=""></p><p><img src="https://pic4.zhimg.com/v2-752d2c6b47d8ef92a8eeffb3ace69b1f_r.jpg" alt=""></p><p><img src="https://pic3.zhimg.com/v2-f2fb26b34779c19804dfc7b7983d90da_r.jpg" alt=""></p><p><img src="https://pic4.zhimg.com/v2-4fc1f2861eab11d573cce50abb068cfb_r.jpg" alt=""></p><h3 id="常见的报文头字段"><a href="#常见的报文头字段" class="headerlink" title="常见的报文头字段"></a>常见的报文头字段</h3><p><strong>ACCEPT</strong>：</p><p>作用： 浏览器端可以接收的媒体类型</p><p>Accept: text/html 代表浏览器可以接收服务器发回的类型是text/html，也就是我们常说的html文档，如果服务器无法返回text/html类型的数据，服务器应该返回一个406错误(Non Acceptable)。</p><p>Accept: */* 代表浏览器可以处理所有类型。</p><p>如果想要给显示的媒体类型增加优先级，则使用 q= 来额外标识权重值；权重值 q 的范围是 0~1 （可精确到小数点后3位），且1为最大值。不指定权重 q 值时，默认权重为 q=1.0。 当服务器提供多种内容时，将会首先返回权重值最高的媒体类型。</p><hr><p><strong>Accept-Encoding</strong>：</p><p>作用：浏览器申明自己接收的编码方法，通常指定压缩方法，是否支持压缩，支持什么压缩（gzip  deflate）</p><p>accept-encoding: gzip, deflate</p><hr><p><strong>Accept-Language</strong>：</p><p>作用： 浏览器申明自己接收的语言</p><p>Accpet-language: zh-cn,zh;q=0.7,en-us,en;q=0.3</p><p>这个字段也是有权重值的。客户端在服务器有中文版资源的情况下，会请求其返回中文版对应的响应，若无，则返回英文版的响应，若再无，返回406错误。</p><hr><p><strong>Connection</strong>：</p><p>Connection: keep-alive   当一个网页打开完成后，客户端和服务器端之间用于串数HTTP数据的TCP连接不会断开，如果客户端再次访问这个服务器上的网页，会继续使用这一条已经建立的连接。</p><p>Connection: close  代表一个request完成后，客户端与服务器端之间用于传输HTTP数据的TCP连接会关闭，当客户端再次发送request，需要重新通过三次握手建立TCP连接。</p><hr><p><strong>Host</strong>：</p><p>host请求报文域主要用于指定被请求资源的Internet主机和端口号，它通常从HTTP URL种提取出来</p><p>我们在浏览器种输入： <a href="http://www.dunteng.com:8080" target="_blank" rel="noopener">http://www.dunteng.com:8080</a></p><p>浏览器发送的请求消息中，就会包含host请求报头域，如下：</p><p>Host: <a href="http://www.dunteng.com:8080" target="_blank" rel="noopener">www.dunteng.com:8080</a></p><hr><p><strong>Referer</strong>：</p><p>当浏览器向web服务器发送请求时，一般会带上Referer，告知服务器我是从哪个页面链接过来的，服务器藉此可以获得一些信息用于处理。</p><hr><p><strong>User-Agent</strong>：</p><p>作用： 告诉HTTP服务器，客户端使用的操作系统和浏览器的名称和版本。</p><p>很多情况下我们会通过User-Agent来判断浏览器类型，从而进行不同的兼容设计。</p><hr><p><strong>Content-Type：</strong></p><p>作用： 说明了报文体内对象的媒体类型</p><p><img src="https://pic4.zhimg.com/80/v2-63f69d8e86d7d3a039d17375031ca296_hd.png" alt=""></p><p><img src="https://pic4.zhimg.com/v2-d50243d48d5ddb8fa92ec05b9c20aa1f_r.jpg" alt=""></p><h3 id="响应报文"><a href="#响应报文" class="headerlink" title="响应报文"></a>响应报文</h3><p><img src="http://dl.iteye.com/upload/attachment/0069/3489/0236098f-1a98-3a4f-ba6c-4a44c6ec4ed0.jpg" alt=""></p><p><img src="https://pic4.zhimg.com/v2-dc3015a969a414a27e97eb4f2c379117_r.jpg" alt=""></p><h2 id="HTTP请求方法"><a href="#HTTP请求方法" class="headerlink" title="HTTP请求方法"></a>HTTP请求方法</h2><p>HTTP/1.1 常用方法：</p><ol><li>GET</li><li>POST</li><li>PUT</li><li>HEAD</li><li>DELETE</li><li>OPTIONS</li><li>TRACE</li><li>CONNECT</li></ol><h3 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h3><p>GET方法用来请求访问被URI识别的资源，指定的资源经服务器解析后返回相应内容。</p><p><img src="https://pic1.zhimg.com/v2-b7890e03668aaadb66efe9ef19949e78_r.jpg" alt=""></p><p>GET方法也可以用来提交表单和其他数据，以下例的格式👇</p><p><a href="http://localhost/login.php?username=44&amp;password=1234" target="_blank" rel="noopener">http://localhost/login.php?username=44&amp;password=1234</a></p><p>从上面的URL请求中，很容易辨认出表单提交的内容，这样很不安全。同时，浏览器对于提交URL的长度也有所限制。</p><h3 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h3><p>POST方法与GET功能类似，一般用来传输实体的主体，常用来提交表单数据，尤其是大批量的数据</p><p><img src="https://pic4.zhimg.com/v2-6c36853c43ab1ca664149029a56224ff_r.jpg" alt=""></p><ul><li>POST方法将要提交的数据存放在请求体中，而非GET那种将数据以参数形式放在URL中，相比较而言隐私安全较好。所以，处于安全和用户隐私的考量，提交表单数据一般采用POST为宜。</li><li>GET方法对于提交的数据（URL长度）有大小限制，POST无大小限制</li></ul><h3 id="PUT"><a href="#PUT" class="headerlink" title="PUT"></a>PUT</h3><p>从客户端向服务器传送的数据取代指定的文档的内容</p><p>PUT方法与POST方法最大的不同是PUT是<strong>幂等</strong>的，而POST不是幂等的</p><p><a href="https://q.cnblogs.com/q/98586/" target="_blank" rel="noopener">PUT没有验证机制，任何人都可以上传，有安全问题，一般网站都不使用该方法。（出自《图解HTTP》，不是很明白）</a></p><p>更多时候将PUT方法用作传输资源</p><p>在 HTTP 协议支持的方法中，PUT 和 POST 是比较容易混淆的一对。我们来看看在 RESTful API 中应该如何正确使用这两种方法。</p><p>从语义的角度来说，HTTP PUT 方法的含义和 Java Map 中的 <code>put</code> 方法是一致的。下面是 Java Doc 的摘录。</p><blockquote><p>V put(K key, V value)</p><p>Associates the specified value with the specified key in this map (optional operation).<br>If the map previously contained a mapping for the key, the old value is replaced by the specified value.</p></blockquote><p>如果从 RESTful API 的角度来理解，PUT 方法是这么工作的：</p><ol><li>把一个对象 <code>V</code> 绑定到地址 <code>K</code> 上；今后请求地址 <code>K</code> 时，就会返回对象 <code>V</code>。</li><li>如果地址 <code>K</code> 之前曾绑定过另一个对象，比如 <code>V0</code>，那么 <code>V0</code> 会被 <code>V</code> 替换。</li></ol><p>举一个简单的例子，假设我的博客后台支持 RESTful API，我可以通过下面的请求发布这篇文章：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PUT https://bitmingw.com/2018/04/16/http-put-vs-post HTTP/1.1</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    /* 文章内容正文 */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看出，使用 PUT 方法时，客户端需要在 HTTP 请求中明确指定地址 <code>K</code>。</p><p>正如 Java 的例子一样，PUT 方法应当支持幂等性。如果是同一个对象 <code>V</code>，<strong>PUT 多次与 PUT 一次返回的结果应该是相同的</strong>。客户端可以利用 PUT 的幂等性安全地重试请求，保证客户端的请求至少被服务端处理一次。</p><p>如果把上面发布文章的例子用 HTTP POST 方法重写，它可能会是下面这样：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST https://bitmingw.com/post-article HTTP/1.1</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    /* 文章内容正文 */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>也就是说，地址 <code>K</code> 不是由客户端指定的，而是由服务端生成的。比如，服务端可能会根据日期和文章标题，为本文分配一个地址。</p><p>另外，与 PUT 方法不同<strong>，POST 方法是不支持幂等性的。同一个请求被处理两次，应当生成两份对象</strong>。</p><p>现在问题来了，如果真的遇到了网络故障，客户端应该如何重试 POST 请求呢？解决方法其实很简单，我们可以在 POST 请求中隐藏一个唯一的 token，服务端在处理请求后把 token 存入数据库，如果这个 token 之前遇到过，服务端就知道这是重复的 POST 请求，可以不再处理了。</p><p>另外实际开发中，更新操作一般不使用PUT，因为不是很安全，而是采用POST，但是在代码逻辑层面进行数据标识的判断，避免了POST的非幂等性的问题，同时POST还比PUT安全。</p><h3 id="HEAD"><a href="#HEAD" class="headerlink" title="HEAD"></a>HEAD</h3><p>类似于GET方法，只不过返回的响应中没有具体的内容，用于获取响应报文头。</p><p>常用于测试超链接的有效性。</p><h3 id="DELETE"><a href="#DELETE" class="headerlink" title="DELETE"></a>DELETE</h3><p>请求服务器删除指定资源。和PUT一样，DELETE也缺乏验证机制。</p><p>项目中一般不使用DELETE，使用DELETE很可能是个安全漏洞。</p><h3 id="OPTIONS"><a href="#OPTIONS" class="headerlink" title="OPTIONS"></a>OPTIONS</h3><p>用来查询服务器支持哪些HTTP方法</p><p>OPTIONS它用于获取当前URL所支持的方法。若请求成功，则它会在HTTP头中包含一个名为“Allow”的头，值是所支持的方法，如“GET, POST”</p><p><img src="https://pic4.zhimg.com/v2-6b5e6e14753632151fae1a62af0b55fb_r.jpg" alt=""></p><p>在上图中，我向服务器端发起了一个OPTIONS方法的请求，返回的数据中allow中显示了该URI所支持的HTTP方法。</p><h3 id="TARCE"><a href="#TARCE" class="headerlink" title="TARCE"></a>TARCE</h3><p>回显服务器端收到的请求，主要用于测试和诊断。（很少用，容易引发安全漏洞）</p><p>客户端发起一个TRACE方法的HTTP请求，看一下服务端回显的客户端请求，监测其是否被修改或篡改过。</p><h3 id="CONNECT"><a href="#CONNECT" class="headerlink" title="CONNECT"></a>CONNECT</h3><p>开启一个客户端与所请求资源之间的双向沟通的渠道，它可以用来创建隧道。</p><p>一般用于HTTP代理。当用户使用HTTP代理服务器来访问网站的时候，就会用到CONNECT方法。比如通过HTTP代理来访问Facebook，首先浏览器向代理服务器发送一个CONNECT方法的请求，代理服务器返回200的状态码，告知链接成功建立，之后浏览器就和服务器握手并交换数据，代理服务器只负责传输彼此的数据包，并不能读取具体的数据内容，不管是HTTPs还是HTTP，都是如此。</p><h2 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h2><p>状态码是用以标识网页服务器超文本传输协议响应状态的3位数字代码。</p><p><img src="https://pic1.zhimg.com/v2-aa8f935ab1ede1af9b1fd20e36649838_r.jpg" alt=""></p><h3 id="常见的状态码"><a href="#常见的状态码" class="headerlink" title="常见的状态码"></a>常见的状态码</h3><p><img src="https://pic1.zhimg.com/v2-eb8ddcadfad6aaaf652fee535d4aa15c_r.jpg" alt=""></p><p>举个生活中的例子：</p><p>202：你要请我吃饭，我说好，然后我俩就去吃饭了。</p><p>202：你要请我吃饭，但是要请我吃饭的人太多了，还轮不到你，你先排着队，排到你了咋就去吃。</p><p>206：你要请我吃饭，咱吃上了。吃到一半，我去接个电话，打完电话，回来接着吃。</p><p>206常见于HTTP断点续传，举个例子：我在下载电影，下到一半网线被拔了，之后我又重新接上网线，这时如果有断点续传，就可以不用重头下载，而是在中断的地方接着下载。</p><p>再补充几个2xx的状态码：</p><p><strong>204：</strong>请求执行成功，但是没有数据，<strong>浏览器不用刷新页面.也不用导向新的页面</strong>。如何理解这段话呢。还是通过例子来说明吧，假设页面上有个form，提交的url为http-204.htm，提交form，正常情况下，页面会跳转到http-204.htm，但是如果http-204.htm的相应的状态码是204，此时页面就不会发生转跳，还是停留在当前页面。另外对于a标签，如果链接的页面响应码为204，页面也不会发生跳转。</p><hr><p><img src="https://pic4.zhimg.com/80/v2-e487502215497883f21144e160dd51ad_hd.png" alt=""></p><p><strong>301适合永久重定向</strong></p><p>　　301比较常用的场景是使用域名跳转。</p><p>　　比如，我们访问 <strong>http</strong>://zhihu.com 会跳转到 <strong>https</strong>://<a href="http://www.zhihu.com，发送请求之后，就会返回301状态码，然后返回一个location，提示新的地址，浏览器就会拿着这个新的地址去访问。" target="_blank" rel="noopener">www.zhihu.com，发送请求之后，就会返回301状态码，然后返回一个location，提示新的地址，浏览器就会拿着这个新的地址去访问。</a> </p><p><img src="https://pic3.zhimg.com/v2-9e1cd55a0db3aeeafdcc874d83148f36_r.jpg" alt=""></p><p>　　<strong>注意： 301请求是可以缓存的， 即通过看status code，可以发现后面写着from cache。</strong></p><p>　    <strong>或者你把你的网页的名称从php修改为了html，这个过程中，也会发生永久重定向。</strong></p><p><strong>302用来做临时跳转</strong></p><p>　　比如未登陆的用户访问知乎首页临时重定向到登录页面。</p><p><img src="https://pic3.zhimg.com/v2-798b3db38f19de8e4fd023bde9950172_r.jpg" alt=""></p><p><strong>304：</strong> 如果客户端发送了一个带条件的GET 请求且该请求已被允许，而文档的内容（自上次访问以来或者根据请求的条件）并没有改变，则服务器应当返回这个304状态码。 简单的表达就是：服务端已经执行了GET，但文件未变化。</p><p>我访问<a href="https://pic4.zhimg.com/v2-983ed96f06690c848061c1abdc8f41c7_r.jpg" target="_blank" rel="noopener">https://pic4.zhimg.com/v2-983ed96f06690c848061c1abdc8f41c7_r.jpg</a>的时候就是304</p><hr><p><img src="https://pic2.zhimg.com/v2-0c073a2e526b762ddfff7ec9cf8c4855_r.jpg" alt=""></p><hr><p><img src="https://pic2.zhimg.com/80/v2-1a0ab33c48d5ef80e8031837056f5dc4_hd.png" alt=""></p><p>补充一下其他的常见5xx状态码：</p><p><strong>501：</strong>　服务器不具备完成请求的功能。例如，我尝试用options方法请求baidu.com，而badu.com服务端不具备options的请求。</p><p><strong>503：</strong>　服务器目前无法使用（由于超载或停机维护）</p><p><strong>504：</strong>    Bad Gateway timeout 网关超时</p><p><strong>505：</strong>　服务器不支持请求中所用的 HTTP 协议版本。</p><p>状态码参考文章和链接：</p><p><a href="https://www.jianshu.com/p/93555718732a" target="_blank" rel="noopener">https://www.jianshu.com/p/93555718732a</a></p><p><a href="https://www.runoob.com/http/http-status-codes.html" target="_blank" rel="noopener">https://www.runoob.com/http/http-status-codes.html</a></p><h2 id="HTTP状态管理（会话机制）：Cookie和Session"><a href="#HTTP状态管理（会话机制）：Cookie和Session" class="headerlink" title="HTTP状态管理（会话机制）：Cookie和Session"></a>HTTP状态管理（会话机制）：Cookie和Session</h2><p>前面说过，HTTP是无状态的，即对于每一次请求都是一个全新的请求，服务器不保存上一次请求的信息，就是它记不住东西，这种特性优点是解放了服务器，缺点就是每次要重复传输大量的信息。所以需要cookie和session来帮它做状态管理，cookie和session都是会话跟踪技术。</p><h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><p>cookie实际上是一小段的文本信息，客户端请求服务器，如果服务器需要记录该用户状态，同时这个浏览器是第一次访问本服务器，那么服务器就生成session和对应的session id，并通过response向客户端浏览器颁发这个session id，同时记录起来这个session（如存入数据库中）</p><p>客户端浏览器会把服务端传来的session id用cookie保存起来。当浏览器再请求该网站的时候，浏览器就把请求的网址连同该cookie以通提交给服务器，服务器检查该cookie中的session id，以此来辨认用户状态。</p><h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>session是<strong>服务器端使用的</strong>一种记录客户端状态的机制。session是另一种记录客户状态的机制，保存在服务器上。客户端浏览器访问服务器的时候，服务器把客户端信息以某种形式记录在服务器上。</p><p>客户端浏览器再次访问时只需要从该Session中查找该客户的状态就可以了。</p><p>cookie可以长期有效，但session存在有效期，有以下几种情况session会失效：</p><ul><li>session超时失效</li><li>程序调用HttpSession.invalidate()主动注销session，一般在用户退出登录或注销的时候发生</li><li>session一般存在于服务器的内存中，当内存溢出时或者服务器进程中止时，session也就失效了。</li></ul><p>”关闭浏览器后session就失效了“这种说法不准确，原因详见<a href="https://blog.csdn.net/zgrjkflmkyc/article/details/53706195" target="_blank" rel="noopener">此文章</a>。</p><h3 id="cookie与session配合使用"><a href="#cookie与session配合使用" class="headerlink" title="cookie与session配合使用"></a>cookie与session配合使用</h3><p><img src="https://pic1.zhimg.com/v2-9f78b0761755943e5757296cbe5040bc_r.jpg" alt=""></p><h3 id="浏览器禁用cookie"><a href="#浏览器禁用cookie" class="headerlink" title="浏览器禁用cookie"></a>浏览器禁用cookie</h3><p>我们可以认为的设置浏览器禁用cookie，那么如果浏览器中禁止了 Cookie，如何保障整个机制的正常运转。这就用到了<strong>URL重写</strong>和<a href="https://blog.csdn.net/thebesghost/article/details/1322255" target="_blank" rel="noopener">隐藏表单的方法</a>。</p><p>将sessionid附加在URL中，用分号隔开👇</p><p><img src="https://pic1.zhimg.com/80/v2-505f23eabd3400f97bf5e82bafd63911_hd.png" alt=""></p><p>或者将sessionid作为参数放在URL中👇</p><p><img src="https://pic3.zhimg.com/80/v2-cc7f76d3394b7a4a1379da7fed89224d_hd.png" alt=""></p><h3 id="cookie与session的不同"><a href="#cookie与session的不同" class="headerlink" title="cookie与session的不同"></a>cookie与session的不同</h3><ul><li>cookie存于客户端不太会给服务器造成压力，session存于服务器端，在高并发情况下容易给服务器造成压力。</li><li>cookie可能会被浏览器的程序窥探甚至修改，安全性不高；session在服务器端较安全。有关账号密码之类的隐私信息要先加密再存入cookie，又服务器端进行解密。</li><li>有效期不同，cookie可以设置一个很长的过期时间。但session不行，服务器会定时地清理超时的session。</li></ul><p>参考文章：<a href="https://blog.csdn.net/zhoucheng05_13/article/details/80530681" target="_blank" rel="noopener">https://blog.csdn.net/zhoucheng05_13/article/details/80530681</a></p><p><a href="https://juejin.im/post/5cd9037ee51d456e5c5babca" target="_blank" rel="noopener">https://juejin.im/post/5cd9037ee51d456e5c5babca</a>（这篇写的特好）</p><h2 id="HTTP协议中的编码和解码"><a href="#HTTP协议中的编码和解码" class="headerlink" title="HTTP协议中的编码和解码"></a>HTTP协议中的编码和解码</h2><h3 id="字符集与编码"><a href="#字符集与编码" class="headerlink" title="字符集与编码"></a>字符集与编码</h3><p><img src="https://pic4.zhimg.com/80/v2-78ff5d6d033da64ff06c3b10344d7e09_hd.png" alt=""></p><p>一套编码规范包括字库表、字符集和编码方式。</p><p>字库表里存储了该编码规范中所有可以显示的字符，gbk编码规范的字库表就包含了几乎所有的汉字，但是不包括法文、俄文，所以gbk不能显示法文俄文。在字库表里每个字符都有对应的二进制地址，而字符集就是这些地址的集合。比如说ASCII码中的字符集中，字母a对应的地址是65（二进制为01000001），根据这个地址就能显示字母a。字库表与字符集一一对应，相互转换。</p><p>直接拿二进制地址来显示字母是非常麻烦的而且很占空间，于是发明了一些算法来节省空间，这些算法被称作编码方式。</p><p>一套表码规范可以又多种编码方式，不同的编码方式又不同的使用场景。比如常见的编码方式utf-8，这是一种编码方式，它所对应的编码规范叫做Unicode。Unicode是一种编码规范，除了utf-8, 它还有utf-16、utf-32等编码方式。不同的编码方式节约的空间不一样。</p><p>总而言之就是，一个二进制数通过一种编码方式，转化成编码字符集中对应的地址，然后在字库表里找到这个地址对应的字符，最终显示给用户。</p><h3 id="常见的编码规范"><a href="#常见的编码规范" class="headerlink" title="常见的编码规范"></a>常见的编码规范</h3><p>常见的编码规范：ASCII、gbk、ISO-8859-1、Unicode等</p><p>ASCII码是最早产生的编码规范，一共包含了从00000000到01111111的128个字符，可以表示阿拉伯数字、英文大小写字母和一些简单的符号。每个字符占据的是<strong>一个字节（实际上使用7位）的空间</strong>。</p><p>gbk全称是汉字内码扩展规范。持国际标准ISO/IEC10646-1和国家标准GB13000-1中的全部中日韩汉字，并包含了BIG5编码中的所有汉字。它使用<strong>两个字节的空间</strong>大小来存储字符的地址。一般国内网站使用大量汉字的时候会使用gbk编码规范。</p><p>ISO-8859-1除了收录了ASCII码里的字符，还有西欧语言、泰语、阿拉伯语、希伯来语等等文字符号.。ISO-8859-1<strong>充分使用8位的空间大小，占一个字节的空间</strong>。MySQL的默认编码规范就是它。但是它不支持中文。</p><p>以上三种规范互相是不兼容的，国际标准化组织推出了一款全球性标准的编码规范——Unicode。Unicode包含了世界所有的字符，使用<strong>4字节空间地址</strong>。虽说Unicode使用4字节的空间大小收尽了所有的字符，但每个字符都要使用4字节的空间大小，这有些浪费存储空间。于是推出了几种编码方式，最广为人所用的就是utf-8，utf-8是一种<strong>变长</strong>字符编码方式，再强调一次，utf-8是编码方式不是编码规范。utf-8的优势在于，对于一个字节就可以表示的字符，Unicode采用ASCII编码，通常用的英文都是一个字节，中文就采用三个字节，虽然中文编码方面Unicode编码占的空间没有ASCII编码所占空间小，但是它胜在面向全世界。当然，我们需要根据具体的使用环境来选择不同的编码规范。</p><h3 id="乱码的由来"><a href="#乱码的由来" class="headerlink" title="乱码的由来"></a>乱码的由来</h3><p>使用错误的编码规范来进行编码和解码，都会产生乱码现象。</p><h3 id="URL的编码与解码"><a href="#URL的编码与解码" class="headerlink" title="URL的编码与解码"></a>URL的编码与解码</h3><p>URL是采用ASCII码字符集进行编码的，所以如果URL中含有非ASCII码字符集的字符，就要对其进行编码。另外，URL中有一些保留字，如“&amp;”，表示参数分隔符，如果想要在URL中使用这些保留字，就要进行编码。至于具体怎么编码，就要用到“百分号编码规范”（“%编码”规范）。</p><p>对URL中属于ASCII字符集的非保留字不做编码；对URL中的保留字需要取其ASCII内码，然后加上“%”前缀将该字符进行编码；对于URL中的非ASCII字符需要取其Unicode内码，然后加上“%”前缀将该字符进行编码。</p><p><img src="https://pic2.zhimg.com/v2-8c7bac3dcc754caa225e826a2f74da8d_r.jpg" alt=""></p><h2 id="HTTP协议之身份认证"><a href="#HTTP协议之身份认证" class="headerlink" title="HTTP协议之身份认证"></a>HTTP协议之身份认证</h2><p>HTTP是无状态的，即对于每一次请求都是一个全新的请求，服务器不保存上一次请求的信息，记不住请求者的信息。但是实际开发中，身份认证是非常重要的，有的HTTP请求只能允许部分人发起，因此需要身份认证。</p><p>常见的认证方式有：</p><ul><li>BASIC认证（基本认证）</li><li>DIGEST认证（摘要认证）</li><li>SSL客户端认证</li><li>FormBase认证（基于表单认证）</li></ul><h3 id="BASIC基本认证"><a href="#BASIC基本认证" class="headerlink" title="BASIC基本认证"></a>BASIC基本认证</h3><p>Basic身份认证，是HTTP 1.0中引入的认证方案之一。虽然方案比较古老，同时存在安全缺陷，但由于实现简单，至今仍有不少网站在使用它。</p><p><img src="https://pic4.zhimg.com/v2-4b2d93c38a1924ac8746c884b14ef6af_r.jpg" alt=""></p><p>工作原理：</p><p><img src="https://pic4.zhimg.com/v2-983ed96f06690c848061c1abdc8f41c7_r.jpg" alt=""></p><p>BASIC基本认证使用的是明文密码，安全性差。</p><h3 id="DIGEST认证"><a href="#DIGEST认证" class="headerlink" title="DIGEST认证"></a>DIGEST认证</h3><p>DIGEST认证同样使用质询/响应的方式，但不会向BASIC认证那样直接发送明文密码。服务器端会返回一个临时的质询码，客户端收到后会发送摘要以及由质询码计算得来的响应码，这比起明文base64编码来得安全。</p><p><img src="https://pic1.zhimg.com/v2-16fd13ed150171630d7ada72bf1860c4_r.jpg" alt=""></p><p>DIGEST认证提供了防止mi’ma被窃听的保护机制，但是没有防止用户伪装的保护机制。所以其安全性也不算高。</p><h3 id="SSL客户端认证"><a href="#SSL客户端认证" class="headerlink" title="SSL客户端认证"></a>SSL客户端认证</h3><p>SSL客户端认证是借由HTTPS的客户端证书完成认证的方式。凭借客户端证书认证，服务器可确认访问是否来自自己登录的客户端。</p><p>SSL安全性高，但是使用的成本高，一般是银行或者网银使用。</p><h3 id="基于表单的认证"><a href="#基于表单的认证" class="headerlink" title="基于表单的认证"></a>基于表单的认证</h3><p>基于表单的认证方法并不是在HTTP协议中定义的，使用由web应用程序各自实现基于表单的认证方式。通过cookie和session的方式来保持用户的状态。</p><p>这是最广泛使用的认证方法。</p><h2 id="长连接与短连接"><a href="#长连接与短连接" class="headerlink" title="长连接与短连接"></a>长连接与短连接</h2><p>HTTP协议是基于请求/响应模式的，因此只要服务端给了响应，本次HTTP请求就结束了，是无连接的。所以就谈不上什么长连接短链接了，那么我们说的HTTP长连接短链接究竟是什么意思呢？</p><p><strong>HTTP的长连接和短链接本质上是TCP长连接和短链接。</strong></p><p>HTTP/1.0中，默认使用的是短链接。也就是说，浏览器和服务器每进行一次HTTP操作，就建立一次连接，结束后就中断。</p><p>HTTP/1.1起，默认使用长连接，用以保持连接特性。</p><p>访问百度首页：</p><p><img src="https://pic3.zhimg.com/v2-af381740b7676fbd8f89681cbb99c6ee_r.jpg" alt=""></p><p>打开开发者工具可以看到响应头里有<code>Connection：keep-alive</code>报文字段。这是一个长连接，用于传输数据的TCP/IP连接并没有断开，如果客户端再次访问这个网页，会继续使用这条已经建立的连接。注意，keep-alive不会永久保持，它也有一个保持时间，可以用apache等中间件进行设置。</p><p><img src="https://pic2.zhimg.com/v2-fff9f2850d504f3d129f3bec11d54fa1_r.jpg" alt=""></p><p>那些需要频繁请求的业务场景就需要用到长连接。目前大多数网站都默认使用长连接。</p><p>参考文章：<a href="https://www.cnblogs.com/0201zcr/p/4694945.html" target="_blank" rel="noopener">https://www.cnblogs.com/0201zcr/p/4694945.html</a>（写得很好）</p><h2 id="HTTP中介之代理proxy"><a href="#HTTP中介之代理proxy" class="headerlink" title="HTTP中介之代理proxy"></a>HTTP中介之代理proxy</h2><p><img src="https://pic4.zhimg.com/v2-7f176794f2dc6ce1f6cfe490853c9073_r.jpg" alt=""></p><p>比如常见的Charles和fiddler就是代理服务器软件。</p><h3 id="代理服务器的作用"><a href="#代理服务器的作用" class="headerlink" title="代理服务器的作用"></a>代理服务器的作用</h3><ul><li>翻墙（和vpn的原理还不一样，VPN的原理是隧道技术而非代理服务器）</li><li>抓包</li><li>匿名访问</li><li>儿童过滤器</li></ul><h3 id="使用代理服务器的安全问题"><a href="#使用代理服务器的安全问题" class="headerlink" title="使用代理服务器的安全问题"></a>使用代理服务器的安全问题</h3><p>代理服务器和抓包工具（比如Fiddler）都能看到http request中的数据。 如果我们发送的request中有敏感数据，比如用户名，密码，信用卡号码。这些信息都会被代理服务器看到。所以非常危险。 所以我们一般都是用HTTPS来加密Http request.  这样代理服务器就看不到里面的数据了。</p><p>参考文章：<a href="https://www.cnblogs.com/dhl-2013/p/3252986.html" target="_blank" rel="noopener">https://www.cnblogs.com/dhl-2013/p/3252986.html</a>（写得很好）</p><h2 id="HTTP中介之网关gateway"><a href="#HTTP中介之网关gateway" class="headerlink" title="HTTP中介之网关gateway"></a>HTTP中介之网关gateway</h2><p>网关可以作为某种翻译器使用，它抽象出了一种能够到达资源的方法。网关是资源和应用程序之间的粘合剂。</p><p><strong>网关扮演的是“协议转换器”的角色。</strong></p><p> 可以用一个斜杠来分隔客户端和服务器端协议，并以此对网关进行描述：</p><p>&lt; 客户端协议 &gt;/&lt; 服务器端协议 &gt;</p><ul><li>服务器端网关（server-side gateway）通过 HTTP 与客户端对话，通过其他协议与服务器通信（HTTP/*）。</li><li>客户端网关（client-side gateway）通过其他协议与客户端对话，通过 HTTP 与服务器通信（*/HTTP）。</li></ul><h3 id="常见的几种网关"><a href="#常见的几种网关" class="headerlink" title="常见的几种网关"></a>常见的几种网关</h3><p><strong>1、 HTTP/*：服务器端Web网关</strong></p><p>　　请求流入原始服务器时，服务器端Web网关会将客户端HTTP请求转换为其他协议</p><p>　　在下图中，网关收到了一条对FTP资源的HTTP请求:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ftp://ftp.irs.gov/pub/00-index.txt</span><br></pre></td></tr></table></figure><p><img src="https://pic.xiaohuochai.site/blog/HTTP_gateway4.jpg" alt="gateway4"></p><p>　　网关会打开一条到原始服务器FTP端口(端口 21)的FTP连接，通过FTP协议获取对象。网关会发送USER和PASS命令登录到服务器上去；发布CWD命令，转移到服务器上合适的目录中去；将下载类型设置为ASCII；用MDTM获取文档的最后修改时间；用PASV告诉服务器将有被动数据获取请求到达；用RETR请求进行对象获取；打开到FTP服务器的数据连接，服务器端口由控制信道返回，一旦数据信道打开了，就将对象内容回送给网关</p><p>　　完成获取之后，会将对象放在一条HTTP响应中回送给客户端</p><p>　　<strong>2、HTTP/HTTPS：服务器端安全网关</strong></p><p>　　一个组织可以通过网关对所有的输入Web请求加密，以提供额外的隐私和安全性保护。客户端可以用普通的HTTP浏览Web内容，但网关会自动加密用户的对话</p><p><img src="https://pic.xiaohuochai.site/blog/HTTP_gateway5.jpg" alt="gateway5"></p><p>　　<strong>3、HTTPS/HTTP：客户端安全加速器网关</strong></p><p>　　可以将HTTPS/HTTP网关作为安全加速器使用，这些HTTPS/HTTP网关位于Web服务器之前，通常作为不可见的拦截网关或反向代理使用。它们接收安全的HTTPS流量，对安全流量进行解密，并向Web服务器发送普通的HTTP请求</p><p><img src="https://pic.xiaohuochai.site/blog/HTTP_gateway6.jpg" alt="gateway6"></p><p>　　这些网关中通常都包含专用的解密硬件，以比原始服务器有效得多的方式来解密安全流量，以减轻原始服务器的负荷。这些网关在网关和原始服务器之间发送的是未加密的流量。所以，要谨慎使用，确保网关和原始服务器之间的网络是安全的</p><p>【资源网关】</p><p>　　最常见的网关——应用程序服务器，会将目标服务器与网关结合在一个服务器中实现。应用程序服务器是服务器端网关，与客户端通过HTTP进行通信，并与服务器端的应用程序相连</p><p><img src="https://pic.xiaohuochai.site/blog/HTTP_gateway7.jpg" alt="gateway7"></p><p>　　在上图中，两个客户端是通过HTTP连接到应用程序服务器的。但应用程序服务器并没有回送文件，而是将请求通过一个网关应用编程接口(Application Programming Interface, API)发送给运行在服务器上的应用程序</p><p>　　收到客户端A的请求，根据URI将其通过API发送给一个数码相机应用程序。 将得到的图片绑定到一条HTTP响应报文中，再回送给客户端，在客户端的浏览器中显示</p><p>　　客户端B的URI请求的是一个电子商务应用程序。客户端B的请求是通过服务器网关API发送给电子商务软件的，结果会被回送给浏览器。电子商务软件与客户端进行交互，引导用户通过一系列HTML页面来完成购物</p><p>参考文章：<a href="https://xiaohuochai.site/HTTP/structure/others.html" target="_blank" rel="noopener">https://xiaohuochai.site/HTTP/structure/others.html</a></p><h2 id="HTTP缓存"><a href="#HTTP缓存" class="headerlink" title="HTTP缓存"></a>HTTP缓存</h2><p>参考文章：<a href="https://www.cnblogs.com/echolun/p/9419517.html" target="_blank" rel="noopener">https://www.cnblogs.com/echolun/p/9419517.html</a></p><p>如果没有缓存，客户端每次都要请求数据，浪费流量。同时，服务器每次都要提供查找、下载，请求用户基数如果比较大的话，服务器也会存在比较大的压力。客户端每次加载完后要进行页面渲染，用户体验显得特别差。</p><p>那么，我们可不可以将文件保存起来，这就需要做HTTP缓存。     </p><p>H<strong>TTP缓存主要针对样式文件(CSS)、JS文件、图片等更新频率不高的静态文件。</strong>所以，缓存不是缓存了一个HTTP请求的响应，更多是一些静态的资源文件。</p><p>在HTTP协议里面，更多通过请求头和响应头来实现。</p><h3 id="HTTP缓存头部字段"><a href="#HTTP缓存头部字段" class="headerlink" title="HTTP缓存头部字段"></a>HTTP缓存头部字段</h3><p><strong>Cache-Control：</strong></p><p>存在于请求头和响应头，是缓存控制字段。它是控制HTTP缓存的最高指令。</p><p><img src="https://pic4.zhimg.com/v2-e04ce39e4cb49751f44e4644451fde77_r.jpg" alt=""></p><p><strong>Expires：</strong></p><p>响应头字段，代表资源过期时间，有服务器返回提供，是HTTP/1.0的属性，在和max-age共存时，优先级要低。</p><p><strong>Last-Modified：</strong>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </p><p>响应头字段，表示资源最近一次的修改时间，由服务器告知浏览器。跟它经常一起使用的是另一个请求头字段<code>if-Modified-Since</code>。</p><p><strong>if-Modified-Since：</strong></p><p>请求头字段，也是表示资源最近一次的修改时间（实际上就是上次服务器返回的Last-Modified），由浏览器告知服务器，和<code>Last-Modified</code>是一对，它俩会进行比对。</p><p><strong>Etag：</strong></p><p>响应头字段，缓存资源标识，由服务器告知浏览器。</p><p><strong>if-None-Match：</strong></p><p>请求头字段，缓存资源标识，由浏览器告知服务器，（其实就是上次服务器给的Etag），和Etag是一对，它俩会进行对比。</p><h3 id="HTTP缓存工作方式"><a href="#HTTP缓存工作方式" class="headerlink" title="HTTP缓存工作方式"></a>HTTP缓存工作方式</h3><h4 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a><strong>Expires</strong></h4><p><strong>场景一：</strong>让服务器与浏览器约定一个文件过期时间——<strong>Expires</strong></p><p>浏览器：服务器，我要一个xxx.js文件，帮我找找，然后发给我。</p><p>服务器：次次找我要，烦死了。文件给你可以，我们约定一个时间(Expires)，时间没到就别来烦我了。返回了目标文件以及过期时间Expires。</p><p>Expires时间内，浏览器不会再向服务器要xxx.js文件而是使用本地缓存。Expires过期了，浏览器就又会重新发起请求了。但是有这么一种情况，Expires过期了，浏览器重新向服务器要这个xxx.js文件，但是，这个文件并没有发生任何修改。所以这种请求是浪费的。</p><h4 id="Last-Modified与if-Modified-Since"><a href="#Last-Modified与if-Modified-Since" class="headerlink" title="Last-Modified与if-Modified-Since"></a><strong>Last-Modified</strong>与<strong>if-Modified-Since</strong></h4><p><strong>场景二：</strong>让服务器与浏览器在约定文件过期时间的基础上，再加一个文件最新修改时间的对比——<strong>Last-Modified</strong>与<strong>if-Modified-Since</strong></p><p>浏览器：服务器我要一个xxx.js文件，你找到了给我，顺便给我一个过期时间Expires，时间没到我保证不烦你。</p><p>服务器：OK，过期时间Expires我给你，另外再给你一个文件最新修改时间Last-Modified，到时候Expires过期了咱俩核对文件修改时间，对得上(说明文件未被改动)，你就别烦我。返回了xxx.js+Expires+Last-Modified。</p><p>模拟情况：浏览器在Expires过期后，向服务器发起了请求，服务器核对浏览器请求头的if-Modified-Since和自己服务器响应报文头的Last-Modified，发现是一样的，说明该目标文件没有被修改过，所以服务器响应报文会给浏览器返回304状态码，告知浏览器自上次访问以来资源并没有改变，浏览器接着使用本地缓存，不用浪费流量。</p><p><img src="https://pic3.zhimg.com/v2-650886977ac33ef888180368249106ae_r.jpg" alt=""></p><p>有了Expires和文件修改时间这双重机制，还是不够的。Expires可以在浏览器端被修改，不可靠。而Last-Modified和if-Modified-Since只能精确到秒，如果文件恰好在一秒内发生了修改，那么Last-Modified和if-Modified-Since是不可靠的，文件无法拿到最新的文件。</p><h4 id="Etag与If-None-Match"><a href="#Etag与If-None-Match" class="headerlink" title="Etag与If-None-Match"></a>Etag与If-None-Match</h4><p><strong>场景三：</strong>让服务器与浏览器在过期时间Expires+Last-Modified的基础上，增加一个文件内容唯一对比标识Etag与If-None-Match。Expires不稳定，再加一个max-age来加以代替。</p><p>浏览器：我要xxx.js文件</p><p>服务器：xxx.js我给你，过期时间Expires我也给你，再给你一个cache-control: max-age=60(单位秒)，Last-Modified我也给你，再加一个文件内容唯一标识Etag。</p><p>事实上有了<code>cache-control: max-age=</code>，Expires就没用了；有了Etag，Last-Modified就没用了；max-age和Etag的优先级是最高的。尽管如此，服务器很多情况下还是会将Expires和Last-Modified返回给浏览器。</p><p>模拟场景：浏览器在max-age的时间到了之后，向服务器发起了请求，服务器核对浏览器请求头的If-None-Match和自己服务器响应报文头的Etag，发现是一样的，说明该目标文件没有被修改过，所以服务器响应报文会给浏览器返回304状态码，告知浏览器自上次访问以来资源并没有改变，浏览器接着使用本地缓存，不用浪费流量。</p><p><img src="https://pic3.zhimg.com/v2-c3186628332d228b6676bc6ad9482cea_r.jpg" alt=""></p><p><strong>max-age和Expires的区别</strong></p><p>在用fiddler抓包的时候，发现不少网站同时设置了max-age和Expires，为毛要设置两个，功能不都差不多吗，两者区别是啥？</p><p>1.max-age是http1.1的属性，Expires是http1.0的属性，为了做到向下兼容，一般写两个。但如在1.1环境下，max-age优先级比Expires高。</p><p>2.max-age是相对过期时间，Expires是绝对过期时间。max-age在浏览器成功缓存文件后，只需相对请求成功之后的多长时间不再发起请求就好了，而Expires总是需要服务器返回一个精准的GMT格式的日期，并以这个日期为标准来判断缓存是否过期，想对就比较麻烦，所以才有了max-age这样的存在来代替它。</p><p>同理，no-cache和 Pargma也是这样的存在，一个是1.1的属性，一个是1.0，向下兼容，同时写了两个。</p><h3 id="缓存改进方案"><a href="#缓存改进方案" class="headerlink" title="缓存改进方案"></a>缓存改进方案</h3><p>Expires和max-age未过期的情况下，浏览器是无法主动感知到服务器文件变化的；服务器的文件变化了，浏览器的缓存时间还没到，浏览器就无法及时的更新文件。那么，如果我们改变了文件，那么如何让用户知道呢？</p><h4 id="1-md5-hash缓存"><a href="#1-md5-hash缓存" class="headerlink" title="1.md5/hash缓存"></a><strong>1.md5/hash缓存</strong></h4><p>通过<strong>不缓存html</strong>，为静态文件添加MD5或者hash标识，解决浏览器无法跳过缓存过期时间主动感知文件变化的问题。</p><p>为什么这么做？实现原理是什么？</p><p>我们前面说的http缓存方案，服务器与浏览器的文件修改时间对比，文件内容标识对比，前提基础都是建立在<strong>两者文件路径完全相同</strong>的情况下。</p><p><strong>module/js/a-hash1.js</strong>与<strong>module/js/a-hash2.js</strong>是两个完全不同的文件，假想浏览器第一次加载页面，请求并缓存了<strong>module/js/a-hash1.js，</strong>第二次加载，文件指向变成了<strong>module/js/a-hash2.js，</strong>浏览器会直接重新请求<strong>a-hash2.js，因为</strong>这就是两个完全不同的文件，哪里还有什么http缓存文件对比，t通过这种做法，我们就可以从根本上解决过期时间没到浏览器无法主动请求服务器的问题。因此我们只需要在项目每次发布迭代将修改过的静态文件添加不同的MD5或hash标识就好啦。</p><p><strong>注意，这里不推荐缓存html文件(或许有更好的做法，欢迎留言)，这样每次html加载渲染都可以感知文件变化，反正文件没变还是使用本地缓存，文件名都变了说明修改过，重新请求缓存就好了。</strong></p><p>怎么改？一个个手动去修改？那不得累死。webpack提供了<strong>webpack-md5-hash插件</strong>，可以帮助开发者在项目发布时自动修改文件标识。</p><p>我们公司因为用的是fis3打包工具，这里使用的是<strong>fis3构建-文件指纹</strong>(搜文件指纹)，原理都差不多。</p><p><img src="https://images2018.cnblogs.com/blog/1213309/201808/1213309-20180812210442732-1599210158.png" alt="img"></p><h4 id="2-CDN缓存"><a href="#2-CDN缓存" class="headerlink" title="2.CDN缓存"></a><strong>2.CDN缓存</strong></h4><p>在文章开头cache-control相关值介绍中，提到了例如s-maxage代理服务器的概念，本人在整理http缓存相关知识点时，从同学口中了解到了也较为推荐的http缓存方案——CDN缓存，这里就作为一个拓展吧，正常的缓存还是推荐MD5缓存。</p><p><strong>2.1什么是CDN</strong></p><p>了解CDN缓存，先得知道什么是CDN，CDN是构建在网络之上的内容分发网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。CDN的关键技术主要有内容存储和分发技术(较为官方的说明)。</p><p>之前看到一个不错的例子，这里直接拿过来举例说说CDN。</p><p>假设多年前我们所在的城市只有一个火车站，每次春运，整个城市的人都得去这个火车站买票，人流量以及购票的需求可想而知有多大，为了缓解这个问题，城市的不同区，都出现了火车票代售点，这样每个区的人都可以就近买票了，火车站总站的压力就这样大大减轻了。</p><p>我们可以把每个区的售票点称之为CDN节点，也就是前面所说的代理服务器。简而言之，我们可以把CDN理解成浏览器与服务器之间的临时站点，它会替服务器处理一部分的浏览器请求，从而整理减轻总服务器的压力。</p><p>我们可以把CDN的价值归纳为：</p><p>1.CDN通过分流的形式，大大减轻源站的访问压力。</p><p>2.就像住的区比较偏远，每次买票要去城市中心，而这个区后来有了分站，火车票就可以就近购买一样。CDN也解决了跨地区访问问题，根本上为访问提供了加速。</p><p><strong>2.2什么是CDN缓存</strong></p><p><strong>CDN边缘节点缓存数据，当浏览器请求，CDN将代替源站判断并处理此处请求。</strong></p><p>日常请求对话</p><p>第一次请求</p><p>浏览器：服务器老哥，我需要a.js.</p><p>服务器：（恼羞成怒）文件我给我小弟CDN了，以后你要这个找CDN，别找我了。成功返回a.js给CDN，CDN进行缓存，同时CDN返回给浏览器，浏览器自己也进行了缓存(cache-control的值public就是用在这的)。</p><p>后续请求…</p><p>浏览器：服务器，我缓存时间到了，赶紧给我对比下文件，看看要不要重新返回给我。</p><p>CDN节点：打住打住，叫唤啥呢，我大哥比较忙，文件给我看看，请求被代理了。</p><p>情况1：CDN节点自己缓存的文件未过期，于是返回了304给浏览器，打回了这次请求。</p><p>情况2：CDN节点发现自己缓存的文件过期了，为了保险起见，自己发起请求给了服务器(源站)，成功拿回了最新数据，然后再交给与了浏览器。</p><p>其实说到这，CDN缓存的问题也跟前面的http缓存一样，CDN缓存时间不过期，浏览器始终被拦截，无法拿到最新的文件。</p><p>但是我们回归http缓存问题本质，缓存本身针对于更新频率不高的静态文件，其次，CDN缓存提供了分流以及访问加速其它优势条件。这里我问过同学，得到的信息是，CDN类似一个平台，是可以通过登录，手动更新CDN缓存的，变相解决了浏览器缓存无法手动控制的问题。</p><h3 id="浏览器操作对HTTP缓存的影响"><a href="#浏览器操作对HTTP缓存的影响" class="headerlink" title="浏览器操作对HTTP缓存的影响"></a>浏览器操作对HTTP缓存的影响</h3><p>1.<strong>浏览器地址栏回车，或者点击跳转按钮，前进，后退，新开窗口</strong>，这些行为，会让Expires，max-age生效，也就是说，这几种操作下，浏览器会判断过期时间，再考虑要不要发起请求，当然Last-Modified和Etag也有效。</p><p>2.<strong>F5刷新浏览器，或者使用浏览器导航栏的刷新按钮</strong>，这几种，会忽略掉Expires，max-age的限制，强行发起请求，Last-Modified和Etag在这种情况下也有效。</p><p>3<strong>.CTRL+F5</strong>是强制请求，所有缓存文件都不使用，全部重新请求下载，因此Expires，max-age，Last-Modified和Etag全部失效。</p><p><img src="https://images2018.cnblogs.com/blog/1213309/201808/1213309-20180812215938593-1709664851.png" alt="img"></p><h3 id="强缓存与协商性缓存-弱缓存"><a href="#强缓存与协商性缓存-弱缓存" class="headerlink" title="强缓存与协商性缓存(弱缓存)"></a><strong>强缓存与协商性缓存(弱缓存)</strong></h3><p>了解了上面不同浏览器行为对http缓存的不同影响，理解强缓存与协商性缓存就很容易了。</p><p><strong>强缓存：</strong>不发起http请求，直接使用本地缓存，比如浏览器地址栏回车，使用浏览器的刷新按钮，在Expires或max-age生效的情况下，触发的都是强缓存。</p><p><strong>协商性缓存(弱缓存)：</strong>在使用本地缓存前，先与服务器协商，核对缓存文件是否为最新。比如设置了cache-control=no-cache，不管你做任何操作，都会发起请求，这一类就是协商性缓存了。</p><h2 id="内容协商机制"><a href="#内容协商机制" class="headerlink" title="内容协商机制"></a>内容协商机制</h2><p>举个例子，同样是访问<a href="https://www.google.com/" target="_blank" rel="noopener">https://www.google.com/</a>，在中国显示的就是中文的，在英国就显示英文的，在法国就显示法文的。</p><p>一个URL常常要代表若干个不同的资源，例如那种多种语言显示的网站站点，希望给英语用户提供英文版，给中文用户提供给中文版，这就需要用到内容协商机制。</p><p><strong>内容协商机制</strong>指客户端和服务器端就响应的资源内容进行交涉，然后提供给客户端最为合适的资源。内容协商会以响应资源的语言、字符集、编码方式等作为判断的基准。通过这种方法，同一个URL就可以代表不同的网站。</p><p>一共有三种方式来决定哪个页面最适合当前客户端。</p><p>详见<a href="https://www.cnblogs.com/supersnowyao/p/8593828.html" target="_blank" rel="noopener">https://www.cnblogs.com/supersnowyao/p/8593828.html</a>这篇文章讲得很好</p><h2 id="补充一下：请求体-响应体和实体的区别"><a href="#补充一下：请求体-响应体和实体的区别" class="headerlink" title="补充一下：请求体/响应体和实体的区别"></a>补充一下：请求体/响应体和实体的区别</h2><p><a href="https://blog.csdn.net/u012422829/article/details/51570652" target="_blank" rel="noopener">https://blog.csdn.net/u012422829/article/details/51570652</a></p><h2 id="断点续传和多线程分块下载"><a href="#断点续传和多线程分块下载" class="headerlink" title="断点续传和多线程分块下载"></a>断点续传和多线程分块下载</h2><p>有时用户上传/下载文件需要历时数小时，万一线路中断，不具备断点续传的 HTTP/FTP 服务器或下载软件就只能从头重传，比较好的 HTTP/FTP 服务器或下载软件具有断点续传能力，允许用户从上传/下载断线的地方继续传送，这样大大减少了用户的烦恼。</p><p>常见的支持断点续传的上传/下载软件：QQ 旋风、迅雷、快车、电驴、酷6、土豆、优酷、百度视频、新浪视频、腾讯视频、百度云等。</p><p><strong>断点续传：</strong>指的是在上传/下载时，将任务（一个文件或压缩包）人为的<strong>划分为几个部分</strong>，每一个部分采用一个线程进行上传/下载，如果碰到网络故障，可以从已经上传/下载的部分开始继续上传/下载未完成的部分，而没有必要从头开始上传/下载。可以节省时间，提高速度。</p><p>HTTP通过在Header里两个参数实现的，客户端发请求时对应的时Range，服务器端响应时对应的时Content-Range。无论是断点续传还是多线程分块下载，如果续传成功，返回206并返回剩余的文件内容；如果文件有变动，返回200状态码和新文件的内容。这是HTTP协议里自带的规则。</p><p>Range：</p><p>用于请求头，指定第一个字节的位置和最后一个字节的位置，一般格式为:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Range: (unit=first byte pos)-[last byte pos]</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Range: bytes=0-499   //表示第0到第499字节范围的内容</span><br><span class="line">Range: bytes=500-999 //表示第500到第999字节范围的内容</span><br><span class="line">Range: bytes=-500    //表示最后500个字节的内容</span><br><span class="line">Range: bytes=500-    //表示从第500字节开始到文件结束的部分</span><br><span class="line">Range: bytes=500-600,601-999    //分块了，分别表示表示第500到第600字节范围的内容和表示第601到第999字节范围的内容</span><br></pre></td></tr></table></figure><p><strong>Content-Range：</strong></p><p>用于响应头中，在发出带Range的请求后，服务器会在content-Range头部返回当前接收的范围和文件总大小。一般格式为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Range: bytes(unit first byte pos) - [last byte pos]/[entity length]</span><br></pre></td></tr></table></figure><p>而在响应完成后，返回的响应头内容也不同：</p><ul><li>HTTP/1.1 200 OK （不使用断点续传方式）</li><li>HTTP/1.1 206 Partial Content （使用断点续传）</li></ul><p><img src="https://pic4.zhimg.com/v2-283bc5b378a63a0bc07099c824680c6b_r.jpg" alt=""></p><p> 多线程分块下载也是类似于上述这种断点续传的过程，只不过断点续传是被动的增量下载，而多线程下载是主动的分片下载，但是都是使用的Range的这种模式</p><h2 id="初识HTTP与HTTPS"><a href="#初识HTTP与HTTPS" class="headerlink" title="初识HTTP与HTTPS"></a>初识HTTP与HTTPS</h2><p>参考文章：<a href="https://www.jianshu.com/p/30b8b40a671c" target="_blank" rel="noopener">https://www.jianshu.com/p/30b8b40a671c</a></p><p>实际上HTTP和HTTPS可以算是两种不同的网络传输协议，虽然就差一个字母，但是本质确实大不相同。</p><p><img src="https://pic1.zhimg.com/80/v2-274d4f6d5a04c2dcde944d6f4cfdc73c_hd.jpg" alt=""></p><p>HTTP协议是应用层的协议，以请求和响应的方式在客户端和服务端进行通信。HTTP协议不够安全，因为其是以明文方式进行传输的，不做任何加密。在HTTP传输的过程中可能被中间人截获并篡改了信息。</p><p>针对明文传输的缺点，我们可以对明文进行加密，加密分两种：一种叫对称加密，另一种叫非对称加密。</p><p>对称加密也称密钥加密，即加密和解密使用的都是同一个密钥。而非对称加密也叫公钥加密，即加密和解密使用不同的密钥。</p><h3 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h3><p>小灰和小红可以事先约定一种<strong>对称加密</strong>方式，并且约定一个随机生成的密钥。后续的通信中，信息发送方都使用密钥对信息加密，而信息接收方通过同样的密钥对信息解密。</p><p><img src="https://pic3.zhimg.com/80/v2-f44db3085c661cd5ed65ec091333e45e_hd.jpg" alt="img"></p><p>虽然我们在后续的通信中对明文进行了加密，但是第一次约定加密方式和密钥的通信仍然是明文，如果第一次通信就已经被拦截了，那么密钥就会泄露给中间人，中间人仍然可以解密后续所有的通信内容。</p><h3 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h3><p>针对上述问题，我们可以使用<strong>非对称加密</strong>，为密钥的传输做一层额外的保护。</p><p>非对称加密的一组秘钥对中，包含一个公钥和一个私钥。明文既可以用公钥加密，用私钥解密；也可以用私钥加密，用公钥解密。</p><p>在小灰和小红建立通信的时候，小红首先把自己的公钥Key1发给小灰：</p><p><img src="https://pic2.zhimg.com/80/v2-f3ab1daafe9daa179a15d447467c7aed_hd.jpg" alt="img"></p><p>收到小红的公钥以后，小灰自己生成一个用于对称加密的密钥Key2（key2用于对称加密通信数据），并且用刚才接收的公钥Key1对Key2进行加密，发送给小红：</p><p><img src="https://pic2.zhimg.com/80/v2-d2daf8ba5615dc9d427a6fe3d20d1031_hd.jpg" alt="img"></p><p>小红利用自己非对称加密的私钥，解开了公钥Key1的加密，获得了Key2的内容。从此以后，两人就可以利用Key2进行对称加密的通信了。</p><p><img src="https://pic4.zhimg.com/80/v2-d3ecc2fa78ccaed37c478b4055198ceb_hd.jpg" alt="img"></p><p>在通信过程中，即使中间人在一开始就截获了公钥Key1，由于不知道私钥是什么，也无从解密。</p><p>  <strong>但是，这还不是最安全的！</strong></p><p>中间人虽然不知道小红的私钥是什么，但是在截获了小红的公钥Key1之后，却可以偷天换日，自己另外生成一对公钥私钥，把自己的公钥Key3发送给小灰。</p><p><img src="https://pic3.zhimg.com/80/v2-9a458296959c052b026560a5892368f2_hd.jpg" alt="img"></p><p>小灰不知道公钥被偷偷换过，以为Key3就是小红的公钥。于是按照先前的流程，用Key3加密了自己生成的对称加密密钥Key2，发送给小红。</p><p>这一次通信再次被中间人截获，中间人先用自己的私钥解开了Key3的加密，获得Key2，然后再用当初小红发来的Key1重新加密，再发给小红。</p><p><img src="https://pic2.zhimg.com/80/v2-5123c1a68be44a178c6f6c1543dfc3f1_hd.jpg" alt="img"></p><p>这样一来，两个人后续的通信尽管用Key2做了对称加密，但是中间人已经掌握了Key2，所以可以轻松进行解密。</p><h3 id="引入证书"><a href="#引入证书" class="headerlink" title="引入证书"></a>引入证书</h3><p>上述情况的中间人太狡猾了，难道再把公钥进行一次加密吗？这样只会陷入鸡生蛋蛋生鸡，永无止境的困局。</p><p>这时候，我们有必要引入第三方，一个<strong>权威的证书颁发机构（CA）</strong>来解决。</p><p>到底什么是证书呢？证书包含如下信息：</p><p><img src="https://pic4.zhimg.com/80/v2-d67c298621ff7b0993bf40fada27f573_hd.jpg" alt="img"></p><p>为了便于说明，我们这里做了简化，只列出了一些关键信息。至于这些证书信息的用处，我们看看具体的通信流程就能够弄明白了。</p><p>流程如下：</p><p>1.作为服务端的小红，首先把自己的<strong>公钥发给证书颁发机构</strong>，向证书颁发机构<strong>申请证书</strong>。</p><p><img src="https://pic3.zhimg.com/80/v2-e94e6b7dc1376c799ae3e1aadc469ea2_hd.jpg" alt="img"></p><p>2<strong>.证书颁发机构自己也有一对公钥私钥</strong>。机构利用自己的私钥来加密Key1，并且通过服务端网址等信息生成一个证书签名，证书签名同样经过机构的私钥加密。证书制作完成后，机构把CA证书发送给了服务端小红。</p><p><img src="https://pic3.zhimg.com/80/v2-4a394ede38b526839ce8ada8643934c6_hd.jpg" alt="img"></p><p>3.当小灰向小红请求通信的时候，小红不再直接返回自己的公钥，而是把自己申请的证书返回给小灰。</p><p><img src="https://pic3.zhimg.com/80/v2-35e555a8c74fbddc32ff610819480936_hd.jpg" alt="img"></p><p>4.小灰收到证书以后，要做的第一件事情是验证证书的真伪。需要说明的是，<strong>各大浏览器和操作系统已经维护了所有权威证书机构的名称和公钥</strong>。所以小灰只需要知道是哪个机构颁布的证书，就可以从本地找到对应的机构公钥，解密出证书签名。</p><p>接下来，小灰按照同样的签名规则，自己也生成一个证书签名，如果两个签名一致，说明证书是有效的。验证成功后，小灰就可以放心地再次利用机构公钥，解密出服务端小红的公钥Key1。</p><p><img src="https://pic3.zhimg.com/80/v2-123b8861cdefd9a322760ec7591f1cde_hd.jpg" alt="img"></p><p>5.像之前一样，小灰生成自己的对称加密密钥Key2，并且用服务端公钥Key1加密Key2，发送给小红。</p><p><img src="https://pic3.zhimg.com/80/v2-e8288a959d6fbd5019fa91c0e0b370f2_hd.jpg" alt="img"></p><p>6.最后，小红用自己的私钥解开加密，得到对称加密密钥Key2。于是两人开始用Key2进行对称加密的通信。</p><p><img src="https://pic1.zhimg.com/80/v2-4e1c4a6836c8a4b0c7511a0d21710664_hd.jpg" alt="img"></p><p>在这样的流程下，我们不妨想一想，中间人是否还具有使坏的空间呢？</p><p><img src="https://pic3.zhimg.com/80/v2-98502876ee22cbe643e3cd2a6ad74c2e_hd.jpg" alt="img"></p><p><img src="https://pic4.zhimg.com/80/v2-761d4917160cc15f06056f7043a84307_hd.jpg" alt="img"></p><p><img src="https://pic4.zhimg.com/80/v2-abd130a15c5ba261a42f93add277948f_hd.jpg" alt="img"></p><p><img src="https://pic1.zhimg.com/80/v2-0473074a3253131c0ad3ef4902cb2fb8_hd.jpg" alt="img"></p><p>这就是HTTPS的主题思想，HTTPS在HTTP协议的基础上增加了SSL安全层，上述的一系列认证流程就是在SSL层中完成的。</p><p><img src="https://pic1.zhimg.com/80/v2-3db9b326b9d31745229a26a877a1308c_hd.jpg" alt="img"></p><p>注：最新推出的TLS协议，是SSL 3.0协议的升级版，和SSL协议的大体原理是相同的。</p><p>参考文章：<a href="https://zhuanlan.zhihu.com/p/57142784" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/57142784</a></p><h2 id="HTTPS协议概述"><a href="#HTTPS协议概述" class="headerlink" title="HTTPS协议概述"></a>HTTPS协议概述</h2><p>HTTPS可以认为是HTTP+TLS 。 TLS是传输层加密协议，它的前身是SSL协议。</p><h3 id="HTTPS的功能"><a href="#HTTPS的功能" class="headerlink" title="HTTPS的功能"></a>HTTPS的功能</h3><ul><li>内容加密<ul><li>非对称密钥加密</li><li>对称内容加密</li></ul></li><li>身份认证<ul><li>数字证书</li></ul></li><li>数据完整性</li></ul><h3 id="HTTPS使用成本"><a href="#HTTPS使用成本" class="headerlink" title="HTTPS使用成本"></a>HTTPS使用成本</h3><ul><li>证书费用以及更新维护成本<ul><li>事实上现在不少证书费用都很便宜甚至免费，当然越贵的越安全</li></ul></li><li>HTTPS降低了用户访问的速度<ul><li>对了一层对SSL/TLS的访问，所以速度会变慢</li><li>但是通过合理的优化，使用HTTPS的速度是可以不逊色于HTTP的</li></ul></li><li>消耗CPU资源，需要增加大量机器<ul><li>前面提到的非对称密钥交换、对称的加解密，这很消耗cpu资源，需要其大量的计算</li><li>当然，只要进行合理的优化，该机器成本也可以得到较好的控制</li></ul></li></ul><p>实际上，HTTPS的使用成本大体上是可控的，使用HTTPS是大势所趋。</p><h3 id="HTTPS对性能的影响"><a href="#HTTPS对性能的影响" class="headerlink" title="HTTPS对性能的影响"></a>HTTPS对性能的影响</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- 协议交互所增加的往返时延RTT</span><br><span class="line">- 加解密相关的计算耗时</span><br></pre></td></tr></table></figure><p>在计算机网络中，RTT（往返时延）是一个非常重要的指标。RTT表示：从发送端发送数据开始，到发送端收到来自接收端的确认，在这个过程中总共经过的时延。这也是影响我们网络访问速度的一个重要因素。</p><p>具体内容详见参考文章：<a href="http://blog.itpub.net/31557835/viewspace-2219412/" target="_blank" rel="noopener">http://blog.itpub.net/31557835/viewspace-2219412/</a></p><h3 id="HTTPS常见问答"><a href="#HTTPS常见问答" class="headerlink" title="HTTPS常见问答"></a>HTTPS常见问答</h3><p><a href="https://developer.baidu.com/resources/online/doc/security/https-faq.html" target="_blank" rel="noopener">https://developer.baidu.com/resources/online/doc/security/https-faq.html</a></p><h2 id="HTTP的瓶颈"><a href="#HTTP的瓶颈" class="headerlink" title="HTTP的瓶颈"></a>HTTP的瓶颈</h2><p>影响HTTP网络请求的两个因素： <strong>带宽</strong>  和  <strong>延迟</strong></p><p>以前的网速慢，带宽只有几十兆、一百兆，所以带宽曾经一度是影响HTTP网络请求的一个重大瓶颈，但现在的网速带宽已经非常快了，特别是移动互联网4G5G的到来，带宽越来越不成为影响HTTP网络请求的障碍。那么，就剩下延迟了。</p><p><strong>带宽：</strong>如果说我们还停留在拨号上网的阶段，带宽可能会成为一个比较严重影响请求的问题，以前的网速慢，带宽只有几十兆、一百兆，所以带宽曾经一度是影响HTTP网络请求的一个重大瓶颈，但现在的网速带宽已经非常快了，特别是移动互联网4G5G的到来，带宽越来越不成为影响HTTP网络请求的障碍。那么，就剩下延迟了</p><p><strong>延迟：</strong></p><ul><li><p>浏览器阻塞（HOL blocking）：浏览器会因为一些原因阻塞请求。浏览器对于同一个域名，同时只能有 4 个连接（这个根据浏览器内核不同可能会有所差异），超过浏览器最大连接数限制，后续请求就会被阻塞。</p></li><li><p>DNS 查询（DNS Lookup）：浏览器需要知道目标服务器的 IP 才能建立连接。将域名解析为 IP 的这个系统就是 DNS。这个通常可以利用DNS缓存结果来达到减少这个时间的目的。</p></li><li><p>建立连接（Initial connection）：HTTP 是基于 TCP 协议的，浏览器最快也要在第三次握手时才能捎带 HTTP 请求报文，达到真正的建立连接，但是这些连接无法复用会导致每次请求都经历三次握手和慢启动。三次握手在高延迟的场景下影响较明显，慢启动则对文件类大请求影响较大。</p></li></ul><h2 id="HTTP的缺陷"><a href="#HTTP的缺陷" class="headerlink" title="HTTP的缺陷"></a>HTTP的缺陷</h2><ul><li><p>一条连接上只可发送一个请求</p><p>单路连接 请求低效<br>HTTP 协议的最大弊端就是每个 TCP 连接只能对应一个 HTTP 请求，即每个 HTTP 连接只请求一个资源，浏览器只能通过建立多个连接来解决。此外在 HTTP 中对请求是严格的先入先出（FIFO）进行的，如果中间某个请求处理时间较长会阻塞后面的请求</p></li><li><p>请求只能从客户端开始。客户端不可以接收除响应外的指令。客户端无法及时的主动的感知到服务器文件的更新。</p></li><li><p>请求/响应头部不经压缩就发送</p></li><li><p>HTTP 头冗余<br>HTTP 头在同一个会话里是反复发送的，中间的冗余信息，比如 User-Agent、Host 等不需要重复发送的信息也在反复发送，浪费带宽和资源。</p></li><li><p>非强制压缩发送</p></li></ul><p>（这部分要再看一下视频最好）</p><h2 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h2><p>参考文章：</p><p><a href="https://blog.csdn.net/u012654882/article/details/54576693" target="_blank" rel="noopener">https://blog.csdn.net/u012654882/article/details/54576693</a></p><h3 id="单工、半双工和全双工"><a href="#单工、半双工和全双工" class="headerlink" title="单工、半双工和全双工"></a>单工、半双工和全双工</h3><p>   在网络的领域内，单工、半双工、全双工是经常会遇见的名称，下面简单的讲述一下他们的区别。</p><pre><code>单工：简单的说就是一方只能发信息，另一方则只能收信息，通信是单向的。半双工：比单工先进一点，就是双方都能发信息，但同一时间则只能一方发信息。全双工：比半双工再先进一点，就是双方不仅都能发信息，而且能够同时发送。</code></pre><p>websocket是全双工的。</p><h3 id="websocket建立握手"><a href="#websocket建立握手" class="headerlink" title="websocket建立握手"></a>websocket建立握手</h3><p><strong>WebSocket是HTML5出的东西（协议）</strong>，Websocket其实是一个新协议，跟HTTP协议基本没有关系，只是为了兼容现有浏览器的握手规范而已，也就是说它是HTTP协议上的一种补充可以通过这样一张图理解</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAW8AAACJCAMAAADUiEkNAAAB0VBMVEX///8AAAC8vLz29vb4+Pi5ubk9PT36+vrv7+/w8PC2trbs7OzQ0NA3Nzfz8/PU1NRAQEAyMjLBwcHg4OBISEhQUFAmJiYJCQktLS3a2trLy8vm5ubo/////8daWloXFxfcrHYeHh7//872/////96Ubzm30fUrQonC3//TroZ5eXmLi4usrKy+jloyHk9PP0xIXaKee0B6oMkAAEyGhoZlZWWampqfn58/ACtyrMmSZywdOIVJFTQAKXOqy/iGqNlNGwCYv9tJJDY6apzH7f+cw/mErugzACo4X6L/06B4SCLQ3cL/8cW7o12ddTVAUJZJDwCOfHdZIgDUq3pziH59aigjDUgAAD2tbhwAAC+O0OL52pEOUqbT4/mVYSRQLQAWSoxJBBRcjLPnwJVkLCXytGsyDRxpqtvRl1gzFgAAAGCr0uVhOABEd8U9LWz+/K8pAFdIIR1yOT93pIlYOB2+j1uRnntiSAIAF2p/VBAAHF8AACB1NwAlAD/Bqan/27H9/ehXdrVaIyrl/+6MWgcAKWRaUXO86P9NNADX5q44ADv7yZBFea0LP3Wnr3lNKFSNaUs7PiIvTDXl/9Y1BwBkbZaRlaqelIVqXjwoAAD/3rqjUKhGAAANL0lEQVR4nO2d/UMUxx3Gd+/mdo6Dwzu4N17kPFEUFRUjmGBFq9IKoZpqq0aKWglRI0rTSlsSW9PENKbRvqZv+Ws7s7Oz7+87ezPYfX44VG53v/Px2e+87OyMJGXKlClTpkyZMmXKlClTpkyZMmXKlClTpkyZMmXKlCmTJMG8tyDv4N4QARPTuuytwzBDn0SEM+hXfBh76CTcwdy7fw9j0qCnFZ2zXYfgTqFuujdP+hRojDV6gEl3kpN2UBcVOgEND0UuVa2f3P+xr4wPLjbZojY0Ixx0GBO0VUo/iEEdow5z9pJ3cgsT+QwQgzkuBZhJSNqsKqYeEjr6Yq/fuQZMjIMKESIF8mYOGaM21OgBgcx9WA/DYMbeZVK5H/Y49Rgn5Jj1WBC2Qz738JGggzt+zD1h98F4nF3Kh4KcFQI5jsWHtdF78A3LQF/yPFXTlbk77F0gpqUDgnSDXu8ecujZVZuN3VUghw14QC8CM0VX2EOAOWlLePAUH+ResGeZ3MXe0CnyPBhx/G4wVdbm2OzQUTs2fhs2WCDfX3OiOMUoYVLhgg27I3fCHukKayM2R61T6U/L5LC/4mBwBKZUXAy9z9XpVtipXNw/MjvyVIgja9tpp8ZaF2oB7fKE3csDNo3LWsMrrNMKtA+0pc+aKg+GxIKtydamKjM0OewvW86NOsbMzh1GANpcPtjb1et7yGZy1C1mclrQX+UJGwk6Hd7L295EeVgwBdXqT35G61ByofuwJZpP2o1WtVqutjo0o3Q9ElfBnAl4T8KgrLRzHMYNtAqz2VKUslI6Ui2XlUq1rf7biCjETT2GRhLioKdhnGmAg7Up7U61gmkXcrlCoVTFxJtvHnHLo5IBLkNifdTaSrmCaasixLXYRCTeiZXG+dMGKu5GxUKbEq/QW2+QR2guAkaXuBPd4mZzD/PxEIkfZ5KahbZGXKEBDgpicTPxdk+0Q3vavGlrwZfdaBPiZf1xpSgWNxFvFyNgA8U2Z9qauRFud9qEeKvTFMziJuLN0Bbv4e1tirtdRub2oE2IK1rTUB7iFKhTkYH36PdpX7qReYvE3PIxt6aSomhNwyFxLN4XBbgxtaCPVwnIPdkMMLducaUhmsX1ceTgJG5M5OBmbtKSbZbrQeamFi9rNac4wI1R5KL/F3Xcu7jdngbuMLRVi1cUksV38YrZqXDADdzdisshrZ9WDY0bW7yitHYicHFwN6LgxsC1nLKjgFPcHKt6DXczGm6cU2o7Djid1MGx2qFt13qomtJq8VqZbzXvlP6UxNW/AuCm9q5Fx42Bt0QF7mZwEXDnEuDGwBuiAnc+bgXi4K7Ew20AF6cd7g28lz9uLZkocXFj4B3BDK4Dt6VwDTfXgU1i71ps2ipwtZEyzLMYNg25GVwE3ANJcrcOnMwBEwn4oNPgNHlznUWTi9kQtIoYXKRmuAbczFYYe3fGEuJGGUU4g/faDQ4EwK3auzmW1N4IeFl4g5P/gBGOEWn2ria2N1ZLUINT4ECA5C3haXhtBvZGEtXgsjZf6g2zd26gKqjBSQbPk78EPIhIWQOMsrcqMp1XpF6POYMDAeytppPkjRMLcJESSq8poZA/R5wPxFhq27vFjHdNtIQijei8gSjpRGaVTnKFelO0hFLUE7gQ6YTwZoQbAa+IxrtXT+BAgHSipm+5zox3ri5aAjcSChQgnZChkwGGvJuiJfAeyrsoSjqpD7PjXSiLllCKlLf6k8F7VUk0wNrfOeESuM67KUD6Zu7vjLevMn93V13nrY1Fw+69lvR/zXvP2++Moh+7505PUOhpoxeQN8v8XfPn/T3Ce/+BCWnv3PGDkrT38pWDqRZRKN7M298ReO/efxyZfPf0lQnkcKgugpZGEXssvGO1B0PEFfYmZd2/DM97z3voi6d/fBV9npm/dv4nP5Xlt86GjDqK9P5l0PCJ9hY3cGS5qevfHw+4yOSxkKEzHj/JFYJ55/N5i7+PI39PnrtxYnR5LgXgxvhJMaA/f/P9WwjrytWfrUrSvttnVvVfTB2NwdujWmI7Poj68y3f/vyeOzLRXZS/96v5exp/Tv78HvL92gf4k62M8UEYMF61/uF9hPXBw48ejUsrG4+T8d73oycLbl9UEzijx2k6b+/xKpu/Dd7nT6AiPV+6cDGgYJFlH//2Tiibz5Cz992e+QWy+frH90fJqs8S4a1VLlBbiM9YRZis2KbyBkD/u8rb1eEFprwL9YZv89tWX6bP2/R8J+h5w97bHz2SNn/5q6fI2lPXVZOjKgVZe+vor38jy7/FyW9Oli+hcJe3yS2Kw5fl90+MY96T732yIC1fluVPX41+9wx94a0fuFwFJ5QGq4RSqKvvT8XgreYTQp2pzM8vg56nPfjdrfH1J48uX1rdXEJWX//43uq+/Qj41EP0sbJ9YGL33IEJ+Pvh8W82Lk3A5e0z89Li9pfzcLk0gXivbbyel57fvvDVZ9fefjXq6W/Mu62wMnhdafoOx1p5ow/E+/Q8In3uk7Mo+LvzieA6ZXk+H5RQVu48Xr15d/XBk0crH9wf3Tf3h1UIVlCVMvVDHDQK/ettbG4tcGnt83tfbB0leXvy2MkXXy5In1374wIEy/svfOWVv8nz+TIjgxfqVd/0be1fLm7I2CIbantw7CW6Q1njts4/CZoPsff2pa+fPV5d+fz+1p9uja48JV9/vErqy2+e3vtiunkDxb9MsC8uvXp3Tk0qiPdLGeGWlqfJMa/nPXmrCbzFyOB1dakOv9Eqy/gJVOsc/IkyyWgKa8La5lcFzfe5+cmf/3JrfHPp8V9fr6pNFKBWi1uU90Xp+bZ8453dJt6XSOd48mUTNWhR9n69QI7x5o2bKIwMXlLtHefpTgqZG8s2IzloPtv6+b+dQfXk5b9/i6rMzaUrWpOQ5BNCXUK5+91pmk/+Mf2E3JKTx2Yvo86DQdmHt1pjMjE4qS3jPL1Mh3evnW+AwTeXZNzZWb8j49bgA0QdrPxzQtr69swERJwPrvwL/Vx6dXHPOVRfLm6gXLJ29e48XDyF68tlDHzt2esFuPxvTP76Wa/bNac2CRlMkFUbg7EeXl77MA3ejvnfQfORb8q4m7NyB3d5MHDSHpw6+p+HpB249V9ZfnURmxydRW27Lm6rwxDXUHvw+YtP742vPVPbg5L03Qv39qDErMosqX2dmA/n0xiUdXm/IWC+PR1C0Q6hm1lAiW4eAdz6O0CLX62O9BWroffwW460CRO+UFIXbDqy2/s7QrxPor3hUE6UwgvaK4HCzD2h65VbXSbCCyXaKErCWbLkHWNx7D3o7mSBgCd5Ra0k2ivdrm8DYgnwvqtE3wmsxMZdE6IUhoY8+5IivM9trIIX9wV6wezt8XKxKhHWKzAtEBGDeKlGllUSBTfwWx5CMOCRllPScQs1azBwfR+RgLeVqMAR7or/qHd3FWL9qqJAwBsRgZcqSsX/IVp3FWp9NgEWsJIo8JYScv1BLLwknppNBMEddv1BARZok+j6mg0lzPqamrnLQuEOv76mAOs9YqnA236LI9tyiUi4I60fK8B6plikId4Js4SsmksUhXu9QxVxfWQTcJ4W16LueKy2bjK3Usa4m4Lgjr7+t2mba54Wp4E3G37E8fLIBLcQ61HHW9/eWACc23rrWDT2tqfHC6VymeLmGChV7P0bDOBcidOKp23fn8RGWxEjlxg7wkTen8S0gQNX4hrwZtlJ3KCtCLF9g2kDnjj775g2KOFJnHYcGoq2v5ROu0ppN3iP2kt42zqDdsz9pQTYXYrEoRFvVQziJtpVAcxt3lsqwY51ohDfRZOKRtxCe4j7vozm/QET7sho26+OVYSRw6AbMqoeP0JoV/Ca9oO8adv2v0y6HaN1P8Ycjx0CSRh06L7daDRaWA281RHn1/5T2d+137wBJpf9RlXBQdkuzhuOprV/Mchz309XctnCWB6EHLeMTnd/bt77Rbtv0S3z2n/evgF9CvvPu+2HzvoaHvKEzQW5nXUqtLFQWqk4kKdd1Hwe2NNILxix/QtqgedTj0QNJg9P2S5dY5tIrIJ24qkyR6Xrs1+O1JF50Ov4hTwE0mTuglqW6ym8C2EVMnnNcdlTkLW9sJOGHdeRi0bqyLsQxw+lUjA6DmbW5WL1tGETIbh1l6vPYujJy5r3QG2BrX3TzeVIfWwiIXOo3VHLY/nUrW0NxA25Tj1OKOS4AffTOmDTgzyQIw2TSOJw146Ehz1OPdZN1qaYxrzKKh/WQg5Er3+r5HkuuVkEPlWSp801DRihBBZIi+Wkz+lmAAfYRojAm7mmQ0ZBHHI0rezq9IAwy5Gg7xQDzoRV8gvlUPDxPFlTYeYzIcoaXQ3EOkJTKyTzuJqB/FlTYdswhV7tD2Vrh3DrxDKIzELkBhWFtS4Y8qYMkBITtUmEeiv4WuFQC0faJBg+GdqE+mmqmHXWADmdfRgilE7ScrAKJm2FrOzHTPVVWqEA4xoebVgiU5Nq53B2kU+boNvl8gtlRzPO5K3/AbhYdw7o4xCpAAAAAElFTkSuQmCC" alt=""></p><p>有交集，但是并不是全部。</p><p>Websocket是一个<strong>持久化</strong>的协议，相对于HTTP这种<strong>非持久</strong>的协议来说。HTTP是不支持持久连接的（长连接，循环连接的不算）。简单的举个例子吧，用目前应用比较广泛的PHP生命周期来解释。<br>1) HTTP的生命周期通过Request来界定，也就是一个Request一个Response，那么<strong>在</strong>HTTP1.0<strong>中</strong>，这次HTTP请求就结束了。<br>在HTTP1.1中进行了改进，使得有一个keep-alive，也就是说，在一个HTTP连接中，可以发送多个Request，接收多个Response。<br>但是请记住 Request = Response ，在HTTP中永远是这样，也就是说一个request只能有一个response。而且这个response也是<strong>被动</strong>的，不能主动发起。</p><p>Websocket是基于HTTP协议的，或者说借用了HTTP的协议来完成一部分握手。</p><p>在握手阶段是一样的：</p><p>首先我们来看个典型的Websocket握手</p><p><img src="https://pic1.zhimg.com/v2-c91c2ee4afd3dbf92199aba00e84eae0_r.jpg" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /chat HTTP/1.1</span><br><span class="line">Host: server.example.com</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Sec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==</span><br><span class="line">Sec-WebSocket-Protocol: chat, superchat</span><br><span class="line">Sec-WebSocket-Version: 13</span><br><span class="line">Origin: http://example.com</span><br></pre></td></tr></table></figure><p>熟悉HTTP的童鞋可能发现了，这段类似HTTP协议的握手请求中，多了几个东西。</p><p>我会顺便讲解下作用。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Upgrade: websocket</span><br><span class="line">Connection: Upgrade</span><br></pre></td></tr></table></figure><p>这个就是Websocket的核心了，告诉Apache、Nginx等服务器：</p><p>注意啦，窝发起的是Websocket协议，快点帮我找到对应的助理处理~不是那个老土的HTTP。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Sec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==</span><br><span class="line">Sec-WebSocket-Protocol: chat, superchat</span><br><span class="line">Sec-WebSocket-Version: 13</span><br></pre></td></tr></table></figure><p>首先，Sec-WebSocket-Key 是一个Base64encode的值，这个是浏览器随机生成的，告诉服务器：“不要忽悠窝，我要验证尼是不是真的是Websocket助理。”</p><p>然后，Sec_WebSocket-Protocol是一个用户定义的字符串，用来区分同URL下，不同的服务所需要的协议。简单理解：</p><p>今晚我要服务A，别搞错啦~</p><p>最后，Sec-WebSocket-Version 是告诉服务器所使用的WebsocketDraft（协议版本），在最初的时候，Websocket协议还在 Draft阶段，各种奇奇怪怪的协议都有，而且还有很多期奇奇怪怪不同的东西，什么Firefox和Chrome用的不是一个版本之类的，当初Websocket协议太多可是一个大难题。。不过现在还好，已经定下来啦~大家都使用的一个协议版本。</p><p>然后服务器会返回下列东西，表示已经接受到请求， 成功建立Websocket啦！</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 101 Switching Protocols</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Sec-WebSocket-Accept: HSmrc0sMlYUkAGmm5OPpG2HaGWk=</span><br><span class="line">Sec-WebSocket-Protocol: chat</span><br></pre></td></tr></table></figure><p>这里开始就是HTTP最后负责的区域了，告诉客户，我已经成功切换协议啦~</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Upgrade: websocket</span><br><span class="line">Connection: Upgrade</span><br></pre></td></tr></table></figure><p>依然是固定的，告诉客户端即将升级的是Websocket协议，而不是其他乱七八糟的协议。</p><p>然后，Sec-WebSocket-Accept 这个则是经过服务器确认，并且加密过后的Sec-WebSocket-Key。服务器：“好啦好啦，知道啦，给你看我的ID CARD来证明行了吧。。”</p><p>后面的，Sec-WebSocket-Protocol 则是表示最终使用的协议。</p><p>至此，HTTP已经完成它所有工作了，接下来就是完全按照Websocket协议进行了。</p><h3 id="Ajax轮询和long-poll长轮询"><a href="#Ajax轮询和long-poll长轮询" class="headerlink" title="Ajax轮询和long poll长轮询"></a>Ajax轮询和long poll长轮询</h3><p>HTTP协议下，请求只能从客户端开始，客户端不可以接收除响应外的指令。<strong>客户端无法及时的主动的感知到服务器文件的更新。</strong>所以要想办法监听服务器端文件的更新情况。因此有了一些优化处理方式：一个是<strong>Ajax轮询</strong>，另一个叫<strong>long poll(其实就是长轮询)</strong>。 </p><p>  首先是 <strong>ajax轮询</strong> ，ajax轮询 的原理非常简单，让浏览器隔个几秒就发送一次请求，询问服务器是否有新信息。<br>场景再现：<br>客户端：啦啦啦，有没有新信息(Request)<br>服务端：没有（Response）<br>客户端：啦啦啦，有没有新信息(Request)<br>服务端：没有。。（Response）<br>客户端：啦啦啦，有没有新信息(Request)<br>服务端：你好烦啊，没有啊。。（Response）<br>客户端：啦啦啦，有没有新消息（Request）<br>服务端：好啦好啦，有啦给你。（Response）<br>客户端：啦啦啦，有没有新消息（Request）<br>服务端：。。。。。没。。。。没。。。没有（Response） —- loop</p><p><strong>long poll</strong><br>long poll 其实原理跟 ajax轮询差不多，都是采用轮询的方式，不过采取的是<strong>阻塞模型（一直打电话，没收到就不挂电话）</strong>，也就是说，客户端发起连接后，如果没消息，就一直不返回Response给客户端。直到有消息才返回，返回完之后，客户端再次建立连接，周而复始。<br>场景再现<br>客户端：啦啦啦，有没有新信息，没有的话就等有了才返回给我吧（Request）<br>服务端：额。。 等待到有消息的时候。。来 给你（Response）<br>客户端：啦啦啦，有没有新信息，没有的话就等有了才返回给我吧（Request） -loop</p><p>从上面可以看出其实这两种方式，都是在不断地建立HTTP连接，然后等待服务端处理，可以体现HTTP协议的另外一个特点，<strong>被动性</strong>。<br>何为被动性呢，其实就是，服务端不能主动联系客户端，只能有客户端发起。<br>简单地说就是，服务器不会、不能主动发起连接，但是上司有命令，如果有客户来，不管多么累都要好好接待。</p><p>说完这个，我们再来说一说上面的<strong>缺陷</strong><br>从上面很容易看出来，不管怎么样，上面这两种都是非常消耗资源的。<br>ajax轮询 需要服务器有很快的处理速度和资源。（速度）<br>long poll 需要有很高的并发，也就是说同时接待客户的能力。（场地大小）<br>所以ajax轮询 和long poll 都有可能发生这种情况👇：</p><p>客户端：啦啦啦啦，有新信息么？<br>服务端：忙死啦，请稍后再试（503 Server Unavailable）<br>客户端：。。。。好吧，啦啦啦，有新信息么？<br>服务端：忙死啦，请稍后再试（503 Server Unavailable）<br>客户端：<img src="https://pic1.zhimg.com/7c0cf075c7ee4cc6cf52f4572a4c1c10_b.jpg" alt="WebSocket与http的区别，以及它的原理--"></p><p>-————————-</p><h3 id="webSocket解决方案"><a href="#webSocket解决方案" class="headerlink" title="webSocket解决方案"></a>webSocket解决方案</h3><p><strong>言归正传，我们来说Websocket吧</strong><br>通过上面这个例子，我们可以看出，这两种方式都不是最好的方式，需要很多资源。<br>一种需要更快的速度，一种需要更强的并发处理能力。<br>哦对了，忘记说了HTTP还是一个状态协议。<br>通俗的说就是，服务器因为每天要接待太多客户了，是个<strong>健忘鬼</strong>，你一挂电话，他就把你的东西全忘光了，把你的东西全丢掉了。你第二次还得再告诉服务器一遍。</p><p>  所以在这种情况下出现了，Websocket出现了。<br>他解决了HTTP的这几个难题。<br>首先，<strong>被动性</strong>，当服务器完成协议升级后（HTTP-&gt;Websocket），服务端就可以主动推送信息给客户端啦。<br>所以上面的情景可以做如下修改：<br>客户端：啦啦啦，我要建立Websocket协议，需要的服务：chat，Websocket协议版本：17   （HTTPRequest）<br>服务端：ok，确认，已升级为Websocket协议（   HTTP Protocols Switched）<br>客户端：麻烦你有信息的时候推送给我噢。。<br>服务端：ok，有的时候会告诉你的。<br>服务端：balabalabalabala<br>服务端：balabalabalabala<br>服务端：balabalabalabala</p><p>就变成了这样，只需要经过<strong>一次HTTP请求</strong>，就可以做到源源不断的信息传送了。（在程序设计中，这种设计叫做回调，即：你有信息了再来通知我，而不是我傻乎乎的每次跑来问你）<br><strong>这样的协议解决了上面同步有延迟，而且还非常消耗资源的这种情况。</strong><br>那么为什么他会解决服务器上消耗资源的问题呢？<br>其实我们所用的程序是要经过两层代理的，即<strong>HTTP协议在Nginx等服务器的解析下</strong>，然后再传送给相应的<strong>Handler（PHP等）</strong>来处理。<br>简单地说，我们有一个非常快速的接<strong>线员（Nginx）</strong>，他负责把问题转交给相应的<strong>客服（Handler）</strong>。<br>本身<strong>接线员基本上速度是足够的</strong>，但是每次都卡在<strong>客服（Handler）</strong>了，老有<strong>客服</strong>处理速度太慢。，导致客服不够。<br>Websocket就解决了这样一个难题，建立后，可以直接跟接线员建立持<strong>久连接</strong>，有信息的时候客服想办法通知接线员，然后<strong>接线员</strong>在统一转交给客户。<br>这样就可以解决客服处理速度过慢的问题了。</p><p>同时，在传统的方式上，要不断的建立，关闭HTTP协议，由于HTTP是非状态性的，每次都要<strong>重新传输identityinfo（鉴别信息）</strong>，来告诉服务端你是谁。<br>虽然接线员很快速，但是每次都要听这么一堆，效率也会有所下降的，同时还得不断把这些信息转交给客服，不但浪费客服的<strong>处理时间</strong>，而且还会在网路传输中消耗<strong>过多的流量/时间。</strong><br>但是Websocket只需要<strong>一次HTTP握手，所以说整个通讯过程是建立在一次连接/状态中</strong>，也就避免了HTTP的非状态性，服务端会一直知道你的信息，直到你关闭请求，这样就解决了接线员要反复解析HTTP协议，还要查看identityinfo的信息。<br>同时由<strong>客户主动询问</strong>，转换为<strong>服务器（推送）有信息的时候就发送（当然客户端还是等主动发送信息过来的。。）</strong>，没有信息的时候就交给接线员（Nginx），不需要占用本身速度就慢的<strong>客服（Handler）</strong>了<br>-——————-<br>至于怎么在不支持Websocket的客户端上使用Websocket。。答案是：<strong>不能</strong><br>但是可以通过上面说的 long poll 和 ajax 轮询来 <strong>模拟出类似的效果</strong>  </p><p>WebSocket 是类似 Socket 的 TCP 长连接的通讯模式，一旦 WebSocket 连接建立后，后续数据都以帧序列的形式传输。在客户端断开 WebSocket 连接或 Server 端断掉连接前，不需要客户端和服务端重新发起连接请求。在海量并发及客户端与服务器交互负载流量大的情况下，极大的节省了网络带宽资源的消耗，有明显的性能优势，且客户端发送和接受消息是在同一个持久连接上发起，实时性优势明显。</p><p>总的来说，websocket的特点是(1) 全双工通信、(2)减少通信量。</p><p>具体的websocket使用见<a href="https://www.ruanyifeng.com/blog/2017/05/websocket.html" target="_blank" rel="noopener">https://www.ruanyifeng.com/blog/2017/05/websocket.html</a></p><h2 id="SPDY协议"><a href="#SPDY协议" class="headerlink" title="SPDY协议"></a>SPDY协议</h2><p>参考文章：<a href="http://www.geekpark.net/news/158198" target="_blank" rel="noopener">http://www.geekpark.net/news/158198</a></p><p>这篇参考文章写的时候，作者还是很看好spdy的，认为其会有一个很好的前景，但事实上，spdy还没推广就被HTTP/2.0给取代了，谷歌也宣布放弃了spdy转投HTTP/2.0。</p><h2 id="HTTP2-0"><a href="#HTTP2-0" class="headerlink" title="HTTP2.0"></a>HTTP2.0</h2><p>参考文章：</p><p><a href="https://segmentfault.com/a/1190000016656529#item-5-2" target="_blank" rel="noopener">https://segmentfault.com/a/1190000016656529#item-5-2</a></p><p><a href="http://www.alloyteam.com/2015/03/http2-0-di-qi-miao-ri-chang/#prettyPhoto" target="_blank" rel="noopener">http://www.alloyteam.com/2015/03/http2-0-di-qi-miao-ri-chang/#prettyPhoto</a></p><p><a href="https://www.zhihu.com/question/34074946/answer/75364178" target="_blank" rel="noopener">https://www.zhihu.com/question/34074946/answer/75364178</a></p><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>HTTP/2（超文本传输协议第2版，最初命名为HTTP2.0），是HTTP协议的第二个主要版本。HTTP/2是HTTP协议自1999年HTTP1.1发布后的首个更新，主要基于SPDY协议。<br>HTTP2.0的特点是：在不改动HTTP语义、方法、状态码、URI及首部字段的情况下，大幅度提高了web性能。</p><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- 二进制传输（核心）</span><br><span class="line">- 首部压缩</span><br><span class="line">- 多路复用</span><br><span class="line">- 请求优先级</span><br><span class="line">- 服务器推送</span><br></pre></td></tr></table></figure><h3 id="二进制传输"><a href="#二进制传输" class="headerlink" title="二进制传输"></a>二进制传输</h3><h4 id="二进制分帧层"><a href="#二进制分帧层" class="headerlink" title="二进制分帧层"></a>二进制分帧层</h4><p><strong>HTTP2.0性能增强的核心：二进制分帧</strong><br>    HTTP 2.0最大的特点： 不会改动HTTP 的语义，HTTP 方法、状态码、URI 及首部字段，等等这些核心概念上一如往常，却能致力于突破上一代标准的性能限制，改进传输性能，实现低延迟和高吞吐量。而之所以叫2.0，是在于新增的二进制分帧层。<br>既然又要保证HTTP的各种动词，方法，首部都不受影响，那就需要<strong>在应用层(HTTP2.0)和传输层(TCP or UDP)之间增加一个二进制分帧层。</strong><br>     在二进制分帧层上， HTTP 2.0 会将所有传输的信息分割为更小的消息和帧,并对它们采用二进制格式的编码 ，其中<strong>HTTP1.x的首部信息会被封装到Headers帧，而我们的request body则封装到Data帧里面。</strong></p><p><img src="https://img-blog.csdn.net/20180912153834839?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAyMzA3OTQ=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p><p>    然后，HTTP 2.0 通信都在<strong>一个连接</strong>上完成，这个连接可以<strong>承载任意数量的双向数据流</strong>。相应地，每个数据流以消息的形式发送，而消息由一或多个帧组成，这些帧可以乱序发送，然后再根据每个帧首部的流标识符重新组装。</p><p>说到这儿，可能会有人要说了，<em>但是那样，所有的二进制帧都会带上Headers帧，这是多大的数据冗余传送啊，性能会受到影响吧…</em>。  事实上，针对这一点，HTTP2.0做了<strong>首部压缩处理</strong></p><h3 id="首部压缩"><a href="#首部压缩" class="headerlink" title="首部压缩"></a>首部压缩</h3><p>​    HTTP 2.0 在客户端和服务器端使用“首部表”来跟踪和存储之前发送的键-值对，对于相同的数据，不再通过每次请求和响应发送; 通信期间几乎不会改变的通用键-值对(用户代理、可接受的媒体类型,等等)只 需发送一次。事实上, 如果请求中不包含首部(例如对同一资源的轮询请求),那么 首部开销就是零字节。此时所有首部都自动使用之前请求发送的首部。<br>    如果首部发生变化了，那么只需要发送变化了数据在Headers帧里面，新增或修改的首部帧会被追加到“首部表”。首部表在 HTTP 2.0 的连接存续期内始终存在,由客户端和服务器共同渐进地更新 。</p><h3 id="多路复用"><a href="#多路复用" class="headerlink" title="多路复用"></a>多路复用</h3><p>众所周知 ，在 HTTP/1.1 协议中 「浏览器客户端在同一时间，针对同一域名下的请求有一定数量限制。超过限制数目的请求会被阻塞」。在HTTP1.0中，我们经常会使用到雪碧图、使用多个域名等方式来进行优化，都是因为浏览器限制了同一个域名下的请求数量，当页面需要请求很多资源的时候，队头阻塞（Head of line blocking）会导致在达到最大请求时，资源需要等待其他资源请求完成后才能继续发送。</p><p>该图总结了不同浏览器对该限制的数目。</p><p><img src="https://pic3.zhimg.com/faedeb3dae59455f6520d6a5dbf436e5_r.jpg" alt=""></p><p>这也是为何一些站点会有多个静态资源 CDN 域名的原因之一，目的就是变相的解决浏览器针对同一域名的请求限制阻塞问题。</p><p><strong>HTTP2.0中，有两个概念非常重要：帧（frame）和流（stream）。</strong><br>帧是最小的数据单位，每个帧会标识出该帧属于哪个流，流是多个帧组成的数据流。<br>所谓<strong>多路复用</strong>，即在一个TCP连接中存在多个流，即可以同时发送多个请求，对端可以通过帧中的表示知道该帧属于哪个请求。在客户端，这些帧乱序发送，到对端后再根据每个帧首部的流标识符重新组装。通过该技术，可以避免HTTP旧版本的队头阻塞问题，极大提高传输性能。</p><p>多路复用有两个基本点：1、所有的HTTP2.0请求都在一个TCP链接上；2、并行双向字节流的请求和响应。</p><h4 id="所有的-HTTP2-0-的请求都在一个-TCP-链接上"><a href="#所有的-HTTP2-0-的请求都在一个-TCP-链接上" class="headerlink" title="所有的 HTTP2.0 的请求都在一个 TCP 链接上"></a>所有的 HTTP2.0 的请求都在一个 TCP 链接上</h4><p>而 HTTP/2 的多路复用(Multiplexing) 则允许同时通过单一的 HTTP/2 连接发起多重的<strong>请求-响应</strong>消息，这也是继承自spdy协议。 </p><p><img src="https://pic3.zhimg.com/80/b1e608ddb7493608efea3e76912aabe1_hd.jpg" alt=""></p><p>因此 HTTP/2 可以很容易的去实现多流并行而不用依赖建立多个 TCP 连接，HTTP/2 把 HTTP 协议通信的基本单位缩小为一个一个的帧，这些帧对应着逻辑流中的消息。并行地在同一个 TCP 连接上。</p><p><img src="https://segmentfault.com/img/bVbgpF3?w=494&amp;h=138" alt="图片描述"></p><p>HTTP2.0 所有通信都是在一个 TCP 连接上完成。HTTP 2.0 把 HTTP 协议通信的基本单位缩小为一个一个的帧，这些帧对应 着逻辑流中的消息。并行地在同一个 TCP 连接上双向交换消息。就好比，我请求一个页面 <a href="http://www.qq.com。页面上所有的资源请求都是客户端与服务器上的一条" target="_blank" rel="noopener">http://www.qq.com。页面上所有的资源请求都是客户端与服务器上的一条</a> TCP 上请求和响应的！</p><p>​    <strong>有关注 TCP 性能的同学就会知道，HTTP 性能的关键在于低延迟而不是高带宽！</strong>大多数 HTTP 连接的时间都很短，而且是突发性的，但 <strong>TCP 只在长时间连接传输大块数据时效率才最高</strong>。HTTP 2.0 通过让所有数据流共用同一个连接，可以更有效地使用 TCP 连接，让高带宽也能真正的服务于 HTTP 的性能提升。</p><p>​    同时，单链接多资源的方式，使到至上而下的层面都得到了好处：</p><ol><li>可以减少服务链接压力, 内存占用少了, 连接吞吐量大了</li></ol><p>​    2. 由于 TCP 连接减少而使网络拥塞状况得以改观;</p><p>​    3. 慢启动时间减少, 拥塞和丢包恢复速度更快。</p><p> <strong>补充：</strong>TCP 连接会随着时间进行自我「调谐」，起初会限制连接的最大速度，如果数据成功传输，会随着时间的推移提高传输的速度。这种调谐则被称为 TCP 慢启动。由于这种原因，让原本就具有突发性和短时性的 HTTP 连接变的十分低效。</p><p><strong>也就是说，“资源合并减少请求” 的优化手段对于 HTTP2.0 来说是没有效果的，只会增大无用的工作量而已。</strong></p><h4 id="并行双向字节流的请求和响应"><a href="#并行双向字节流的请求和响应" class="headerlink" title="并行双向字节流的请求和响应"></a>并行双向字节流的请求和响应</h4><p>在 HTTP2.0 上，客户端和服务器可以把 HTTP 消息分解为互不依赖的帧，然后乱序发送，最后再在另一端把它们重新组合起来。注意，同一链接上有多个不同方向的数据流在传输。客户端可以一边乱序发送 stream，也可以一边接收者服务器的响应，而服务器那端同理。</p><p><a href="http://www.alloyteam.com/wp-content/uploads/2015/03/stream.jpg" target="_blank" rel="noopener"><img src="http://www.alloyteam.com/wp-content/uploads/2015/03/stream.jpg" alt="stream"></a></p><p>把 HTTP 消息分解为独立的帧, 交错发送, 然后在另一端重新组装是 HTTP 2.0 最 重要的一项增强。事实上, 这个机制会在整个 Web 技术栈中引发一系列连锁反应, 从而带来巨大的性能提升, 因为:</p><ul><li><p>可以并行交错地发送请求, 请求之间互不影响;</p></li><li><p>可以并行交错地发送响应, 响应之间互不干扰;</p></li><li><p>只使用一个连接即可并行发送多个请求和响应;</p></li><li><p>消除不必要的延迟, 从而减少页面加载的时间;</p></li></ul><p><strong>那么也就是说 “域名分区” 这种优化手段对于 HTTP2.0 是无用的，因为资源都是并行交错发送，且没有限制，不需要额外的多域名并行下载。</strong></p><p>“既然所有资源都是并行交错发送，会不会出现这样的情况 【浏览器明明在等关键的 CSS 和 JS，你 TMD 的服务器还在发送图片】” ？？这就要说到HTTP2.0的请求优先级特性了。</p><h3 id="请求优先级"><a href="#请求优先级" class="headerlink" title="请求优先级"></a>请求优先级</h3><p>每个 HTTP2.0 流里面有个<strong>优先值</strong>，这个优先值确定着客户端和服务器处理不同的流采取不同的优先级策略，<strong>高优先级的流都应该优先发送</strong>，但又<strong>不会绝对地遵守</strong>，可能又会引入首队阻塞的问题：高优先级的请求慢导致阻塞其他资源交付。分配处理资源和客户端与服务器间的带宽，<strong>不同优先级的混合也是必须的</strong>。</p><p>“有了优先级，<strong>HTTP2.0 根本不会发生【浏览器明明在等关键的 CSS 和 JS，你 TMD 的服务器还在发图】</strong>” </p><h3 id="服务器推送"><a href="#服务器推送" class="headerlink" title="服务器推送"></a>服务器推送</h3><p><img src="https://pic3.zhimg.com/v2-85da1ac1cd92134019fbcfbe7161257e_r.jpg" alt=""></p><p> HTTP 2.0 新增的一个强大的新功能，就是服务器可以对一个客户端请求发送多个响应。换句话说，除了对最初请求的响应外，服务器还可以<strong>主动地向客户端推送额外的资源，而无需客户端明确地请求</strong>。</p><p>当浏览器请求一个 html，服务器其实大概知道你是接下来要请求资源了，而不需要等待浏览器得到 html 后解析页面再发送资源请求。使用服务器推送的资源的方式更加高效，因为客户端还可以缓存起来（比如一开始向服务器请求的时候只请求了style.css，而服务器不仅给了style.css还主动返回了style.js，那么客户端就先缓存起来了，到要使用到style.js的时候很高兴的发现不用向服务端发起请求了，本地缓存就有！）。</p><h2 id="WebDAV（了解）"><a href="#WebDAV（了解）" class="headerlink" title="WebDAV（了解）"></a>WebDAV（了解）</h2><p>WebDAV（Web-based Distributed Authoring and Versioning，基于万维网的分布式创作和版本控制）是一个可<strong>对 Web 服务器上的内容直接进行文件复制、编辑等操作的分布式文件系统</strong>。它作为扩展 HTTP/1.1 的协议定义在 RFC4918。多应用于坚果云网盘、wps、office等。</p><p>除了创建、删除文件等基本功能，它还具备文件创建者管理、文件编辑过程中禁止其他用户内容覆盖的加锁功能，以及对文件内容修改的版本控制功能。</p><p>使用 HTTP/1.1 的 PUT 方法和 DELETE 方法，就可以对 Web 服务器上的文件进行创建和删除操作。可是出于安全性及便捷性等考虑，一般不使用。</p><h3 id="扩展-HTTP-1-1-的-WebDAV"><a href="#扩展-HTTP-1-1-的-WebDAV" class="headerlink" title="扩展 HTTP/1.1 的 WebDAV"></a>扩展 HTTP/1.1 的 WebDAV</h3><p>针对服务器上的资源，WebDAV 新增加了一些概念，如下所示。</p><ul><li>集合（Collection）：是一种统一管理多个资源的概念。以集合为单位可进行各种操作。也可实现类似集合的集合这样的叠加。</li><li>资源（Resource）：把文件或集合称为资源。</li><li>属性（Property）：定义资源的属性。定义以“名称 = 值”的格式执行。</li><li>锁（Lock）：把文件设置成无法编辑状态。多人同时编辑时，可防止在同一时间进行内容写入。</li></ul><h3 id="WebDAV-内新增的方法及状态码"><a href="#WebDAV-内新增的方法及状态码" class="headerlink" title="WebDAV 内新增的方法及状态码"></a>WebDAV 内新增的方法及状态码</h3><p>WebDAV 为实现远程文件管理，向 HTTP/1.1 中追加了以下这些方法。</p><ul><li>PROPFIND ：获取属性</li><li>PROPPATCH ：修改属性</li><li>MKCOL ：创建集合</li><li>COPY ：复制资源及属性</li><li>MOVE ：移动资源</li><li>LOCK ：资源加锁</li><li>UNLOCK ：资源解锁</li></ul><p>为配合扩展的方法，状态码也随之扩展。</p><ul><li>102 Processing ：可正常处理请求，但目前是处理中状态</li><li>207 Multi-Status ：存在多种状态</li><li>422 Unprocessible Entity ：格式正确，内容有误</li><li>423 Locked ：资源已被加锁</li><li>424 Failed Dependency ：处理与某请求关联的请求失败，因此不再维持依赖关系</li><li>507 Insufficient Storage ：保存空间不足</li></ul><h3 id="WebDAV-的请求实例"><a href="#WebDAV-的请求实例" class="headerlink" title="WebDAV 的请求实例"></a>WebDAV 的请求实例</h3><p>下面是使用 PROPFIND 方法对 <a href="http://www.example.com/file" target="_blank" rel="noopener">http://www.example.com/file</a> 发起获取属性的请求。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PROPFIND /file HTTP/1.1</span><br><span class="line">Host: www.example.com</span><br><span class="line">Content-Type: application/xml; charset=&quot;utf-8&quot;</span><br><span class="line">Content-Length: 219</span><br><span class="line">　</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span><br><span class="line">&lt;D:propfind xmlns:D=&quot;DAV:&quot;&gt;</span><br><span class="line">  &lt;D:prop xmlns:R=&quot;http://ns.example.com/boxschema/&quot;&gt;</span><br><span class="line">  &lt;R:bigbox/&gt;</span><br><span class="line">    &lt;R:author/&gt;</span><br><span class="line">    &lt;R:DingALing/&gt;</span><br><span class="line">    &lt;R:Random/&gt;</span><br><span class="line">  &lt;/D:prop&gt;</span><br><span class="line">&lt;/D:propfind&gt;</span><br></pre></td></tr></table></figure><h3 id="WebDAV-的响应实例"><a href="#WebDAV-的响应实例" class="headerlink" title="WebDAV 的响应实例"></a>WebDAV 的响应实例</h3><p>下面是针对之前的 PROPFIND 方法，返回 <a href="http://www.example.com/file" target="_blank" rel="noopener">http://www.example.com/file</a> 的属性的响应。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 207 Multi-Status</span><br><span class="line">Content-Type: application/xml; charset=&quot;utf-8&quot;</span><br><span class="line">Content-Length: 831</span><br><span class="line">　</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span><br><span class="line">&lt;D:multistatus xmlns:D=&quot;DAV:&quot;&gt;</span><br><span class="line">  &lt;D:response xmlns:R=&quot;http://ns.example.com/boxschema/&quot;&gt;</span><br><span class="line">    &lt;D:href&gt;http://www.example.com/file&lt;/D:href&gt;</span><br><span class="line">    &lt;D:propstat&gt;</span><br><span class="line">      &lt;D:prop&gt;</span><br><span class="line">        &lt;R:bigbox&gt;</span><br><span class="line">        &lt;R:BoxType&gt;Box type A&lt;/R:BoxType&gt;</span><br><span class="line">        &lt;/R:bigbox&gt;</span><br><span class="line">        &lt;R:author&gt;</span><br><span class="line">        &lt;R:Name&gt;J.J. Johnson&lt;/R:Name&gt;</span><br><span class="line">        &lt;/R:author&gt;</span><br><span class="line">      &lt;/D:prop&gt;</span><br><span class="line">      &lt;D:status&gt;HTTP/1.1 200 OK&lt;/D:status&gt;</span><br><span class="line">    &lt;/D:propstat&gt;</span><br><span class="line">    &lt;D:propstat&gt;</span><br><span class="line">      &lt;D:prop&gt;&lt;R:DingALing/&gt;&lt;R:Random/&gt;&lt;/D:prop&gt;</span><br><span class="line">      &lt;D:status&gt;HTTP/1.1 403 Forbidden&lt;/D:status&gt;</span><br><span class="line">      &lt;D:responsedescription&gt; The user does not have access to the DingALing property.</span><br><span class="line">      &lt;/D:responsedescription&gt;</span><br><span class="line">    &lt;/D:propstat&gt;</span><br><span class="line">  &lt;/D:response&gt;</span><br><span class="line">  &lt;D:responsedescription&gt; There has been an access violation error.</span><br><span class="line">  &lt;/D:responsedescription&gt;</span><br><span class="line">&lt;/D:multistatus&gt;</span><br></pre></td></tr></table></figure><h2 id="QUIC-amp-HTTP3-0"><a href="#QUIC-amp-HTTP3-0" class="headerlink" title="QUIC&amp;HTTP3.0"></a>QUIC&amp;HTTP3.0</h2><p>参考文章：<a href="https://www.cnblogs.com/Leo_wl/p/10530323.html#_label7" target="_blank" rel="noopener">https://www.cnblogs.com/Leo_wl/p/10530323.html#_label7</a></p><p>参考文章：<a href="https://zhuanlan.zhihu.com/p/32553477" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/32553477</a></p><p>HTTP2.0是基于SPDY协议的，类似的，HTTP3.0是基于QUIC协议的。SPDY和QUIC都是谷歌制定的，谷歌牛逼。</p><p><img src="https://pic2.zhimg.com/v2-0a847430b0a7696a1c2d59ecb7e715bd_r.jpg" alt=""></p><p>Google 在 <em>SPDY</em> 白皮书里表示要向协议栈下面渗透并替换掉<em>传输层</em>协议（TCP），<em>但是</em>因为这样无论是部署起来还是<em>实现</em>起来暂时相当困难。事实上TCP协议有很多顽疾无法解决，对此，谷歌推出了基于UDP的新协议——QUIC。</p><p>2018年底，互联网工程任务组正式将基于 QUIC 协议的 HTTP （HTTP over QUIC）重命名为 <strong>HTTP/3</strong>。</p><h3 id="HTTP2-0存在的问题"><a href="#HTTP2-0存在的问题" class="headerlink" title="HTTP2.0存在的问题"></a>HTTP2.0存在的问题</h3><h4 id="队头阻塞"><a href="#队头阻塞" class="headerlink" title="队头阻塞"></a>队头阻塞</h4><p>虽然HTTP2.0解决了之前HTTP1.1的很多问题，但还有存在一些问题，主要还是底层的TCP协议造成的。之前提到了HTTP2.0采取了多路复用的方法，一般来说，同一个域名下只需要一个TCP连接。但是，当这个TCP连接出现了丢包的情况，那么就会导致HTTP2.0的表现反而不如HTTP1.1了，为什么呢？因此HTTP2.0下，一旦TCP连接出现丢包的情况，整个的连接都要等待重传，也就导致了后面所有数据都被阻塞住了，而对于HTTP1.1来说，它是开启多个TCP连接的，出现丢包的情况也就影响其中的一个连接而不会殃及其他的TCP连接，剩余的TCP连接还能正常传输数据。对于这种情况，我们称之为<strong>队头阻塞</strong>。</p><p>另外 TLS 协议层面也有一个队头阻塞，因为 TLS 协议都是按照 record 来处理数据的，如果一个 record 中丢失了数据，也会导致整个 record 无法正确处理。</p><p>可见，对于HTTP2.0的优化，在某些情况下反而阻碍了性能的发展。那么就有人想要考虑修改TCP协议，但是这基本上是不可能的了，TCP出现的历史太久了，应用的范围也及其广，而且是在操作系统层面实现的，很难再推翻重做了。</p><h4 id="建立连接的握手延迟大"><a href="#建立连接的握手延迟大" class="headerlink" title="建立连接的握手延迟大"></a>建立连接的握手延迟大</h4><p>不管是HTTP1.0、HTTP1.1、HTTPS，还是HTTP2.0，都是使用的TCP协议进行传输，其中HTTPS和HTTP2.0还要使用TLS协议进行安全传输，这就出现了两个握手延迟。</p><ol><li>TCP 三次握手导致的 TCP 连接建立的延迟。<br>2.TLS 完全握手需要至少 2 个 RTT 才能建立，简化握手需要 1 个 RTT 的握手延迟。<br>对于很多短连接场景，这样的握手延迟影响很大，且无法消除。</li></ol><h3 id="QUIC的特性"><a href="#QUIC的特性" class="headerlink" title="QUIC的特性"></a>QUIC的特性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- 0RTT  连接建立延时低</span><br><span class="line">- 没有对头阻塞的多路复用</span><br><span class="line">- 加密认证的报文</span><br><span class="line">- 向前纠错机制</span><br></pre></td></tr></table></figure><h4 id="QUIC核心特性连接建立延时低"><a href="#QUIC核心特性连接建立延时低" class="headerlink" title="QUIC核心特性连接建立延时低"></a>QUIC核心特性连接建立延时低</h4><p>0RTT 建连可以说是 QUIC 相比 HTTP2 最大的性能优势。那什么是 0RTT 建连呢？这里面有两层含义。</p><ol><li>传输层 0RTT 就能建立连接。</li><li>加密层 0RTT 就能建立加密连接。</li></ol><p><img src="https://pic3.zhimg.com/80/v2-b4b3eb89464b192eed0304e5647a2d26_hd.jpg" alt="img">图 1 HTTPS 及 QUIC 建连过程</p><p>比如上图左边是 HTTPS 的一次完全握手的建连过程，需要 3 个 RTT。就算是 Session Resumption[14]，也需要至少 2 个 RTT。</p><p>而 QUIC 呢？由于建立在 UDP 的基础上，同时又实现了 0RTT 的安全握手，所以在大部分情况下，只需要 0 个 RTT 就能实现数据发送，在实现前向加密 [15] 的基础上，并且 0RTT 的成功率相比 TLS 的 Sesison Ticket[13] 要高很多。</p><h4 id="没有队头阻塞的多路复用"><a href="#没有队头阻塞的多路复用" class="headerlink" title="没有队头阻塞的多路复用"></a>没有队头阻塞的多路复用</h4><p>虽然HTTP2.0实现了多路复用，但前面也提到过，存在队头阻塞的问题。而<strong>QUIC原生就实现了多路复用</strong>，并且传输的单个数据流，可以保证有序交付，而且不会影响到其他的数据流。这样就解决了TCP存在的一些问题。</p><p>同HTTP2.0一样，同一条 QUIC连接上可以创建多个stream，来发送多个HTTP请求，但是，QUIC是基于UDP的，一个连接上的多个stream之间没有依赖。比如下图中stream2丢了一个UDP包，不会影响后面跟着 Stream3 和 Stream4，不存在 TCP 队头阻塞。虽然stream2的那个包需要重新传，但是stream3、stream4的包无需等待，就可以发给用户。</p><p><img src="https://image.fundebug.com/2019-03-06-8.png" alt="img"></p><p>另外QUIC 在移动端的表现也会比 TCP 好。因为 TCP 是基于 IP 和端口去识别连接的，这种方式在多变的移动端网络环境下是很脆弱的。但是 QUIC 是通过 ID 的方式去识别一个连接，不管你网络环境如何变化，只要 ID 不变，就能迅速重连上。</p><h4 id="加密认证的报文"><a href="#加密认证的报文" class="headerlink" title="加密认证的报文"></a>加密认证的报文</h4><p>TCP 协议头部没有经过任何加密和认证，所以在传输过程中很容易被中间网络设备篡改，注入和窃听。比如修改序列号、滑动窗口。这些行为有可能是出于性能优化，也有可能是主动攻击。</p><p>但是 QUIC 的 packet 可以说是武装到了牙齿。除了个别报文比如 PUBLIC_RESET 和 CHLO，所有报文头部都是经过认证的，报文 Body 都是经过加密的。</p><p>这样只要对 QUIC 报文任何修改，接收端都能够及时发现，有效地降低了安全风险。</p><p><img src="https://image.fundebug.com/2019-03-06-9.png" alt="img"></p><p>如上图所示，红色部分是 Stream Frame 的报文头部，有认证。绿色部分是报文内容，全部经过加密。</p><h4 id="向前纠错机制"><a href="#向前纠错机制" class="headerlink" title="向前纠错机制"></a>向前纠错机制</h4><p>QUIC协议有一个非常独特的特性，称为向前纠错 (Forward Error Correction，FEC)，每个数据包除了它本身的内容之外，还包括了部分其他数据包的数据，因此<strong>少量的丢包可以通过其他包的冗余数据直接组装而无需重传</strong>。向前纠错牺牲了每个数据包可以发送数据的上限，但是减少了因为丢包导致的数据重传，因为数据重传将会消耗更多的时间(包括确认数据包丢失、请求重传、等待新数据包等步骤的时间消耗)</p><p>假如说这次我要发送三个包，那么协议会算出这三个包的异或值并单独发出一个校验包，也就是总共发出了四个包。当出现其中的非校验包丢包的情况时，可以通过另外三个包计算出丢失的数据包的内容。<strong>当然这种技术只能使用在丢失一个包的情况下，如果出现丢失多个包就不能使用纠错机制了，只能使用重传的方式了</strong>。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul><li>HTTP/1.x 有连接无法复用、队头阻塞、协议开销大和安全因素等多个缺陷</li><li>HTTP/2 通过多路复用、二进制流、Header 压缩等等技术，极大地提高了性能，但是还是存在着问题的</li><li>QUIC 基于 UDP 实现，是 HTTP/3 中的底层支撑协议，该协议基于 UDP，又取了 TCP 中的精华，实现了即快又可靠的协议</li><li>但目前HTTP1.1仍然是主流，HTTP2.0都尚未普及，改动力度更大的HTTP3.0就更加需要我们等待了</li></ul><h2 id="Web安全攻击概述"><a href="#Web安全攻击概述" class="headerlink" title="Web安全攻击概述"></a>Web安全攻击概述</h2><p><strong>WASC</strong>（web application security consortium）是一个由安全专家、行业顾问和诸多组织的代表组成的国际团体，他们负责为www万维网制定被广为接受的应用安全标准。</p><p><strong>WASC将web安全威胁分为六大块</strong>：</p><ol><li>Authentication（验证）：用来确认某用户、服务或是应用身份的攻击手段</li><li>Authorization（授权）：用来决定是否某用户、服务或者是应用具有执行请求动作必要权限的攻击手段</li><li>Client-Side Attacks（客户侧攻击）：用来扰乱或者是探测web站点用户的攻击手段</li><li>Command Execution（命令执行）：在web站点上执行远程命令的攻击手段</li><li>Information Disclosure（信息泄露）：用来获取 web站点具体系统信息的攻击手段</li><li>Logical Attacks（逻辑性攻击）：用来扰乱或是探测web应用逻辑流程的攻击手段</li></ol><p>OWASP（Open Web Application Security Project）该组织致力于发现和解决不安全Web应用的根本原因。他们最重要的项目之一是“web应用的十大安全隐患”，总结了目前web应用最常收到的十种攻击手段，并按照攻击发生的频率进行了排序。</p><p>官网链接：<a href="http://www.owasp.org.cn/owasp-project/OWASPTop102017v1.3.pdf" target="_blank" rel="noopener">http://www.owasp.org.cn/owasp-project/OWASPTop102017v1.3.pdf</a></p><p><img src="https://pic2.zhimg.com/v2-9d75b28cfede20e3caf3d1f8df491e05_r.jpg" alt=""></p><h3 id="验证机制概述"><a href="#验证机制概述" class="headerlink" title="验证机制概述"></a>验证机制概述</h3><p>验证机制是web应用中最简单的一层安全机制。</p><p>一般来说，应用程序必须核实用户提交的用户名和密码是否正确。正确则允许登录，否则禁止登录。用户通过一个post请求，将用户名和密码提交到服务器，服务器端的代码逻辑进行验证。</p><p>验证机制是应用程序防御恶意攻击的<strong>核心机制</strong>，也是最外围的一层防御机制。它处在安全防御的最前沿，如果被轻易的突破，通常应用程序的全部功能、数据都会被恶意控制。所以，如果<strong>缺乏了安全有效的验证机制</strong>，其他核心安全机制都无法实施（会话管理和访问控制）。</p><p><strong>验证机制</strong>、<strong>会话管理</strong>和<strong>访问控制</strong>构成了三大防御机制。</p><p><img src="https://pic1.zhimg.com/v2-3ed5a7f3bb2743324320fa446d4b167c_r.jpg" alt=""></p><p>我们讲的验证机制，着重于用户登录到session生成这一阶段。</p><p><strong>验证技术</strong></p><ul><li><p>基于HTML表单的验证（最常用）</p><ul><li>如用户名+密码+验证码</li></ul></li><li><p>多元机制，如组合型密码和物理令牌</p><ul><li>如要求用户输入账号+密码之后，还要回答一个验证问题</li></ul></li><li><p>客户端SSL证书或智能卡（成本非常昂贵）</p><ul><li>常用于网银</li></ul></li></ul><p><strong>验证机制中的不安全因素</strong></p><ul><li><p><strong>弱密码</strong></p><p>许多web应用程序没有或者很少对用户的密码强度进行控制</p><ul><li>非常短或者空白的密码</li><li>非常简单的密码，如123456、password</li><li>密码与用户名完全相同</li><li>长时间使用默认密码</li></ul></li><li><p><strong>暴力破解</strong></p><p>登录功能的公开性会诱使攻击者试图猜测用户名和密码，从而获得访问应用程序的权力。如果应用程序允许攻击者用不同的密码暴力尝试，直到他找到正确的密码，这个程序就非常容易遭受攻击。</p><p>如今的带宽和服务器处理能力，每分钟可以发出几千甚至上万个登录尝试，如果没有一些安全措施的话，再强大的密码也最终会被攻破。</p><p>应对暴力破解，比较 有效的是采用验证码技术，从最简单的几个数字、字母、汉字、到问题回答和滑动滑块。</p></li></ul><p><strong>Cookie和会话检测</strong></p><p>有些应用程序会设置一个cookie，如failedlogin=0；登录尝试失败，递增该值，达到某个上限，则拒绝其再次登录尝试。</p><p>这样有用吗？也不一定有用，攻击者可以劫持发出的请求，将请求头中的cookie的值改掉。这样又无法防止暴力破解了。</p><p><strong>双因子认证</strong></p><p>参考文章：<a href="https://www.aqniu.com/vendor/45775.html" target="_blank" rel="noopener">https://www.aqniu.com/vendor/45775.html</a></p><ul><li>双因子认证的核心是综合what you know（个人密码）和what you have（手机）来达到双重认证效果。常见的形式就是输入密码后要输入手机收到的验证码（注意这里的验证码和前面所提到的看图读验证码是不一样的），这种双因子认证更加安全靠谱。</li></ul><p><strong>忘记密码模块</strong></p><ul><li>当前多数的应用程序和网站都回提供“忘记密码”功能，但是如果忘记密码的流程跳过了<strong>身份验证</strong>了完蛋了。</li><li>通常“忘记密码”操作的几种认证用户的方式：<ol><li>用户设定的安全问题（早期QQ主要使用这个）</li><li>用户注册时留下的安全邮箱</li><li>绑定的手机号接收验证码短信</li><li>联系客服</li></ol></li></ul><p><strong>这部分视频后部分看一下，讲的是验证机制漏洞的几个实例，我暂时不做笔记了，了解即可</strong></p><h3 id="会话管理机制"><a href="#会话管理机制" class="headerlink" title="会话管理机制"></a>会话管理机制</h3><p>绝大多数web应用程序中，会话管理机制是一个基本的安全组件。会话管理在应用程序执行登录功能时显得特别重要。因为，它可以在用户通过请求提交他们的证书后，持续向应用程序保证任何特定用户身份的真实性。</p><p>用户登录成功后，服务器端会分配一个session，即一个会话，客户端将这个会话令牌存到cookie中，那么之后所有的请求，拿着这个会话令牌，就可以告诉服务器我是合法用户，我有相应的权限。</p><p>由于一些开发者对会话管理的逻辑设计得不够严谨，会话管理常常成为针对应用程序的恶意攻击的主要目标。若攻击者能够破坏应用程序的会话管理，他就能轻易避开应用程序实施的验证机制，不需要用户证书就可以伪装成应用程序用户。</p><p>如果攻击者以这种方式攻破一个管理用户，那么他就能控制整个应用程序。</p><h3 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h3><p>几乎每个web应用都需要使用数据库来保存操作所需的各种信息，而SQL注入就是主要针对数据库的攻击。</p><p>web程序经常会建立和执行用户操作数据的SQL语句。但是，如果建立这种语句的方法不安全，那么应用程序就很容易收到SQL注入的攻击。最严重的情况下，攻击者可以利用SQL注入读取甚至修改数据库中的所有数据。</p><p>用户可以提交一段数据库查询代码，根据程序返回的结果，获得某些他想得知的数据，这就是所谓的 SQL Injection，即SQL注入。</p><h3 id="xss攻击"><a href="#xss攻击" class="headerlink" title="xss攻击"></a>xss攻击</h3><p>跨站脚本攻击(Cross  site  scripting)，xss是一种经常在web应用中的计算机安全漏洞。它允许恶意web用户将代码植入到提供给其他用户使用的页面中，其他用户在观看网页时，恶意脚本就会执行。</p><p>xss攻击通常通过注入HTML或JS等脚本发动攻击。攻击成功后，攻击者可以得到私密网页内容和cookie等。比如一些钓鱼网站，做了一个假的qq登录界面，诱使用户输入用户名和密码。</p><p>xss攻击的危害：</p><ol><li>盗取各类用户账号密码</li><li>控制数据，包括读取、篡改、添加、删除企业敏感数据的能力</li><li>盗窃企业重要的具有商业价值的资料。</li><li>非法转账</li><li>控制受害者机器成为肉机，向其他网站发起攻击或者挖比特币。</li></ol><p>xss攻击案例：</p><ul><li>MySpace</li><li>apache</li></ul><p><strong>xss分类</strong></p><p>针对xss的攻击方式不同，我们可以把xss分为如下三大类：</p><ol><li>反射式xss</li><li>存储式xss</li><li>基于dom的xss</li></ol><h3 id="CSRF攻击"><a href="#CSRF攻击" class="headerlink" title="CSRF攻击"></a>CSRF攻击</h3><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>CSRF（cross-site request forgery），跨站请求伪造，也称为“one click attack”（可以理解为一点就中）或者session riding，通常缩写为CSRF或者XSRF，是一种对网站的恶意利用。</p><p>尽管听起来像跨站脚本攻击xss，但它与xss非常不同，攻击方式几乎相左。</p><p>xss利用站点内的信任用户（受害者），而CSRF通过伪装来自受信任用户的请求来利用受信任的网站。</p><p>通过社会工程学的手段（如通过电子邮件发送一个链接）来蛊惑受害者进行一些敏感性的操作，如修改密码、修改Email、转账等，而受害者还不知道他已中招。</p><h4 id="CSRF-攻击的危害性"><a href="#CSRF-攻击的危害性" class="headerlink" title="CSRF 攻击的危害性"></a>CSRF 攻击的危害性</h4><ul><li>CSRF的破坏力依赖于受害者的权限。如果受害者只是一个普通用户，则只是危害用户的数据以及一些功能；如果受害者具有管理员权限，则一个成功的CSRF攻击甚至会威胁到整个网站的安全。</li><li>与xss攻击相比，CSRF攻击往往不太流行，因此对其进行防范的资源也较为稀少，和难以防范。事实上，CSRF被认为比xss更具危险性。</li></ul><h4 id="CSRF攻击案例"><a href="#CSRF攻击案例" class="headerlink" title="CSRF攻击案例"></a>CSRF攻击案例</h4><p>小明登录了一个金融网站mybank.com，攻击者小李发现了这个金融网站mybank.com的转账功能有CSRF漏洞，于是攻击者小李在myblog.com上发表了一条博文，这个博文支持img图片自定义功能，攻击者小李就在这博文中插入了这么一行危险的html代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://www.mybank.com/Transfer.php?toBankId=xiaoli&amp;money=10000"</span> <span class="attr">width</span>=<span class="string">"1"</span> <span class="attr">height</span>=<span class="string">"1"</span> <span class="attr">border</span>=<span class="string">"0"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>并诱使小明在已登录自己的金融网站的同时访问小李的危险博客，这时候一个CSRF攻击就开始了。于是小明的账户就不知不觉地向小李的账户转账了10000而自己毫不知情。</p><h4 id="攻击过程深度剖析"><a href="#攻击过程深度剖析" class="headerlink" title="攻击过程深度剖析"></a>攻击过程深度剖析</h4><ol><li><p>web浏览器对于cookie和http身份验证信息之类的会话信息的处理方式：</p><ul><li><p>目前，浏览器会自动的发送标识用户对话的信息，而无需用户自己操作</p></li><li><p>换句话说，当浏览器发送这些身份信息的时候，用户根本感觉不到。</p></li><li><p>假设站点A上有个web应用程序，并且受害者正好已经在该站点上通过了身份认证，这时，相应消息中就会有cookie来记录这个信息。</p><p>一般情况下，浏览器收到站点设置的cookie信息后，每当向该站点发送请求的时候，浏览器都会自动的连同该cookie一起发出。</p><p>这个cookie是被站点作为用户会话的标志，即如果站点收到 了带有受害者的cookie的请求，那么它会把这个请求看作是已登录的受害者发来的。</p></li></ul></li></ol><ol start="2"><li><p>应用程序赖以管理会话的信息对浏览器的透明性问题：</p><p>为了提高web应用的便捷性，<strong>用来管理会话的信息</strong>，如cookie或者基于HTTP的身份验证（如HTTP基本认证、非基于表单的认证）等<strong>敏感信息，都是由浏览器来存放的</strong>。并在每当向需要身份验证的应用程序发送请求时自动捎带上。这就为跨站请求伪造CSRF创造了条件。因为web应用程序不会判断这个请求到底是不是合法用户发送的，它只要看到了有正确的会话管理信息就认可。</p></li></ol><h3 id="CSRF攻击的防御"><a href="#CSRF攻击的防御" class="headerlink" title="CSRF攻击的防御"></a>CSRF攻击的防御</h3><ol><li><p>增加一些确认操作</p><p>比如说上面的转账功能，当用户调用api进行转账的时候，弹出一个对话框，例如：你确定转账10000元吗？</p><p>这样CSRF受害者就可以知道他可能中招了。</p></li><li><p>重新认证</p><p>在做一些重要敏感操作的时候，要求用户重新输入密码进行二次验证，只有正确了才进行操作。点典型的一般金融转账类的应用程序会要求用户除了有账号密码还要有支付密码。</p></li><li><p>使用token（最佳）</p><p>在用户刚登录的时候，产生一个新的不可预知的CSRF Token，并且把此Token存放在用户的session中。</p><p>在任何一个需要保护的表单中，增加一个隐藏的字段来存放这个token。</p><p>对于需要保护的URL，增加一个参数来存放此token。</p><p>提交此请求的时候， 在服务端检查提交的token与用户session中的token是否一支，继续处理请求，否则返回一个错误信息给用户。</p><p>在用户推出或者session过期的时候，用户信息（包括CSRF Token）从session中溢出并且销毁session。</p></li></ol><h2 id="未完待续⚠"><a href="#未完待续⚠" class="headerlink" title="未完待续⚠"></a>未完待续⚠</h2>]]></content>
      
      
      <categories>
          
          <category> 计算机网络 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计算机网络 </tag>
            
            <tag> HTTP </tag>
            
            <tag> web安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小程序云函数路由优化之tcb-router</title>
      <link href="/2019/11/23/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BA%91%E5%87%BD%E6%95%B0%E8%B7%AF%E7%94%B1%E4%BC%98%E5%8C%96%E4%B9%8Btcb-router.html"/>
      <url>/2019/11/23/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BA%91%E5%87%BD%E6%95%B0%E8%B7%AF%E7%94%B1%E4%BC%98%E5%8C%96%E4%B9%8Btcb-router.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="背景："><a href="#背景：" class="headerlink" title="背景："></a>背景：</h2><p>一个用户在一个云环境中只能创建50个云函数，之前是20个，更少。</p><p>比如我们要开发一个项目，当我们要获取A数据的时候可能要创建一个云函数，要获取B数据的时候又要创建一个云函数。。。。随着业务的增多，创建的对应的云函数数目越来越多，50个可能不够用，而且这种做法也很冗杂。</p><p>所以希望把相似的请求归类到同一个云函数处理，比如我们把获取音乐信息和获取电影信息都在同一个云函数里实现，从而避免创建过多云函数的情况。</p><p>要实现这一功能就要用到一个第三方库——<a href="https://github.com/TencentCloudBase/tcb-router" target="_blank" rel="noopener"><strong>tcb-router</strong></a> 一个<strong>koa风格</strong>的云函数路由库。</p><p><br></p><h2 id="koa洋葱模型"><a href="#koa洋葱模型" class="headerlink" title="koa洋葱模型"></a>koa洋葱模型</h2><p>koa框架采用了【中间件】的形式，中间件可以介入请求和相应的处理，可以理解是一个轻量级的模块，或者在我们的代码当中是一个函数形式。中间件可以负责一个特定的功能，通过一个<code>next</code>函数把每个中间件之间建立关系。</p><p>什么是【洋葱模型】？</p><p><img src="https://ask.qcloudimg.com/http-save/yehe-1000017/uuitxvbg4y.jpeg?imageView2/2/w/1620" alt=""></p><p><img src="https://images0.cnblogs.com/blog2015/570057/201507/281409123445079.jpg" alt=""></p><p>简单的理解就如上面两张图所表示的那样。</p><p><br></p><h2 id="tcbRouter云函数"><a href="#tcbRouter云函数" class="headerlink" title="tcbRouter云函数"></a>tcbRouter云函数</h2><p>这里我通过一个例子来说明一下<a href="https://github.com/TencentCloudBase/tcb-router" target="_blank" rel="noopener"><strong>tcb-router</strong></a>的用法。</p><p>我们实现一个功能：把获取音乐信息和获取电影信息都在同一个云函数里实现，两者都要获取<code>用户openid</code>并且获取各自的信息，从而避免创建多个云函数的情况。</p><p>创建云函数<code>tcbRouter</code>👇</p><p><img src="https://pic3.zhimg.com/80/v2-889713697407a747e014aeadc142866a_hd.jpg" alt=""></p><p>在tcbRouter云函数的目录下安装tcb-router依赖👇</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save tcb-router</span><br></pre></td></tr></table></figure><p><br></p><p>云函数<strong>tcbRouter</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 云函数入口文件</span></span><br><span class="line"><span class="keyword">const</span> cloud = <span class="built_in">require</span>(<span class="string">'wx-server-sdk'</span>)</span><br><span class="line"><span class="comment">// 引入tcb-router</span></span><br><span class="line"><span class="keyword">const</span> TcbRouter = <span class="built_in">require</span>(<span class="string">'tcb-router'</span>)</span><br><span class="line"></span><br><span class="line">cloud.init()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 云函数入口函数</span></span><br><span class="line">exports.main = <span class="keyword">async</span> (event, context) =&gt; &#123;</span><br><span class="line">  <span class="comment">// return &#123;event,context&#125;  //看看event和context到底是啥</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// new一个TcbRouter对象,需要传入一个参数,把event传入</span></span><br><span class="line">  <span class="comment">// 这时候tcb-router就会自动帮我们处理事件中的参数和路由转发</span></span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> TcbRouter(&#123;event&#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 公共路由</span></span><br><span class="line">  <span class="comment">// app.use 表示该中间件会适用于所有的路由</span></span><br><span class="line">  app.use(<span class="keyword">async</span> (ctx,next)=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'进入全局中间件'</span>)</span><br><span class="line">    ctx.data = &#123;&#125;</span><br><span class="line">    ctx.data.openId = event.userInfo.openId <span class="comment">//通过该公共路由获取到用户openid</span></span><br><span class="line">    <span class="keyword">await</span> next()  <span class="comment">//执行一下中间件.这是一个异步操作,要加上await</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'退出全局中间件'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// music相关的路由</span></span><br><span class="line">  app.router(<span class="string">'music'</span>, <span class="keyword">async</span> (ctx,next)=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'进入音乐名称路由中间件'</span>)</span><br><span class="line">    ctx.data.musicName = <span class="string">"Let it be"</span></span><br><span class="line">    <span class="keyword">await</span> next()  <span class="comment">//执行一下中间件</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'退出音乐名称路由中间件'</span>)</span><br><span class="line">  &#125;, <span class="keyword">async</span> (ctx, next)=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'进入音乐类型路由中间件'</span>)</span><br><span class="line">    ctx.data.musicType = <span class="string">'摇滚乐'</span></span><br><span class="line">    ctx.body = &#123;</span><br><span class="line">      data: ctx.data</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ctx.body 返回数据到小程序端</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'退出音乐类型路由中间件'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// movie相关的路由</span></span><br><span class="line">  app.router(<span class="string">'movie'</span>, <span class="keyword">async</span> (ctx,next)=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'进入电影名称路由中间件'</span>)</span><br><span class="line">    ctx.data.movieName = <span class="string">"千与千寻"</span></span><br><span class="line">    <span class="keyword">await</span> next()  <span class="comment">//执行一下中间件</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'退出电影名称路由中间件'</span>)</span><br><span class="line">  &#125;, <span class="keyword">async</span> (ctx, next)=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'进入电影类型路由中间件'</span>)</span><br><span class="line">    ctx.data.movieType = <span class="string">'动漫'</span></span><br><span class="line">    ctx.body = &#123;</span><br><span class="line">      data: ctx.data</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ctx.body 返回数据到小程序端</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'退出电影类型路由中间件'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// // 必须写! 需要把当前的服务返回</span></span><br><span class="line">  <span class="keyword">return</span> app.serve()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>小程序端调用tcbRouter函数👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//demo.js</span></span><br><span class="line">getMusicInfo()&#123;</span><br><span class="line">   wx.cloud.callFunction(&#123;</span><br><span class="line">     name: <span class="string">'tcbRouter'</span>,</span><br><span class="line">     data: &#123;</span><br><span class="line">       $url: <span class="string">'music'</span></span><br><span class="line">     &#125;</span><br><span class="line">   &#125;).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(res)</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;,</span><br><span class="line"> getMovieInfo()&#123;</span><br><span class="line">   wx.cloud.callFunction(&#123;</span><br><span class="line">     name: <span class="string">'tcbRouter'</span>,</span><br><span class="line">     data:&#123;</span><br><span class="line">       $url: <span class="string">'movie'</span></span><br><span class="line">     &#125;</span><br><span class="line">   &#125;).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(res)</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure><p>上面这段代码两个方法实际上调用的都是同一个云函数<strong>tcbRouter</strong>，但实现了不同的功能。</p><p><img src="https://pic1.zhimg.com/v2-928c9ce713a0d13a92d18d6abe21b910_r.jpg" alt=""></p><p><br></p><p>为了更加直观的体现【洋葱模型】这一概念在该例子上的应用，我们可以在云开发控制台的云函数运行日志中查看打印的日志👇</p><p><img src="https://pic3.zhimg.com/v2-0484ed79f891b5e7b2e82ad95296e6ca_r.jpg" alt=""></p><p><img src="https://images0.cnblogs.com/blog2015/570057/201507/281409123445079.jpg" alt=""></p><p><br><br><br></p>]]></content>
      
      
      <categories>
          
          <category> 小程序 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 优化 </tag>
            
            <tag> 小程序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo博文中的图文外链失效问题</title>
      <link href="/2019/11/22/hexo%E5%8D%9A%E6%96%87%E4%B8%AD%E7%9A%84%E5%9B%BE%E6%96%87%E5%A4%96%E9%93%BE%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98.html"/>
      <url>/2019/11/22/hexo%E5%8D%9A%E6%96%87%E4%B8%AD%E7%9A%84%E5%9B%BE%E6%96%87%E5%A4%96%E9%93%BE%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>我的博文使用的图床是知乎，这样在Hexo博客发布时就可以直接引用我存放在知乎上的网络图片。但是在刚deploy上去的时候，预览都是OK的，但是过几天后就全都显示不了。</p><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>解决方法其实很简单，只需要文章的头部如下图所示位置添加<meta name="referrer" content="no-referrer">这一句话就可以完美解决问题</p><p><img src="https://img-blog.csdnimg.cn/20190721223929809.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21xZHhpYW94aWFv,size_16,color_FFFFFF,t_70" alt="img"></p><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>详见<a href="https://blog.lyz810.com/article/2016/08/referrer-policy-and-anti-leech/" target="_blank" rel="noopener">《Referrer策略与防盗链》</a></p><p>目前大部分网站采用的是判断referrer是否是当前域名或指定白名单域名下的url。而没有referrer的请求都会放行。<br>referrer策略普及后，单从referrer判断防盗链的方法会失效，所以需要考虑其他的技术手段实现防盗链机制。</p>]]></content>
      
      
      <categories>
          
          <category> 博客配置 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> 博客配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>复习对象</title>
      <link href="/2019/10/28/%E5%AF%B9%E8%B1%A1.html"/>
      <url>/2019/10/28/%E5%AF%B9%E8%B1%A1.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="对象创建方法"><a href="#对象创建方法" class="headerlink" title="对象创建方法"></a>对象创建方法</h2><ul><li><p>对象字面量</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123; &#125;;</span><br></pre></td></tr></table></figure></li><li><p>系统自带的构造函数Object()</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br></pre></td></tr></table></figure></li><li><p>自定义构造函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 与普通函数区别：1、函数名大驼峰命名；2、定义属性和方法为纯语句</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Teacher</span>(<span class="params">name, sex</span>) </span>&#123; <span class="comment">// 传入参数-单个属性</span></span><br><span class="line">    <span class="comment">// 当没有经过关键字new构造函数，就还没有实例化，此时this不存在</span></span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.sex = sex;</span><br><span class="line">    <span class="keyword">this</span>.age = <span class="number">25</span>; <span class="comment">// 默认属性</span></span><br><span class="line">    <span class="keyword">this</span>.smoke = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'I am smoking'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> teacher = <span class="keyword">new</span> Teacher(<span class="string">'dunteng'</span>,<span class="string">'male'</span>);</span><br></pre></td></tr></table></figure></li><li><p>Object.create()创建对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  name: <span class="string">"xiaoming"</span>,</span><br><span class="line">  age: <span class="number">18</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 将obj作为obj1的原型</span></span><br><span class="line"><span class="keyword">var</span> obj1 = <span class="built_in">Object</span>.create(obj)</span><br></pre></td></tr></table></figure></li></ul><p><br><br></p><h2 id="构造函数的内部原理"><a href="#构造函数的内部原理" class="headerlink" title="构造函数的内部原理"></a>构造函数的内部原理</h2><ol><li>在函数体最前面隐式地加上<code>this={}</code></li><li>执行<code>this.xxx = xxx;</code></li><li>隐式地返回<code>this</code></li></ol><p>构造函数能构造出对象的前提是要new它！从而触发构造函数的内部原理。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,height</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// var this =&#123;&#125;</span></span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.height = height;</span><br><span class="line">  <span class="keyword">this</span>.say = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.say);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// return this</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person(<span class="string">'xiaolin'</span>,<span class="number">180</span>);</span><br></pre></td></tr></table></figure><p>⚠来点捣乱的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, height</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.height = height;</span><br><span class="line">  <span class="keyword">this</span>.say = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.say);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;&#125;;<span class="comment">//返回一个空对象</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person(<span class="string">'xiaolin'</span>, <span class="number">180</span>);</span><br></pre></td></tr></table></figure><p>结果person的值就变成了return出来的空对象。</p><p>在构造函数内部允许显示地return出一个对象（空对象也好其他对象也好），则new出来的实例结果就是对应的对象。⚠但是如果是显示return出数字、字符串、undefined或者null，即return的是五大原始值，则new出实例的时候仍然是return语句前面构造出来的this对象！</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570849572989.png" alt="1570849572989"></p><p><br><br></p><h2 id="包装类"><a href="#包装类" class="headerlink" title="包装类"></a>包装类</h2><p><strong>原始值是不能有属性和方法的</strong>。</p><p>看下面👇</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570850068707.png" alt="1570850068707"></p><p>这里的num依然是数字，但是它是用<strong>包装类</strong>Number new出来的数字对象，那么<strong>它就可以加属性和方法</strong>。同时它依旧可以运算，但是运算结果是原始值的数字。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570850243772.png" alt="1570850243772"></p><p>同样的也有:</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570850309748.png" alt="1570850309748"></p><p>前面说了原始值不能有属性和方法，那么看下面的栗子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">4</span>;</span><br><span class="line">num.len = <span class="number">3</span>;</span><br><span class="line"><span class="built_in">console</span>.log(num.len);</span><br></pre></td></tr></table></figure><p>打印结果为undefined，也不报错。原因是存在包装类的隐式调用，如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">4</span>;</span><br><span class="line">num.len = <span class="number">3</span>;</span><br><span class="line"><span class="comment">// 原始值是不能有属性和方法的，但是在这里系统会自动执行：new Number(num).len = 3以避免报错</span></span><br><span class="line"><span class="comment">// 但随即又delete自己。即刚new完Number随机就把自己删了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 然后在console.log(num.len)的时候，讲道理num.len已经不存在了会报错的</span></span><br><span class="line"><span class="comment">// 但是系统为了避免报错又隐式地执行了new Number(num).len，所以结果为输出undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(num.len);</span><br></pre></td></tr></table></figure><p><br></p><hr><p>对于数组，有以下的可行操作：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">arr.length = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(arr);<span class="comment">//[1,2]</span></span><br></pre></td></tr></table></figure><p>数组是可以通过length来截断的，但字符串不行！</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"1234"</span>;</span><br><span class="line">str.length = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(str);<span class="comment">//"1234"</span></span><br></pre></td></tr></table></figure><p>分析：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"1234"</span>;</span><br><span class="line">str.length = <span class="number">2</span>;</span><br><span class="line"><span class="comment">// 执行到str.length = 2的时候系统隐式地执行了new Number(str).length=2,</span></span><br><span class="line"><span class="comment">// 以避免报错，但随机就销毁了</span></span><br><span class="line"><span class="built_in">console</span>.log(str);<span class="comment">//"1234"</span></span><br><span class="line"><span class="comment">// 执行console.log(str.length)的时候系统隐式地执行了new Number(str).length，</span></span><br><span class="line"><span class="comment">// 而length是String类型内置的属性，可以访问</span></span><br><span class="line"><span class="built_in">console</span>.log(str.length);<span class="comment">//4</span></span><br></pre></td></tr></table></figure><p><br></p><hr><p><strong>来练练</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"abc"</span>;</span><br><span class="line">str += <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> test = <span class="keyword">typeof</span> (str);</span><br><span class="line"><span class="keyword">if</span> (test.length == <span class="number">6</span>) &#123;</span><br><span class="line">  test.sign = <span class="string">"hello world"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(test.sign);</span><br></pre></td></tr></table></figure><p>分析如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"abc"</span>;</span><br><span class="line">str += <span class="number">1</span>;  <span class="comment">//str变成了"abc1"</span></span><br><span class="line"><span class="keyword">var</span> test = <span class="keyword">typeof</span> (str);  <span class="comment">//test为"string"</span></span><br><span class="line"><span class="keyword">if</span> (test.length == <span class="number">6</span>) &#123;</span><br><span class="line">  test.sign = <span class="string">"hello world"</span>;<span class="comment">//test是字符串，原始值不能有属性，隐式地执行</span></span><br><span class="line">  <span class="comment">//new Number(test).sign="hello world"，随即销毁</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//隐式地执行包装类转换：new Number(test).sign，随即销毁</span></span><br><span class="line"><span class="built_in">console</span>.log(test.sign);<span class="comment">//undefined</span></span><br></pre></td></tr></table></figure><p><br></p><p>同闭包知识点结合的一题👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, sex</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.age = age;</span><br><span class="line">  <span class="keyword">this</span>.sex = sex;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sss</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    a++;</span><br><span class="line">    <span class="built_in">console</span>.log(a);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.say = sss;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person();</span><br><span class="line">person1.say();</span><br><span class="line">person1.say();</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person();</span><br><span class="line">person2.say();</span><br></pre></td></tr></table></figure><p><br><br></p><h2 id="原型prototype"><a href="#原型prototype" class="headerlink" title="原型prototype"></a>原型prototype</h2><ul><li><p>定义： 原型是function对象的一个属性，它定义了构造函数制造出的对象的公共祖先。通过该构造函数产生的对象，可以继承原型的属性和方法。原型也是对象。</p></li><li><p>利用原型特点和概念，可以提取共有属性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Car.prototype.height = <span class="number">1400</span>;</span><br><span class="line">Car.prototype.lang = <span class="number">4900</span>;</span><br><span class="line">Car.prototype.carName = <span class="string">"BMW"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Car</span>(<span class="params">color, owner</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.owner = owner;</span><br><span class="line">  <span class="keyword">this</span>.color = color;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">var</span> car = <span class="keyword">new</span> Car(<span class="string">'red'</span>, <span class="string">'dunteng'</span>)</span><br><span class="line"><span class="keyword">var</span> car = <span class="keyword">new</span> Car(<span class="string">'pink'</span>, <span class="string">'xiaolin'</span>)</span><br></pre></td></tr></table></figure></li><li><p>对象如何查看原型   通过隐式属性<code>__proto__</code></p><p>​    访问对象实例的属性的时候，先查看实例对象自己有没有，没有的话就通过它的隐式属性<code>__proto__</code>查看原型里有没有这个属性。</p><p>💡  <code>对象实例.__proto__</code>全等于<code>对象构造函数.prototype</code></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570862901392.png" alt="1570862901392"></p></li></ul><p>  <img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570863065304.png" alt="1570863065304"></p><ul><li><p>对象如何查看对象的构造函数   通过<code>constructor</code></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570863239261.png" alt="1570863239261"></p><p>constructor存在于原型中。</p></li></ul><p><br><hr></p><p>看典例👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Person.prototype.name = <span class="string">"sunny"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person();</span><br><span class="line"><span class="built_in">console</span>.log(person.name);  <span class="comment">//"sunny"</span></span><br><span class="line"></span><br><span class="line">Person.prototype.name = <span class="string">"jenny"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person.name);  <span class="comment">//"jenny"</span></span><br></pre></td></tr></table></figure><p>上面这个很容易理解，但下面改一下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Person.prototype.name = <span class="string">"sunny"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person();</span><br><span class="line"><span class="comment">// 在new的时候存在一个隐式过程👇</span></span><br><span class="line"><span class="comment">// function Person() &#123;</span></span><br><span class="line"><span class="comment">// var this = &#123;</span></span><br><span class="line"><span class="comment">//   __proto__: Person.prototype   用__proto__记录了Person.prototype的地址</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(person.name);  <span class="comment">//"sunny"</span></span><br><span class="line"></span><br><span class="line">Person.prototype = &#123;</span><br><span class="line">  name: <span class="string">'jenny'</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 将Person.prototype重新指向了一个新的空间，而person作为new出来的实例是通过__proto__查找</span></span><br><span class="line"><span class="comment">// 原型的，__proto__中记录的东西并没有改变，仍指向原来的Person.prototyped空间</span></span><br><span class="line"><span class="built_in">console</span>.log(person.name);  <span class="comment">//"sunny"</span></span><br></pre></td></tr></table></figure><p><br><br></p><h2 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h2><p>原型也有自己的原型，就形成了原型链。原型链的终端是Object.prototype。可以说<strong>绝大多数</strong>对象的最终都会继承自Object.prototype。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GrandFather.prototype.lastName = <span class="string">"wang"</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GrandFather</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = <span class="string">"祖父"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> grandfather = <span class="keyword">new</span> GrandFather();</span><br><span class="line"></span><br><span class="line">Father.prototype = grandfather;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Father</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = <span class="string">"父亲"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> father = <span class="keyword">new</span> Father();</span><br><span class="line"></span><br><span class="line">Son.prototype = father;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Son</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = <span class="string">"儿子"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> son = <span class="keyword">new</span> Son();</span><br><span class="line"><span class="built_in">console</span>.log(son.lastName);<span class="comment">//"wang"</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570865370449.png" alt="1570865370449"></p><hr><p>前面有提到【绝大多数的对象最终都继承自Object.prototype】，那么什么对象例外呢？</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570866805009.png" alt="1570866805009"></p><hr><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570867335732.png" alt="1570867335732"></p><p>原始值的123是没有方法的，所以要用包装类包装成Number类型，再调用toString方法，注意这里的toString方法是Number()自己重写的，不是Object()的toString，Object()的toString()打印出来的是<code>[Object, Object]</code></p><p><br><br></p><h2 id="call-apply"><a href="#call-apply" class="headerlink" title="call/apply"></a>call/apply</h2><p>作用： 都能改变<code>this</code>指向</p><p>区别： 后面传递的参数形式不同</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person(<span class="string">'lin'</span>, <span class="number">18</span>);</span><br><span class="line"><span class="comment">// 这里直接调用Person函数就没把它当作构造函数new了，里面的this就指向全局window</span></span><br><span class="line"><span class="built_in">console</span>.log(name);</span><br><span class="line"><span class="built_in">console</span>.log(age);</span><br></pre></td></tr></table></figure><p>这里说一下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test()实际上是test.call()</span><br></pre></td></tr></table></figure><p>使用<code>call</code>改变this指向：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">Person.call(obj, <span class="string">'lin'</span>, <span class="number">18</span>);</span><br><span class="line"><span class="built_in">console</span>.log(obj);<span class="comment">//obj里面age为18，name为lin</span></span><br></pre></td></tr></table></figure><p>这里使用call将this的指向改变成了obj，或者说这里就把对象<code>obj</code>拿来取代了this，或者说this就成了obj。</p><p>来个应用栗子👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.age = age;</span><br><span class="line">  <span class="keyword">this</span>.sex = sex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name, age, sex, tel, grade</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.age = age;</span><br><span class="line">  <span class="keyword">this</span>.sex = sex;</span><br><span class="line">  <span class="keyword">this</span>.tel = tel;</span><br><span class="line">  <span class="keyword">this</span>.grade = grade;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> student = <span class="keyword">new</span> Student(<span class="string">'lin'</span>, <span class="number">18</span>, <span class="string">'male'</span>, <span class="number">137</span>, <span class="number">6</span>)</span><br></pre></td></tr></table></figure><p>这样<strong>代码太冗余</strong>了，用call方法改进一下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.age = age;</span><br><span class="line">  <span class="keyword">this</span>.sex = sex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name, age, sex, tel, grade</span>) </span>&#123;</span><br><span class="line">  Person.call(<span class="keyword">this</span>, name, age, sex)</span><br><span class="line">    <span class="comment">//上面结束后实际上 就有一个 this = &#123;name:'lin',age:'18',sex:'male' &#125; </span></span><br><span class="line">  <span class="keyword">this</span>.tel = tel;</span><br><span class="line">  <span class="keyword">this</span>.grade = grade;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> student = <span class="keyword">new</span> Student(<span class="string">'lin'</span>, <span class="number">18</span>, <span class="string">'male'</span>, <span class="number">137</span>, <span class="number">6</span>)</span><br></pre></td></tr></table></figure><p><br></p><p>call需要把实参按照形参的个数一个个传进去，</p><p>apply需要传入一个实参数组</p><p>再来个栗子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Wheel</span>(<span class="params">WheelSize, style</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.WheelSize = WheelSize;</span><br><span class="line">  <span class="keyword">this</span>.style = style;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sit</span>(<span class="params">c, sitColor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.c = c;</span><br><span class="line">  <span class="keyword">this</span>.sitColor = sitColor</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Model</span>(<span class="params">height, width, len</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.height = height;</span><br><span class="line">  <span class="keyword">this</span>.width = width;</span><br><span class="line">  <span class="keyword">this</span>.len = len;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Car</span>(<span class="params">WheelSize, style, c, sitColor, height, width, len</span>) </span>&#123;</span><br><span class="line">  Wheel.apply(<span class="keyword">this</span>, [WheelSize, style]);</span><br><span class="line">  Sit.apply(<span class="keyword">this</span>, [c, sitColor]);</span><br><span class="line">  Model.apply(<span class="keyword">this</span>, [height, width, len])</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> myCar = <span class="keyword">new</span> Car(<span class="number">100</span>, <span class="string">'花里胡哨'</span>, <span class="string">'真皮'</span>, <span class="string">'red'</span>, <span class="number">1800</span>, <span class="number">1900</span>, <span class="number">4900</span>)</span><br><span class="line"><span class="built_in">console</span>.log(myCar);</span><br></pre></td></tr></table></figure><p><br><br></p><h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><p>继承发展史：</p><ol><li><p>原型链</p><p>缺点：过多的继承了没用的属性<br></p></li><li><p>借用构造函数+call/apply</p><p>我上面讲call/apply的两个栗子就是</p><p>缺点：无法继承借用来的构造函数的原型，而且不方便。<br></p></li><li><p>共有原型</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Father.prototype.lastName = <span class="string">"xi"</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Father</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Son</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inherit</span>(<span class="params">Target, Origin</span>) </span>&#123;</span><br><span class="line">  Target.prototype = Origin.prototype;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line">inherit(Son, Father);<span class="comment">//一定要先继承再定义哦</span></span><br><span class="line"><span class="keyword">var</span> son = <span class="keyword">new</span> Son();</span><br></pre></td></tr></table></figure><p>这种做法有<strong>缺点</strong>，如果想要给Son对象的原型添加些属性，那么很不好的事，Father对象并不需要这些属性，因为要知道，它俩的原型指向的是同一个。<br></p></li><li><p>圣杯模式 </p><p>借用一个中间层。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inherit</span>(<span class="params">Target, Origin</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">  F.prototype = Origin.prototype;<span class="comment">//这行和下一行顺序一定不能调换，否则就错了</span></span><br><span class="line">  Target.prototype = <span class="keyword">new</span> F();  <span class="comment">//F作为中间层，这样就算Target会修改原型，也只是修改了F，影响不到Origin</span></span><br><span class="line">  Target.prototype.constructor = Target;  <span class="comment">//手动添加构造器constructor</span></span><br><span class="line">  Target.prototype.uber = Origin.prototype; <span class="comment">//记录真实的原型</span></span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Father</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Son</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">Father.prototype = &#123;</span><br><span class="line">  lastName: <span class="string">'Lin'</span></span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line">inherit(Son, Father);</span><br><span class="line"><span class="keyword">var</span> son = <span class="keyword">new</span> Son();</span><br><span class="line"><span class="keyword">var</span> father = <span class="keyword">new</span> Father();</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570887149405.png" alt="1570887149405"></p><p>上面这个继承还可以再优化一下，使用立即执行函数和闭包来优化：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">var</span> inherit = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="keyword">var</span> F = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;;</span><br><span class="line">     <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">Target, Origin</span>) </span>&#123;</span><br><span class="line">       F.prototype = Origin.prototype;</span><br><span class="line">       Target.prototype = <span class="keyword">new</span> F();</span><br><span class="line">       Target.prototype.constructor = Target;</span><br><span class="line">       Target.prototype.uber = Origin.prototype;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;())<span class="comment">//整个是一个立即执行函数，即用即销毁，优化性能</span></span><br><span class="line"><span class="comment">//inherit里面的F通过闭包保存成了inherit的私有化属性，更加优化</span></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">Father</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">Son</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">   Father.prototype = &#123;</span><br><span class="line">     lastName: <span class="string">'lin'</span></span><br><span class="line">   &#125;</span><br><span class="line">   inherit(Son, Father)</span><br><span class="line">   <span class="keyword">var</span> father = <span class="keyword">new</span> Father();</span><br><span class="line">   <span class="keyword">var</span> son = <span class="keyword">new</span> Son();</span><br></pre></td></tr></table></figure></li></ol><p><br><br></p><h2 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h2><p>管理变量，防止污染全局，适用于模块化开发。</p><p>传统的方法是用对象包起来形成专有的命名空间，用的时候就通过xxx.xxxx.xxx这样的方式访问。</p><p>解决方式：使用<strong>立即执行函数和闭包</strong></p><p>栗子👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">var</span> init = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="keyword">var</span> name = <span class="string">'abc'</span>;</span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">callName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(name);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">       callName();</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> _init = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="keyword">var</span> name = <span class="string">'def'</span>;</span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">callName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(name);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">       callName();</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;)()</span><br><span class="line">   </span><br><span class="line">   init();</span><br><span class="line">_init();</span><br></pre></td></tr></table></figure><p>上面这两个函数变量命名互不影响，因为都存在于立即执行函数里面，而变量被闭包保存return带出来。<strong>实现模块开发，防止污染全局变量</strong></p><p><br><br></p><h2 id="对象的遍历"><a href="#对象的遍历" class="headerlink" title="对象的遍历"></a>对象的遍历</h2><p>对象遍历不可能像遍历数组那样for循环，因为根本不知道对象的“长度”</p><p>所以要使用<code>for key in obj</code>的方法：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  name: <span class="string">'lin'</span>,</span><br><span class="line">  age: <span class="number">12</span>,</span><br><span class="line">  sex: <span class="string">"male"</span>,</span><br><span class="line">  height: <span class="number">180</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(obj[key]);<span class="comment">//这里的每一个key本身都是String类型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们知道<code>obj.xxx</code>和<code>obj[&#39;xxx&#39;]</code>都可以访问到对象属性，但是在<code>for key in obj</code>循环里必须十一用<code>obj[&#39;xxx&#39;]</code>的方式访问，<code>obj.xxx</code>输出的为undefined</p><p><code>obj.name</code>实际上本质会先转化为<code>obj[&#39;name&#39;]</code>，索引框里必须是字符串类型。</p><p>在上面代码中如果使用<code>obj.xxx</code>的方式的话：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  name: <span class="string">'lin'</span>,</span><br><span class="line">  age: <span class="number">12</span>,</span><br><span class="line">  sex: <span class="string">"male"</span>,</span><br><span class="line">  height: <span class="number">180</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(obj.key);<span class="comment">//这里变成了obj['key'],可是obj中没有key这个键，所以undefined</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><code>for key in obj</code>可以遍历出原型里的东西吗？答案是可以的（除了Object.prototype）。</p><p>但是我就只想遍历出目标对象自己的属性，怎么做？</p><p><strong>利用<code>hasOwnProperty(xxx)</code>方法来判断<code>xxx</code>是不是obj自身的属性。</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  name: <span class="string">'lin'</span>,</span><br><span class="line">  age: <span class="number">12</span>,</span><br><span class="line">  sex: <span class="string">"male"</span>,</span><br><span class="line">  height: <span class="number">180</span>,</span><br><span class="line">  __proto__: &#123;</span><br><span class="line">    hobby: <span class="string">"guitar"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj.hasOwnProperty(key)) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(obj[key]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>除了<code>hasOwnProperty()</code>可以判断是不是属性，<code>in</code>也可以。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'height'</span> <span class="keyword">in</span> obj);<span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'hobby'</span> <span class="keyword">in</span> obj);<span class="comment">//true</span></span><br></pre></td></tr></table></figure><p>⚠注意：<code>hasOwnProperty()</code>是判断是不是对象自己的非继承属性，<code>in</code>指判断是不是属性，不管是不是继承来的。</p><p><br></p><p>💡再来说说<code>instanceof</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">instanceof</span> B</span><br></pre></td></tr></table></figure><p>它的语法理解就是：</p><p>​    看A对象是不是B构造函数构造出来的</p><p>​    更深层次的理解是看A对象的原型链上有没有B的原型</p><p>应用：判断一个变量是数组还是对象？</p><p>方法一：看constructor</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570897037168.png" alt="1570897037168"></p><p>方法二：用instanceof</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570897168419.png" alt="1570897168419"></p><p>方法三：看toString()</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570897447379.png" alt="1570897447379"></p><p><br><br></p><h2 id="this"><a href="#this" class="headerlink" title="this"></a>this</h2><ul><li><p>函数预编译过程中  this—&gt;window</p></li><li><p>全局作用域里  this—&gt;window</p></li><li><p>call/apply可以改变函数运行时this的指向</p></li><li><p>obj.func();   func()里面的this指向obj；即谁调用this就指向谁</p></li></ul><p><br></p><p>这里补充一下预编译：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> a = <span class="number">123</span>;</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     test(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570903506616.png" alt="1570903506616"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> a = <span class="number">123</span>;</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">new</span> test(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570903422900.png" alt="1570903422900"></p><p>例题👇：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">"222"</span>;</span><br><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  name: <span class="string">"111"</span>,</span><br><span class="line">  say: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> fun = a.say;</span><br><span class="line">fun()</span><br><span class="line">a.say()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = &#123;</span><br><span class="line">  name: <span class="string">"333"</span>,</span><br><span class="line">  say: <span class="function"><span class="keyword">function</span> (<span class="params">fun</span>) </span>&#123;</span><br><span class="line">    fun()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">b.say(a.say);</span><br><span class="line">b.say = a.say;</span><br><span class="line">b.say();</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="number">123</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pr</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.foo = <span class="number">234</span>;<span class="comment">//this指向全局window</span></span><br><span class="line">  <span class="built_in">console</span>.log(foo);</span><br><span class="line">&#125;</span><br><span class="line">pr();</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="number">123</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pr</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.foo = <span class="number">234</span>;<span class="comment">//this指向Object.create(pr.prototype)</span></span><br><span class="line">  <span class="built_in">console</span>.log(foo);<span class="comment">//123</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.foo);<span class="comment">//234</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> pr();</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">5</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  a = <span class="number">0</span>;</span><br><span class="line">  alert(a);</span><br><span class="line">  alert(<span class="keyword">this</span>.a);</span><br><span class="line">  <span class="keyword">var</span> a;</span><br><span class="line">  alert(a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test();<span class="comment">//0  5  0</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">5</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  a = <span class="number">0</span>;</span><br><span class="line">  alert(a);</span><br><span class="line">  alert(<span class="keyword">this</span>.a);</span><br><span class="line">  <span class="keyword">var</span> a;</span><br><span class="line">  alert(a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> test();<span class="comment">//0  undefined  0</span></span><br></pre></td></tr></table></figure><p><br><br></p><h2 id="arguments-callee和function-caller"><a href="#arguments-callee和function-caller" class="headerlink" title="arguments.callee和function.caller"></a>arguments.callee和function.caller</h2><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570931723015.png" alt="1570931723015"></p><p><strong>callee</strong> 是 <code>arguments</code> 对象的一个属性。它可以用于引用该函数的函数体内当前正在执行的函数。这在函数的名称是未知时很有用，例如在没有名称的函数表达式 (也称为“匿名函数”)内。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//求阶乘</span></span><br><span class="line">    <span class="keyword">var</span> num = (<span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">arguments</span>.callee(n - <span class="number">1</span>) * n</span><br><span class="line">    &#125;)(<span class="number">100</span>)</span><br></pre></td></tr></table></figure><hr><p>来说说<strong>Function.caller</strong>。</p><p>如果一个函数<code>f</code>是在全局作用域内被调用的,则<code>f.caller为`</code>null<code>,相反,如果一个函数是在另外一个函数作用域内被调用的,则</code>f.caller指向调用它的那个函数.`</p><p>⚠该特性是非标准的，官方建议不要再生产环境中使用。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>.callee.caller);</span><br><span class="line">&#125;</span><br><span class="line">test1();</span><br><span class="line"><span class="comment">//执行结果为null</span></span><br></pre></td></tr></table></figure><p><br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  test2()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>.callee.caller);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>.callee.caller === test1);</span><br><span class="line">&#125;</span><br><span class="line">test1();</span><br><span class="line"><span class="comment">//执行打印结果为test1函数体和true</span></span><br></pre></td></tr></table></figure><p><br><br></p><h2 id="浅克隆-深克隆"><a href="#浅克隆-深克隆" class="headerlink" title="浅克隆/深克隆"></a>浅克隆/深克隆</h2><p>【浅克隆】</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  name: <span class="string">'abc'</span>,</span><br><span class="line">  age: <span class="number">18</span>,</span><br><span class="line">  sex: <span class="string">'male'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clone</span>(<span class="params">origin, target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> target = target || &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> origin) &#123;</span><br><span class="line">    target[key] = origin[key]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> newObj = clone(obj);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570935515334.png" alt="1570935515334"></p><p>浅克隆的原始值属性更改，另一个对象不受影响。但是引用值属性一改就全都改了。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570936074035.png" alt="1570936074035"></p><p>为了避免这个问题就需要进行<strong>深度克隆</strong></p><p>思想：</p><ol><li>遍历对象  <code>for (var prop in origin)</code></li><li>判断是不是原始值 ，同时排除null。 <code>origin[prop] !== null &amp;&amp; typeof (origin[prop]) == &#39;object&#39;</code></li><li>判断是数组还是对象，利用<code>Object.prototype.toStringcall(origin[prop])</code>方法</li><li>建立相应的数组或对象</li><li>递归</li></ol><p><br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.num = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> person1 = &#123;</span><br><span class="line">  name: <span class="string">'zhang'</span>,</span><br><span class="line">  age: <span class="number">18</span>,</span><br><span class="line">  sex: <span class="string">'male'</span>,</span><br><span class="line">  say: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="number">666</span>); &#125;,</span><br><span class="line">  children: &#123;</span><br><span class="line">    first: &#123;</span><br><span class="line">      name: <span class="string">'zhang2'</span>,</span><br><span class="line">      age: <span class="number">11</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  car: [<span class="string">'Benz'</span>, <span class="string">'Mazda'</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person2 = deepClone(person1);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">origin, target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> target = target || &#123;&#125;,</span><br><span class="line">    toStr = <span class="built_in">Object</span>.prototype.toString,</span><br><span class="line">    arrStr = <span class="string">"[object Array]"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> prop <span class="keyword">in</span> origin) &#123;</span><br><span class="line">    <span class="keyword">if</span> (origin.hasOwnProperty(prop)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (origin[prop] !== <span class="literal">null</span> &amp;&amp; <span class="keyword">typeof</span> (origin[prop]) == <span class="string">'object'</span>) &#123;</span><br><span class="line">        target[prop] = toStr.call(origin[prop]) == arrStr ? [] : &#123;&#125;;</span><br><span class="line">        deepClone(origin[prop], target[prop]);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        target[prop] = origin[prop];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>💡另外还可以使用 JSON 来实现深度克隆：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="built_in">JSON</span>.stringify(person1);</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="built_in">JSON</span>.parse(str);</span><br></pre></td></tr></table></figure><p>但是json克隆无法克隆方法</p><p>haikyi</p><p><br></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>复习预编译-作用域-闭包-立即执行函数</title>
      <link href="/2019/10/28/%E9%A2%84%E7%BC%96%E8%AF%91-%E4%BD%9C%E7%94%A8%E5%9F%9F-%E9%97%AD%E5%8C%85-%E7%AB%8B%E5%8D%B3%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0.html"/>
      <url>/2019/10/28/%E9%A2%84%E7%BC%96%E8%AF%91-%E4%BD%9C%E7%94%A8%E5%9F%9F-%E9%97%AD%E5%8C%85-%E7%AB%8B%E5%8D%B3%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="函数定义"><a href="#函数定义" class="headerlink" title="函数定义"></a>函数定义</h2><p>👉<a href="http://doc.liangxinghua.com/javascript/3.1.html" target="_blank" rel="noopener">点击</a></p><p>【补充】：</p><ul><li><p>注意区分什么是函数声明、什么是函数表示，不要混淆。</p></li><li><p>命定表达式</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570686806366.png" alt="1570686806366"></p><p>函数按照上面的方式定义后，只有test才是函数，test1不是一个函数，但是test1是test的name，可以通过test.name得到。</p></li></ul><h2 id="参数、返回值"><a href="#参数、返回值" class="headerlink" title="参数、返回值"></a>参数、返回值</h2><p>👉<a href="http://doc.liangxinghua.com/javascript/3.2.html" target="_blank" rel="noopener">点击</a></p><p><br><br></p><h2 id="预编译"><a href="#预编译" class="headerlink" title="预编译"></a>预编译</h2><p>JavaScript执行的三部曲：</p><p>​    1、语法分析：先通篇扫描一下看有没有语法错误，但是不执行。</p><p>​    2、预编译</p><p>​    3、解释执行</p><hr style="background-color:lightblue"><p><strong>【函数声明整体提升，变量的声明提升，变量的赋值不提升】</strong></p><p>我们知道JavaScript是解释一行执行一行的，看下面的代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">test();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">666</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>它是可以成功执行打印出666的。因为<strong>函数声明整体提升</strong>了，它会把函数的声明提升到逻辑的最前面。</p><p>再看下面的代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(a);</span><br></pre></td></tr></table></figure><p>报错，a未定义。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">123</span>;</span><br></pre></td></tr></table></figure><p>可执行，但是打印结果为<strong>undefined</strong>。这说明了 a 是<strong>已经声明但是尚未赋值</strong>。这一现象是<strong>变量的声明提升</strong>。</p><p>但是，这两个口诀治标不治本，必须把预编译搞明白。</p><hr style="background-color:lightblue"><p><strong>imply global  暗示全局变量</strong>：</p><p>任何变量，如果变量未经声明就赋值，此变量就为全局对象window所有。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">a = <span class="number">10</span>; <span class="comment">//未经声明就赋值，相当于window.a = 10;</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>再来一个栗子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = b = <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line">test();</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br></pre></td></tr></table></figure><p>这个执行结果是报错的。</p><p><code>var a = b= 10</code>是从右往左赋值的，先将10赋值给b，但是b没有声明所以它是一个全局变量，之后再把b赋值给a，a有声明变量，它是函数test里面的一个局部变量。外界是无法访问a的，所以报错。但是如果打印b是可以正确输出10的。</p><hr style="background-color:lightblue"><p><strong>一切声明的全局变量，都归window所有，都是window的属性</strong>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">var a = 10; //相当于window.a = 10;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr style="background-color:lightblue"><h3 id="函数预编译"><a href="#函数预编译" class="headerlink" title="函数预编译"></a>函数预编译</h3><p>函数预编译发生在函数执行的前一刻。过程如下：</p><ul><li>创建AO对象（Activation Object 执行期上下文，它的作用就是我们理解的作用域）</li><li>找形参和变量声明，将变量和形参名作为AO对象的属性名，值为undefined</li><li>将实参值和形参统一</li><li>找函数声明，将函数名也作为AO对象的属性名挂起来，将该声明的函数体作为值。</li></ul><p>举个栗子👇</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570706022488.png" alt="1570706022488"></p><p>这段代码执行结果为？</p><p>栗子1👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(a);</span><br><span class="line">      c = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">var</span> c;</span><br><span class="line">      a = <span class="number">3</span>;</span><br><span class="line">      b = <span class="number">2</span>;</span><br><span class="line">      <span class="built_in">console</span>.log(b);</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">d</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">      <span class="built_in">console</span>.log(b);</span><br><span class="line">    &#125;</span><br><span class="line">    test(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>栗子2👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a);</span><br><span class="line">  <span class="built_in">console</span>.log(b);</span><br><span class="line">  <span class="keyword">var</span> b = <span class="number">234</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(b);</span><br><span class="line">  a = <span class="number">123</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(a);</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">  <span class="keyword">var</span> a;</span><br><span class="line">  b = <span class="number">234</span>;</span><br><span class="line">  <span class="keyword">var</span> b = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(a);</span><br><span class="line">  <span class="built_in">console</span>.log(b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><hr style="background-color:lightblue"><h3 id="全局预编译"><a href="#全局预编译" class="headerlink" title="全局预编译"></a>全局预编译</h3><p>和函数的预编译类似，同时它产生的叫做GO，GO就是window</p><ul><li>创建GO对象（global object 全局上下文，它的作用就是我们理解的全局作用域）</li><li>找形参和变量声明，将形参名、变量名作为GO对象的属性名，值为undefined</li><li>找函数声明，将函数名也作为GO对象的属性名挂起来，将该声明的函数体作为值。</li></ul><p>举个栗子👇</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570758880702.png" alt="1570758880702"></p><p>上面的栗子改动一下👇</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570759070170.png" alt="1570759070170"></p><p>来练练👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(test);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">test</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(test);</span><br><span class="line">  <span class="keyword">var</span> test = <span class="number">234</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(test);</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">test(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">var</span> test = <span class="number">123</span>;</span><br><span class="line"><span class="built_in">console</span>.log(test);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(bar());</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      foo = <span class="number">10</span>;</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">var</span> foo = <span class="number">11</span>;</span><br><span class="line">      <span class="keyword">return</span> foo;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> foo;</span><br><span class="line">  foo = <span class="number">10</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> foo = <span class="number">11</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(bar());</span><br></pre></td></tr></table></figure><p><hr style="background-color:lightblue"></p><h2 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h2><p>每个JavaScript函数都是一个对象，对象中有些属性我们可以访问。也有些是不可以访问的，这种属性仅供JavaScript引擎存取，[[scope]]就是其中之一。</p><p>[[scope]]指的就是作用域，其中存储了运行期上下文的集合。</p><p>[[scope]]中所存储的执行期上下文对象的集合，这种集合呈链式链接，称作是<strong>作用域链</strong></p><hr style="background-color:lightblue"><p><strong>执行期上下文</strong>：当函数执行时，会创建一个称为执行期上下文的内部对象。一个执行期上下文定义了一个函数执行时的环境，函数每次执行时对应的执行上下文都是独一无二的，所以多次调用同一个函数会导致创建多个执行上下文，当函数执行完毕，它所产生的执行上下文就销毁。爽完了就抛弃，渣男！</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">test()  <span class="comment">//第一个执行test函数，创建了一个它的执行上下文AO</span></span><br><span class="line"><span class="comment">//执行完毕后，AO就被销毁了</span></span><br><span class="line">test()  <span class="comment">//再一次执行test函数，又需要创建一个执行上下文AO</span></span><br><span class="line"><span class="comment">//爽完之后再次抛弃(╬▔皿▔)凸</span></span><br></pre></td></tr></table></figure><p><hr style="background-color:lightblue"><br>举个栗子👇</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570772661596.png" alt="1570772661596"></p><p>这段代码首先是函数a的声明，a函数被定义的时候就产生了如下环节：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570772746072.png" alt="1570772746072"></p><p>a的[[scope]]里面存的是scope chain即作用域链，这时候作用域链里只有一个全局执行上下文GO，紧接着执行代码<code>var glob = 100</code>更新GO。紧接着执行函数a()。</p><p>a函数执行的时候就产生了它的执行期上下文AO，并把AO放到作用域链的最顶端，现前的GO就往后稍稍。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570773023375.png" alt="1570773023375"></p><p>一旦我们再a里面查找一个变量的话，它会从a的作用域链的顶端——AO<strong>依次向下</strong>查找。</p><p>紧接着，由于a的执行产生了一个过程——b函数的定义，b作为函数也有自己的[[scope]]，但是b刚出生时它的环境就是a给它的，所以b可以捡现成的[[scope]]。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570773293755.png" alt="1570773293755"></p><p>即b刚刚被定义的时候，它保存的就是a的劳动成果。</p><p>重点在于b函数被执行的时候，它也产生了它的执行上下文AO，将其放在作用域链的最顶端，之前a的AO和GO就又往后稍稍了。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570773491976.png" alt="1570773491976"></p><p>这时如果在b里面找一个变量的话，也是从作用域链的最顶端自顶向下查找。</p><p>b()执行完成之后，b自己的AO就被销毁了，b.[[[scope]]回到了b一开始被定义的时候；</p><p>接着b()执行完说明a()也执行完成了，a自己的AO也被销毁了，a.[[scope]]回到了a一开始定义的时候。</p><p><hr style="background-color:lightblue"><br>再举个栗子👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    c();</span><br><span class="line">  &#125;</span><br><span class="line">  b();</span><br><span class="line">&#125;</span><br><span class="line">a()</span><br></pre></td></tr></table></figure><p>执行a()，得到作用域链如下：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570775695313.png" alt="1570775695313"></p><p>在任何一个函数里面想要访问一个变量，找它的作用域链就完事了。想要访问变量一定是看在这个函数执行时产生的作用域链，而且是自顶向下访问。</p><p>假如我们要在b函数里面访问c函数里定义的cc变量，那么这时候我们是站在【b executing  b.[[scoep]]】这个作用域链上的，而这个作用域链里面根本没有cAO，也就访问不到c函数里面定义的cc变量了。这就是为什么函数外部无法访问函数内部的变量的原因。</p><p>ps：上面这段代码如果a函数没有执行就没有【a executing 。。。】及其之后的作用域链。</p><p><br><br></p><h2 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h2><p>一个栗子👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> bbb = <span class="number">234</span>;</span><br><span class="line">    <span class="built_in">document</span>.write(aaa);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> aaa = <span class="number">123</span>;</span><br><span class="line">  <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> glob = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">var</span> demo = a();</span><br><span class="line">demo();</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570777469422.png" alt="1570777469422"></p><p>a执行完毕后销毁了aAO，讲道理，里面的aaa也应该销毁了，但是a函数把b返回了出来并且赋给了demo，导致demo保留了aAO，从而可以访问到aaa。最终结果是打印出123。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570777779515.png" alt="1570777779515"></p><p>这就是闭包。</p><p><strong>但凡函数内部的函数，被保存到了外面，一定生成闭包。</strong></p><hr style="background-color:lightblue"><p>再来个详细一点的图文：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570780727395.png" alt="1570780727395"></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570784350992.png" alt="1570784350992"></p><hr style="background-color:lightblue"><p>当内部函数被保存到外部时，将会生成闭包。</p><h2 id="闭包的作用"><a href="#闭包的作用" class="headerlink" title="闭包的作用"></a>闭包的作用</h2><ul><li><p>实现公有变量</p><ul><li><p>栗子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     count++;</span><br><span class="line">     <span class="built_in">console</span>.log(count);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> demo</span><br><span class="line"> &#125;</span><br><span class="line"><span class="comment">//这样就把count这个变量公有化了</span></span><br><span class="line"> <span class="keyword">var</span> counter = add();</span><br><span class="line">    </span><br><span class="line"> setInterval(counter, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>可以做缓存（存储结构）</p></li><li><p>可以实现封装，属性私有化</p></li><li><p>模块化开发，防止污染全局变量</p></li></ul><p>【闭包的缺点】闭包会导致原有作用域链不释放，占用内存，造成内存泄漏。</p><p><br><br></p><h2 id="立即执行函数"><a href="#立即执行函数" class="headerlink" title="立即执行函数"></a>立即执行函数</h2><p>执行完立即销毁</p><p>两种格式：</p><ul><li>(function () { })()</li><li>(function () { }())</li></ul><p><br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">666</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test()<span class="comment">//这样是可以成功执行的</span></span><br></pre></td></tr></table></figure><p>而且打印test结果就是test函数的函数体。那么我这样写行不行呢？👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">666</span>);</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure><p>⚠很遗憾，不行！！！</p><p>这里记住：【只有表达式才能被执行符号()执行】</p><p>所以上面栗子中<code>function test(){}</code>它是函数声明，不是表达式，不可以被执行；</p><p>而<code>test()</code>中<code>test</code>就算单独杵着它也是一个表达式，不是说非要<code>a+b</code>之类的才叫表达式，单独的<code>123;</code>、<code>test</code>也是表达式了。</p><p>那么！函数表达式能不能被执行呢？</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> test = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">666</span>);</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure><p>都叫表达式了它就一定能被执行。</p><p>【奇技淫巧】</p><p>记住表达式能被立即执行则表达式的名字不存在，举个栗子👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> test = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">666</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在控制台操作如下：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570789411336.png" alt="1570789411336"></p><p>这个test的名字还代表着这个函数。    </p><p>但是，我们在函数表达式后边加一个括号，这个表达式就可以被立即执行了：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> test = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">666</span>);</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure><p>控制台中打印test为undefined，它就不再代表函数了，<code>function(){console.log(666)}</code>被永久的放弃了，这也符合立即执行函数的特点，用完就销毁。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570789509076.png" alt="1570789509076"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+ function test() &#123;</span><br><span class="line">  console.log(666);</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure><p>函数声明后面加上括号是不可以被执行的，但是在函数声明前面加上一个加号，就会使得<code>function test(){}</code>有一个转化为number类型的趋势，整个<code>+ function(){}</code>就变成了一个表达式,，从而可以被括号执行。同样的减号也可以办到。但是乘号除号不可以。</p><p>以下的运算符都可以办到：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> || <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">666</span>);</span><br><span class="line">&#125;();</span><br><span class="line"></span><br><span class="line">    <span class="number">1</span> &amp;&amp; <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">666</span>);</span><br><span class="line">&#125;();</span><br><span class="line"></span><br><span class="line"> !<span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">666</span>);</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure><p>被执行了之后，test就不再代表<code>function (){}</code>了，变成了undefined。</p><p>以上的核心步骤就是【将函数声明变成表达式，就可以被立即执行了】</p><p><strong>那么括号()也是运算符，将函数声明用括号包起来，就能将函数声明变成表达式了！因此可以被立即执行。这就是立即执行函数的原理。</strong></p><p>好，来个迷惑又恶心的 栗子👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a, b, c, d</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a + b + c + d);</span><br><span class="line">&#125; (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br></pre></td></tr></table></figure><p>这个居然不报错！因为系统将其理解成了：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a, b, c, d</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(a + b + c + d);</span><br><span class="line"> &#125; </span><br><span class="line"> </span><br><span class="line"> (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br></pre></td></tr></table></figure><p>虽然不报错，但也没执行test函数。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570795567350.png" alt="1570795567350"></p><p>再来一个👇：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f = (</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"1"</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">g</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">)();</span><br><span class="line"><span class="built_in">console</span>.log(f);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> f);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570807949996.png" alt="1570807949996"></p><p>再来一个难的栗子👇：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123; &#125;) &#123;</span><br><span class="line">  x += <span class="keyword">typeof</span> f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(x);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570810489773.png" alt="1570810489773"></p><hr><p>【一颗经典的栗子】👇：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> arr = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    arr[i] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test().forEach(<span class="function"><span class="params">element</span> =&gt;</span> &#123;</span><br><span class="line">  element()</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>我们想要的结果是输出从0到9，但是结果是输出了十个10。为啥呢？</p><p>在for循环的过程中，把函数体<code>function(){console.log(i)}</code>赋给了arr[0]、arr[1]、arr[2]。。。。。arr[9]，注意不是把<code>function(){console.log(0)}</code>赋给了arr[0]、把<code>function(){console.log(1)}</code>赋给arr[1]。。。把<code>function(){console.log(9)}</code>赋给arr[9]。这点要搞清楚。所以循环结束，是把十个相同的函数体赋给了数组arr，而在执行arr里的每一个元素即每一个函数体的时候，才会给函数体里的 i 进行赋值，而赋值的时候可以看到 i 的值为10！所以最终打印除了十个10。</p><p>{建议手写GO、AO作用域链，可以更理解清晰）</p><p>解决方案：</p><p>方法一：利用立即执行函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> arr = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params">j</span>) </span>&#123;</span><br><span class="line">      arr[j] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(j);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)(i)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test().forEach(<span class="function"><span class="params">element</span> =&gt;</span> &#123;</span><br><span class="line">  element()</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>方案二：另一种立即执行函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> arr = [];</span><br><span class="line">  <span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> (<span class="params">ele</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(ele);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    arr[i] = foo(i)；<span class="comment">//参数传入时foo函数就执行了</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test().forEach(<span class="function"><span class="params">element</span> =&gt;</span> &#123;</span><br><span class="line">  element</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>以上栗子的实际应用如下👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给每个li添加点击事件，点击时打印该li的顺序</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> liCollection = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'li'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; liCollection.length; i++) &#123;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params">j</span>) </span>&#123;</span><br><span class="line">      liCollection[j].onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(j);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)(i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test()</span><br></pre></td></tr></table></figure><p><br><br></p><h2 id="with"><a href="#with" class="headerlink" title="with"></a>with</h2><p>with 可以改变作用域链</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  name: <span class="string">'obj-name'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">"window"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">'scope'</span>;</span><br><span class="line">  <span class="keyword">with</span> (obj) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">test()</span><br></pre></td></tr></table></figure><p>with(obj){…}括号里填入对象obj，会把这个对象obj当作with圈定的代码体的作用域链的最顶端，即把obj当作最顶端的AO（执行上下文），所以打印出来的name就是obj里的name。</p><p>💡应用场景</p><p>之前说过命名空间</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> org = &#123;</span><br><span class="line">  dp1: &#123;</span><br><span class="line">    jc: &#123;</span><br><span class="line">      name: <span class="string">'jicheng'</span>,</span><br><span class="line">      age: <span class="number">22</span></span><br><span class="line">    &#125;,</span><br><span class="line">    deng: &#123;</span><br><span class="line">      name: <span class="string">"laodeng"</span>,</span><br><span class="line">      age: <span class="number">30</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  dp2: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当dp1部门的jc要开发的时候,通过如下方式获取并编程</span></span><br><span class="line"><span class="comment">// org.dp1.jc.age</span></span><br><span class="line"><span class="comment">// org.dp1.jc.name</span></span><br><span class="line"><span class="comment">// org.dp1.jc.xxx....</span></span><br><span class="line"><span class="comment">// 这样太麻烦了，可以先var jc = org.dp1.jc  从而简化代码</span></span><br><span class="line"><span class="comment">// 实际上开发时使用with的，这样最简便</span></span><br><span class="line"><span class="keyword">with</span> (org.dp1.jc) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name);</span><br><span class="line">  <span class="built_in">console</span>.log(age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>⚠使用with会降低效率，所以<br>ES5严格模式禁止使用它。</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>复习数组</title>
      <link href="/2019/10/28/%E5%A4%8D%E4%B9%A0%E6%95%B0%E7%BB%84.html"/>
      <url>/2019/10/28/%E5%A4%8D%E4%B9%A0%E6%95%B0%E7%BB%84.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>可以先看一下这里的总结👉<a href="https://www.jianshu.com/p/9521594710d7" target="_blank" rel="noopener">点击</a></p><h2 id="数组创建方法"><a href="#数组创建方法" class="headerlink" title="数组创建方法"></a>数组创建方法</h2><ul><li><p>字面量定义方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br></pre></td></tr></table></figure></li><li><p>new Array</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">10</span>);<span class="comment">//创建了长度为10的稀松数组，值都为undefined</span></span><br><span class="line"><span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>); <span class="comment">//创建了数组[1,2,3,4]</span></span><br><span class="line"><span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">10.2</span>)<span class="comment">//报错，长度不能为小数</span></span><br></pre></td></tr></table></figure></li></ul><p><br><br></p><h2 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h2><p>【会改变原数组的方法】</p><ul><li><p>push</p></li><li><p>pop</p></li><li><p>shift</p></li><li><p>unshift</p></li><li><p>reverse</p></li><li><p>splice</p></li><li><p>sort</p></li></ul><p>【不会改变原数组的方法】</p><ul><li>concat</li><li>join</li><li>slice</li><li>toString</li><li>join，返回字符串</li><li>String.split，这个不是数组的方法，它是字符串的方法。返回数组   join和split互逆</li></ul><p><strong>数组和字符串之间的相互转换就可以使用join和split</strong></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570956573946.png" alt="1570956573946"></p><p>手写push方法：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="built_in">Array</span>.prototype.push = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">arguments</span>.length; i++) &#123;</span><br><span class="line">    <span class="keyword">this</span>[<span class="keyword">this</span>.length] = <span class="built_in">arguments</span>[i];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.length + <span class="string">"  我是手写的push"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(arr);</span><br><span class="line"><span class="built_in">console</span>.log(arr.push(<span class="number">5</span>));</span><br><span class="line"><span class="built_in">console</span>.log(arr);</span><br><span class="line"><span class="built_in">console</span>.log(arr.push(<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>));</span><br><span class="line"><span class="built_in">console</span>.log(arr);</span><br></pre></td></tr></table></figure><p><br></p><p>  这个splice我要特别记一下，他是这样子的👇</p><p>  arr.splice(从第几位开始，截取多少的长度，在切口处添加新数据)</p><p>  这个位数的判断很微妙，这里特别说一下，之前一直理解错</p><p>  <img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570954253675.png" alt="1570954253675"></p><p>  <img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570954293519.png" alt="1570954293519"></p><p>  如果是splice(-1)表示从倒数第一位置开始切。</p><p><br></p><p>sort不能直接使用，要传入一个函数。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">4</span>];</span><br><span class="line">arr.sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (a &gt; b) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(arr);</span><br></pre></td></tr></table></figure><p>以上是升序排序。</p><p>可以再简化一下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arr.sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a - b;<span class="comment">//升序</span></span><br><span class="line"><span class="comment">//return b - a;//降序</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>练练👇：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给定一个有序的数组，使其乱序</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">arr.sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.random() - <span class="number">0.5</span>;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(arr);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//对象数组的排序</span><br><span class="line">var aaa = &#123;</span><br><span class="line">  age: 12,</span><br><span class="line">  name: &apos;AAA&apos;</span><br><span class="line">&#125;,</span><br><span class="line">  bbb = &#123;</span><br><span class="line">    age: 20,</span><br><span class="line">    name: &apos;BBB&apos;</span><br><span class="line">  &#125;,</span><br><span class="line">  ccc = &#123;</span><br><span class="line">    age: 6,</span><br><span class="line">    name: &apos;CCC&apos;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">var arr = [aaa, bbb, ccc];</span><br><span class="line">arr.sort(function (a, b) &#123;</span><br><span class="line">  return a.age - b.age</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">console.log(arr);</span><br></pre></td></tr></table></figure><p><br></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570956085353.png" alt="1570956085353"></p><p><br></p><p>slice方法</p><p>slice（从该位开始截取，截取到该位），返回出截取出来的数组</p><p><br><br></p><h2 id="类数组"><a href="#类数组" class="headerlink" title="类数组"></a>类数组</h2><p>举个栗子，arguments就是个类数组。</p><p>手写一个类数组：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var obj = &#123;</span><br><span class="line">  &quot;0&quot;: &apos;a&apos;,</span><br><span class="line">  &quot;1&quot;: &apos;b&apos;,</span><br><span class="line">  &quot;2&quot;: &apos;c&apos;,</span><br><span class="line">  &quot;length&quot;: 3,</span><br><span class="line">  &quot;push&quot;: Array.prototype.push</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570957073803.png" alt="1570957073803"></p><p>💡类数组：属性要为索引（数字）属性，必须有length属性，最好加上push方法。而且如果加上splice方法的话，外观就更像数组了👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="string">"0"</span>: <span class="string">'a'</span>,</span><br><span class="line">  <span class="string">"1"</span>: <span class="string">'b'</span>,</span><br><span class="line">  <span class="string">"2"</span>: <span class="string">'c'</span>,</span><br><span class="line">  <span class="string">"length"</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="string">"push"</span>: <span class="built_in">Array</span>.prototype.push,</span><br><span class="line">  <span class="string">"splice"</span>: <span class="built_in">Array</span>.prototype.splice</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570957380785.png" alt="1570957380785"></p><p>阿里巴巴笔试题👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 运行以下代码，问obj变成了什么样？</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="string">"2"</span>: <span class="string">'a'</span>,</span><br><span class="line">  <span class="string">"3"</span>: <span class="string">'b'</span>,</span><br><span class="line">  <span class="string">"length"</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="string">"push"</span>: <span class="built_in">Array</span>.prototype.push,</span><br><span class="line">  <span class="string">"splice"</span>: <span class="built_in">Array</span>.prototype.splice</span><br><span class="line">&#125;</span><br><span class="line">obj.push(<span class="string">'c'</span>);</span><br><span class="line">obj.push(<span class="string">'d'</span>);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/jsnote/1570957532671.png" alt="1570957532671"></p><p>这里看一下push的原理就懂了，我上文有写👆</p><p><br></p><p>【封装typeof】</p><p>使其可以准确判断类型</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_type</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> template = &#123;</span><br><span class="line">    <span class="string">"[object Array]"</span>: <span class="string">"array"</span>,</span><br><span class="line">    <span class="string">"[object Object]"</span>: <span class="string">"object"</span>,</span><br><span class="line">    <span class="comment">// 下面三个包装类</span></span><br><span class="line">    <span class="string">"[object Number]"</span>: <span class="string">"number - object"</span>,</span><br><span class="line">    <span class="string">"[object Boolean]"</span>: <span class="string">"boolean - object"</span>,</span><br><span class="line">    <span class="string">"[object String]"</span>: <span class="string">"string - object"</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (target == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> (target) == <span class="string">'object'</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> str = <span class="built_in">Object</span>.prototype.toString.call(target);</span><br><span class="line">    <span class="keyword">return</span> template[str];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> (target);<span class="comment">//原始值和Function可以直接通过原生typeof判断</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>【数组去重】</p><p>方法一：利用对象属性的唯一性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.unique = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> temp = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> arr = [];</span><br><span class="line">  <span class="keyword">var</span> len = <span class="keyword">this</span>.length;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!temp[<span class="keyword">this</span>[i]]) &#123;</span><br><span class="line">      temp[<span class="keyword">this</span>[i]] = <span class="string">"abc"</span>;</span><br><span class="line">      arr.push(<span class="keyword">this</span>[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line"><span class="built_in">console</span>.log(arr.unique());</span><br></pre></td></tr></table></figure><p>方法二：利用ES6的[..new Set(arr)]或者Array.from(new Set(arr))</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">2</span>,];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(arr)) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'type error!'</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [...new <span class="built_in">Set</span>(arr)];</span><br><span class="line">  <span class="comment">//return Array.from(new Set(arr))  </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(unique(arr));</span><br></pre></td></tr></table></figure><p>方法三： 双循环</p><p>双重for（或while）循环是比较笨拙的方法，它实现的原理很简单：先定义一个包含原始数组第一个元素的数组，然后遍历原始数组，将原始数组中的每个元素与新数组中的每个元素进行比对，如果不重复则添加到新数组中，最后返回新数组；因为它的时间复杂度是O(n^2)，如果数组长度很大，那么将会非常耗费内存</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(arr)) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'type error!'</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> res = [arr[<span class="number">0</span>]]</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> flag = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; res.length; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[i] === res[j]) &#123;</span><br><span class="line">                flag = <span class="literal">false</span>;<span class="comment">//利用一个flag来判断是否已存在，关键</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">            res.push(arr[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>方法四：indexOf方法</p><p>数组的indexOf()方法可返回某个指定的元素在数组中首次出现的位置。该方法首先定义一个空数组res，然后调用indexOf方法对原来的数组进行遍历判断，如果元素不在res中，则将其push进res中，最后将res返回即可获得去重的数组</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(arr)) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'type error!'</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> res = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.indexOf(arr[i]) === <span class="number">-1</span>) &#123;</span><br><span class="line">            res.push(arr[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br></p><p>来点随堂练习👇：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">delete</span> x;</span><br><span class="line">  <span class="keyword">return</span> x;</span><br><span class="line">&#125;)(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>结果为1。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 形参实际上就是隐式地执行了 var x;</span></span><br><span class="line">  <span class="comment">// 同时注意，var出来的变量，如果不是作为属性而存在的话，是无法被delete掉的</span></span><br><span class="line">  <span class="keyword">delete</span> x;<span class="comment">//无效</span></span><br><span class="line">  <span class="keyword">return</span> x;<span class="comment">//该是啥就是啥</span></span><br><span class="line">&#125;)(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><hr><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> h = <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">23</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> a());<span class="comment">//Uncaught ReferenceError: a is not defined</span></span><br></pre></td></tr></table></figure><hr>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue页面间通信传值的方法</title>
      <link href="/2019/10/17/Vue%E9%A1%B5%E9%9D%A2%E9%97%B4%E9%80%9A%E4%BF%A1%E4%BC%A0%E5%80%BC%E7%9A%84%E6%96%B9%E6%B3%95.html"/>
      <url>/2019/10/17/Vue%E9%A1%B5%E9%9D%A2%E9%97%B4%E9%80%9A%E4%BF%A1%E4%BC%A0%E5%80%BC%E7%9A%84%E6%96%B9%E6%B3%95.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="页面跳转与传值"><a href="#页面跳转与传值" class="headerlink" title="页面跳转与传值"></a>页面跳转与传值</h2><h3 id="一、使用router-link"><a href="#一、使用router-link" class="headerlink" title="一、使用router-link"></a>一、使用router-link</h3><p>routes路由：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">'/'</span>,</span><br><span class="line">        name: <span class="string">'Index'</span>,</span><br><span class="line">        component: Index</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">'/deitail'</span>,</span><br><span class="line">        name: <span class="string">'deitail'</span>,</span><br><span class="line">        component: deitail</span><br><span class="line">      &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>使用<code>&lt;router-link&gt;</code>进行跳转和传值</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-link :to=&quot;&#123;name:&apos;deitail&apos;,params:&#123;freezeMon:&apos;2017-10&apos;,owerName:&apos;西安&apos;&#125;&#125;&quot; tag=&quot;div&quot; &gt;</span><br><span class="line">&lt;/router-link&gt;</span><br></pre></td></tr></table></figure><p>取值时：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;$route.params.freezeMon&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>小结：router-link跳转传值要注意的地方</p><ul><li>to前面要加 <code>:</code></li><li>to后面{中的name值要与路由中的name值一致</li></ul><h3 id="二、使用-router-push"><a href="#二、使用-router-push" class="headerlink" title="二、使用$router.push()"></a>二、使用$router.push()</h3><h4 id="query写法"><a href="#query写法" class="headerlink" title="query写法"></a>query写法</h4><p><strong>传值的路由</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.$router.push(&#123;</span><br><span class="line">  path: <span class="string">"/login?uname="</span> + <span class="keyword">this</span>.userName</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>传值路由第二种写法</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.$router.push(&#123;</span><br><span class="line">  path: <span class="string">"/login"</span>,</span><br><span class="line">  query: &#123;</span><br><span class="line">    uname: <span class="keyword">this</span>.userName</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>接收值的路由</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"接收过来的值为："</span> + <span class="keyword">this</span>.$route.query.uname);        <span class="comment">//这里是$route 没有r----</span></span><br></pre></td></tr></table></figure><p><br></p><h4 id="params写法"><a href="#params写法" class="headerlink" title="params写法"></a>params写法</h4><p><strong>传值路由第一种写法（还是会将参数显示在地址栏中）</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.$router.push(&#123;</span><br><span class="line">  path: <span class="string">"/login/"</span> + <span class="keyword">this</span>.userName</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>传值路由的第二种写法（不会将参数显示在地址栏中）</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.$router.push(&#123;</span><br><span class="line">  name: <span class="string">"login"</span>,</span><br><span class="line">  params: &#123;</span><br><span class="line">    uname: <span class="keyword">this</span>.userName</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>接收值的路由</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"接收过来的值为："</span> + <span class="keyword">this</span>.$route.params.uname);</span><br></pre></td></tr></table></figure><p>注意：在使用params传递参数的时候，我们需要在router的对象里面，找到当前的这个路由，然后去更改它的 path</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   path: <span class="string">"/login/:uname"</span>, <span class="comment">//代表当前url跳转的路径</span></span><br><span class="line">   component: login, <span class="comment">//代表在当前这个路径下面，我们如何显示组件（显示那一个组件）</span></span><br><span class="line">   name: <span class="string">"login"</span> <span class="comment">//给当前路由取一个别名</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>上面的path后面是 /login/:uname ,这一个是我们的一个路径变量，前面的login代表路由，而后面<code>:uname</code>代表的是变量</p>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>防抖节流</title>
      <link href="/2019/10/15/%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81.html"/>
      <url>/2019/10/15/%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="背景问题"><a href="#背景问题" class="headerlink" title="背景问题"></a>背景问题</h2><p>在前端开发中有一部分的用户行为会频繁的触发事件，从而频繁地执行函数，而对于DOM操作、资源加载等耗费性能的处理，很可能导致界面卡顿，甚至浏览器崩溃（本质是因为js是单线程的）。</p><p>函数节流（throttle）和函数防抖（debounce）可以解决问题。</p><h2 id="防抖"><a href="#防抖" class="headerlink" title="防抖"></a>防抖</h2><p>函数防抖就是在函数需要频繁触发情况时，只有等足够空闲的事件，才执行，为了避免又有事件触发。</p><ul><li>常见应用场景：搜索框实时搜索请求数据、拖拽</li></ul><ul><li>代码实现：</li></ul><p>关键点：设置定时器、this的指向、arguments的指向 </p><p>模拟搜索框实时请求数据👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> oInp = <span class="built_in">document</span>.getElementById(<span class="string">'inp'</span>);</span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> timer = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">oInp.oninput = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// console.log(arguments);</span></span><br><span class="line">  <span class="keyword">var</span> _self = <span class="keyword">this</span>;<span class="comment">//想要的是输入框input的数据，若无此步，setTimeout的this指向window</span></span><br><span class="line">  <span class="keyword">var</span> _arg = <span class="built_in">arguments</span>;</span><br><span class="line">  clearTimeout(timer);</span><br><span class="line">  timer = setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    ajax.apply(_self, _arg)<span class="comment">//改变this指向，让输入框元素实际调用这个函数</span></span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e, <span class="keyword">this</span>.value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的代码只能应对发送ajax这种业务，下面进行一下防抖的封装</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> oInp = <span class="built_in">document</span>.getElementById(<span class="string">'inp'</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e, <span class="keyword">this</span>.value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">handler, delay</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// handler  要进行防抖处理的功能性函数</span></span><br><span class="line">  <span class="comment">// delay    延迟时间</span></span><br><span class="line">  <span class="keyword">var</span> timer = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _self = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">var</span> _arg = <span class="built_in">arguments</span>;</span><br><span class="line">    clearTimeout(timer);</span><br><span class="line">    timer = setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      handler.apply(_self, _arg)</span><br><span class="line">    &#125;, delay);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">oInp.oninput = debounce(ajax, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure><h2 id="节流"><a href="#节流" class="headerlink" title="节流"></a>节流</h2><p>函数节流就是预定一个函数只有在大于或等于执行周期时才执行，周期内调用不执行。</p><ul><li>常见应用场景<ul><li>窗口调整</li><li>页面滚动数据加载</li><li>防止恶意脚本抢购疯狂点击</li></ul></li></ul><ul><li><p>代码实现</p><p>模拟抢红包的功能👇</p><p><img src="https://pic1.zhimg.com/v2-b6352cf3e28fc9e753d3eacab3e1b8b4_r.jpg" alt="1571146823113"></p><p>这种代码如果被人注入恶意脚本，使得按钮点击事件疯狂触发，服务器和客户端都受不了。为了避免这种情况，使用节流操作。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">我抢到<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"show"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span>个红包！</span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"btn"</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line"><span class="keyword">var</span> oSpan = <span class="built_in">document</span>.getElementById(<span class="string">'show'</span>);</span><br><span class="line"><span class="keyword">var</span> oBtn = <span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>);</span><br><span class="line">  </span><br><span class="line"><span class="comment">// oBtn.onclick = function () &#123;</span></span><br><span class="line"><span class="comment">//   oSpan.innerText = parseInt(oSpan.innerText) + 1;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line">oBtn.onclick = throttle(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  oSpan.innerText = <span class="built_in">parseInt</span>(oSpan.innerText) + <span class="number">1</span>;</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">handler, wait</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> lastTime = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> nowTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">    <span class="keyword">if</span> (nowTime - lastTime &gt; wait) &#123;</span><br><span class="line">      handler();</span><br><span class="line">      lastTime = nowTime;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再改进一下👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> oSpan = <span class="built_in">document</span>.getElementById(<span class="string">'show'</span>);</span><br><span class="line"><span class="keyword">var</span> oBtn = <span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>);</span><br><span class="line">  </span><br><span class="line">oBtn.onclick = throttle(crazyClick, <span class="number">1000</span>)</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">handler, wait</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> lastTime = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> nowTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">        <span class="keyword">if</span> (nowTime - lastTime &gt; wait) &#123;</span><br><span class="line">            handler.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">            lastTime = nowTime;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">crazyClick</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>, e);</span><br><span class="line">    oSpan.innerText = <span class="built_in">parseInt</span>(oSpan.innerText) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><br></p><p>假设无限次触发：防抖函数永远不会真正执行；节流函数则会按照间隔时间执行。</p><p>防抖动和节流本质是不一样的。防抖动是将多次执行变为最后一次执行，节流是将多次执行变成每隔一段时间执行。</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 优化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记住密码和自动登录的逻辑</title>
      <link href="/2019/10/10/jizhumima.html"/>
      <url>/2019/10/10/jizhumima.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="记住密码和自动登录"><a href="#记住密码和自动登录" class="headerlink" title="记住密码和自动登录"></a>记住密码和自动登录</h2><p>每次点击登录按钮时触发相应的函数，这里为了简便我直接将用户名、密码等登录所需要的信息存进了localstorage中，<strong>事实上这是很危险的</strong>，好一点的一定要做好加密。</p><p><img src="https://pic4.zhimg.com/v2-8f1ff8bfb1e964b0cb79df79e36ff3b3_r.jpg" alt=""></p><p>存入缓存：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (res.data.code == <span class="number">1</span>) &#123;</span><br><span class="line">  <span class="comment">// 登录成功</span></span><br><span class="line">  <span class="comment">// 记住用户密码</span></span><br><span class="line">  localStorage.setItem(</span><br><span class="line">    <span class="string">"Login_SFA_data"</span>,</span><br><span class="line">    <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">      remember: <span class="keyword">this</span>.remember,</span><br><span class="line">      autologin: <span class="keyword">this</span>.autologin,</span><br><span class="line">      p_Numer: <span class="keyword">this</span>.remember ? <span class="keyword">this</span>.p_Numer : <span class="string">""</span>,</span><br><span class="line">      cm_code: <span class="keyword">this</span>.remember ? <span class="keyword">this</span>.cm_code : <span class="string">""</span>,</span><br><span class="line">      psw: <span class="keyword">this</span>.remember ? <span class="keyword">this</span>.psw : <span class="string">""</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ); </span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.$router.push(<span class="string">"/home"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在每次页面挂载的时候，就取缓存，并显示在表单中：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mounted() &#123;</span><br><span class="line">  <span class="keyword">let</span> data = <span class="built_in">JSON</span>.parse(localStorage.getItem(<span class="string">"Login_SFA_data"</span>));</span><br><span class="line">  <span class="keyword">if</span> (data) &#123;</span><br><span class="line">    <span class="keyword">this</span>.cm_code = data.cm_code;</span><br><span class="line">    <span class="keyword">this</span>.psw = data.psw;</span><br><span class="line">    <span class="keyword">this</span>.p_Numer = data.p_Numer;</span><br><span class="line">    <span class="keyword">this</span>.autologin = data.autologin;</span><br><span class="line">    <span class="keyword">this</span>.remember = data.remember;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.p_Numer = <span class="keyword">this</span>.$route.query.p_Numer;</span><br><span class="line">    <span class="keyword">this</span>.cm_code = <span class="keyword">this</span>.$route.query.cm_code;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.autologin) &#123;</span><br><span class="line">    <span class="keyword">this</span>.login(); <span class="comment">// 方法就是登录</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>自动登录这一块还可以做些其他的操作，比如通过判断当前时间和缓存记录的时间差是否 间隔了一定的时间，若超过了规定的时间就取消自动登录，要求重新输入密码再登录。</p>]]></content>
      
      
      <categories>
          
          <category> 业务场景 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小案例 </tag>
            
            <tag> 业务场景 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis</title>
      <link href="/2019/10/08/Redis.html"/>
      <url>/2019/10/08/Redis.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="缓存背景"><a href="#缓存背景" class="headerlink" title="缓存背景"></a>缓存背景</h2><p>由于数据库是建立在硬盘上的，当有大量数据读写数据库时，而硬盘的读写速度慢，导致数据库性能有瓶颈，数据吞吐不够。</p><p>因此在客户端和数据库之前间，加一个<strong>缓存</strong>，而这个缓存是用内存做的，<strong>内存的读写速度非常快</strong>。 当要对数据库进行读写时，先访问中间层的缓存，读数据时先看缓存中有无想要的数据，若有直接从缓存拿，若无则再去访问数据库；写数据时，先写进缓存，之后缓存再慢慢同步到数据库。这样就帮数据库有效地拦截了一些频繁的读写操作。</p><p><img src="https://pic4.zhimg.com/v2-ae215207d175303dd4e37b37b61a7d33_r.jpg" alt=""></p><p>【什么样的数据存入缓存】缓存中存的应是读写数据库非常频繁的数据。</p><p>【防止缓存穿透】缓存穿透是指查询一个一定不存在的数据，由于缓存是不命中时被动写的，并且出于容错考虑，如果从存储层查不到数据则不写入缓存，这将导致这个不存在的数据每次请求都要到存储层去查询，失去了缓存的意义。在流量大时，可能DB就挂掉了，要是有人利用不存在的key频繁攻击我们的应用，这就是漏洞。这需要一些算法去识别，比如布隆算法。参考文章👉<a href="https://blog.csdn.net/zeb_perfect/article/details/54135506" target="_blank" rel="noopener">点击</a></p><p><br></p><p>缓存这一层就用<strong>Redis</strong>来做。Redis既使用内存，也使用硬盘。作为读写操作的时候是用内存的，但是内存存数据是暂时的，机器一关内存里的东西就没了，所以需要用到硬盘来做缓存备份。内存与硬盘之间是同步数据和恢复数据的关系。</p><p>Redis是用C语言写的，Redis支持多种数据结构，key-value、key-map、key-set、key-list等等。比较常用的就是key-value，key一般是字符串，value可以是数字也可以是字符串。但是C语言中是没有字符串的。而Redis中的字符串长度是可变的，是用了SDS结构（Simple Dynamic String）。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sdshdr</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 记录 buf 数组中已使用字节的数量</span></span><br><span class="line">    <span class="comment">// 等于 SDS 所保存字符串的长度</span></span><br><span class="line">    <span class="keyword">int</span> len;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 记录 buf 数组中未使用字节的数量</span></span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">free</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 字节数组，用于保存字符串</span></span><br><span class="line">    <span class="keyword">char</span> buf[];</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>当字符串变长时，先看sds结构内free还有没有足够的空间，没有的话就要重新创建一个更大的字节数组用以存储变长后的字符串。</p><p>关于更多Redis源码的知识这里就不说了，因为我只懂一点皮毛。</p><p><br></p><h2 id="Windows使用Redis"><a href="#Windows使用Redis" class="headerlink" title="Windows使用Redis"></a>Windows使用Redis</h2><p>Redis是微软开源的一个存储数据库。可以在GitHub上下载👉<a href="https://github.com/microsoftarchive/redis/releases" target="_blank" rel="noopener">https://github.com/microsoftarchive/redis/releases</a></p><p>注意window系统中只有64位的系统才能使用Redis。</p><p><img src="https://pic2.zhimg.com/v2-754e178d110a14222ca88e9d52ee724d_r.jpg" alt=""></p><p>下载后点击，不需要配置什么，按提示安装就行了。安装后要配置一些配置文件。</p><p><br></p><p><strong>设置链接密码，修改redis.windows-service.conf</strong></p><p>​    <img src="https://pic4.zhimg.com/v2-3d74b5d6edf13cb03fca1b642b1abc6b_r.jpg" alt=""></p><p><br></p><p><strong>查看是否允许本地访问</strong>，有的版本是允许的，如下所示</p><p><img src="https://pic3.zhimg.com/v2-f62414b17a45477d65578f64858c555e_r.jpg" alt=""></p><p><br></p><p>配置修改后需要重启Redis，打开系统的”服务“，找到Redis重启即可。</p><p><br></p><p>双击redis-cli.exe启动。</p><p>输入<code>auth 123456</code>连接Redis。通过<code>set</code>键值对来写入数据，通过<code>get</code>键来获取数据。</p><p><img src="https://pic4.zhimg.com/80/v2-c2683c7ddec97d9396f726cfbe89c9bb_hd.jpg" alt=""></p><h2 id="CentOS使用Redis"><a href="#CentOS使用Redis" class="headerlink" title="CentOS使用Redis"></a>CentOS使用Redis</h2><p>使用安装包下载👇</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.redis.io/releases/redis-4.0.2.tar.gz</span><br></pre></td></tr></table></figure><p>解压</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar xzf redis-4.0.2.tar.gz</span><br></pre></td></tr></table></figure><p>下载gcc依赖环境</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc</span><br></pre></td></tr></table></figure><p>执行下面的命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make MOLLOC=libc</span><br><span class="line"></span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p>之后再<code>/usr/local/bin</code>目录下就多了Redis的可执行文件</p><p><img src="https://pic3.zhimg.com/v2-8dda927023de977c96fdf8b25f4b581e_r.jpg" alt=""></p><p>执行命令👇</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-sever &amp;</span><br></pre></td></tr></table></figure><p>这样它就可以在后台运行了。</p><p>执行<code>ps aux grep|&quot;redis&quot;</code>查看到redis的进程正在执行。</p><p>如果要关闭Redis，就杀了它的进程。</p><p><img src="https://pic1.zhimg.com/v2-dff48949afd760407a8abce57ff851ec_r.jpg" alt=""></p><p><br></p><h2 id="node操作Redis"><a href="#node操作Redis" class="headerlink" title="node操作Redis"></a>node操作Redis</h2><p>需要<code>npm install redis --save</code>安装redis模块。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> redis = <span class="built_in">require</span>(<span class="string">'redis'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> port = <span class="number">6379</span>;</span><br><span class="line"><span class="keyword">var</span> host = <span class="string">"127.0.0.1"</span>;</span><br><span class="line"><span class="keyword">var</span> password = <span class="string">"123456"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> client = redis.createClient(port, host);</span><br><span class="line">client.auth(password, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"OK，redis连接成功"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getKey</span>(<span class="params">key, callback</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    client.on(<span class="string">"connect"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        client.get(key, callback);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setKey</span>(<span class="params">key, value, callback</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    client.on(<span class="string">'connect'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        client.set(key, value, callback);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">error, reply</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (error == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(reply);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">setKey(<span class="string">'iii'</span>, <span class="string">'III'</span>, callback);</span><br><span class="line">getKey(<span class="string">'iii'</span>, callback);</span><br></pre></td></tr></table></figure><p><br></p><p>之前说过redis除了key-value的数据结构，还可以存哈希结构的数据。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sethash</span>(<span class="params">hash, key, value, callback</span>) </span>&#123;</span><br><span class="line">    client.on(<span class="string">'connect'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        client.hset(hash, key, value, callback)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gethash</span>(<span class="params">hash, key, callback</span>) </span>&#123;</span><br><span class="line">    client.on(<span class="string">'connect'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        client.hget(hash, key, callback)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getallhash</span>(<span class="params">hash, callback</span>) </span>&#123;</span><br><span class="line">    client.on(<span class="string">'connect'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        client.hgetall(hash, callback)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hmset</span>(<span class="params">hash, params, callback</span>) </span>&#123;</span><br><span class="line">    client.on(<span class="string">'connect'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        client.hmset(hash, ...params, callback)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">error, reply</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (error == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(reply);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sethash(<span class="string">'map1'</span>, <span class="string">'key1'</span>, <span class="string">'value1'</span>, callback)</span><br><span class="line">sethash(<span class="string">'map1'</span>, <span class="string">'key2'</span>, <span class="string">'value2'</span>, callback)</span><br><span class="line">hmset(<span class="string">'set1'</span>, [<span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">12</span>], callback)</span><br><span class="line">gethash(<span class="string">'map1'</span>, <span class="string">'key1'</span>, callback)</span><br><span class="line">getallhash(<span class="string">'map1'</span>, callback)</span><br><span class="line">getallhash(<span class="string">'set1'</span>, callback)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 后端开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> 后端 </tag>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mongoDB</title>
      <link href="/2019/10/05/mongoDB.html"/>
      <url>/2019/10/05/mongoDB.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="Windows安装"><a href="#Windows安装" class="headerlink" title="Windows安装"></a>Windows安装</h2><p>下载地址：<a href="https://www.mongodb.com/download-center/community" target="_blank" rel="noopener">https://www.mongodb.com/download-center/community</a></p><p>运行mongo.exe</p><p>输入<code>show dbs</code>显示数据库。</p><p><img src="https://pic2.zhimg.com/80/v2-f16be839b9b3f541f4de299d92ae0b75_hd.jpg" alt=""></p><p><br></p><h2 id="CentOS安装"><a href="#CentOS安装" class="headerlink" title="CentOS安装"></a>CentOS安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://fastdl.mongodb.org/linux/mongodb-linux-x86_64-2.4.9.tgz</span><br></pre></td></tr></table></figure><p>执行该命令下载安装报包。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf mongodb-linux-x86_64-2.4.9.tgz</span><br></pre></td></tr></table></figure><p>解压之后移动到/usr/local中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv ./mongodb-linux-x86_64-2.4.9.tgz /usr/local/mongodb</span><br></pre></td></tr></table></figure><p>数据库存放到/home目录下，在/home目录下新建两个文件夹并创建mongodb.log</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir mongodb  /home/mongodb 即为数据库路径</span><br><span class="line">mkdir mongodblog  /home/mongodblog  日志路径</span><br><span class="line">cd /home/mongodblog</span><br><span class="line">touch mongodb.log</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/mongodb/bin</span><br><span class="line">ll</span><br><span class="line">可以看到有一个可执行文件mongod</span><br></pre></td></tr></table></figure><p>回到mongodb的根路径下执行👇</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/mongod --dbpath /home/mongodb/ --logpath /home/mongolog/mongodb.log --fork --port 27017</span><br></pre></td></tr></table></figure><p><code>--fork</code>使得mongodb在后台执行。</p><p>查看是否成功启动：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux |grep &quot;mongo&quot;</span><br></pre></td></tr></table></figure><p><br></p><h2 id="mongodb基本指令"><a href="#mongodb基本指令" class="headerlink" title="mongodb基本指令"></a>mongodb基本指令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">查看数据库：</span><br><span class="line">show dbs</span><br><span class="line"></span><br><span class="line">使用数据库, （use 数据库名）如果这给数据库不存在，则创建之：</span><br><span class="line">use &lt;database&gt;</span><br><span class="line"></span><br><span class="line">查看当前数据库名：</span><br><span class="line">db.getName()</span><br><span class="line"></span><br><span class="line">mongodb没有mysql表的概念，但是有集合collection</span><br><span class="line">查看collection：</span><br><span class="line">show collections</span><br><span class="line"></span><br><span class="line">创建collection：</span><br><span class="line">db.createCollection(&apos;集合名称&apos;)</span><br><span class="line"></span><br><span class="line">集合中增加数据：</span><br><span class="line">db.collection1.save(&#123;name:&apos;tony&apos;,age:18&#125;);</span><br><span class="line"></span><br><span class="line">查询集合中所有数据：</span><br><span class="line">db.collection1.find()</span><br><span class="line"></span><br><span class="line">查询集合中有几条数据：</span><br><span class="line">db.collection1.find().count()</span><br><span class="line"></span><br><span class="line">条件查询:</span><br><span class="line">db.collection1.find(&#123;age:18&#125;)//age为18的数据</span><br><span class="line">db.collection1.find(&#123;age:&#123;$gt:18&#125;&#125;)//age大于18</span><br><span class="line">db.collection1.find(&#123;age:&#123;$lt:18&#125;&#125;)//age小于18</span><br><span class="line">db.collection1.find(&#123;age:&#123;$gte:18&#125;&#125;)//age大于等于18</span><br><span class="line">db.collection1.find(&#123;age:&#123;$lte:18&#125;&#125;)//age小于等于18</span><br><span class="line"></span><br><span class="line">名字去重</span><br><span class="line">db.collection1.distinct(&quot;name&quot;)</span><br><span class="line"> </span><br><span class="line">多重条件查询</span><br><span class="line">and：</span><br><span class="line">db.collection1.find(&#123;$and:[&#123;age:18&#125;,&#123;name:&apos;tony&apos;&#125;]&#125;)  //要特别注意这种写法</span><br><span class="line">or:   </span><br><span class="line">db.collection1.find(&#123;$or:[&#123;age:18&#125;,&#123;name:&apos;tony&apos;&#125;]&#125;)</span><br><span class="line"></span><br><span class="line">查询age大于12小于19：</span><br><span class="line">db.collection1.find(&#123;age:&#123;$gt:12, $lt:19&#125;&#125;)</span><br><span class="line"></span><br><span class="line">查询前两条数据：</span><br><span class="line">db.collection1.find().limit(2)</span><br><span class="line"></span><br><span class="line">跳过前两条然后只查看两条：</span><br><span class="line">db.collection1.find().skip(2).limit(2)</span><br><span class="line"></span><br><span class="line">删除age为12的数据：</span><br><span class="line">db.collection1.remove(&#123;age:12&#125;)</span><br><span class="line"></span><br><span class="line">修改：</span><br><span class="line">db.collection1.update(&#123;name:&apos;tony&apos;&#125;,&#123;$set:&#123;age:80&#125;&#125;, false ,true)</span><br></pre></td></tr></table></figure><p>更多操作Google一下。</p><p><br></p><h2 id="node操作mongodb"><a href="#node操作mongodb" class="headerlink" title="node操作mongodb"></a>node操作mongodb</h2><p>先安装mongodb依赖</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mongodb --save</span><br></pre></td></tr></table></figure><p>先保证开启了mongodb，最基本的连接👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongo = <span class="built_in">require</span>(<span class="string">'mongodb'</span>).MongoClient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">"mongodb://127.0.0.1:27017/test"</span>;  <span class="comment">//本地ip地址、端口号和数据库名称</span></span><br><span class="line"></span><br><span class="line">mongo.connect(url, <span class="function"><span class="keyword">function</span> (<span class="params">error, db</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (error == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(db);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error);</span><br><span class="line">    &#125;</span><br><span class="line">    db.close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><br></p><p>进行【增删改查】代码操作👇</p><p>未完待续。。。。</p>]]></content>
      
      
      <categories>
          
          <category> 后端开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> mongoDB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>聊天机器人</title>
      <link href="/2019/10/05/%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA.html"/>
      <url>/2019/10/05/%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>这个Demo用node.js实现代理服务器，核心的api是<a href="http://www.turingapi.com/" target="_blank" rel="noopener">图灵机器人</a>，浏览器使用这个api存在跨域问题，所以用<strong>node.js代理服务器解决跨域问题</strong>。</p><p><br></p><h2 id="关于后端解决跨域"><a href="#关于后端解决跨域" class="headerlink" title="关于后端解决跨域"></a>关于后端解决跨域</h2><p><img src="https://pic3.zhimg.com/v2-1c347617d163242e7def6c157e82fc76_r.jpg" alt=""></p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p><a href="https://github.com/Dunteng/node.js/tree/v1/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA" target="_blank" rel="noopener">https://github.com/Dunteng/node.js/tree/v1/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA</a></p><h2 id="未完待续。。。"><a href="#未完待续。。。" class="headerlink" title="未完待续。。。"></a>未完待续。。。</h2>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 项目 </tag>
            
            <tag> node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用express搭建静态文件服务器</title>
      <link href="/2019/10/02/express%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8.html"/>
      <url>/2019/10/02/express%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="搭建静态文件服务器"><a href="#搭建静态文件服务器" class="headerlink" title="搭建静态文件服务器"></a>搭建静态文件服务器</h2><p>之前用过原生的node.js来写服务器👉（<a href="https://dunteng.github.io/[object%20Object]2019/09/30/net%E6%A8%A1%E5%9D%97%E5%86%99%E5%BE%AE%E5%9E%8Bnode%E6%9C%8D%E5%8A%A1%E5%99%A8.html">net服务器</a>，<a href="https://dunteng.github.io/[object%20Object]2019/10/01/%E4%BD%BF%E7%94%A8http%E6%A8%A1%E5%9D%97%E9%87%8D%E6%9E%84%E5%BE%AE%E5%9E%8B%E6%9C%8D%E5%8A%A1%E5%99%A8.html">http服务器</a>）</p><p>今天用express，比起<strong>原生node.js</strong>来太简单了！</p><p>先<code>npm init</code>初始化项目文件夹，运行<code>npm install express --save</code>安装express.</p><p>index.js服务器启动文件👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> express();<span class="comment">//创建express实例</span></span><br><span class="line"></span><br><span class="line">app.use(express.static(<span class="string">"page"</span>));</span><br><span class="line">app.listen(<span class="number">12306</span>);</span><br></pre></td></tr></table></figure><p>项目架构如下👇</p><p><img src="https://pic2.zhimg.com/v2-30bad54d291afaa93d00b03e257fb535_r.jpg" alt=""></p><p>运行<code>node index.js</code>，然后在浏览器中访问<a href="http://127.0.0.1:12306/index.html" target="_blank" rel="noopener">http://127.0.0.1:12306/index.html</a>和<a href="http://127.0.0.1:12306/test.html" target="_blank" rel="noopener">http://127.0.0.1:12306/test.html</a>就直接显示出相应的页面了。<strong>太他妈方便了！</strong></p><p><br></p><p>写一下配置文件和对应的处理文件稍微规范化一点👇</p><p><img src="https://pic3.zhimg.com/v2-6380ca214c7bf0c61be476f8cc1fbf0a_r.jpg" alt=""></p><p>📌<strong>config.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> globalConfig = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> conf = fs.readFileSync(<span class="string">'./server.conf'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> configArr = conf.toString().split(<span class="string">"\r\n"</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; configArr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> itemArr = configArr[i].replace(<span class="regexp">/\s+/g</span>, <span class="string">""</span>).split(<span class="string">'='</span>);</span><br><span class="line">    globalConfig[itemArr[<span class="number">0</span>]] = itemArr[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(globalConfig);</span><br><span class="line"><span class="built_in">module</span>.exports = globalConfig;</span><br></pre></td></tr></table></figure><p><br><br></p>]]></content>
      
      
      <categories>
          
          <category> node.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 后端 </tag>
            
            <tag> node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用http模块重构微型服务器</title>
      <link href="/2019/10/01/%E4%BD%BF%E7%94%A8http%E6%A8%A1%E5%9D%97%E9%87%8D%E6%9E%84%E5%BE%AE%E5%9E%8B%E6%9C%8D%E5%8A%A1%E5%99%A8.html"/>
      <url>/2019/10/01/%E4%BD%BF%E7%94%A8http%E6%A8%A1%E5%9D%97%E9%87%8D%E6%9E%84%E5%BE%AE%E5%9E%8B%E6%9C%8D%E5%8A%A1%E5%99%A8.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>之前写过一个用net模块构建的微型服务器，👉<a href="https://dunteng.github.io/[object%20Object]2019/09/30/%E5%86%99%E4%B8%80%E4%B8%AA%E5%BE%AE%E5%9E%8Bnode%E6%9C%8D%E5%8A%A1%E5%99%A8.html">链接</a></p><p>现在用http模块来重构一下。👉<a href="https://github.com/Dunteng/node.js/tree/master/http%E9%87%8D%E6%9E%84%E5%BE%AE%E5%9E%8B%E6%9C%8D%E5%8A%A1%E5%99%A8" target="_blank" rel="noopener">GitHub仓库</a></p><h2 id="http模块的初步使用"><a href="#http模块的初步使用" class="headerlink" title="http模块的初步使用"></a>http模块的初步使用</h2><p><strong>配置文件server.conf，用以配置服务器信息</strong>👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">port=<span class="number">12306</span></span><br><span class="line">page_path=page</span><br><span class="line">static_file_type=.html|.js|.css|.jpg|.png|.gif|.ico|.json</span><br></pre></td></tr></table></figure><p>其中的静态资源信息用以后面判断请求是静态资源还是动态资源。</p><p>静态资源主要就是一些写好固定的文件，比如写好的html文件、图片、css、js等，</p><p>动态资源就涉及到了可能会与业务逻辑处理有关，需要ajax处理或者涉及数据库，动态生成的数据。</p><p>这里我们暂且简化概念，把后缀名为<code>.html|.js|.css|.jpg|.png|.gif|.ico|.json</code>的路径请求视为静态数据，其余的视为动态。具体由不同的操作，下文会处理。</p><p><br></p><p><strong>配置文件处理config.js，用以处理配置文件信息</strong>👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> conf = fs.readFileSync(<span class="string">'./server.conf'</span>);</span><br><span class="line"><span class="comment">// console.log(typeof conf);//这哥们是个对象</span></span><br><span class="line"><span class="keyword">var</span> confArr = conf.toString().split(<span class="string">'\n'</span>);<span class="comment">//将conf字符串化后根据换行符分割成数组</span></span><br><span class="line"><span class="comment">// console.log(confArr);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> globalConfig = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> confArr) &#123;</span><br><span class="line">    <span class="keyword">var</span> itemArr = confArr[i].replace(<span class="regexp">/\s+/g</span>, <span class="string">""</span>).split(<span class="string">'='</span>);<span class="comment">//去掉所有空格并用'='拆分</span></span><br><span class="line">    <span class="comment">// console.log(itemArr);</span></span><br><span class="line">    globalConfig[itemArr[<span class="number">0</span>]] = itemArr[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (globalConfig.static_file_type) &#123;</span><br><span class="line">    globalConfig.static_file_type = globalConfig.static_file_type.split(<span class="string">"|"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"配置文件异常，缺少:static_file_type"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// console.log(globalConfig);</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = globalConfig;</span><br></pre></td></tr></table></figure><p>处理完配置文件后导出，长这个样子👇</p><p><img src="https://pic4.zhimg.com/v2-87d153cd7dc81bf29e2c1ccc5145f72b_r.jpg" alt=""></p><p><br></p><p><strong>duntengServer.js 服务器端文件</strong>👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> globalConfig = <span class="built_in">require</span>(<span class="string">'./config'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'新的连接已建立'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(request.url);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> urlObj = url.parse(request.url);</span><br><span class="line">    <span class="keyword">var</span> pathName = url.parse(request.url).pathname;</span><br><span class="line">    <span class="keyword">var</span> params = url.parse(request.url).query;</span><br><span class="line">    <span class="keyword">var</span> paramsObj = url.parse(request.url, <span class="literal">true</span>).query;</span><br><span class="line">    <span class="built_in">console</span>.log(urlObj);</span><br><span class="line">    <span class="built_in">console</span>.log(pathName);</span><br><span class="line">    <span class="built_in">console</span>.log(params);</span><br><span class="line">    <span class="built_in">console</span>.log(paramsObj);</span><br><span class="line">&#125;).listen(globalConfig.port);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(globalConfig);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是静态数据请求还是动态数据请求</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isStaticsRequest</span>(<span class="params">pathName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; globalConfig.static_file_type.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> temp = globalConfig.static_file_type[i];</span><br><span class="line">        <span class="keyword">if</span> (pathName.indexOf(temp) == pathName.length - temp.length) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来尝试启动它，浏览器访问<a href="http://127.0.0.1:12306/index.html?a=1&amp;b=3" target="_blank" rel="noopener">http://127.0.0.1:12306/index.html?a=1&amp;b=3</a></p><p>终端输出如下👇</p><p><img src="https://pic1.zhimg.com/v2-bccefe3e22d1c4410b99c644ccf30b68_r.jpg" alt=""></p><p><br></p><h2 id="处理静态数据请求"><a href="#处理静态数据请求" class="headerlink" title="处理静态数据请求"></a>处理静态数据请求</h2><p>从上一步可以得到浏览器的请求头信息，最主要的就是我们服务端知道了浏览器想要得到<code>index.html</code>的内容，并可以判断出是静态数据请求还是动态数据请求：</p><p><br></p><p>写个html文件<code>/page/login.html</code>👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">    &lt;script&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>script&gt;</span><br><span class="line">&lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp">&lt;body&gt;</span></span><br><span class="line"><span class="regexp">    &lt;h1&gt;hello man！&lt;/</span>h1&gt;</span><br><span class="line">    &lt;img src=<span class="string">"./cheng.png"</span> alt=<span class="string">""</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure><p><br></p><p><strong>duntengServer.js</strong>👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> globalConfig = <span class="built_in">require</span>(<span class="string">'./config'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'新的连接已建立'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(request.url);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> urlObj = url.parse(request.url);</span><br><span class="line">    <span class="keyword">var</span> pathName = url.parse(request.url).pathname;</span><br><span class="line">    <span class="keyword">var</span> params = url.parse(request.url).query;</span><br><span class="line">    <span class="keyword">var</span> paramsObj = url.parse(request.url, <span class="literal">true</span>).query;</span><br><span class="line">    <span class="built_in">console</span>.log(urlObj);</span><br><span class="line">    <span class="built_in">console</span>.log(pathName);</span><br><span class="line">    <span class="built_in">console</span>.log(params);</span><br><span class="line">    <span class="built_in">console</span>.log(paramsObj);</span><br><span class="line">    <span class="built_in">console</span>.log(isStaticsRequest(pathName));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isStaticsRequest(pathName)) &#123;</span><br><span class="line">        <span class="comment">// 处理静态数据请求</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> dataFile = fs.readFileSync(globalConfig.page_path + pathName);</span><br><span class="line">            response.writeHead(<span class="number">200</span>);</span><br><span class="line">            response.write(dataFile)</span><br><span class="line">            response.end();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            response.writeHead(<span class="number">404</span>);</span><br><span class="line">            response.write(<span class="string">"&lt;html&gt;&lt;body&gt;&lt;h1&gt;404 NotFound&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"</span>);</span><br><span class="line">            response.end();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 处理动态数据请求</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'动态请求'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;).listen(globalConfig.port);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是静态数据请求还是动态数据请求</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isStaticsRequest</span>(<span class="params">pathName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; globalConfig.static_file_type.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> temp = globalConfig.static_file_type[i];</span><br><span class="line">        <span class="keyword">if</span> (pathName.indexOf(temp) == pathName.length - temp.length) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动duntengServer.js，浏览器访问&lt;<a href="http://127.0.0.1:12306/login.html" target="_blank" rel="noopener">http://127.0.0.1:12306/login.html</a></p><p>浏览器如下👇</p><p><img src="https://pic1.zhimg.com/v2-e26b850a27f3c42c88b6b5f91dd87c40_r.jpg" alt=""></p><p>在服务器终端打印出以下信息👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"> node duntengServer.js</span><br><span class="line">新的连接已建立</span><br><span class="line">/login.html</span><br><span class="line">Url &#123;</span><br><span class="line">  protocol: <span class="literal">null</span>,</span><br><span class="line">  slashes: <span class="literal">null</span>,</span><br><span class="line">  auth: <span class="literal">null</span>,</span><br><span class="line">  host: <span class="literal">null</span>,</span><br><span class="line">  port: <span class="literal">null</span>,</span><br><span class="line">  hostname: <span class="literal">null</span>,</span><br><span class="line">  hash: <span class="literal">null</span>,</span><br><span class="line">  search: <span class="literal">null</span>,</span><br><span class="line">  query: <span class="literal">null</span>,</span><br><span class="line">  pathname: <span class="string">'/login.html'</span>,</span><br><span class="line">  path: <span class="string">'/login.html'</span>,</span><br><span class="line">  href: <span class="string">'/login.html'</span> &#125;</span><br><span class="line">/login.html</span><br><span class="line"><span class="literal">null</span></span><br><span class="line">[<span class="built_in">Object</span>: <span class="literal">null</span> prototype] &#123;&#125;</span><br><span class="line"><span class="literal">true</span></span><br><span class="line">静态请求</span><br><span class="line">/login.html</span><br><span class="line">新的连接已建立</span><br><span class="line">/cheng.png</span><br><span class="line">Url &#123;</span><br><span class="line">  protocol: <span class="literal">null</span>,</span><br><span class="line">  slashes: <span class="literal">null</span>,</span><br><span class="line">  auth: <span class="literal">null</span>,</span><br><span class="line">  host: <span class="literal">null</span>,</span><br><span class="line">  port: <span class="literal">null</span>,</span><br><span class="line">  hostname: <span class="literal">null</span>,</span><br><span class="line">  hash: <span class="literal">null</span>,</span><br><span class="line">  search: <span class="literal">null</span>,</span><br><span class="line">  query: <span class="literal">null</span>,</span><br><span class="line">  pathname: <span class="string">'/cheng.png'</span>,</span><br><span class="line">  path: <span class="string">'/cheng.png'</span>,</span><br><span class="line">  href: <span class="string">'/cheng.png'</span> &#125;</span><br><span class="line">/cheng.png</span><br><span class="line"><span class="literal">null</span></span><br><span class="line">[<span class="built_in">Object</span>: <span class="literal">null</span> prototype] &#123;&#125;</span><br><span class="line"><span class="literal">true</span></span><br><span class="line">静态请求</span><br><span class="line">/cheng.png</span><br></pre></td></tr></table></figure><p>可见，每请求一次静态数据就会创建对应的http链接，这里一共建立了两个http请求链接，分别是对<code>login.html</code>和<code>cheng.png</code>的</p><p><br></p><h2 id="处理动态数据请求"><a href="#处理动态数据请求" class="headerlink" title="处理动态数据请求"></a>处理动态数据请求</h2><p>到这一步为止，就完成了对客户端请求静态数据的响应处理，接下来搞一下动态的数据请求处理。</p><p>这里以一个ajax请求为例子。</p><p><strong>page/login.js</strong>👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    xmlHttp = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    xmlHttp.open(<span class="string">"GET"</span>, <span class="string">"/getData"</span>, <span class="literal">true</span>);</span><br><span class="line">    xmlHttp.send(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    xmlHttp.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (xmlHttp.readyState == <span class="number">4</span> &amp;&amp; xmlHttp.status == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(xmlHttp.responseText);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">typeof</span> xmlHttp.responseText);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样<code>login.js</code>就触发了对<a href="http://127.0.0.1:12306/getData" target="_blank" rel="noopener">http://127.0.0.1:12306/getData</a>的请求，这个路径都不符合<code>server.conf</code>中对静态数据的限定，所以视为动态请求。</p><p>在<code>login.html</code>中引入<code>login.js</code>👇</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./login.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello man！<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./cheng.png"</span> <span class="attr">alt</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><p><code>duntengServer.js</code>中处理动态数据请求，将其路径名称打印出来👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> globalConfig = <span class="built_in">require</span>(<span class="string">'./config'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'新的连接已建立'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(request.url);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> urlObj = url.parse(request.url);</span><br><span class="line">    <span class="keyword">var</span> pathName = url.parse(request.url).pathname;</span><br><span class="line">    <span class="keyword">var</span> params = url.parse(request.url).query;</span><br><span class="line">    <span class="keyword">var</span> paramsObj = url.parse(request.url, <span class="literal">true</span>).query;</span><br><span class="line">    <span class="built_in">console</span>.log(urlObj);</span><br><span class="line">    <span class="built_in">console</span>.log(pathName);</span><br><span class="line">    <span class="built_in">console</span>.log(params);</span><br><span class="line">    <span class="built_in">console</span>.log(paramsObj);</span><br><span class="line">    <span class="built_in">console</span>.log(isStaticsRequest(pathName));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isStaticsRequest(pathName)) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"静态请求"</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(pathName);</span><br><span class="line">        <span class="comment">// 处理静态数据请求</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> dataFile = fs.readFileSync(globalConfig.page_path + pathName);</span><br><span class="line">            response.writeHead(<span class="number">200</span>);</span><br><span class="line">            response.write(dataFile)</span><br><span class="line">            response.end();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            response.writeHead(<span class="number">404</span>);</span><br><span class="line">            response.write(<span class="string">"&lt;html&gt;&lt;body&gt;&lt;h1&gt;404 NotFound&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"</span>);</span><br><span class="line">            response.end();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 处理动态数据请求</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'动态请求'</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(pathName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;).listen(globalConfig.port);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是静态数据请求还是动态数据请求</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isStaticsRequest</span>(<span class="params">pathName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; globalConfig.static_file_type.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> temp = globalConfig.static_file_type[i];</span><br><span class="line">        <span class="keyword">if</span> (pathName.indexOf(temp) == pathName.length - temp.length) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动之，浏览器访问<a href="http://127.0.0.1:12306/login.html" target="_blank" rel="noopener">http://127.0.0.1:12306/login.html</a>，可以看到👇</p><p><img src="https://pic3.zhimg.com/v2-aaec8ec3106268c5e11d8e16f8c1a4aa_r.jpg" alt=""></p><p><img src="https://pic2.zhimg.com/v2-a123410cd6c292df40378871820c474d_r.jpg" alt=""></p><p>可以看到对动态请求的监测和处理是成功了。</p><h2 id="从duntengServer-js中抽离出业务处理代码"><a href="#从duntengServer-js中抽离出业务处理代码" class="headerlink" title="从duntengServer.js中抽离出业务处理代码"></a>从duntengServer.js中抽离出业务处理代码</h2><p>上文中客户端发起了数据请求，比如<code>login.html--&gt;login.js--&gt;ajax</code>我们直接在<code>duntengServer.js</code>中处理了针对它的业务处理（打印出了/getData的路径），<strong>但是</strong>这是不合适的，对于这种业务处理的代码应该交由<code>/web/loginController.js</code>来处理。所以应该在<code>/web/loginController.js</code>中写针对<code>login这一功能</code>的业务处理代码，然后在<code>duntengServer.js</code>中require这个<code>/web/loginController.js</code>。如下👇</p><p>📌<strong>/web/loginController.js</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"666~"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    <span class="comment">// 或者是存储数据等其他什么操作，这里只以打印操作为例</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = getData;</span><br></pre></td></tr></table></figure><p>📌<strong>duntengServer.js</strong>：</p><p><img src="https://pic1.zhimg.com/v2-e2604cb1b573b9f6bbbb5baa6a011f7c_r.jpg" alt=""></p><p><img src="https://pic4.zhimg.com/v2-aec6bf41f5d6f24a4aa56b4734056c5f_r.jpg" alt=""></p><p><br></p><p>但是如果一个项目里面除了login，还有其他很多的业务操作，像上面这样子一个一个地往<code>duntengServer.js</code>里手动引入会很繁琐，所以要想办法自动引入👇</p><p><br></p><h2 id="进一步优化实现自动识别路径和处理方法的映射"><a href="#进一步优化实现自动识别路径和处理方法的映射" class="headerlink" title="进一步优化实现自动识别路径和处理方法的映射"></a>进一步优化实现自动识别路径和处理方法的映射</h2><p>项目分层架构</p><p><img src="https://pic3.zhimg.com/80/v2-c12a1ed050c3cb1a76ee6a9d67ff4a3a_hd.jpg" alt=""></p><p>📌创建一个<code>/loader.js</code>，它负责将<code>/web</code>下所有业务处理 js 文件中的路径与方法函数之间的映射存进一个Map中👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> globalConfig = <span class="built_in">require</span>(<span class="string">"./config"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pathMap = <span class="keyword">new</span> <span class="built_in">Map</span>();<span class="comment">//用于管理全局的路径请求和对应方法(操作)的映射</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> files = fs.readdirSync(globalConfig[<span class="string">'web_path'</span>]); <span class="comment">//读取出了web路径下的所有文件名</span></span><br><span class="line"><span class="comment">// console.log(files);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; files.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> temp = <span class="built_in">require</span>(<span class="string">'./'</span> + globalConfig[<span class="string">'web_path'</span>] + <span class="string">'/'</span> + files[i]);</span><br><span class="line">    <span class="keyword">if</span> (temp.path) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> [key, value] <span class="keyword">of</span> temp.path) &#123;</span><br><span class="line">            <span class="comment">// console.log("key为 " + key);</span></span><br><span class="line">            <span class="comment">// console.log("value为 " + value);</span></span><br><span class="line">            <span class="keyword">if</span> (pathMap.get(key) == <span class="literal">null</span>) &#123;</span><br><span class="line">                pathMap.set(key, value);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"重复设置了pathMap，key为"</span> + key + <span class="string">"的路径和方法的映射已存在，请检查你的代码是否针对"</span> + key + <span class="string">"路径设置了多个处理方法"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// console.log(pathMap);</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = pathMap;</span><br></pre></td></tr></table></figure><p>📌<strong>web/loginController.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    response.writeHead(<span class="number">200</span>);</span><br><span class="line">    response.write(<span class="string">"hey kong, can u hear me?"</span>);</span><br><span class="line">    response.end();</span><br><span class="line">&#125;</span><br><span class="line">path.set(<span class="string">"/getData"</span>, getData);</span><br><span class="line"><span class="built_in">module</span>.exports.path = path;</span><br></pre></td></tr></table></figure><p>📌<strong>web/test.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> path = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testA</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    response.writeHead(<span class="number">200</span>);</span><br><span class="line">    response.write(<span class="string">"This is testA"</span>);</span><br><span class="line">    response.end();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testB</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    response.writeHead(<span class="number">200</span>);</span><br><span class="line">    response.write(<span class="string">"This is testB"</span>);</span><br><span class="line">    response.end();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">path.set(<span class="string">"/testA"</span>, testA);</span><br><span class="line">path.set(<span class="string">"/testB"</span>, testB);</span><br><span class="line"><span class="built_in">module</span>.exports.path = path;</span><br></pre></td></tr></table></figure><p>📌<strong>duntengServer.js</strong></p><p><img src="https://pic4.zhimg.com/v2-dce9c3e212881c762a5138e7b071ab5f_r.jpg" alt=""></p><p><img src="https://pic1.zhimg.com/v2-1ac404b18f188fb7a4aeb3278872e8f8_r.jpg" alt=""></p><p>启动服务器duntengServer.js，浏览器访问<a href="http://127.0.0.1:12306/login.html" target="_blank" rel="noopener">http://127.0.0.1:12306/login.html</a>👇</p><p><img src="https://pic3.zhimg.com/v2-0271a7f2b65255a6271bd897ccc6e056_r.jpg" alt=""></p><p><img src="https://pic4.zhimg.com/v2-a9cc15570463bcd4f0990170e0e7dd2b_r.jpg" alt=""></p><p><img src="https://pic2.zhimg.com/v2-096a3a28f5252ad840ea67cf43d99ae9_r.jpg" alt=""></p><p><br>浏览器访问<a href="http://127.0.0.1:12306/testA" target="_blank" rel="noopener">http://127.0.0.1:12306/testA</a>和&lt;<a href="http://127.0.0.1:12306/testB" target="_blank" rel="noopener">http://127.0.0.1:12306/testB</a>  👇</p><p><img src="https://pic1.zhimg.com/v2-f2b1bfe8ff194a6a0529face2f7dc03c_r.jpg" alt=""></p><p><img src="https://pic4.zhimg.com/v2-e733e42fed98df821d04c6ecc97ee5a3_r.jpg" alt=""></p><p><br><br></p><h2 id="生成运行日志"><a href="#生成运行日志" class="headerlink" title="生成运行日志"></a>生成运行日志</h2><p>📌 <strong>log.js</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> globalConfig = <span class="built_in">require</span>(<span class="string">"./config"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fileName = globalConfig.log_path + globalConfig.log_name;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> time = <span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString();</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    fs.appendFile(fileName, time + <span class="string">"  "</span> + data + <span class="string">"\n"</span>, &#123; <span class="attr">flag</span>: <span class="string">"a"</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = log;</span><br></pre></td></tr></table></figure><p>在<code>duntengServer.js</code>中引用<code>log.js</code>，在服务启动的时候调用log函数进行日志的更新写入。</p><p><br><br></p>]]></content>
      
      
      <categories>
          
          <category> node.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 后端 </tag>
            
            <tag> node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL基本的增删改查操作</title>
      <link href="/2019/10/01/MySQL%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E6%93%8D%E4%BD%9C.html"/>
      <url>/2019/10/01/MySQL%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E6%93%8D%E4%BD%9C.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p><img src="https://pic1.zhimg.com/v2-8dc902e921dfc2f2d189f2940dbbc3a7_1200x500.jpg" alt=""></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//增</span></span><br><span class="line">insert into student(name, age, stu_num, <span class="class"><span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">value</span> ('卡卡西',28,6600,1)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//改</span></span><br><span class="line">update student set name=<span class="string">'鸣人'</span> where id = <span class="number">1</span>;</span><br><span class="line">update student set name = <span class="string">'佐助'</span>, age=<span class="number">18</span>, stu_num=<span class="number">6631</span>, <span class="class"><span class="keyword">class</span></span>=<span class="number">1</span> where id = <span class="number">2</span>;</span><br><span class="line">update student</span><br><span class="line">set  id = <span class="number">3</span>, age=<span class="number">18</span>, stu_num=<span class="number">6632</span>, <span class="class"><span class="keyword">class</span></span>=<span class="number">1</span></span><br><span class="line">where name=<span class="string">'小樱'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查</span></span><br><span class="line">select * <span class="keyword">from</span> student;  <span class="comment">/*查询表中所有人*/</span></span><br><span class="line"></span><br><span class="line">select  name,age <span class="keyword">from</span> student;  <span class="comment">/*查询表中所有人的名字和年龄*/</span></span><br><span class="line"></span><br><span class="line">select * <span class="keyword">from</span> student where age = <span class="number">18</span>; <span class="comment">/*查询年龄为18的所有人*/</span></span><br><span class="line"></span><br><span class="line">select count(<span class="number">1</span>) <span class="keyword">from</span> student; <span class="comment">/*查询表中所有记录条数（在这里就是表中所有人总数）*/</span></span><br><span class="line"></span><br><span class="line">select count(<span class="number">1</span>) <span class="keyword">from</span> student where age=<span class="number">18</span>; <span class="comment">/*查询表中年龄为18的人数*/</span></span><br><span class="line"></span><br><span class="line">select sum(age) <span class="keyword">from</span> student; <span class="comment">/* 所有人的年龄加起来的总数*/</span></span><br><span class="line"></span><br><span class="line">select avg(age) <span class="keyword">from</span> student;<span class="comment">/*求所有人的平均年龄*/</span></span><br><span class="line"></span><br><span class="line">select  avg(age) <span class="keyword">as</span> avg_age <span class="keyword">from</span> student; <span class="comment">/*给平均数设置别名*/</span></span><br><span class="line"></span><br><span class="line">select <span class="class"><span class="keyword">class</span>, <span class="title">count</span>(1) <span class="title">from</span> <span class="title">student</span> <span class="title">group</span> <span class="title">by</span> <span class="title">class</span></span>; <span class="comment">/*查询每班各有多少人，使用了group by进行分组*/</span></span><br><span class="line"></span><br><span class="line">select name, <span class="class"><span class="keyword">class</span> <span class="title">from</span> <span class="title">student</span> <span class="title">where</span> <span class="title">age</span>!</span>=<span class="number">18</span> and <span class="class"><span class="keyword">class</span></span>=<span class="number">3</span>; <span class="comment">/* 多个条件使用and */</span></span><br><span class="line">select name, <span class="class"><span class="keyword">class</span> <span class="title">from</span> <span class="title">student</span> <span class="title">where</span> <span class="title">age</span></span>=<span class="number">18</span> or stu_num&gt;<span class="number">6640</span>; <span class="comment">/* 或操作使用or */</span></span><br><span class="line"></span><br><span class="line">select * <span class="keyword">from</span> student limit <span class="number">2</span>; <span class="comment">/* 只取前两条记录*/</span></span><br><span class="line"></span><br><span class="line">select * <span class="keyword">from</span> student limit <span class="number">5</span>,<span class="number">3</span>; <span class="comment">/* 前5条记录不看，从第6条记录看起，取出3条记录*/</span></span><br><span class="line"></span><br><span class="line">select * <span class="keyword">from</span> student order by id; <span class="comment">/* 以id进行正序排列 */</span></span><br><span class="line">select * <span class="keyword">from</span> student order by id desc ; <span class="comment">/* 倒序排列 */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//删</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> student;  <span class="comment">/*删除整个表。危险！！！*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> student where name=<span class="string">'卡卡西'</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 后端开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>写一个微型node服务器</title>
      <link href="/2019/09/30/net%E6%A8%A1%E5%9D%97%E5%86%99%E5%BE%AE%E5%9E%8Bnode%E6%9C%8D%E5%8A%A1%E5%99%A8.html"/>
      <url>/2019/09/30/net%E6%A8%A1%E5%9D%97%E5%86%99%E5%BE%AE%E5%9E%8Bnode%E6%9C%8D%E5%8A%A1%E5%99%A8.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p><a href="https://github.com/Dunteng/node.js/tree/master/net%E5%BE%AE%E5%9E%8B%E6%9C%8D%E5%8A%A1%E5%99%A8" target="_blank" rel="noopener">https://github.com/Dunteng/node.js/tree/master/net%E5%BE%AE%E5%9E%8B%E6%9C%8D%E5%8A%A1%E5%99%A8</a></p><p><br><br></p><h2 id="基础demo"><a href="#基础demo" class="headerlink" title="基础demo"></a>基础demo</h2><p>我们可以使用浏览器来对Server建立连接并发送请求。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//server.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">"net"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = net.createServer();</span><br><span class="line">server.listen(<span class="number">12306</span>, <span class="string">"127.0.0.1"</span>);</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">"listening"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"服务已启动"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">"connection"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">socket</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"有新的连接"</span>);</span><br><span class="line">    socket.on(<span class="string">"data"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data.toString());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><br>开启server服务，然后在浏览器访问<code>127.0.0.0:12306</code>，可以看到打印出了data，而这个data就是请求头👇</p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1571650335272.png" alt="1571650335272"></p><p><br></p><p>模拟获取请求头数据和设置响应头👇</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">"net"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = net.createServer();</span><br><span class="line">server.listen(<span class="number">12306</span>, <span class="string">"127.0.0.1"</span>);</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">"listening"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"服务已启动"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">"connection"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">socket</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"有新的连接"</span>);</span><br><span class="line">    socket.on(<span class="string">"data"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data.toString());</span><br><span class="line">        <span class="keyword">var</span> request = data.toString().split(<span class="string">"\r\n"</span>);</span><br><span class="line">        <span class="keyword">var</span> url = request[<span class="number">0</span>].split(<span class="string">" "</span>)[<span class="number">1</span>];</span><br><span class="line">        <span class="built_in">console</span>.log(url);</span><br><span class="line">        socket.write(<span class="string">"HTTP 200OK\r\nContent-type:text/html\r\nServer:DWS/1.1\r\n\r\n&lt;html&gt;&lt;body&gt;hello browser&lt;/body&gt;&lt;/html&gt;"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><br></p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1571651223434.png" alt="1571651223434"></p><p><br></p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1571651233360.png" alt="1571651233360"></p><p><br></p><p>💡到了这一步，我们可以进一步实现平时看到的网站响应的效果：</p><p>​    新建一个<code>index.html</code>文件，我们通过浏览器访问<a href="http://127.0.0.1:12306/index" target="_blank" rel="noopener">http://127.0.0.1:12306/index</a>，然后服务端解析请求头截取到<code>index</code>字段，通过这个字段知道服务端要响应出<code>index.html</code>的数据。怎么获取到目标文件的内容，这就涉及到了读写文件的操作了。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">"net"</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = net.createServer();</span><br><span class="line">server.listen(<span class="number">12306</span>, <span class="string">"127.0.0.1"</span>);</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'listening'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'服务启动了'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">socket</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'有新的连接建立了'</span>);</span><br><span class="line"></span><br><span class="line">    socket.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data.toString());</span><br><span class="line">        <span class="keyword">var</span> request = data.toString().split(<span class="string">'\r\n'</span>);</span><br><span class="line">        <span class="keyword">var</span> url = request[<span class="number">0</span>].split(<span class="string">" "</span>)[<span class="number">1</span>];</span><br><span class="line">        <span class="built_in">console</span>.log(url);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> dataFile = fs.readFileSync(__dirname + url);</span><br><span class="line">            <span class="comment">// console.log(dataFile.toString());</span></span><br><span class="line">            socket.write(<span class="string">"HTTP 200OK\r\nContent-type:text/html\r\nServer:DWS/1.1\r\n\r\n"</span>);</span><br><span class="line">            socket.write(dataFile)  <span class="comment">//socket分成两部写，避免dataFile被字符串化</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            socket.write(<span class="string">"HTTP 404NotFound\r\nContent-type:text/html\r\nServer:DWS/1.1\r\n\r\n&lt;html&gt;&lt;body&gt;&lt;h1&gt;&lt;/h1&gt;404 Not Found&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        socket.end();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br>运行<code>node server.js</code>，在浏览器访问<a href="http://127.0.0.1:12306/index.html就可以显示出`index.html`中的页面，如果访问的页面不存在会显示404页面。" target="_blank" rel="noopener">http://127.0.0.1:12306/index.html就可以显示出`index.html`中的页面，如果访问的页面不存在会显示404页面。</a></p><p><br><br></p><h2 id="微型服务器的编写"><a href="#微型服务器的编写" class="headerlink" title="微型服务器的编写"></a>微型服务器的编写</h2><p>在此基础上进行配置文件的编写，从而构建一个node.js微型服务器👇</p><ul><li>server.conf   配置文件，在里面写入要打开的文件的路径，相对路径和绝对路径都可。</li><li>conf.js   处理配置信息，暴露出一个全局的配置</li><li>newserver.js  服务端代码</li></ul><p>运行<code>node newserver.js</code>服务器，在浏览器打开<a href="http://127.0.0.1:12306/index.html" target="_blank" rel="noopener">http://127.0.0.1:12306/index.html</a>即可成功访问。</p><p>代码实现见文首GitHub链接。</p><p><br><br></p>]]></content>
      
      
      <categories>
          
          <category> node.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 后端 </tag>
            
            <tag> node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>虚拟机安装centos7和node</title>
      <link href="/2019/09/25/%E6%96%B0linux%E5%AD%A6%E4%B9%A0.html"/>
      <url>/2019/09/25/%E6%96%B0linux%E5%AD%A6%E4%B9%A0.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>【外部文章】：</p><ul><li>我的Linux基础整理网站👉<a href="https://rockdunteng.github.io/LinuxStudy/index.html" target="_blank" rel="noopener">rockdunteng</a></li></ul><h2 id="虚拟机安装centos7"><a href="#虚拟机安装centos7" class="headerlink" title="虚拟机安装centos7"></a>虚拟机安装centos7</h2><ul><li><p><a href="https://www.cnblogs.com/lynn-li/p/6077944.html" target="_blank" rel="noopener">参考文章</a></p></li><li><p>我安装的是迷你版，没有桌面系统，纯命令模式。</p></li><li><p>之后我们会搭建小型的集群</p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1560265774418.png" alt="1560265774418"></p><p><br>现实项目中的全栈过程👇</p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1571589448636.png" alt="1571589448636"></p><p><br>推荐的虚拟机内存配置：</p><ul><li>最好就是16G内存，随便配；但是老子是8G，往下看</li><li>proxy代理服务器：512</li><li>Service服务器： 1024</li><li>Cache缓存服务器： 1024</li><li>Database服务器： 1024</li><li>Release服务器： 1024/512</li></ul></li></ul><p><br><br></p><h2 id="桥接网络设置"><a href="#桥接网络设置" class="headerlink" title="桥接网络设置"></a>桥接网络设置</h2><ul><li><p>设置的是桥接网络，为了是不与宿主机共享同一网络。这时是无法上网的，需要进行下面的配置：</p><ul><li><p>进入路径<code>/etc/sysconfig/network-scripts</code>，修改<code>ifcfg-ens33</code>文件，将末行的<code>ONBOOT=no</code>改为<code>yes</code>。</p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1571577252621.png" alt="1571577252621"></p></li><li><p>重启系统<code>reboot</code>。然后尝试<code>ping</code>功能，发现可以<code>ping</code>通即可。</p></li><li><p>如果还是ping不通，见这两篇文章👉   <a href="https://blog.csdn.net/bob_666/article/details/81412242" target="_blank" rel="noopener">一</a>   <a href="https://jingyan.baidu.com/article/f7ff0bfc7859502e26bb1328.html" target="_blank" rel="noopener">二</a></p></li><li><p>这里我平时用的是校园网，是无法桥接成功的。所以我改用手机热点wifi，并把网卡换成相应的无线网卡。</p></li><li><p>注意，我用热点的时候网速很慢，当要下载东西的时候最好切换回nat模式连接网络。</p></li></ul></li></ul><p><br><br></p><h2 id="安装wget和node"><a href="#安装wget和node" class="headerlink" title="安装wget和node"></a>安装wget和node</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum install wget//用于网络请求</span><br><span class="line"></span><br><span class="line">wget https://nodejs.org/dist/v10.16.0/node-v10.16.0-linux-x64.tar.xz    //安装node压缩包</span><br><span class="line"></span><br><span class="line">xz -d node-v10.16.0-linux-x64.tar.xz      //解压成node-v10.16.0-linux-x64.tar</span><br><span class="line"></span><br><span class="line">tar -xf node-v10.16.0-linux-x64.tar      //解压成node-v10.16.0-linux-x64文件夹</span><br></pre></td></tr></table></figure><p><br>安装成功之后在本路径下查看：</p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1560361705831.png" alt="1560361705831"></p><p><br>通过<code>ll</code>指令可以看到多了node的安装包，之后通过<code>xz -d</code>指令解压得到.tar<br>的压缩包，再通过<code>tar -xf</code>指令解压得到node-v10.16.0-linux-x64的文件夹。</p><p><br><br></p><h2 id="创建node软连接（快捷方式）"><a href="#创建node软连接（快捷方式）" class="headerlink" title="创建node软连接（快捷方式）"></a>创建node软连接（快捷方式）</h2><p>目前node安装在了root的用户目录下，没有放在<code>/usr/bin</code>下，所以需要创建一个软连接到<code>/usr/bin</code>下。</p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1560527054649.png" alt="1560527054649"></p><p><br>定位到/usr/bin路径下，这个文件夹下有很多可执行的程序。上面绿色的就是代表可执行程序，浅蓝色的是链接，连接到指定的程序，有点类似win下的快捷方式。</p><p>我们进入node/bin文件夹里面，可以看到有<code>node</code>，<code>npm</code>，<code>npx</code>等可执行程序，这就是我们之前常用到的node命令。</p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1560527879178.png" alt="1560527879178"></p><p>为了使得node指令在全局范围下都可以使用，我们需要把上述的node可执行程序放到/usr/bin/文件夹中。怎么实现呢？我们做个<strong>软连接</strong>而不是真的把文件放到那里面去。</p><p><br></p><ul><li><p>node</p><p>使用指令<code>ln -s ~/node-v10.16.0-linux-x64/bin/node /usr/bin/node</code>将原本node-xxx/bin/文件夹中的node可执行程序软连接到了/usr/bin/node文件夹中，可以看到在用户根目录路径下就可以使用node指令了</p><p> <img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1560528488411.png" alt="1560528488411"><br></p></li><li><p>npm和npx</p><p>同样地搞一下npm和npx</p><p>通过检查版本可以看到，这时已经可以在全局下使用node、npm、npx了：</p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1571587193826.png" alt="1571587193826"></p></li></ul><p>  <br>这时再到/usr/bin/路径下输入<code>ls</code>指令就能看到我们链接的三个程序，使用<code>shift+PgUp</code> 向前翻看,一般翻13页左右。<code>shift+PgDown</code>向后翻看,一般翻13页左右。</p><p>  <img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1560529922036.png" alt="1560529922036"></p><p>  <br></p><p><br></p><h2 id="FHS-文件系统层次化标准"><a href="#FHS-文件系统层次化标准" class="headerlink" title="FHS(文件系统层次化标准)"></a>FHS(文件系统层次化标准)</h2><p><img src="https://oscimg.oschina.net/oscnet/719336e7cbb111e832a03c95075d32701fa.jpg" alt=""></p><p><br></p><p>/home和/root的区别：实际上，linux与windows的分区都有主分区，扩展分区，逻辑分区，只是他们的目录结构不一样，windows为森林型目录结构，他可以有很多的跟，如C，D，E，F都是他的根目录，而linux中是一个树形机构，他只有一个根目录那就是 / ,然后在他下面有子目录/root  /home  /etc /bin 等，你可以将各个子目录单独挂载到一个分区，而其中的/root 相当于是linux超级权限用户root的家目录，而/home/XXX(用户名)这是普通用户的家目录，当新建一个普通用户时候，那么在/home 目录下就有一个对应的/home/XX 路径，用来存放用户的主目录</p><p><br><br></p><h2 id="使用xshell"><a href="#使用xshell" class="headerlink" title="使用xshell"></a>使用xshell</h2><p>虚拟机的终端不支持复制粘贴，不太方便，所以可以使用xshell远程连接上虚拟机，通过xshell来执行操作。</p><p><br><br></p><h2 id="node服务器初试"><a href="#node服务器初试" class="headerlink" title="node服务器初试"></a>node服务器初试</h2><p>找个目录，我随便在<code>/home/test</code>下新建了一个<code>test.js</code>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-Type"</span>:<span class="string">"text/plain"</span>&#125;);</span><br><span class="line">res.end(<span class="string">"hello world"</span>);</span><br><span class="line">&#125;</span><br><span class="line">http.createServer(hello).listen(<span class="number">12306</span>,<span class="string">"192.168.171.134"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"hello world"</span>);</span><br></pre></td></tr></table></figure><p>【注意】：</p><ul><li>通过<code>ip addr</code>查看IP地址，然后用xshell远程连接之。</li><li>代码中的IP地址即为centos的IP地址，开启端口为12306</li><li>在<code>/home/test</code>下执行<code>node test.js</code>指令就开启了node服务器。</li><li>然后要<strong>关闭centos的防火墙</strong>。<code>systemctl disable firewalld</code>，然后<code>reboot</code>重启之。</li><li>这下子就可以在浏览器中访问到<code>http://192.168.171.134:12306/</code>了，页面显示<code>res.end</code>中的内容。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 后端开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux基础入门</title>
      <link href="/2019/09/01/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html"/>
      <url>/2019/09/01/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html</url>
      
        <content type="html"><![CDATA[<p><br><br><br></p><p>点击此处跳转👉  <a href="https://rockdunteng.github.io/LinuxStudy/index.html" target="_blank" rel="noopener">Linux笔记</a></p><p><br><br><br></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 后端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue基础笔记</title>
      <link href="/2019/08/09/vue%E7%9F%A5%E8%AF%86%E7%82%B9.html"/>
      <url>/2019/08/09/vue%E7%9F%A5%E8%AF%86%E7%82%B9.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p style="color:red">【复习本篇笔记时一边看源码】</p><p><a href="https://github.com/rockdunteng/rockdunteng.github.io/tree/master/note/vue/%E6%B8%A1%E4%B8%80%E6%96%B0Vue%E6%BA%90%E7%A0%81" target="_blank" rel="noopener">https://github.com/rockdunteng/rockdunteng.github.io/tree/master/note/vue/%E6%B8%A1%E4%B8%80%E6%96%B0Vue%E6%BA%90%E7%A0%81</a><br><br><br></p><h1 id="一、Vue前导"><a href="#一、Vue前导" class="headerlink" title="一、Vue前导"></a>一、Vue前导</h1><p>Vue的优点：</p><ol><li>减少dom操作，性能更好</li><li>视图、数据分离</li><li>维护成本低</li></ol><p>点击该<a href="https://rockdunteng.github.io/note/vue/vue%E7%9A%84%E4%BC%98%E7%82%B9.pdf" target="_blank" rel="noopener">pdf</a>查看详情</p><p><br><br><br></p><h1 id="二、数据绑定与视图渲染"><a href="#二、数据绑定与视图渲染" class="headerlink" title="二、数据绑定与视图渲染"></a>二、数据绑定与视图渲染</h1><p>使用“Mustache”语法 (双花括号)插值表达式渲染视图。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564215958637.png" alt="1564215958637"></p><p><br><br></p><h2 id="数据要先存在，才能实现数据绑定"><a href="#数据要先存在，才能实现数据绑定" class="headerlink" title="数据要先存在，才能实现数据绑定"></a><strong>数据要先存在，才能实现数据绑定</strong></h2><p>在下图所示中，可以通过<code>vm.name</code>的方式进行数据的获取和修改，数据修改的同时，视图也随之改变，如本例中的<code>name</code>的值由jimmy变成了tony，视图立即随之改变。但是当<code>vm.obj.xx=12</code>时，虽然<code>vm.obj.xx</code>成功创建了，但是视图没有随之渲染。</p><p>因为在 Vue 中，<strong>数据要先存在，才能实现数据绑定，从而渲染视图</strong></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564212932741.png" alt="1564212932741"></p><p><br><br></p><h2 id="通过索引的方式修改数组，或通过修改数组长度的方式修改数组，都无法重新渲染视图"><a href="#通过索引的方式修改数组，或通过修改数组长度的方式修改数组，都无法重新渲染视图" class="headerlink" title="通过索引的方式修改数组，或通过修改数组长度的方式修改数组，都无法重新渲染视图"></a>通过<strong>索引的方式</strong>修改数组，或通过<strong>修改数组长度的方式</strong>修改数组，都无法重新渲染视图</h2><p> <img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564213382860.png" alt="1564213382860"></p><p><br><br></p><h2 id="数组变异方法"><a href="#数组变异方法" class="headerlink" title="数组变异方法"></a>数组变异方法</h2><p>发现使用数组方法时，就会触发视图重新渲染。</p><p>Vue的数据绑定是通过<strong>数据劫持</strong>来实现的，在数据劫持的时候通过<strong>索引修改数组</strong>或者<strong>通过修改数组长度来修改数组</strong>是无法被感知的，Vue在设计的时候通过<strong>修改数组的一些方法</strong>，在这些方法里面添加了一个<strong>更新视图的方法的执行</strong>，所以当我们调用这些数组的方法的时候可以触发更新视图方法，从而更新视图。这些数组的方法在vue中被称为<strong>数组变异方法</strong>。这些方法已经不是原生的 js 方法了，是被 Vue 改写了，让它能有一个重新渲染视图的功能。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564214165792.png" alt="1564214165792"></p><p><br><br></p><p>Vue 有以下7中变异方法</p><ul><li><code>push()</code>        往数组最后面添加一个元素，成功返回当前数组的长度 </li><li><code>pop()</code>             删除数组的最后一个元素，成功返回删除元素的值 </li><li><code>shift()</code>          删除数组的第一个元素，成功返回删除元素的值 </li><li><code>unshift()</code>      往数组最前面添加一个元素，成功返回当前数组的长度 </li><li><code>splice()</code>        有三个参数，第一个是想要删除的元素的下标（必选），第二个是想要删除的个数（必选），                     第三个是删除后想要在原位置替换的值（可选） </li><li><code>sort()</code>             使数组按照字符编码默认从小到大排序,成功返回排序后的数组 </li><li><code>reverse()</code>           将数组倒序，成功返回倒序后的数组 </li></ul><p><br><br></p><h2 id="set方法"><a href="#set方法" class="headerlink" title="$set方法"></a>$set方法</h2><p>$set方法可以<strong>解决对象中未存在数据的数据绑定问题</strong>。</p><p>可以实现视图的实时更新。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564216195094.png" alt="1564216195094"></p><p><br><br></p><h2 id="el"><a href="#el" class="headerlink" title="$el"></a>$el</h2><p>Vue实例vm中有一个 $el 属性，它能指向挂载 Vue 的Dom结构。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564217181273.png" alt="1564217181273"><br></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564217272687.png" alt="1564217272687"></p><p><br>上图一共修改了 name 三次，修改了 age 两次，最后一行代码是打印 <code>$el.innerText</code>，但是这五次的数据修改是<strong>异步</strong>的，结果就是是先打印了一开始的 <code>$el.innerText</code>:</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564217455589.png" alt="1564217455589"></p><p><br>这样导致我们无法打印获取到数据更改后的<code>$el.innerText</code>，如何解决，看下面的 <code>$nextTick</code></p><p><br><br></p><h2 id="nextTick"><a href="#nextTick" class="headerlink" title="$nextTick"></a>$nextTick</h2><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564217936576.png" alt="1564217936576"></p><p>它会在数据都修改完成并且重新渲染到页面上之后才执行里面的函数。这样就能获取到数据更改后的dom。</p><p><br><br></p><h2 id="mount"><a href="#mount" class="headerlink" title="$mount"></a>$mount</h2><p>创建 Vue 实例的时候可以不写 <code>el: &#39;#app&#39;</code>, 使用 <code>$mount</code>也能实现同样的效果。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564218209720.png" alt="1564218209720"></p><p><br><br></p><h2 id="refs"><a href="#refs" class="headerlink" title="$refs"></a>$refs</h2><p>在元素标签上使用<code>ref</code>来标记，然后通过<code>$refs</code>来获取到标记的引用：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567579888756.png" alt="1567579888756"></p><p><br>注意的是，不能重复标记相同名称，相同名称的 ref 只会覆盖为最后一个：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567580190773.png" alt="1567580190773"></p><p><br>但是，如果是用 v-for 的方式来循环标记，则不会发生覆盖，会得到一个数组：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567580308732.png" alt="1567580308732"></p><p>ref 除了可以标记 dom 元素，还可以标记组件。如果在普通的 DOM 元素上使用，引用指向的就是 DOM 元素；如果用在子组件上，引用就指向组件实例。下文讲组件传值时会讲到。</p><p> <br><br><br></p><h1 id="三、Vue-指令"><a href="#三、Vue-指令" class="headerlink" title="三、Vue 指令"></a>三、Vue 指令</h1><h2 id="v-pre、v-cloak和v-once指令"><a href="#v-pre、v-cloak和v-once指令" class="headerlink" title="v-pre、v-cloak和v-once指令"></a>v-pre、v-cloak和v-once指令</h2><h3 id="v-pre指令"><a href="#v-pre指令" class="headerlink" title="v-pre指令"></a>v-pre指令</h3><p>在模板中跳过vue的编译，直接输出原始值。就是在标签中加入v-pre就不会输出vue中的data值了。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-pre</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这时并不会输出我们的message值，而是直接在网页中显示<code></code><br></p><h3 id="v-cloak指令"><a href="#v-cloak指令" class="headerlink" title="v-cloak指令"></a>v-cloak指令</h3><p>在vue渲染完指定的整个DOM后才进行显示。它必须和CSS样式一起使用，</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[v-cloak]</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="selector-tag">div</span> <span class="selector-tag">v-cloak</span>&gt;</span><br><span class="line">  &#123;&#123; message &#125;&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p><br></p><h3 id="v-once指令"><a href="#v-once指令" class="headerlink" title="v-once指令"></a>v-once指令</h3><p>在第一次DOM时进行渲染，渲染完成后视为静态内容，跳出以后的渲染过程。</p><p><br></p><h2 id="其他常用指令"><a href="#其他常用指令" class="headerlink" title="其他常用指令"></a>其他常用指令</h2><p>还有 v-html、v-text、v-if、v-else-if、v-else、v-show等，具体见旧版笔记。</p><p><br><br></p><h2 id="xss攻击"><a href="#xss攻击" class="headerlink" title="xss攻击"></a>xss攻击</h2><p>讲到 v-html 的时候，提到了<strong>XSS攻击</strong>，了解一下。</p><p><a href="https://github.com/lynnic26/LynnNote/issues/1" target="_blank" rel="noopener">https://github.com/lynnic26/LynnNote/issues/1</a></p><p><br><br></p><h2 id="v-bind和v-on"><a href="#v-bind和v-on" class="headerlink" title="v-bind和v-on"></a>v-bind和v-on</h2><p><code>&lt;img v-bind:src=&quot;imgUrl&quot; alt=&quot;&quot;&gt;</code>中的<code>v-bind</code>可以简写为<code>&lt;img :src=&quot;imgUrl&quot; alt=&quot;&quot;&gt;</code></p><p><br><br></p><h3 id="绑定class"><a href="#绑定class" class="headerlink" title="绑定class"></a>绑定class</h3><ol><li><p>使用 <strong>:class</strong> 来绑定类名：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">style</span>&gt;</span><br><span class="line">    <span class="selector-class">.red</span> &#123;</span><br><span class="line">        <span class="attribute">color</span>: red</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;p :class=&apos;redClass&apos;&gt;peace!&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">   </span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var vm = new Vue(&#123;</span><br><span class="line">        data: &#123;</span><br><span class="line">            redClass: &apos;red&apos;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">   </span><br><span class="line">    vm.$mount(&apos;#app&apos;)</span><br><span class="line">   </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>这样 p 标签就添加上了一个名为 red 的类了。<br><br></p></li></ol><ol start="2"><li><p>结合<strong>数组</strong>方式绑定类名：</p><p>如果想要给一个标签绑定多个类名，</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564384342505.png" alt="1564384342505"></p><p>正确方式是使用【数组】：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">:class</span>=<span class="string">"[redClass, bigClass]"</span>&gt;</span>peace!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><p>​    还可以在数组中进行判断运算：</p><p>​    <img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564385335421.png" alt="1564385335421"></p><p><br></p><ol start="3"><li><p>结合<strong>对象</strong>绑定class：    </p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564386032576.png" alt="1564386032576"></p><p>也可以这样：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564386210997.png" alt="1564386210997"></p></li></ol><p><br><br></p><h3 id="绑定style"><a href="#绑定style" class="headerlink" title="绑定style"></a>绑定style</h3><p>将样式写进一个对象花括号里面，注意键值对中的值要用引号包起来。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p :style=&quot;&#123;width:&apos;100px&apos;,height:&apos;200px&apos;,backgroundColor:&apos;red&apos;&#125;&quot;&gt;&lt;/p&gt;</span><br></pre></td></tr></table></figure><p>也可以在data中写样式对象，然后用<code>:style</code>绑定，这样比较清晰：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564386818920.png" alt="1564386818920"></p><p>如果想要给一个标签绑定上多个样式对象，需要使用数组：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564387087174.png" alt="1564387087174"></p><p>注意一点是在一个标签内部，<code>style</code>的权重低于<code>:style</code>的权重，先执行style的样式，然后再执行<code>:style</code>的样式，遇到相同的backgroundColor<code>:style</code>的样式会覆盖<code>style</code>的。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564387434614.png" alt="1564387434614"></p><p>p 的背景颜色为red</p><p><br><br></p><h2 id="v-for"><a href="#v-for" class="headerlink" title="v-for"></a>v-for</h2><p><br><br></p><h2 id="v-model"><a href="#v-model" class="headerlink" title="v-model"></a>v-model</h2><p>实现双向数据绑定</p><p>可以实现 v-model 的表单元素：</p><ul><li>input text</li><li>input checkbox</li><li>input radio</li><li>textarea</li><li>select</li></ul><p>【这部分看一下源码】</p><p><br><br><br></p><h1 id="四、自定义键盘修饰符"><a href="#四、自定义键盘修饰符" class="headerlink" title="四、自定义键盘修饰符"></a>四、自定义键盘修饰符</h1><h3 id="2-x中自定义键盘修饰符"><a href="#2-x中自定义键盘修饰符" class="headerlink" title="2.x中自定义键盘修饰符"></a><a href="https://cn.vuejs.org/v2/guide/events.html#键值修饰符" target="_blank" rel="noopener">2.x中自定义键盘修饰符</a></h3><ol><li>通过<code>Vue.config.keyCodes.名称 = 按键值</code>来自定义案件修饰符的别名：</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vue.config.keyCodes.f2 = 113;</span><br></pre></td></tr></table></figure><ol><li>使用自定义的按键修饰符：</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;text&quot; v-model=&quot;name&quot; @keyup.f2=&quot;add&quot;&gt;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h1 id="五、directive自定义指令"><a href="#五、directive自定义指令" class="headerlink" title="五、directive自定义指令"></a><a href="https://cn.vuejs.org/v2/guide/custom-directive.html" target="_blank" rel="noopener">五、directive自定义指令</a></h1><ol><li>自定义全局和局部的 自定义指令：</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">// 自定义全局指令 v-focus，为绑定的元素自动获取焦点：</span><br><span class="line"></span><br><span class="line">Vue.directive(&apos;focus&apos;, &#123;</span><br><span class="line"></span><br><span class="line">  inserted: function (el) &#123; // inserted 表示被绑定元素插入父节点时调用</span><br><span class="line"></span><br><span class="line">    el.focus();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 自定义局部指令 v-color 和 v-font-weight，为绑定的元素设置指定的字体颜色 和 字体粗细：</span><br><span class="line"></span><br><span class="line">  directives: &#123;</span><br><span class="line"></span><br><span class="line">    color: &#123; // 为元素设置指定的字体颜色</span><br><span class="line"></span><br><span class="line">      bind(el, binding) &#123;</span><br><span class="line"></span><br><span class="line">        el.style.color = binding.value;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    &apos;font-weight&apos;: function (el, binding2) &#123; // 自定义指令的简写形式，等同于定义了 bind 和 update 两个钩子函数</span><br><span class="line"></span><br><span class="line">      el.style.fontWeight = binding2.value;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ol><li>自定义指令的使用方式：</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;text&quot; v-model=&quot;searchName&quot; v-focus v-color=&quot;&apos;red&apos;&quot; v-font-weight=&quot;900&quot;&gt;</span><br></pre></td></tr></table></figure><p>【渡一案例见源码和视频】</p><p>F:\渡一前端课\新录制的vue课程资料\9. directive\vue.html</p><p><br><br><br></p><h1 id="六、filter过滤器"><a href="#六、filter过滤器" class="headerlink" title="六、filter过滤器"></a>六、filter过滤器</h1><p>概念：Vue.js 允许你自定义过滤器，<strong>可被用作一些常见的文本格式化</strong>。过滤器可以用在两个地方：<strong>mustache 插值和 v-bind 表达式</strong>。过滤器应该被添加在 JavaScript 表达式的尾部，由“管道”符指示；<br><br></p><h3 id="私有过滤器"><a href="#私有过滤器" class="headerlink" title="私有过滤器"></a>私有过滤器</h3><ol><li>HTML元素：</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;td&gt;&#123;&#123;item.ctime | dataFormat(&apos;yyyy-mm-dd&apos;)&#125;&#125;&lt;/td&gt;</span><br></pre></td></tr></table></figure><ol><li>私有 <code>filters</code> 定义方式：</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">filters: &#123; // 私有局部过滤器，只能在 当前 VM 对象所控制的 View 区域进行使用</span><br><span class="line"></span><br><span class="line">    dataFormat(input, pattern = &quot;&quot;) &#123; // 在参数列表中 通过 pattern=&quot;&quot; 来指定形参默认值，防止报错</span><br><span class="line"></span><br><span class="line">      var dt = new Date(input);</span><br><span class="line"></span><br><span class="line">      // 获取年月日</span><br><span class="line"></span><br><span class="line">      var y = dt.getFullYear();</span><br><span class="line"></span><br><span class="line">      var m = (dt.getMonth() + 1).toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line">      var d = dt.getDate().toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      // 如果 传递进来的字符串类型，转为小写之后，等于 yyyy-mm-dd，那么就返回 年-月-日</span><br><span class="line"></span><br><span class="line">      // 否则，就返回  年-月-日 时：分：秒</span><br><span class="line"></span><br><span class="line">      if (pattern.toLowerCase() === &apos;yyyy-mm-dd&apos;) &#123;</span><br><span class="line"></span><br><span class="line">        return `$&#123;y&#125;-$&#123;m&#125;-$&#123;d&#125;`;</span><br><span class="line"></span><br><span class="line">      &#125; else &#123;</span><br><span class="line"></span><br><span class="line">        // 获取时分秒</span><br><span class="line"></span><br><span class="line">        var hh = dt.getHours().toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line">        var mm = dt.getMinutes().toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line">        var ss = dt.getSeconds().toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        return `$&#123;y&#125;-$&#123;m&#125;-$&#123;d&#125; $&#123;hh&#125;:$&#123;mm&#125;:$&#123;ss&#125;`;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><blockquote><p>使用ES6中的字符串新方法 String.prototype.padStart(maxLength, fillString=’’) 或 String.prototype.padEnd(maxLength, fillString=’’)来填充字符串；</p></blockquote><p><br><br></p><h3 id="全局过滤器"><a href="#全局过滤器" class="headerlink" title="全局过滤器"></a>全局过滤器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">// 定义一个全局过滤器</span><br><span class="line"></span><br><span class="line">Vue.filter(&apos;dataFormat&apos;, function (input, pattern = &apos;&apos;) &#123;</span><br><span class="line"></span><br><span class="line">  var dt = new Date(input);</span><br><span class="line"></span><br><span class="line">  // 获取年月日</span><br><span class="line"></span><br><span class="line">  var y = dt.getFullYear();</span><br><span class="line"></span><br><span class="line">  var m = (dt.getMonth() + 1).toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line">  var d = dt.getDate().toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // 如果 传递进来的字符串类型，转为小写之后，等于 yyyy-mm-dd，那么就返回 年-月-日</span><br><span class="line"></span><br><span class="line">  // 否则，就返回  年-月-日 时：分：秒</span><br><span class="line"></span><br><span class="line">  if (pattern.toLowerCase() === &apos;yyyy-mm-dd&apos;) &#123;</span><br><span class="line"></span><br><span class="line">    return `$&#123;y&#125;-$&#123;m&#125;-$&#123;d&#125;`;</span><br><span class="line"></span><br><span class="line">  &#125; else &#123;</span><br><span class="line"></span><br><span class="line">    // 获取时分秒</span><br><span class="line"></span><br><span class="line">    var hh = dt.getHours().toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line">    var mm = dt.getMinutes().toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line">    var ss = dt.getSeconds().toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    return `$&#123;y&#125;-$&#123;m&#125;-$&#123;d&#125; $&#123;hh&#125;:$&#123;mm&#125;:$&#123;ss&#125;`;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>注意：当有局部和全局两个名称相同的过滤器时候，会以就近原则进行调用，即：局部过滤器优先于全局过滤器被调用！</p></blockquote><p>【渡一案例见源码和视频】</p><p>F:\渡一前端课\新录制的vue课程资料\10. filter\vue.html</p><p><br><br><br></p><h1 id="七、el、-template、render"><a href="#七、el、-template、render" class="headerlink" title="七、el、 template、render"></a>七、el、 template、render</h1><p>挂载过程：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/挂载流程.jpg" alt=""></p><p>【渡一案例见源码和视频】</p><p>F:\渡一前端课\新录制的vue课程资料\11. el、template、render\vue.html</p><p><br><br><br></p><h1 id="八、vue实例的生命周期"><a href="#八、vue实例的生命周期" class="headerlink" title="八、vue实例的生命周期"></a><a href="https://cn.vuejs.org/v2/guide/instance.html#实例生命周期" target="_blank" rel="noopener">八、vue实例的生命周期</a></h1><p><a href="https://ws1.sinaimg.cn/large/006ttwEMly1g2hbe8i32jj31xe25qtku.jpg" target="_blank" rel="noopener">[查看大图]</a><img src="https://ws1.sinaimg.cn/large/006ttwEMly1g2hbe8i32jj31xe25qtku.jpg" alt=""></p><ul><li>什么是生命周期：从Vue实例创建、运行、到销毁期间，总是伴随着各种各样的事件，这些事件，统称为生命周期！</li><li><a href="https://cn.vuejs.org/v2/api/#选项-生命周期钩子" target="_blank" rel="noopener">生命周期钩子</a>：就是生命周期事件的别名而已；</li><li>生命周期钩子 = 生命周期函数 = 生命周期事件</li><li><p>主要的生命周期函数分类：</p></li><li><p>创建期间的生命周期函数：</p></li><li><p>beforeCreate：实例刚在内存中被创建出来，此时，还没有初始化好 data 和 methods 属性</p></li><li>created：实例已经在内存中创建OK，此时 data 和 methods 已经创建OK，此时还没有开始 编译模板</li><li>beforeMount：此时已经完成了模板的编译，但是还没有挂载到页面中</li><li><p>mounted：此时，已经将编译好的模板，挂载到了页面指定的容器中显示</p></li><li><p>运行期间的生命周期函数：</p></li><li><p>beforeUpdate：状态更新之前执行此函数， 此时 data 中的状态值是最新的，但是界面上显示的 数据还是旧的，因为此时还没有开始重新渲染DOM节点</p></li><li><p>updated：实例更新完毕之后调用此函数，此时 data 中的状态值 和 界面上显示的数据，都已经完成了更新，界面已经被重新渲染好了！</p></li><li><p>销毁期间的生命周期函数：</p></li><li><p>beforeDestroy：实例销毁之前调用。在这一步，实例仍然完全可用。</p></li><li>destroyed：Vue 实例销毁后调用。调用后，Vue 实例指示的所有东西都会解绑定，所有的事件监听器会被移除，所有的子实例也会被销毁。</li></ul><p><br><br><br></p><h1 id="九、计算属性computed和监听器watch"><a href="#九、计算属性computed和监听器watch" class="headerlink" title="九、计算属性computed和监听器watch"></a>九、计算属性computed和监听器watch</h1><p>模板内的表达式非常便利，但是设计它们的初衷是用于简单运算的。在模板中放入太多的逻辑会让模板过重且难以维护。 </p><p>当我想要拼接name，looks，和age时，使用模板表达式很麻烦。直接写入describe属性中有显得代码亢余。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv1"</span>&gt;</span>&#123;&#123;name&#125;&#125; &#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv2"</span>&gt;</span>&#123;&#123;name+' '+age&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv3"</span>&gt;</span>&#123;&#123;describe&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">        el: <span class="string">"#dv"</span>,</span><br><span class="line">        data: &#123;</span><br><span class="line">            name: <span class="string">"dunteng"</span>,</span><br><span class="line">            age: <span class="string">"18"</span>,</span><br><span class="line">            describe: <span class="string">"dunteng 18"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>效果：<img src="https://ws1.sinaimg.cn/large/006ttwEMgy1g2czp6tk1ej303o02dmwx.jpg" alt=""></p><p>以上三种方法都可以，但是并不灵活。</p><p>应该用methods中的方法来实现：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv1"</span>&gt;</span>&#123;&#123;name&#125;&#125; &#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv2"</span>&gt;</span>&#123;&#123;name+' '+age&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv3"</span>&gt;</span>&#123;&#123;describe()&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>   //括号不可丢1</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">        el: <span class="string">"#dv"</span>,</span><br><span class="line">        data: &#123;</span><br><span class="line">            name: <span class="string">"dunteng"</span>,</span><br><span class="line">            age: <span class="string">"18"</span>,</span><br><span class="line">            height: <span class="number">180</span>,</span><br><span class="line">            <span class="comment">// describe: "dunteng 18"  data中的变量命名和methods中的方法不可同名</span></span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            describe()&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"方法describe被执行了"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.name+<span class="string">" "</span>+<span class="keyword">this</span>.age;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>函数返回了 name和age这两个属性，并且渲染到页面 </p><p>如此相比直接用模板语法来拼接确实简洁很多。</p><p><br><br></p><p>【这里需要知道】</p><p>在控制台上修改了这两个属性的其中一个之后，函数会被再执行一次，比如我在控制台输入<code>vm.name = &quot;hh&quot;</code>后， 页面上的<code>dunteng 18</code>会立即变成<code>hh 18</code>并再打印一次console语句。简而言之就是，<strong>当视图重新渲染了就会再执行一次该函数。</strong>另外当我们修改与describe方法无关的变量且该变量没有被渲染到试图上如height时，不会触发describe方法，但是一旦这个与describe方法无关的变量是有渲染到视图里的，则照样触发describe方法。</p><p><strong>因此我们修改属性影响视图渲染的同时，会涉及到重新加载无关的函数的问题，如此对性能十分不友好。</strong></p><p><br></p><p><strong>解决方法一：watch</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv3"</span>&gt;</span>&#123;&#123;describe&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">        el: <span class="string">"#dv"</span>,</span><br><span class="line">        data: &#123;</span><br><span class="line">            name: <span class="string">"dunteng"</span>,</span><br><span class="line">            age: <span class="string">"18"</span>,</span><br><span class="line">            height: <span class="number">180</span>,</span><br><span class="line">            describe: <span class="string">"dunteng 18"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        watch: &#123;</span><br><span class="line">            <span class="comment">// 监听name的变化</span></span><br><span class="line">            name()&#123;</span><br><span class="line">                <span class="keyword">this</span>.describe = <span class="keyword">this</span>.name + <span class="string">" "</span> +<span class="keyword">this</span>.age;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 监听age的变化</span></span><br><span class="line">            age()&#123;</span><br><span class="line">                <span class="keyword">this</span>.describe = <span class="keyword">this</span>.name + <span class="string">" "</span> +<span class="keyword">this</span>.age;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>这个方式虽然解决了问题，但是并不方便，代码冗余。</p><p><br></p><p><strong>解决方法二： computed</strong></p><p>这是最优的解决方法。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv3"</span>&gt;</span>&#123;&#123;describe&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">        el: <span class="string">"#dv"</span>,</span><br><span class="line">        data: &#123;</span><br><span class="line">            name: <span class="string">"dunteng"</span>,</span><br><span class="line">            age: <span class="string">"18"</span>,</span><br><span class="line">            height: <span class="number">180</span></span><br><span class="line">        &#125;,</span><br><span class="line">        computed: &#123;</span><br><span class="line">               describe()&#123;</span><br><span class="line">                   <span class="keyword">return</span> <span class="keyword">this</span>.name + <span class="string">" "</span> + <span class="keyword">this</span>.age;</span><br><span class="line">               &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>computed里面除了可以像上面那样写成方法（实际上并不是方法）的样子，还可以写成对象：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv3"</span>&gt;</span>&#123;&#123;describe&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">        el: <span class="string">"#dv"</span>,</span><br><span class="line">        data: &#123;</span><br><span class="line">            name: <span class="string">"dunteng"</span>,</span><br><span class="line">            age: <span class="string">"18"</span>,</span><br><span class="line">            height: <span class="number">180</span></span><br><span class="line">        &#125;,</span><br><span class="line">        computed: &#123;</span><br><span class="line">            <span class="comment">//    describe()&#123;</span></span><br><span class="line">            <span class="comment">//        return this.name + " " + this.age;</span></span><br><span class="line">            <span class="comment">//    &#125;</span></span><br><span class="line">            describe: &#123;</span><br><span class="line">            <span class="comment">//当我们获得这个describe的时候（渲染的时候）会执行get方法</span></span><br><span class="line">                get()&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">this</span>.name + <span class="string">" "</span> + <span class="keyword">this</span>.age;</span><br><span class="line">                &#125;,</span><br><span class="line">                set()&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">"describe被修改了"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p><br><br></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/006ttwEMgy1g2d14c4gstj308c076jrd.jpg" alt=""></p><p><br><br>【注意】：上述例子中，当<code>vm.name</code>  和<code>vm.age</code>修改了的时候，因为有computed监听，所以在修改的同时页面的内容也相应地修改了。但是当<code>vm.describe</code>整个被修改的时候，页面时没有同步渲染更新的，所以还要如下操作：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv3"</span>&gt;</span>&#123;&#123;describe&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv4"</span>&gt;</span>&#123;&#123;height&#125;&#125;cm<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">        el: <span class="string">"#dv"</span>,</span><br><span class="line">        data: &#123;</span><br><span class="line">            name: <span class="string">"dunteng"</span>,</span><br><span class="line">            age: <span class="string">"18"</span>,</span><br><span class="line">            height: <span class="number">180</span></span><br><span class="line">        &#125;,</span><br><span class="line">        computed: &#123;</span><br><span class="line">            <span class="comment">//    describe()&#123;</span></span><br><span class="line">            <span class="comment">//        return this.name + " " + this.age;</span></span><br><span class="line">            <span class="comment">//    &#125;</span></span><br><span class="line">            describe: &#123;</span><br><span class="line">                get()&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">this</span>.name + <span class="string">" "</span> + <span class="keyword">this</span>.age;</span><br><span class="line">                &#125;,</span><br><span class="line">                set(value)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">"describe被修改了"</span>);</span><br><span class="line">                    <span class="keyword">const</span> arr = value.split(<span class="string">" "</span>);</span><br><span class="line">                    <span class="built_in">console</span>.log(arr[<span class="number">0</span>]);</span><br><span class="line">                    <span class="built_in">console</span>.log(arr[<span class="number">1</span>]);</span><br><span class="line">                    <span class="keyword">this</span>.name = arr[<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">this</span>.age = arr[<span class="number">1</span>]; </span><br><span class="line">                    <span class="keyword">if</span>(arr[<span class="number">0</span>]==<span class="string">"大帅哥"</span>)&#123;</span><br><span class="line">                        <span class="keyword">this</span>.height = <span class="number">200</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p><strong>新版渡一代码</strong>：F:\渡一前端课\新录制的vue课程资料\13. 计算属性和侦听器\vue.html</p><p><strong>思否文章</strong>：<a href="https://segmentfault.com/a/1190000012948175" target="_blank" rel="noopener">https://segmentfault.com/a/1190000012948175</a></p><p><br><br><br></p><h1 id="十、组件"><a href="#十、组件" class="headerlink" title="十、组件"></a>十、组件</h1><h2 id="全局组件"><a href="#全局组件" class="headerlink" title="全局组件"></a>全局组件</h2><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567510618984.png" alt="1567510618984"></p><p>这样注册了一个全局组件，名为lin-dunteng，使用时直接标签化。</p><p>也可以写成小驼峰式：linDunteng，标签化为<code>&lt;lin-Dunteng&gt;&lt;lin-Dunteng&gt;</code>或者<code>&lt;lin-dunteng&gt;&lt;/lin-dunteng&gt;</code>，但是不能写成<code>&lt;linDunteng&gt;&lt;/linDunteng&gt;</code></p><p>也可以写成大驼峰式：LinDunteng，标签化为<code>&lt;lin-Dunteng&gt;&lt;lin-Dunteng&gt;</code>或者<code>&lt;lin-dunteng&gt;&lt;/lin-dunteng&gt;</code>或者<code>&lt;Lin-dunteng&gt;&lt;/Lin-dunteng&gt;</code>或者<code>&lt;Lin-Dunteng&gt;&lt;/Lin-Dunteng&gt;</code>, 但是不能写成<code>&lt;LinDunteng&gt;&lt;/LinDunteng&gt;</code></p><p>【提醒】不过以上情况是针对.html文件而言的，之后在.vue文件中就没这么多禁忌，相对比较自由宽泛。还有一点就是在.html文件中最好使用双标签，使用单标签可能会有些bug，但是在.vue文件中就没事</p><p>【问题】：为什么组件中的data要通过函数返回对象？</p><p>答：当一个组件被定义， data 必须声明为返回一个初始数据对象的函数，因为组件可能被用来创建多个实例。如果 data 仍然是一个纯粹的对象，则所有的实例将共享引用同一个数据对象！通过提供 data 函数，每次创建一个新实例后，我们能够调用 data 函数，从而返回初始数据的一个全新副本数据对象。</p><p>其实也很好理解，大概意思就是：</p><p>类比与引用数据类型。如果不用function return 每个组件的data都是内存的同一个地址，那一个数据改变其他也改变了，这当然就不是我们想要的。用function return 其实就相当于申明了新的变量，相互独立，自然就不会有这样的问题；js在赋值object对象时，是直接一个相同的内存地址。所以为了每个组件的data独立，采用了这种方式。<br>如果不是组件的话，正常data的写法可以直接写一个对象，比如data：{ msg ： ‘ 下载 ‘ }，但由于组件是会在多个地方引用<br>的，JS中直接共享对象会造成引用传递，也就是说修改了msg后所有按钮的msg都会跟着修改，所以这里用function来每次返回一个对象实例。</p><p><br><br></p><h2 id="局部组件"><a href="#局部组件" class="headerlink" title="局部组件"></a>局部组件</h2><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567511594805.png" alt="1567511594805"></p><p>该局部组件只能在相应的el中使用</p><p><br><br></p><h2 id="动态组件和插槽-v-slot"><a href="#动态组件和插槽-v-slot" class="headerlink" title="动态组件和插槽 v-slot"></a>动态组件和插槽 v-slot</h2><h3 id="动态组件"><a href="#动态组件" class="headerlink" title="动态组件"></a>动态组件</h3><p>关键为<code>&lt;component :is=&quot;comName&quot;&gt;&lt;/component&gt;</code>和<code>&lt;keep-alive&gt;&lt;/keep-alive&gt;</code></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567668494678.png" alt="1567668494678"></p><p><br><br></p><h3 id="插槽"><a href="#插槽" class="headerlink" title="插槽"></a>插槽</h3><p><strong>【匿名插槽】</strong></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567668892295.png" alt="1567668892295"></p><p><br><br></p><p><strong>【具名插槽】</strong></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567669076852.png" alt="1567669076852"></p><p><br><br><strong>【作用域插槽】</strong></p><p>详见F:\渡一前端课\0我的学习\VUE\上课学习代码\Vue全家桶一\09动态组件与插槽\作用域插槽01.html</p><p>和F:\渡一前端课\0我的学习\VUE\上课学习代码\Vue全家桶一\09动态组件与插槽\作用域插槽02.html</p><p>和<a href="https://ke.qq.com/webcourse/index.html#cid=288781&amp;term_id=100342071&amp;taid=2943852189345805&amp;type=1024&amp;vid=l14309p5itq" target="_blank" rel="noopener">https://ke.qq.com/webcourse/index.html#cid=288781&amp;term_id=100342071&amp;taid=2943852189345805&amp;type=1024&amp;vid=l14309p5itq</a></p><p><br><br></p><h2 id="组件传值"><a href="#组件传值" class="headerlink" title="组件传值"></a>组件传值</h2><p>利用属性的方式传值</p><h3 id="组件传递普通的值"><a href="#组件传递普通的值" class="headerlink" title="组件传递普通的值"></a>组件传递普通的值</h3><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567512737130.png" alt="1567512737130"></p><p><br><br></p><h3 id="组件传递data中的值，父组件传值给子组件"><a href="#组件传递data中的值，父组件传值给子组件" class="headerlink" title="组件传递data中的值，父组件传值给子组件"></a>组件传递data中的值，父组件传值给子组件</h3><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567513134224.png" alt="1567513134224"></p><p>以上的<code>props</code>都是一个数组的形式，它还可以写成一个对象的形式，而且有多个属性，看下面的例子 ：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567514346664.png" alt="1567514346664"></p><p>数组和对象这两个引用类型，default需要写成一个函数的形式。</p><p>【一个小练习】：</p><p>F:\渡一前端课\新录制的vue课程资料\15. 组件数据传递&amp;属性校验</p><p><br><br></p><h3 id="多层父传子通信"><a href="#多层父传子通信" class="headerlink" title="多层父传子通信"></a>多层父传子通信</h3><p>【场景】： 父组件要传值给子组件和孙子组件（子组件的子组件）</p><p>####【方案一】两层的父传子通信。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567519232543.png" alt="1567519232543"></p><p><br><br></p><h4 id="【方案二】利用-attrs-来传值"><a href="#【方案二】利用-attrs-来传值" class="headerlink" title="【方案二】利用 $attrs 来传值"></a>【方案二】利用 $attrs 来传值</h4><p>vm.$attrs 包含是组件中未被props注册的属性</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567573718978.png" alt="1567573718978"></p><p>$attrs–继承所有的父组件属性（除了prop注册传递的属性、class 和 style ），一般用在子组件的子元素上。</p><p>在本例中 <code>&lt;my-p :content=&#39;$attrs.content&#39;&gt;&lt;/my-p&gt;</code>得到应用。</p><p>【注意】如果$attrs继承了很多的属性，那么像上栗这样子一个一个在子组件标签中列出来很麻烦，可以直接使用</p><p><code>v-bind=&#39;$attrs&#39;</code>来一次性全部拿到$attrs中的全部属性。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567574861249.png" alt="1567574861249"></p><p>但是我们发现，在html结构中，被props注册传递的属性不会出现，而未被props注册传递的属性会出现，如下图所示：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567574935531.png" alt="1567574935531"></p><p>如何去除呢？</p><p>使用<code>inheritAttrs：false</code>!</p><p>inheritAttrs：默认值true,继承所有的父组件属性（除props的特定绑定）作为普通的HTML特性应用在子组件的根元素上，如果你不希望组件的根元素继承特性设置inheritAttrs: false,但是class属性会继承（<strong>简单的说，inheritAttrs：true 继承除props之外的所有属性；inheritAttrs：false 只继承class属性</strong>）</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567575042562.png" alt="1567575042562"></p><p>像这样子写之后，就大功告成了。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567575099573.png" alt="1567575099573"></p><p><br><br></p><h4 id="【方案三】利用-parent"><a href="#【方案三】利用-parent" class="headerlink" title="【方案三】利用 $parent"></a>【方案三】利用 $parent</h4><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567576385970.png" alt="1567576385970"></p><p>对于$children，是一个数组，因为可以有多个子组件。</p><p>但是这种方法官方不推荐使用，像孙子组件myP中这样多个$parent写起来很不友好。</p><p><br><br></p><h4 id="【方案四】利用provide和inject"><a href="#【方案四】利用provide和inject" class="headerlink" title="【方案四】利用provide和inject"></a>【方案四】利用provide和inject</h4><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567576901607.png" alt="1567576901607"></p><p>在组件中inject拿到的属性和数据是来自provide的，而非data中的。</p><p>虽然很方便却也是不太推荐使用的， 容易使得代码混乱，不知道属性是从何而来的。但是必须知道，面试的时候可以装逼。</p><p><br><br></p><h3 id="子组件向父组件传值"><a href="#子组件向父组件传值" class="headerlink" title="子组件向父组件传值"></a>子组件向父组件传值</h3><h4 id="【方案一】利用-children"><a href="#【方案一】利用-children" class="headerlink" title="【方案一】利用 $children"></a>【方案一】利用 $children</h4><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567579334058.png" alt="1567579334058"></p><p>但是这种方法官方不推荐使用。</p><p><br><br></p><h4 id="【方案二】-利用-refs"><a href="#【方案二】-利用-refs" class="headerlink" title="【方案二】 利用 $refs"></a>【方案二】 利用 $refs</h4><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567581936328.png" alt="1567581936328"></p><p>通过 $refs 获取到了子组件的数据和方法。</p><p><br><br></p><p>####【方案三】$emit</p><p>这是比较常用的方法</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567585452418.png" alt="1567585452418"></p><p>效果如下：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567585482438.png" alt="1567585482438"></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567585581527.png" alt="1567585581527"></p><p><br><br></p><h3 id="兄弟组件之间的传值"><a href="#兄弟组件之间的传值" class="headerlink" title="兄弟组件之间的传值"></a>兄弟组件之间的传值</h3><h4 id="利用事件总线EventBus"><a href="#利用事件总线EventBus" class="headerlink" title="利用事件总线EventBus"></a>利用事件总线EventBus</h4><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567588110311.png" alt="1567588110311"></p><p>【具体实现方式】：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Eventbus=<span class="keyword">new</span> Vue();    </span><br><span class="line">Eventbus.$emit(事件名,数据);    </span><br><span class="line">Eventbus.$on(事件名,data =&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure><p><br><br></p><h3 id="组件双向数据通信"><a href="#组件双向数据通信" class="headerlink" title="组件双向数据通信"></a>组件双向数据通信</h3><p>暂未整理</p><p><br><br><br></p><h1 id="十一、Vue-cli-脚手架"><a href="#十一、Vue-cli-脚手架" class="headerlink" title="十一、Vue-cli 脚手架"></a>十一、Vue-cli 脚手架</h1><h2 id="安装初试"><a href="#安装初试" class="headerlink" title="安装初试"></a>安装初试</h2><p>npm install -g @vue/cli     安装脚手架，用于生成项目，使用指令<code>vue --version</code>查看是否安装成功<br>npm install -g @vue/cli-service-global   快速原型开发，可以直接通过<code>vue serve xxx.vue</code>的指令来编译.vue文件</p><p>如果之前已经安装过旧版本（非3.x）脚手架，需先卸载旧版本：<br>npm uninstall vue-cli -g</p><p>如果仍然需要使用旧版本的 vue init 功能，可以全局安装一个桥接工具：<br>npm install -g @vue/cli-init    拉取旧版本</p><p>插件名字：Vetur（由于vscode并不认识.vue文件，所以没有代码高亮，需要安装Vetur这个插件来弥补</p><p><code>vue create vue-app</code>创建一个vue项目文件夹，叫做vue-app，【注意这里的命令操作最好用cmd执行，git bash有些操作完成不了】。会提示选择一个预设的方案，有default和manually selectfeature，选择后者。然后会有一些配置需要你选择，按空格键进行选择和取消选择，这里只选择Babel。再然后选择<code>In package.json</code>选项，选<img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567834770585.png" alt="1567834770585"></p><ul><li>★ 同时注意使用<code>redirect</code>来重定向到具体的一个子路由路径上，否则一打开“community”路由的时候没有默认的选中子路由，只会显示空白不会显示出具体的子路由页面。</li></ul><ul><li><p>在一级路由.vue文件中继续使用<code>&lt;router-link&gt;</code>和<code>&lt;router-view&gt;</code></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567834990024.png" alt="1567834990024"></p></li></ul><ul><li><p>关于首页路径和<code>router-link-active</code>的优化</p><p>在本例子中路由community的样式是加在<code>router-link-extra-active</code>上的，且匹配的是路径<code>/community</code>，因此路由community的子路由被点击时community的样式没有显现，因为此时的路径变成了<code>/community/xxx</code>没有完全匹配<code>/community</code>。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567836335642.png" alt="1567836335642">因此要把样式加到<code>router-link-active</code>上。但是问题又来了，<code>router-link-active</code>匹配了两个路径<code>/</code>和<code>/community</code></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567836265612.png" alt="1567836265612"></p><p>这样就应该把原本首页匹配的路径由根路径<code>/</code>换成<code>/home</code>。然后又有一个问题，就是我们访问<code>http://localhost:8080</code>的时候无法自动跳转到首页。所以还需要进行一步重定向：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567836714591.png" alt="1567836714591"></p><p>或者还可以这样子使用redirect ( )重定向：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567836792711.png" alt="1567836792711"></p></li><li><p>不存在的路径和优化</p><p>比如不存在该路径<code>http://localhost:8080/gjalhj</code>，对此要将这一切不存在路径同意跳转到某一指定页面</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567837033399.png" alt="1567837033399"></p><p>这里的<code>path: *</code>表示当以上的所有路径都没有匹配的时候，判断路径是否为<code>/</code>，是则重定向到<code>/home</code>，否则重定向到统一的指定页面。</p></li></ul><p><br><br></p><h2 id="router的push、replace和go"><a href="#router的push、replace和go" class="headerlink" title="$router的push、replace和go"></a>$router的push、replace和go</h2><ul><li><p>this.$router.push()</p><p>描述：跳转到不同的url，但这个方法回向history栈添加一个记录，点击后退会返回到上一个页面。</p><p>用法：<img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1568037236fa.jpg" alt=""></p></li></ul><ul><li><p>this.$router.replace()</p><p>描述：同样是跳转到指定的url，但是这个方法不会向history里面添加新的记录，点击返回，会跳转到上上一个页面。上一个记录是不存在的。</p></li><li><p>this.$router.go(n)</p><p>相对于当前页面向前或向后跳转多少个页面,类似 window.history.go(n)。n可为正数可为负数。正数返回上一个页面</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/20180315110305411.png" alt=""></p></li></ul><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567838042925.png" alt="1567838042925"></p><p>-</p><p><br><br></p><h2 id="导航守卫和动态路由"><a href="#导航守卫和动态路由" class="headerlink" title="导航守卫和动态路由"></a><a href="https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E5%AF%BC%E8%88%AA%E5%AE%88%E5%8D%AB" target="_blank" rel="noopener">导航守卫</a>和动态路由</h2><p>【重要的一节课】F:\渡一前端课\新录制的vue课程资料\28. 导航守卫&amp;动态路由</p><h3 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h3><p>【方案一】使用params：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567850470296.png" alt="1567850470296"></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567850528088.png" alt="1567850528088"></p><p>【方案二】使用query：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567851075014.png" alt="1567851075014"></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567851012789.png" alt="1567851012789"></p><p><br><br></p><h3 id="组件内的守卫"><a href="#组件内的守卫" class="headerlink" title="组件内的守卫"></a>组件内的守卫</h3><p>你可以在路由组件内直接定义以下路由导航守卫：</p><ul><li><code>beforeRouteEnter</code></li><li><code>beforeRouteUpdate</code> (2.2 新增)</li><li><code>beforeRouteLeave</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Foo = &#123;</span><br><span class="line">  template: <span class="string">`...`</span>,</span><br><span class="line">  beforeRouteEnter (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">    <span class="comment">// 在渲染该组件的对应路由被 confirm 前调用</span></span><br><span class="line">    <span class="comment">// 不！能！获取组件实例 `this`</span></span><br><span class="line">    <span class="comment">// 因为当守卫执行前，组件实例还没被创建</span></span><br><span class="line">  &#125;,</span><br><span class="line">  beforeRouteUpdate (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">    <span class="comment">// 在当前路由改变，但是该组件被复用时调用</span></span><br><span class="line">    <span class="comment">// 举例来说，对于一个带有动态参数的路径 /foo/:id，在 /foo/1 和 /foo/2 之间跳转的时候，</span></span><br><span class="line">    <span class="comment">// 由于会渲染同样的 Foo 组件，因此组件实例会被复用。而这个钩子就会在这个情况下被调用。</span></span><br><span class="line">    <span class="comment">// 可以访问组件实例 `this`</span></span><br><span class="line">  &#125;,</span><br><span class="line">  beforeRouteLeave (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">    <span class="comment">// 导航离开该组件的对应路由时调用</span></span><br><span class="line">    <span class="comment">// 可以访问组件实例 `this`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>beforeRouteEnter</code> 守卫 <strong>不能</strong> 访问 <code>this</code>，因为守卫在导航确认前被调用,因此即将登场的新组件还没被创建。</p><p>不过，你可以通过传一个回调给 <code>next</code>来访问组件实例。在导航被确认的时候执行回调，并且把组件实例作为回调方法的参数。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">beforeRouteEnter (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">  next(<span class="function"><span class="params">vm</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 通过 `vm` 访问组件实例</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意 <code>beforeRouteEnter</code> 是支持给 <code>next</code> 传递回调的唯一守卫。对于 <code>beforeRouteUpdate</code> 和 <code>beforeRouteLeave</code> 来说，<code>this</code> 已经可用了，所以<strong>不支持</strong>传递回调，因为没有必要了。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">beforeRouteUpdate (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">  <span class="comment">// just use `this`</span></span><br><span class="line">  <span class="keyword">this</span>.name = to.params.name</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个离开守卫通常用来禁止用户在还未保存修改前突然离开。该导航可以通过 <code>next(false)</code> 来取消。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">beforeRouteLeave (to, <span class="keyword">from</span> , next) &#123;</span><br><span class="line">  <span class="keyword">const</span> answer = <span class="built_in">window</span>.confirm(<span class="string">'Do you really want to leave? you have unsaved changes!'</span>)</span><br><span class="line">  <span class="keyword">if</span> (answer) &#123;</span><br><span class="line">    next()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next(<span class="literal">false</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>【案例】实现一个功能</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567845124241.png" alt="1567845124241"></p><p>这就要用到导航守卫之<strong>beforeRouterLeave</strong></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567845232834.png" alt="1567845232834"></p><p>相应的还有<strong>beforeRouteEnter</strong> ：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567850373975.png" alt="1567850373975"></p><p><strong>beforeRouteUpdate</strong>：</p><p>★ 这个看视频【F:\渡一前端课\新录制的vue课程资料\28. 导航守卫&amp;动态路由】</p><p><br><br></p><h3 id="路由独享守卫"><a href="#路由独享守卫" class="headerlink" title="路由独享守卫"></a>路由独享守卫</h3><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567926980649.png" alt="1567926980649"></p><p><br><br></p><h3 id="全局前置守卫"><a href="#全局前置守卫" class="headerlink" title="全局前置守卫"></a>全局前置守卫</h3><p>你可以使用 <code>router.beforeEach</code> 注册一个全局前置守卫：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123; ... &#125;)</span><br><span class="line"></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>当一个导航触发时，全局前置守卫按照创建顺序调用。守卫是异步解析执行，此时导航在所有守卫 resolve 完之前一直处于 <strong>等待中</strong>。</p><p>每个守卫方法接收三个参数：</p><ul><li><strong>to: Route</strong>: 即将要进入的目标 <a href="https://router.vuejs.org/zh/api/#%E8%B7%AF%E7%94%B1%E5%AF%B9%E8%B1%A1" target="_blank" rel="noopener">路由对象</a></li><li><strong>from: Route</strong>: 当前导航正要离开的路由</li><li><strong>next: Function</strong>: 一定要调用该方法来 <strong>resolve</strong> 这个钩子。执行效果依赖 <code>next</code> 方法的调用参数。<ul><li><strong>next()</strong>: 进行管道中的下一个钩子。如果全部钩子执行完了，则导航的状态就是 <strong>confirmed</strong> (确认的)。</li><li><strong>next(false)</strong>: 中断当前的导航。如果浏览器的 URL 改变了 (可能是用户手动或者浏览器后退按钮)，那么 URL 地址会重置到 <code>from</code> 路由对应的地址。</li><li><strong>next(‘/‘) 或者 next({ path: ‘/‘ })</strong>: 跳转到一个不同的地址。当前的导航被中断，然后进行一个新的导航。你可以向 <code>next</code> 传递任意位置对象，且允许设置诸如 <code>replace: true</code>、<code>name: &#39;home&#39;</code> 之类的选项以及任何用在 <a href="https://router.vuejs.org/zh/api/#to" target="_blank" rel="noopener"><code>router-link</code> 的 <code>to</code> prop</a> 或 <a href="https://router.vuejs.org/zh/api/#router-push" target="_blank" rel="noopener"><code>router.push</code></a> 中的选项。</li><li><strong>next(error)</strong>: (2.4.0+) 如果传入 <code>next</code> 的参数是一个 <code>Error</code> 实例，则导航会被终止且该错误会被传递给 <a href="https://router.vuejs.org/zh/api/#router-onerror" target="_blank" rel="noopener"><code>router.onError()</code></a> 注册过的回调。</li></ul></li></ul><p><strong>确保要调用 next 方法，否则钩子就不会被 resolved。</strong></p><p><br><br></p><h3 id="全局解析守卫"><a href="#全局解析守卫" class="headerlink" title="全局解析守卫"></a>全局解析守卫</h3><blockquote><p>2.5.0 新增</p></blockquote><p>在 2.5.0+ 你可以用 <code>router.beforeResolve</code> 注册一个全局守卫。这和 <code>router.beforeEach</code> 类似，区别是在导航被确认之前，<strong>同时在所有组件内守卫和异步路由组件被解析之后</strong>，解析守卫就被调用。</p><p><br><br></p><h3 id="全局后置钩子"><a href="#全局后置钩子" class="headerlink" title="全局后置钩子"></a>全局后置钩子</h3><p>你也可以注册全局后置钩子，然而和守卫不同的是，这些钩子不会接受 <code>next</code> 函数也不会改变导航本身：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">router.afterEach(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567928081876.png" alt="1567928081876"></p><p><br><br></p><h3 id="导航守卫小汇总"><a href="#导航守卫小汇总" class="headerlink" title="导航守卫小汇总"></a>导航守卫小汇总</h3><ol><li><strong>全局守卫</strong></li></ol><ul><li><p>beforeEach</p></li><li><p>beforeResolve</p></li><li><p>afterEach</p></li></ul><ol start="2"><li><strong>路由独享守卫</strong></li></ol><ul><li>beforeEnter</li></ul><ol start="3"><li><strong>组件内守卫</strong></li></ol><ul><li><p>beforeRouteLeave 当离开这个路径时执行</p></li><li><p>beforeRouteEnter </p></li><li><p>beforeRouteUpdate mounted</p></li></ul><p>   进入某一个路径时，执行顺序</p><p>- beforeEach -&gt; beforeEnter -&gt; beforeRouteEnter -&gt; beforeResolve -&gt; afterEach </p><p><br></p><h3 id="完整的导航解析流程"><a href="#完整的导航解析流程" class="headerlink" title="完整的导航解析流程"></a>完整的导航解析流程</h3><ol><li>导航被触发。</li><li>在失活的组件里调用离开守卫。</li><li>调用全局的 <code>beforeEach</code> 守卫。</li><li>在重用的组件里调用 <code>beforeRouteUpdate</code> 守卫 (2.2+)。</li><li>在路由配置里调用 <code>beforeEnter</code>。</li><li>解析异步路由组件。</li><li>在被激活的组件里调用 <code>beforeRouteEnter</code>。</li><li>调用全局的 <code>beforeResolve</code> 守卫 (2.5+)。</li><li>导航被确认。</li><li>调用全局的 <code>afterEach</code> 钩子。</li><li>触发 DOM 更新。</li><li>用创建好的实例调用 <code>beforeRouteEnter</code> 守卫中传给 <code>next</code> 的回调函数。</li></ol><p><br><br></p><h2 id="路由元信息"><a href="#路由元信息" class="headerlink" title="路由元信息"></a>路由元信息</h2><p>定义路由的时候可以配置 <code>meta</code> 字段：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/foo'</span>,</span><br><span class="line">      component: Foo,</span><br><span class="line">      children: [</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">'bar'</span>,</span><br><span class="line">          component: Bar,</span><br><span class="line">          <span class="comment">// a meta field</span></span><br><span class="line">          meta: &#123; <span class="attr">requiresAuth</span>: <span class="literal">true</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>那么如何访问这个 <code>meta</code> 字段呢？</p><p>首先，我们称呼 <code>routes</code> 配置中的每个路由对象为 <strong>路由记录</strong>。路由记录可以是嵌套的，因此，当一个路由匹配成功后，他可能匹配多个路由记录</p><p>例如，根据上面的路由配置，<code>/foo/bar</code> 这个 URL 将会匹配父路由记录以及子路由记录。</p><p>一个路由匹配到的所有路由记录会暴露为 <code>$route</code> 对象 (还有在导航守卫中的路由对象) 的 <code>$route.matched</code> 数组。因此，我们需要遍历 <code>$route.matched</code> 来检查路由记录中的 <code>meta</code> 字段。</p><p>下面例子展示在全局导航守卫中检查元字段：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (to.matched.some(<span class="function"><span class="params">record</span> =&gt;</span> record.meta.requiresAuth)) &#123;</span><br><span class="line">    <span class="comment">// this route requires auth, check if logged in</span></span><br><span class="line">    <span class="comment">// if not, redirect to login page.</span></span><br><span class="line">    <span class="keyword">if</span> (!auth.loggedIn()) &#123;</span><br><span class="line">      next(&#123;</span><br><span class="line">        path: <span class="string">'/login'</span>,</span><br><span class="line">        query: &#123; <span class="attr">redirect</span>: to.fullPath &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      next()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next() <span class="comment">// 确保一定要调用 next()</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>【案例】实现用户登录后才有查看内容权限，仍然基于上面的程序，要求用户登录后才可以查看“学员展示”和”社区“</p><p>★★★ F:\渡一前端课\新录制的vue课程资料\30. 路由元信息</p><p><br><br><br></p><h1 id="十三、Vuex"><a href="#十三、Vuex" class="headerlink" title="十三、Vuex"></a>十三、Vuex</h1><h2 id="state、getters、mutations、actions"><a href="#state、getters、mutations、actions" class="headerlink" title="state、getters、mutations、actions"></a>state、getters、mutations、actions</h2><p>详见我的完整笔记：</p><p><a href="https://github.com/Dunteng/learnVue/tree/master/%E5%AD%A6%E4%B9%A0Vuex#%E6%9C%AC%E6%96%87%E4%BB%A3%E7%A0%81" target="_blank" rel="noopener">https://github.com/Dunteng/learnVue/tree/master/%E5%AD%A6%E4%B9%A0Vuex#%E6%9C%AC%E6%96%87%E4%BB%A3%E7%A0%81</a></p><p><br><br></p><h2 id="vuex-module"><a href="#vuex-module" class="headerlink" title="vuex module"></a>vuex module</h2><p>【F:\渡一前端课\新录制的vue课程资料\33. vuex mutation&amp;action\src】</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567958712382.png" alt="1567958712382"></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567958795682.png" alt="1567958795682"></p><p>注意到在此，使用的 vuex state都是存放关于 “学员展示” 模块的，一旦其他板块如 “课程学习” “社区” 等也需要用到 vuex ， 那么一大堆的数据都堆积到state中，这样就很庞大很杂乱，不好维护和管理，<strong>因此需要分模块用到 vuex module</strong>。</p><h3 style="color:red;">★★★★★ 看代码【F:\渡一前端课\新录制的vue课程资料\34. vuex module\src】</h3><p> <strong>modules</strong></p><ul><li><p>根据功能让vuex分出模块</p></li><li><p>state会放入到每一个模块下，getters、mutations、actions会直接放入到全局</p><p><strong>获取vuex中的数据（无namespaced）</strong></p></li><li><p>获取state : this.$store.state.moduleName.xxx</p></li><li><p>获取getters： this.$store.getters.xxx</p></li><li><p>获取mutations： this.$store.commit(‘xxx’)</p></li><li><p>获取actions： this.$store.dispatch(‘xxx’)</p></li><li><p>可以通过mapXXX 方式拿到getters、mutations、action，但是不能拿到state，如果想通过这种方式获取state，需要加命名空间：namespaced：true</p><p><strong>获取vuex中的数据（有namespaced）</strong></p></li><li><p>获取state : this.$store.state.moduleName.xxx</p></li><li><p>获取getters： this.$store[‘moduleName/getters’].xxx</p></li><li><p>获取mutations： this.$store.commit(‘moduleName/xxx’)</p></li><li><p>获取actions： this.$store.dispatch(‘moduleName/xxx’)</p></li><li><p>可以通过mapXXX: mapXXX(‘moduleName’, [‘xxx’])  mapXXX(‘moduleName’, {})</p></li></ul><p><br><br><br></p><h1 id="十四、跨域"><a href="#十四、跨域" class="headerlink" title="十四、跨域"></a>十四、跨域</h1><h1 id="十五、网络请求axios"><a href="#十五、网络请求axios" class="headerlink" title="十五、网络请求axios"></a>十五、网络请求axios</h1><p>参考：</p><ul><li><a href="https://www.kancloud.cn/yunye/axios/234845" target="_blank" rel="noopener">https://www.kancloud.cn/yunye/axios/234845</a></li><li>王红元老师的<a href="https://www.bilibili.com/video/av67171816/?p=146" target="_blank" rel="noopener">vue课程</a></li></ul><p>axios 是 Vue 作者尤雨溪推荐的官方 ajax 库。有一下主要功能特点：</p><ul><li>在浏览器中发送 XMLHttpRequest 请求</li><li>在 node.js 中发送 http 请求</li><li>支持 Promise API</li><li>拦截请求和响应</li><li>转化请求和响应数据</li></ul><p><br></p><p>先安装：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install axios --save</span><br></pre></td></tr></table></figure><p>再引入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br></pre></td></tr></table></figure><p>发送请求：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">  url: <span class="string">"http://123.207.32.32:8000/home/multidata"</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>以上没有指定 GET 请求还是 POST 请求，只传了一个 url ，默认为 GET 请求。</p><p><br></p><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><p>执行 <code>GET</code> 请求</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为给定 ID 的 user 创建请求</span></span><br><span class="line">axios.get(<span class="string">'/user?ID=12345'</span>)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(response);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可选地，上面的请求可以这样做</span></span><br><span class="line">axios.get(<span class="string">'/user'</span>, &#123;</span><br><span class="line">    params: &#123;</span><br><span class="line">      ID: <span class="number">12345</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(response);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>执行 <code>POST</code> 请求</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">axios.post(<span class="string">'/user'</span>, &#123;</span><br><span class="line">    firstName: <span class="string">'Fred'</span>,</span><br><span class="line">    lastName: <span class="string">'Flintstone'</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(response);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>执行多个<strong>并发请求</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserAccount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> axios.get(<span class="string">'/user/12345'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserPermissions</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> axios.get(<span class="string">'/user/12345/permissions'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">axios.all([getUserAccount(), getUserPermissions()])</span><br><span class="line">    .then(axios.spread(<span class="function">(<span class="params">res1, res2</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res1);</span><br><span class="line">    <span class="built_in">console</span>.log(res2);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/vue/1568962541144.png" alt="1568962541144"></p><p><br></p><h2 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a>全局配置</h2><p>看下面的例子</p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/vue/1568962967595.png" alt="1568962967595"></p><p>这里面的 baseURL 和 timeout 存在冗余，可以将其再全局配置中写好。事实上，在开发中可能很多参数都是固定的，这时候我们可以进行一些抽取，也可以利用axios的全局配置。</p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/vue/1568963218053.png" alt="1568963218053"></p><p>类似的还有</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">axios.defaults.headers.post[<span class="string">'Content-Type'</span>]=<span class="string">'application/x-www-form-urlencoded'</span></span><br></pre></td></tr></table></figure><p>还有其他配置选项，我就不一一列出来了。</p><p><br></p><h2 id="axios-的实例使用"><a href="#axios-的实例使用" class="headerlink" title="axios 的实例使用"></a>axios 的实例使用</h2><p>像上面的几个例子都是直接使用 axios ，但是有时候这样子直接使用 axios 是不合适的。</p><p>比如，我们的项目并非只是在 baseURL=“<a href="http://aaaa:8000”，而是还有多个" target="_blank" rel="noopener">http://aaaa:8000”，而是还有多个</a> baseURL，那么这时候如果直接用 axios 来配置 baseURL 和其他的相关配置，就实现不了了，所以可以使用 axios 的实例，使用实例就可以避免这样的问题。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个axios的实例 instance1</span></span><br><span class="line"><span class="keyword">const</span> instance1 = axios.create(&#123;</span><br><span class="line">  baseURL: <span class="string">'http://123.123.123.12:8000'</span>,</span><br><span class="line">  timeout: <span class="number">5000</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 使用instance1实例</span></span><br><span class="line">instance1(&#123;</span><br><span class="line">  url: <span class="string">'/home/multidata'</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个axios实例 instance2</span></span><br><span class="line"><span class="keyword">const</span> instance2 = axios.create(&#123;</span><br><span class="line">  baseURL: <span class="string">'http://456.123.123.12:8000'</span>,</span><br><span class="line">  timeout: <span class="number">5000</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 使用instance2实例</span></span><br><span class="line">instance2(&#123;</span><br><span class="line">  url: <span class="string">'/home/multidata'</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br></p><h2 id="axios-封装代码"><a href="#axios-封装代码" class="headerlink" title="axios 封装代码"></a>axios 封装代码</h2><p>假设项目中有十处组件要用到 axios 来请求数据，那么我们可能需要引入 axios 十次，如果有五十次要用到就要引入五十次。万一某天 axios 挂掉了或者不再维护了，那么我们的项目就要大改了，每次用到 axios 的地方都要重新编写，五十次就够呛了，大型项目的话直接扑街。</p><p>所以在实际开发中，一定要有意识的封装 axios 代码，比如我们在 <code>src/network/request.js</code>中对 axios 进行了封装，对外导出实例<code>request</code>，在进行数据请求的时候就可以使用封装好的<code>request</code>而不是直接使用 axios，这样一来，如果以后要更换技术或者修改，就不用每处地方都进行修改，只要该封装代码<code>request</code>就可以了。</p><p>下面开始进行封装：</p><h3 id="level-1"><a href="#level-1" class="headerlink" title="level 1"></a>level 1</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//   src/network/request.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">config, success, failure</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 创建axios的实例</span></span><br><span class="line">    <span class="keyword">const</span> instance = axios.create(&#123;</span><br><span class="line">        baseURL: <span class="string">' https://easy-mock.com/mock/5c88abff4c25252b7c484888/magazine'</span>,</span><br><span class="line">        timeout: <span class="number">5000</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送网络请求,使用回调函数来处理数据</span></span><br><span class="line">    instance(config).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        success(res)</span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        failure(err)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; request &#125; <span class="keyword">from</span> <span class="string">'./network/request'</span></span><br><span class="line"></span><br><span class="line">request(&#123;</span><br><span class="line">  url: <span class="string">'/home'</span></span><br><span class="line">&#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">  &#125;,</span><br><span class="line">  err =&gt; &#123;   </span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><br></p><h3 id="level-2"><a href="#level-2" class="headerlink" title="level 2"></a>level 2</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 创建axios的实例</span></span><br><span class="line">    <span class="keyword">const</span> instance = axios.create(&#123;</span><br><span class="line">        baseURL: <span class="string">' https://easy-mock.com/mock/5c88abff4c25252b7c484888/magazine'</span>,</span><br><span class="line">        timeout: <span class="number">5000</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送真正的网络请求</span></span><br><span class="line">    instance(config.baseConfig).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        config.success(res)</span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        config.failure(err)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; request &#125; <span class="keyword">from</span> <span class="string">'./network/request'</span></span><br><span class="line"></span><br><span class="line">request(&#123;</span><br><span class="line">  baseConfig: &#123;</span><br><span class="line">    url: <span class="string">'/home'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">  &#125;,</span><br><span class="line">  failure: <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><br></p><h3 id="level-3"><a href="#level-3" class="headerlink" title="level 3"></a>level 3</h3><p><strong>Promise化</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 返回一个Promise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> instance = axios.create(&#123;</span><br><span class="line">            baseURL: <span class="string">' http://www.liulongbin.top:3005'</span>,</span><br><span class="line">            timeout: <span class="number">5000</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        instance(config).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            resolve(res)</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            reject(err)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><p>调用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; request &#125; <span class="keyword">from</span> <span class="string">'./network/request'</span></span><br><span class="line"></span><br><span class="line">request(&#123;</span><br><span class="line">  url: <span class="string">'/api/getlunbo'</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br></p><h3 id="level-4"><a href="#level-4" class="headerlink" title="level 4"></a>level 4</h3><p>上面封装成 Promise 的版本还不是最好的，事实上<code>instance(config)</code>所返回的就是一个 <strong>Promise</strong>，因此可以不必再去封装成 Promise ，直接将 <code>instance(config)</code>返回出来即可：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 返回一个Promise</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> instance = axios.create(&#123;</span><br><span class="line">        baseURL: <span class="string">' http://www.liulongbin.top:3005'</span>,</span><br><span class="line">        timeout: <span class="number">5000</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> instance(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; request &#125; <span class="keyword">from</span> <span class="string">'./network/request'</span></span><br><span class="line"></span><br><span class="line">request(&#123;</span><br><span class="line">  url: <span class="string">'/api/getlunbo'</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br><br></p><h2 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h2><p>在请求或响应被 <code>then</code> 或 <code>catch</code> 处理前拦截它们。</p><p>一般有以下业务场景：</p><ul><li>当config中的一些信息不符合服务器要求，可以在发送请求之前拦截之并进行修改</li><li>每次发送网络请求时，在界面中触发加载动画，响应完成时关闭加载动画</li><li>某些网络请求（比如登录的token），必须携带一些特殊的信息</li><li>等等等</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加请求拦截器</span></span><br><span class="line">axios.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 在发送请求之前做些什么</span></span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 对请求错误做些什么</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加响应拦截器</span></span><br><span class="line">axios.interceptors.response.use(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 对响应数据做点什么</span></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 对响应错误做点什么</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>如果你想在稍后移除拦截器，可以这样：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myInterceptor = axios.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="comment">/*...*/</span>&#125;);</span><br><span class="line">axios.interceptors.request.eject(myInterceptor);</span><br></pre></td></tr></table></figure><p>可以为自定义 axios 实例添加拦截器</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> instance = axios.create();</span><br><span class="line">instance.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="comment">/*...*/</span>&#125;);</span><br></pre></td></tr></table></figure><hr><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 返回一个Promise</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> instance = axios.create(&#123;</span><br><span class="line">        baseURL: <span class="string">' http://www.liulongbin.top:3005'</span>,</span><br><span class="line">        timeout: <span class="number">5000</span></span><br><span class="line">    &#125;)</span><br><span class="line">    instance.interceptors.request.use(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(config);<span class="comment">//拦截config进行处理，这里将其打印出来，这里的config实际上就是上面的config</span></span><br><span class="line">        <span class="keyword">return</span> config  <span class="comment">//这里必须return config以取消拦截，否则之后无法响应成功</span></span><br><span class="line">    &#125;, err =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    instance.interceptors.response.use(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res);<span class="comment">//拦截res进行处理，这里将其打印出来</span></span><br><span class="line">        <span class="keyword">return</span> res.data<span class="comment">//这里必须return res.data以取消拦截，否则之后无法响应成功</span></span><br><span class="line">    &#125;, err =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> instance(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vi编辑器教程</title>
      <link href="/2019/08/08/vi%E2%80%94%E7%BB%88%E7%AB%AF%E4%B8%AD%E7%9A%84%E7%BC%96%E8%BE%91%E5%99%A8.html"/>
      <url>/2019/08/08/vi%E2%80%94%E7%BB%88%E7%AB%AF%E4%B8%AD%E7%9A%84%E7%BC%96%E8%BE%91%E5%99%A8.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h1 id="vi-——-终端中的编辑器"><a href="#vi-——-终端中的编辑器" class="headerlink" title="vi —— 终端中的编辑器"></a><code>vi</code> —— 终端中的编辑器</h1><h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><ul><li><code>vi</code> 简介</li><li>打开和新建文件</li><li>三种工作模式</li><li>常用命令</li><li>分屏命令</li><li>常用命令速查图</li></ul><h2 id="01-vi-简介"><a href="#01-vi-简介" class="headerlink" title="01. vi 简介"></a>01. <code>vi</code> 简介</h2><h3 id="1-1-学习-vi-的目的"><a href="#1-1-学习-vi-的目的" class="headerlink" title="1.1 学习 vi 的目的"></a>1.1 学习 <code>vi</code> 的目的</h3><ul><li>在工作中，要对 <strong>服务器</strong> 上的文件进行 <strong>简单</strong> 的修改，可以使用 <code>ssh</code> 远程登录到服务器上，并且使用 <code>vi</code> 进行快速的编辑即可</li><li>常见需要修改的文件包括：<ul><li><strong>源程序</strong></li><li><strong>配置文件</strong>，例如 <code>ssh</code> 的配置文件 <code>~/.ssh/config</code></li></ul></li></ul><blockquote><ul><li>在没有图形界面的环境下，要编辑文件，<code>vi</code> 是最佳选择！</li><li>每一个要使用 Linux 的程序员，都应该或多或少的学习一些 <code>vi</code> 的常用命令</li></ul></blockquote><h3 id="1-2-vi-和-vim"><a href="#1-2-vi-和-vim" class="headerlink" title="1.2 vi 和 vim"></a>1.2 vi 和 vim</h3><ul><li>在很多 <code>Linux</code> 发行版中，直接把 <code>vi</code> 做成 <code>vim</code> 的软连接</li></ul><h4 id="vi"><a href="#vi" class="headerlink" title="vi"></a>vi</h4><ul><li><code>vi</code> 是 <code>Visual interface</code> 的简称，是 <code>Linux</code> 中 <strong>最经典</strong> 的文本编辑器</li><li><code>vi</code> 的核心设计思想 —— <strong>让程序员的手指始终保持在键盘的核心区域，就能完成所有的编辑操作</strong></li></ul><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vi/001_vi%E9%94%AE%E7%9B%98.png" alt="001_vi键盘-w551"></p><ul><li><code>vi</code> 的特点：<ul><li><strong>没有图形界面</strong> 的 <strong>功能强大</strong> 的编辑器</li><li>只能是编辑 <strong>文本内容</strong>，不能对字体、段落进行排版</li><li><strong>不支持鼠标操作</strong></li><li><strong>没有菜单</strong></li><li><strong>只有命令</strong></li></ul></li><li><code>vi</code> 编辑器在 <strong>系统管理</strong>、<strong>服务器管理</strong> 编辑文件时，<strong>其功能永远不是图形界面的编辑器能比拟的</strong></li></ul><h4 id="vim"><a href="#vim" class="headerlink" title="vim"></a><code>vim</code></h4><p><strong>vim = vi improved</strong></p><ul><li><code>vim</code> 是从 <code>vi</code> 发展出来的一个文本编辑器，支持 <strong>代码补全</strong>、<strong>编译</strong> 及 <strong>错误跳转</strong> 等方便编程的功能特别丰富，在程序员中被广泛使用，被称为 <strong>编辑器之神</strong></li></ul><h4 id="查询软连接命令（知道）"><a href="#查询软连接命令（知道）" class="headerlink" title="查询软连接命令（知道）"></a>查询软连接命令（知道）</h4><ul><li>在很多 <code>Linux</code> 发行版中直接把 <code>vi</code> 做成 <code>vim</code> 的软连接</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找 vi 的运行文件</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">which</span> vi</span><br><span class="line">$ ls -l /usr/bin/vi</span><br><span class="line">$ ls -l /etc/alternatives/vi</span><br><span class="line">$ ls -l /usr/bin/vim.basic</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找 vim 的运行文件</span></span><br><span class="line">$ <span class="built_in">which</span> vim</span><br><span class="line">$ ls -l /usr/bin/vim</span><br><span class="line">$ ls -l /etc/alternatives/vim</span><br><span class="line">$ ls -l /usr/bin/vim.basic</span><br></pre></td></tr></table></figure><h2 id="02-打开和新建文件"><a href="#02-打开和新建文件" class="headerlink" title="02. 打开和新建文件"></a>02. 打开和新建文件</h2><ul><li>在终端中输入 <code>vi</code> <strong>在后面跟上文件名</strong> 即可</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi 文件名</span><br></pre></td></tr></table></figure><ul><li>如果文件已经存在，会直接打开该文件</li><li>如果文件不存在，会新建一个文件</li></ul><h3 id="2-1-打开文件并且定位行"><a href="#2-1-打开文件并且定位行" class="headerlink" title="2.1 打开文件并且定位行"></a>2.1 打开文件并且定位行</h3><ul><li>在日常工作中，有可能会遇到 <strong>打开一个文件，并定位到指定行</strong> 的情况</li><li><p>例如：在开发时，<strong>知道某一行代码有错误</strong>，可以 <strong>快速定位</strong> 到出错代码的位置</p></li><li><p>这个时候，可以使用以下命令打开文件</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi 文件名 +行数</span><br></pre></td></tr></table></figure><blockquote><p>提示：如果只带上 <code>+</code> 而不指定行号，会直接定位到文件末尾</p></blockquote><h3 id="2-2-异常处理"><a href="#2-2-异常处理" class="headerlink" title="2.2 异常处理"></a>2.2 异常处理</h3><ul><li>如果 <code>vi</code> 异常退出，在磁盘上可能会保存有 <strong>交换文件</strong></li><li>下次再使用 <code>vi</code> 编辑该文件时，会看到以下屏幕信息，按下字母 <code>d</code> 可以 <strong>删除交换文件</strong> 即可</li></ul><blockquote><p>提示：按下键盘时，注意关闭输入法</p></blockquote><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vi/002_%E5%88%A0%E9%99%A4%E4%BA%A4%E6%8D%A2%E6%96%87%E4%BB%B6.png" alt="002_删除交换文件-w1048"></p><h2 id="03-三种工作模式"><a href="#03-三种工作模式" class="headerlink" title="03. 三种工作模式"></a>03. 三种工作模式</h2><ul><li><p><code>vi</code> 有三种基本工作模式：</p><ol><li><strong>命令模式</strong><ul><li><strong>打开文件首先进入命令模式</strong>，是使用 <code>vi</code> 的 <strong>入口</strong></li><li>通过 <strong>命令</strong> 对文件进行常规的编辑操作，例如：<strong>定位</strong>、<strong>翻页</strong>、<strong>复制</strong>、<strong>粘贴</strong>、<strong>删除</strong>……</li><li>在其他图形编辑器下，通过 <strong>快捷键</strong> 或者 <strong>鼠标</strong> 实现的操作，都在 <strong>命令模式</strong> 下实现</li></ul></li><li><strong>末行模式</strong> —— 执行 <strong>保存</strong>、<strong>退出</strong> 等操作 <ul><li>要退出 <code>vi</code> 返回到控制台，需要在末行模式下输入命令</li><li><strong>末行模式</strong> 是 <code>vi</code> 的 <strong>出口</strong></li></ul></li><li><strong>编辑模式</strong> —— 正常的编辑文字</li></ol></li></ul><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vi/003_vi%E7%9A%84%E6%A8%A1%E5%BC%8F.png" alt="003_vi的模式-w500"></p><blockquote><p>提示：在 <code>Touch Bar</code> 的 Mac 电脑上 ，按 <code>ESC</code> 不方便，可以使用 <code>CTRL + [</code> 替代</p></blockquote><h3 id="末行模式命令"><a href="#末行模式命令" class="headerlink" title="末行模式命令"></a>末行模式命令</h3><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">英文</th><th>功能</th></tr></thead><tbody><tr><td style="text-align:center">w</td><td style="text-align:center">write</td><td>保存</td></tr><tr><td style="text-align:center">q</td><td style="text-align:center">quit</td><td>退出，如果没有保存，不允许退出</td></tr><tr><td style="text-align:center">q!</td><td style="text-align:center">quit</td><td>强行退出，不保存退出</td></tr><tr><td style="text-align:center">wq</td><td style="text-align:center">write &amp; quit</td><td>保存并退出</td></tr><tr><td style="text-align:center">x</td><td style="text-align:center"></td><td>保存并退出</td></tr></tbody></table><h2 id="04-常用命令"><a href="#04-常用命令" class="headerlink" title="04. 常用命令"></a>04. 常用命令</h2><h3 id="命令线路图"><a href="#命令线路图" class="headerlink" title="命令线路图"></a>命令线路图</h3><ol start="0"><li>重复次数<ul><li>在命令模式下，<strong>先输入一个数字</strong>，<strong>再跟上一个命令</strong>，可以让该命令 <strong>重复执行指定次数</strong> </li></ul></li><li>移动和选择（<strong>多练</strong>）<ul><li><code>vi</code> 之所以快，关键在于 <strong>能够快速定位到要编辑的代码行</strong></li><li><strong>移动命令</strong> 能够 和 <strong>编辑操作</strong> 命令 <strong>组合使用</strong></li></ul></li><li>编辑操作<ul><li><strong>删除</strong>、<strong>复制</strong>、<strong>粘贴</strong>、<strong>替换</strong>、<strong>缩排</strong></li></ul></li><li>撤销和重复</li><li>查找替换</li><li>编辑</li></ol><h4 id="学习提示"><a href="#学习提示" class="headerlink" title="学习提示"></a>学习提示</h4><ol><li><code>vi</code> 的命令较多，<strong>不要期望一下子全部记住</strong>，个别命令忘记了，只是会影响编辑速度而已</li><li>在使用 <code>vi</code> 命令时，注意 <strong>关闭中文输入法</strong></li></ol><h3 id="4-1-移动（基本）"><a href="#4-1-移动（基本）" class="headerlink" title="4.1 移动（基本）"></a>4.1 移动（基本）</h3><ul><li>要熟练使用 <code>vi</code>，首先应该学会怎么在 <strong>命令模式</strong> 下样快速移动光标</li><li><strong>编辑操作命令</strong>，能够和 <strong>移动命令</strong> 结合在一起使用</li></ul><h4 id="1-上、下、左、右"><a href="#1-上、下、左、右" class="headerlink" title="1) 上、下、左、右"></a>1) 上、下、左、右</h4><table><thead><tr><th style="text-align:center">命令</th><th>功能</th><th style="text-align:center">手指</th></tr></thead><tbody><tr><td style="text-align:center">h</td><td>向左</td><td style="text-align:center">食指</td></tr><tr><td style="text-align:center">j</td><td>向下</td><td style="text-align:center">食指</td></tr><tr><td style="text-align:center">k</td><td>向上</td><td style="text-align:center">中指</td></tr><tr><td style="text-align:center">l</td><td>向右</td><td style="text-align:center">无名指</td></tr></tbody></table><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vi/005_%E7%A7%BB%E5%8A%A8%E5%85%89%E6%A0%87.png" alt="005_移动光标-w551"></p><h4 id="2-行内移动"><a href="#2-行内移动" class="headerlink" title="2) 行内移动"></a>2) 行内移动</h4><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">英文</th><th>功能</th></tr></thead><tbody><tr><td style="text-align:center">w</td><td style="text-align:center">word</td><td>向后移动一个单词</td></tr><tr><td style="text-align:center">b</td><td style="text-align:center">back</td><td>向前移动一个单词</td></tr><tr><td style="text-align:center">0</td><td style="text-align:center"></td><td>行首</td></tr><tr><td style="text-align:center">^</td><td style="text-align:center"></td><td>行首，第一个不是空白字符的位置</td></tr><tr><td style="text-align:center">$</td><td style="text-align:center"></td><td>行尾</td></tr></tbody></table><h4 id="3-行数移动"><a href="#3-行数移动" class="headerlink" title="3) 行数移动"></a>3) 行数移动</h4><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">英文</th><th>功能</th></tr></thead><tbody><tr><td style="text-align:center">gg</td><td style="text-align:center">go</td><td>文件顶部</td></tr><tr><td style="text-align:center">G</td><td style="text-align:center">go</td><td>文件末尾</td></tr><tr><td style="text-align:center">数字gg</td><td style="text-align:center">go</td><td>移动到 数字 对应行数</td></tr><tr><td style="text-align:center">数字G</td><td style="text-align:center">go</td><td>移动到 数字 对应行数</td></tr><tr><td style="text-align:center">:数字</td><td style="text-align:center"></td><td>移动到 数字 对应行数</td></tr></tbody></table><h4 id="4-屏幕移动"><a href="#4-屏幕移动" class="headerlink" title="4) 屏幕移动"></a>4) 屏幕移动</h4><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">英文</th><th>功能</th></tr></thead><tbody><tr><td style="text-align:center">Ctrl + b</td><td style="text-align:center">back</td><td>向上翻页</td></tr><tr><td style="text-align:center">Ctrl + f</td><td style="text-align:center">forward</td><td>向下翻页</td></tr><tr><td style="text-align:center">H</td><td style="text-align:center">Head</td><td>屏幕顶部</td></tr><tr><td style="text-align:center">M</td><td style="text-align:center">Middle</td><td>屏幕中间</td></tr><tr><td style="text-align:center">L</td><td style="text-align:center">Low</td><td>屏幕底部</td></tr></tbody></table><h3 id="4-2-移动（程序）"><a href="#4-2-移动（程序）" class="headerlink" title="4.2 移动（程序）"></a>4.2 移动（程序）</h3><h4 id="1-段落移动"><a href="#1-段落移动" class="headerlink" title="1) 段落移动"></a>1) 段落移动</h4><ul><li><code>vi</code> 中使用 空行 来区分段落</li><li>在程序开发时，通常 <strong>一段功能相关的代码会写在一起</strong> —— 之间没有空行</li></ul><table><thead><tr><th style="text-align:center">命令</th><th>功能</th></tr></thead><tbody><tr><td style="text-align:center">{</td><td>上一段</td></tr><tr><td style="text-align:center">}</td><td>下一段</td></tr></tbody></table><h4 id="2-括号切换"><a href="#2-括号切换" class="headerlink" title="2) 括号切换"></a>2) 括号切换</h4><ul><li>在程序世界中，<code>()</code>、<code>[]</code>、<code>{}</code> 使用频率很高，而且 <strong>都是成对出现的</strong></li></ul><table><thead><tr><th style="text-align:center">命令</th><th>功能</th></tr></thead><tbody><tr><td style="text-align:center">%</td><td>括号匹配及切换</td></tr></tbody></table><h4 id="3-标记"><a href="#3-标记" class="headerlink" title="3) 标记"></a>3) 标记</h4><ul><li>在开发时，某一块代码可能<strong>需要稍后处理</strong>，例如：编辑、查看</li><li>此时先使用 <code>m</code> 增加一个标记，这样可以 <strong>在需要时快速地跳转回来</strong> 或者 <strong>执行其他编辑操作</strong></li><li><strong>标记名称</strong> 可以是 <code>a~z</code> 或者 <code>A~Z</code> 之间的任意 <strong>一个</strong> 字母</li><li>添加了标记的 <strong>行如果被删除</strong>，<strong>标记同时被删除</strong></li><li>如果 <strong>在其他行添加了相同名称的标记</strong>，<strong>之前添加的标记也会被替换掉</strong></li></ul><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">英文</th><th>功能</th></tr></thead><tbody><tr><td style="text-align:center">mx</td><td style="text-align:center">mark</td><td>添加标记 x，x 是 a~z 或者 A~Z 之间的任意一个字母</td></tr><tr><td style="text-align:center">‘x</td><td style="text-align:center"></td><td>直接定位到标记 x 所在位置</td></tr></tbody></table><h3 id="4-3-选中文本（可视模式）"><a href="#4-3-选中文本（可视模式）" class="headerlink" title="4.3 选中文本（可视模式）"></a>4.3 选中文本（可视模式）</h3><ul><li>学习 <code>复制</code> 命令前，应该先学会 <strong>怎么样选中 要复制的代码</strong></li><li>在 <code>vi</code> 中要选择文本，需要先使用 <code>Visual</code> 命令切换到 <strong>可视模式</strong></li><li><code>vi</code> 中提供了 <strong>三种</strong> 可视模式，可以方便程序员选择 <strong>选中文本的方式</strong></li><li>按 <code>ESC</code> 可以放弃选中，返回到 <strong>命令模式</strong></li></ul><table><thead><tr><th style="text-align:center">命令</th><th>模式</th><th>功能</th></tr></thead><tbody><tr><td style="text-align:center">v</td><td>可视模式</td><td>从光标位置开始按照正常模式选择文本</td></tr><tr><td style="text-align:center">V</td><td>可视行模式</td><td>选中光标经过的完整行</td></tr><tr><td style="text-align:center">Ctrl + v</td><td>可视块模式</td><td>垂直方向选中文本</td></tr></tbody></table><ul><li><strong>可视模式</strong>下，可以和 <strong>移动命令</strong> 连用，例如：<code>ggVG</code> 能够选中所有内容</li></ul><h3 id="4-4-撤销和恢复撤销"><a href="#4-4-撤销和恢复撤销" class="headerlink" title="4.4 撤销和恢复撤销"></a>4.4 撤销和恢复撤销</h3><ul><li>在学习编辑命令之前，先要知道怎样撤销之前一次 <strong>错误的</strong> 编辑动作！</li></ul><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">英文</th><th>功能</th></tr></thead><tbody><tr><td style="text-align:center">u</td><td style="text-align:center">undo</td><td>撤销上次命令</td></tr><tr><td style="text-align:center">CTRL + r</td><td style="text-align:center">redo</td><td>恢复撤销的命令</td></tr></tbody></table><h3 id="4-5-删除文本"><a href="#4-5-删除文本" class="headerlink" title="4.5 删除文本"></a>4.5 删除文本</h3><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">英文</th><th>功能</th></tr></thead><tbody><tr><td style="text-align:center">x</td><td style="text-align:center">cut</td><td>删除光标所在字符，或者选中文字</td></tr><tr><td style="text-align:center">d(移动命令)</td><td style="text-align:center">delete</td><td>删除移动命令对应的内容</td></tr><tr><td style="text-align:center">dd</td><td style="text-align:center">delete</td><td>删除光标所在行，可以 ndd 复制多行</td></tr><tr><td style="text-align:center">D</td><td style="text-align:center">delete</td><td>删除至行尾</td></tr></tbody></table><blockquote><p>提示：如果使用 <strong>可视模式</strong> 已经选中了一段文本，那么无论使用 <code>d</code> 还是 <code>x</code>，都可以删除选中文本</p></blockquote><ul><li>删除命令可以和 <strong>移动命令</strong> 连用，以下是常见的组合命令：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* dw        # 从光标位置删除到单词末尾</span><br><span class="line">* d0        # 从光标位置删除到一行的起始位置</span><br><span class="line">* d&#125;        # 从光标位置删除到段落结尾</span><br><span class="line">* ndd       # 从光标位置向下连续删除 n 行</span><br><span class="line">* d代码行G   # 从光标所在行 删除到 指定代码行 之间的所有代码</span><br><span class="line">* d&apos;a       # 从光标所在行 删除到 标记a 之间的所有代码</span><br></pre></td></tr></table></figure><h3 id="4-6-复制、粘贴"><a href="#4-6-复制、粘贴" class="headerlink" title="4.6 复制、粘贴"></a>4.6 复制、粘贴</h3><ul><li><code>vi</code> 中提供有一个 <strong>被复制文本的缓冲区</strong><ul><li><strong>复制</strong> 命令会将选中的文字保存在缓冲区 </li><li><strong>删除</strong> 命令删除的文字会被保存在缓冲区</li><li>在需要的位置，使用 <strong>粘贴</strong> 命令可以将缓冲区的文字插入到光标所在位置</li></ul></li></ul><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">英文</th><th>功能</th></tr></thead><tbody><tr><td style="text-align:center">y(移动命令)</td><td style="text-align:center">copy</td><td>复制</td></tr><tr><td style="text-align:center">yy</td><td style="text-align:center">copy</td><td>复制一行，可以 nyy 复制多行</td></tr><tr><td style="text-align:center">p</td><td style="text-align:center">paste</td><td>粘贴</td></tr></tbody></table><p><strong>提示</strong></p><ul><li>命令 <code>d</code>、<code>x</code> 类似于图形界面的 <strong>剪切操作</strong> —— <code>CTRL + X</code></li><li>命令 <code>y</code> 类似于图形界面的 <strong>复制操作</strong> —— <code>CTRL + C</code></li><li>命令 <code>p</code> 类似于图形界面的 <strong>粘贴操作</strong> —— <code>CTRL + V</code></li><li><code>vi</code> 中的 <strong>文本缓冲区同样只有一个</strong>，如果后续做过 <strong>复制、剪切</strong> 操作，之前缓冲区中的内容会被替换</li></ul><p><strong>注意</strong></p><ul><li><code>vi</code> 中的 <strong>文本缓冲区</strong> 和系统的 <strong>剪贴板</strong> 不是同一个</li><li>所以在其他软件中使用 <code>CTRL + C</code> 复制的内容，不能在 <code>vi</code> 中通过 <code>P</code> 命令粘贴</li><li>可以在 <strong>编辑模式</strong> 下使用 <strong>鼠标右键粘贴</strong></li></ul><h3 id="4-7-替换"><a href="#4-7-替换" class="headerlink" title="4.7 替换"></a>4.7 替换</h3><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">英文</th><th>功能</th><th>工作模式</th></tr></thead><tbody><tr><td style="text-align:center">r</td><td style="text-align:center">replace</td><td>替换当前字符</td><td>命令模式</td></tr><tr><td style="text-align:center">R</td><td style="text-align:center">replace</td><td>替换当前行光标后的字符</td><td>替换模式</td></tr></tbody></table><ul><li><code>R</code> 命令可以进入 <strong>替换模式</strong>，替换完成后，按下 <code>ESC</code> 可以回到 <strong>命令模式</strong></li><li><strong>替换命令</strong> 的作用就是不用进入 <strong>编辑模式</strong>，对文件进行 <strong>轻量级的修改</strong></li></ul><h3 id="4-8-缩排和重复执行"><a href="#4-8-缩排和重复执行" class="headerlink" title="4.8 缩排和重复执行"></a>4.8 缩排和重复执行</h3><table><thead><tr><th style="text-align:center">命令</th><th>功能</th></tr></thead><tbody><tr><td style="text-align:center">&gt;&gt;</td><td>向右增加缩进</td></tr><tr><td style="text-align:center">&lt;&lt;</td><td>向左减少缩进</td></tr><tr><td style="text-align:center">.</td><td>重复上次命令</td></tr></tbody></table><ul><li><strong>缩排命令</strong> 在开发程序时，<strong>统一增加代码的缩进</strong> 比较有用！<ul><li>一次性 <strong>在选中代码前增加 4 个空格</strong>，就叫做 <strong>增加缩进</strong></li><li>一次性 <strong>在选中代码前删除 4 个空格</strong>，就叫做 <strong>减少缩进</strong></li></ul></li><li>在 <strong>可视模式</strong> 下，缩排命令只需要使用 <strong>一个</strong> <code>&gt;</code> 或者 <code>&lt;</code> </li></ul><blockquote><p>在程序中，<strong>缩进</strong> 通常用来表示代码的归属关系</p><ul><li>前面空格越少，代码的级别越高</li><li>前面空格越多，代码的级别越低</li></ul></blockquote><h3 id="4-9-查找"><a href="#4-9-查找" class="headerlink" title="4.9 查找"></a>4.9 查找</h3><h4 id="常规查找"><a href="#常规查找" class="headerlink" title="常规查找"></a>常规查找</h4><table><thead><tr><th style="text-align:center">命令</th><th>功能</th></tr></thead><tbody><tr><td style="text-align:center">/str</td><td>查找 str</td></tr></tbody></table><ul><li>查找到指定内容之后，使用 <code>Next</code> 查找下一个出现的位置：<ul><li><code>n</code>: 查找下一个</li><li><code>N</code>: 查找上一个</li></ul></li><li>如果不想看到高亮显示，可以随便查找一个文件中不存在的内容即可</li></ul><h4 id="单词快速匹配"><a href="#单词快速匹配" class="headerlink" title="单词快速匹配"></a>单词快速匹配</h4><table><thead><tr><th style="text-align:center">命令</th><th>功能</th></tr></thead><tbody><tr><td style="text-align:center">*</td><td>向后查找当前光标所在单词</td></tr><tr><td style="text-align:center">#</td><td>向前查找当前光标所在单词</td></tr></tbody></table><ul><li>在开发中，通过单词快速匹配，可以快速看到这个单词在其他什么位置使用过</li></ul><h3 id="4-10-查找并替换"><a href="#4-10-查找并替换" class="headerlink" title="4.10 查找并替换"></a>4.10 查找并替换</h3><ul><li>在 <code>vi</code> 中查找和替换命令需要在 <strong>末行模式</strong> 下执行</li><li>记忆命令格式：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s///g</span><br></pre></td></tr></table></figure><h4 id="1-全局替换"><a href="#1-全局替换" class="headerlink" title="1) 全局替换"></a>1) 全局替换</h4><ul><li><strong>一次性</strong>替换文件中的 <strong>所有出现的旧文本</strong></li><li>命令格式如下：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s/旧文本/新文本/g</span><br></pre></td></tr></table></figure><h4 id="2-可视区域替换"><a href="#2-可视区域替换" class="headerlink" title="2) 可视区域替换"></a>2) 可视区域替换</h4><ul><li><strong>先选中</strong> 要替换文字的 <strong>范围</strong></li><li>命令格式如下：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:s/旧文本/新文本/g</span><br></pre></td></tr></table></figure><h4 id="3-确认替换"><a href="#3-确认替换" class="headerlink" title="3) 确认替换"></a>3) 确认替换</h4><ul><li>如果把末尾的 <code>g</code> 改成 <code>gc</code> 在替换的时候，会有提示！<strong>推荐使用！</strong></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s/旧文本/新文本/gc</span><br></pre></td></tr></table></figure><ol><li><code>y</code> - <code>yes</code> 替换</li><li><code>n</code> - <code>no</code> 不替换</li><li><code>a</code> - <code>all</code> 替换所有</li><li><code>q</code> - <code>quit</code> 退出替换</li><li><code>l</code> - <code>last</code> 最后一个，并把光标移动到行首</li><li><code>^E</code> 向下滚屏</li><li><code>^Y</code> 向上滚屏</li></ol><h3 id="4-11-插入命令"><a href="#4-11-插入命令" class="headerlink" title="4.11 插入命令"></a>4.11 插入命令</h3><ul><li>在 <code>vi</code> 中除了常用的 <code>i</code> 进入 <strong>编辑模式</strong> 外，还提供了以下命令同样可以进入编辑模式：</li></ul><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">英文</th><th>功能</th><th style="text-align:center">常用</th></tr></thead><tbody><tr><td style="text-align:center">i</td><td style="text-align:center">insert</td><td>在当前字符前插入文本</td><td style="text-align:center">常用</td></tr><tr><td style="text-align:center">I</td><td style="text-align:center">insert</td><td>在行首插入文本</td><td style="text-align:center">较常用</td></tr><tr><td style="text-align:center">a</td><td style="text-align:center">append</td><td>在当前字符后添加文本</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">A</td><td style="text-align:center">append</td><td>在行末添加文本</td><td style="text-align:center">较常用</td></tr><tr><td style="text-align:center">o</td><td style="text-align:center"></td><td>在当前行后面插入一空行</td><td style="text-align:center">常用</td></tr><tr><td style="text-align:center">O</td><td style="text-align:center"></td><td>在当前行前面插入一空行</td><td style="text-align:center">常用</td></tr></tbody></table><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vi/004_%E6%8F%92%E5%85%A5%E5%91%BD%E4%BB%A4.png" alt="004_插入命令-w400"></p><h4 id="演练-1-——-编辑命令和数字连用"><a href="#演练-1-——-编辑命令和数字连用" class="headerlink" title="演练 1 —— 编辑命令和数字连用"></a>演练 1 —— 编辑命令和数字连用</h4><ul><li>在开发中，可能会遇到连续输入 <code>N</code> 个同样的字符</li></ul><blockquote><p>在 <code>Python</code> 中有简单的方法，但是其他语言中通常需要自己输入</p></blockquote><ul><li>例如：<code>**********</code> 连续 10 个星号</li></ul><p>要实现这个效果可以在 <strong>命令模式</strong> 下</p><ol><li>输入 <code>10</code>，表示要重复 10 次</li><li>输入 <code>i</code> 进入 <strong>编辑模式</strong></li><li>输入 <code>*</code> 也就是重复的文字</li><li>按下 <code>ESC</code> 返回到 <strong>命令模式</strong>，返回之后 <code>vi</code> 就会把第 <code>2、3</code> 两步的操作重复 <code>10</code> 次</li></ol><blockquote><p>提示：正常开发时，在 <strong>进入编辑模式之前，不要按数字</strong></p></blockquote><h4 id="演练-2-——-利用-可视块-给多行代码增加注释"><a href="#演练-2-——-利用-可视块-给多行代码增加注释" class="headerlink" title="演练 2 —— 利用 可视块 给多行代码增加注释"></a>演练 2 —— 利用 可视块 给多行代码增加注释</h4><ul><li>在开发中，可能会遇到一次性给多行代码 <strong>增加注释</strong> 的情况</li></ul><blockquote><p>在 <code>Python</code> 中，要给代码增加注释，可以在代码前增加一个 <code>#</code></p></blockquote><p>要实现这个效果可以在 <strong>命令模式</strong> 下</p><ol><li>移动到要添加注释的 <strong>第 1 行代码</strong>，按 <code>^</code> 来到行首</li><li>按 <code>CTRL + v</code> 进入 <strong>可视块</strong> 模式</li><li>使用 <code>j</code> 向下连续选中要添加的代码行</li><li>输入 <code>I</code> 进入 <strong>编辑模式</strong>，并在 <strong>行首插入</strong>，注意：一定要使用 <strong>I</strong></li><li>输入 <code>#</code> 也就是注释符号</li><li>按下 <code>ESC</code> 返回到 <strong>命令模式</strong>，返回之后 <code>vi</code> 会在之前选中的每一行代码 <strong>前</strong> 插入 <code>#</code></li></ol><h2 id="05-分屏命令"><a href="#05-分屏命令" class="headerlink" title="05. 分屏命令"></a>05. 分屏命令</h2><ul><li>属于 <code>vi</code> 的高级命令 —— 可以 <strong>同时编辑和查看多个文件</strong></li></ul><h3 id="5-1-末行命令扩展"><a href="#5-1-末行命令扩展" class="headerlink" title="5.1 末行命令扩展"></a>5.1 末行命令扩展</h3><p><strong>末行命令</strong> 主要是针对文件进行操作的：<strong>保存</strong>、<strong>退出</strong>、<strong>保存&amp;退出</strong>、<strong>搜索&amp;替换</strong>、<strong>另存</strong>、<strong>新建</strong>、<strong>浏览文件</strong></p><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">英文</th><th>功能</th></tr></thead><tbody><tr><td style="text-align:center">:e .</td><td style="text-align:center">edit</td><td>会打开内置的文件浏览器，浏览要当前目录下的文件</td></tr><tr><td style="text-align:center">:n 文件名</td><td style="text-align:center">new</td><td>新建文件</td></tr><tr><td style="text-align:center">:w 文件名</td><td style="text-align:center">write</td><td>另存为，但是仍然编辑当前文件，并不会切换文件</td></tr></tbody></table><blockquote><p>提示：切换文件之前，必须保证当前这个文件已经被保存！</p></blockquote><ul><li>已经学习过的 <strong>末行命令</strong>：</li></ul><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">英文</th><th>功能</th></tr></thead><tbody><tr><td style="text-align:center">:w</td><td style="text-align:center">write</td><td>保存</td></tr><tr><td style="text-align:center">:q</td><td style="text-align:center">quit</td><td>退出，如果没有保存，不允许退出</td></tr><tr><td style="text-align:center">:q!</td><td style="text-align:center">quit</td><td>强行退出，不保存退出</td></tr><tr><td style="text-align:center">:wq</td><td style="text-align:center">write &amp; quit</td><td>保存并退出</td></tr><tr><td style="text-align:center">:x</td><td style="text-align:center"></td><td>保存并退出</td></tr><tr><td style="text-align:center">:%s///gc</td><td style="text-align:center"></td><td>确认搜索并替换</td></tr></tbody></table><blockquote><p>在实际开发中，可以使用 <code>w</code> 命令 <strong>阶段性的备份代码</strong></p></blockquote><h3 id="5-2-分屏命令"><a href="#5-2-分屏命令" class="headerlink" title="5.2 分屏命令"></a>5.2 分屏命令</h3><ul><li>使用 <strong>分屏命令</strong>，可以 <strong>同时编辑和查看多个文件</strong></li></ul><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">英文</th><th>功能</th></tr></thead><tbody><tr><td style="text-align:center">:sp [文件名]</td><td style="text-align:center">split</td><td>横向增加分屏</td></tr><tr><td style="text-align:center">:vsp [文件名]</td><td style="text-align:center">vertical split</td><td>纵向增加分屏</td></tr></tbody></table><h4 id="1-切换分屏窗口"><a href="#1-切换分屏窗口" class="headerlink" title="1) 切换分屏窗口"></a>1) 切换分屏窗口</h4><blockquote><p>分屏窗口都是基于 <code>CTRL + W</code> 这个快捷键的，<code>w</code> 对应的英文单词是 <code>window</code></p></blockquote><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">英文</th><th>功能</th></tr></thead><tbody><tr><td style="text-align:center">w</td><td style="text-align:center">window</td><td>切换到下一个窗口</td></tr><tr><td style="text-align:center">r</td><td style="text-align:center">reverse</td><td>互换窗口</td></tr><tr><td style="text-align:center">c</td><td style="text-align:center">close</td><td>关闭当前窗口，但是不能关闭最后一个窗口</td></tr><tr><td style="text-align:center">q</td><td style="text-align:center">quit</td><td>退出当前窗口，如果是最后一个窗口，则关闭 vi</td></tr><tr><td style="text-align:center">o</td><td style="text-align:center">other</td><td>关闭其他窗口</td></tr></tbody></table><h4 id="2-调整窗口大小"><a href="#2-调整窗口大小" class="headerlink" title="2) 调整窗口大小"></a>2) 调整窗口大小</h4><blockquote><p>分屏窗口都是基于 <code>CTRL + W</code> 这个快捷键的，<code>w</code> 对应的英文单词是 <code>window</code></p></blockquote><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">英文</th><th>功能</th></tr></thead><tbody><tr><td style="text-align:center">+</td><td style="text-align:center"></td><td>增加窗口高度</td></tr><tr><td style="text-align:center">-</td><td style="text-align:center"></td><td>减少窗口高度</td></tr><tr><td style="text-align:center">&gt;</td><td style="text-align:center"></td><td>增加窗口宽度</td></tr><tr><td style="text-align:center">&lt;</td><td style="text-align:center"></td><td>减少窗口宽度</td></tr><tr><td style="text-align:center">=</td><td style="text-align:center"></td><td>等分窗口大小</td></tr></tbody></table><blockquote><p>调整窗口宽高的命令可以和数字连用，例如：<code>5 CTRL + W +</code> 连续 5 次增加高度</p></blockquote><h2 id="06-常用命令速查图"><a href="#06-常用命令速查图" class="headerlink" title="06. 常用命令速查图"></a>06. 常用命令速查图</h2><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vi/vim.png" alt="vi"></p><h3 id="vimrc"><a href="#vimrc" class="headerlink" title="vimrc"></a>vimrc</h3><ul><li><code>vimrc</code> 是 <code>vim</code> 的配置文件，可以设置 vim 的配置，包括：<strong>热键</strong>、<strong>配色</strong>、<strong>语法高亮</strong>、<strong>插件</strong> 等</li><li><code>Linux</code> 中 <code>vimrc</code> 有两个位置，<strong>家目录下的配置文件优先级更高</strong></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/vim/vimrc</span><br><span class="line">~/.vimrc</span><br></pre></td></tr></table></figure><ul><li>常用的插件有：<ul><li>代码补全</li><li>代码折叠</li><li>搜索</li><li>Git 集成</li><li>……</li></ul></li><li>网上有很多高手已经配置好的针对 <code>python</code> 开发的 <code>vimrc</code> 文件，可以下载过来直接使用，或者等大家多 <code>Linux</code> 比较熟悉后，再行学习！</li></ul>]]></content>
      
      
      <categories>
          
          <category> vi/vim </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> vi/vim </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>我的踩坑合集</title>
      <link href="/2019/06/06/%E6%88%91%E7%9A%84%E8%B8%A9%E5%9D%91%E5%90%88%E9%9B%86.html"/>
      <url>/2019/06/06/%E6%88%91%E7%9A%84%E8%B8%A9%E5%9D%91%E5%90%88%E9%9B%86.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><ul><li><p><a href="https://blog.csdn.net/weixin_42590838/article/details/103800092" target="_blank" rel="noopener">Invalid CSS after “body”: expected 1 selector or at-rule, was “{“</a></p></li><li><p><a href="http://www.yuxang.com/vue-%e4%b8%ad%e5%9b%be%e7%89%87%e6%b7%bb%e5%8a%a0url-%e7%9a%84%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9/" target="_blank" rel="noopener">vue 中图片添加url 的注意事项</a>  👈讲的是vue中若img src使用的是data中存储图片路径的变量，则必须使用require或import引用；若img src直接写的路径则OK。</p></li><li><p><a href="https://segmentfault.com/a/1190000010984731" target="_blank" rel="noopener">node-sass安装失败</a></p></li></ul><ul><li><a href="https://vuex.vuejs.org/zh/guide/mutations.html#mutation-%E9%9C%80%E9%81%B5%E5%AE%88-vue-%E7%9A%84%E5%93%8D%E5%BA%94%E8%A7%84%E5%88%99" target="_blank" rel="noopener">Mutation 需遵守 Vue 的响应规则</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> bug </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue音乐播放器(二)</title>
      <link href="/2019/06/05/02Vue%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8.html"/>
      <url>/2019/06/05/02Vue%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h1 id="推荐页面开发"><a href="#推荐页面开发" class="headerlink" title="推荐页面开发"></a>推荐页面开发</h1><h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><p><a href="https://github.com/Dunteng/Vue-Music-WebApp/tree/v3/vue-music" target="_blank" rel="noopener">完成轮播图时</a></p><p><a href="https://github.com/Dunteng/Vue-Music-WebApp/tree/v4/vue-music" target="_blank" rel="noopener">完成歌单列表时</a></p><p><br><br></p><h2 id="better-scroll插件"><a href="#better-scroll插件" class="headerlink" title="better-scroll插件"></a>better-scroll插件</h2><p><a href="https://github.com/ustbhuangyi/better-scroll/blob/master/README_zh-CN.md" target="_blank" rel="noopener">中文文档</a></p><p><a href="https://ustbhuangyi.github.io/better-scroll/#/" target="_blank" rel="noopener">1.x Docs</a></p><p><a href="https://better-scroll.github.io/docs/en-US/" target="_blank" rel="noopener">2.x Docs</a></p><p>之后的轮播图组件和列表滚动组件都会用到这个插件。这个插件还挺牛逼的，9400+stars。</p><p><br><br></p><h2 id="QQ音乐的api"><a href="#QQ音乐的api" class="headerlink" title="QQ音乐的api"></a>QQ音乐的api</h2><ul><li><p>jsonp用到的：</p><p><a href="https://c.y.qq.com/musichall/fcgi-bin/fcg_yqqhomepagerecommend.fcg" target="_blank" rel="noopener">https://c.y.qq.com/musichall/fcgi-bin/fcg_yqqhomepagerecommend.fcg</a></p></li><li><p>axios/Ajax用到的：</p><p>在webpack.dev.conf.js中配置，见下文</p></li></ul><p><br><br></p><h2 id="【重点难点一】recommend页面jsonp相关文件的编写"><a href="#【重点难点一】recommend页面jsonp相关文件的编写" class="headerlink" title="【重点难点一】recommend页面jsonp相关文件的编写"></a>【重点难点一】recommend页面jsonp相关文件的编写</h2><h3 id="src-common-js-jsonp-js-promise封装"><a href="#src-common-js-jsonp-js-promise封装" class="headerlink" title="src/common/js/jsonp.js  promise封装"></a>src/common/js/jsonp.js  promise封装</h3><p>本项目该部分使用jsonp技术获取数据，解决跨域问题。</p><p>这里使用一个封装好的<a href="https://github.com/webmodules/jsonp" target="_blank" rel="noopener">jsonp插件</a>。这是它的API :</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1560407149676.png" alt="1560407149676"></p><p>利用这个插件里面提供的api进行<strong>Promise</strong>的改写—-&gt; jsonp.js的创建。</p><p>先<code>npm i jsonp</code>进行jsonp插件的安装。</p><p>之后会经常用到它，把他放在js文件夹下，然后编写src/common/js/jsonp.js:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> originJsonp <span class="keyword">from</span> <span class="string">'jsonp'</span></span><br><span class="line"><span class="comment">/* jsonp2这个函数的三个参数，url是一个干净的不带参数的url地址，data表示随同url传过去的参数，</span></span><br><span class="line"><span class="comment">  因为jsonp这个插件要求的url是不支持object类型的的data参数的，所以我们需要先将data里面的数据拼接到url上。</span></span><br><span class="line"><span class="comment">  第三个参数option对应jsonp插件api里的opts参数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">jsonp2</span>(<span class="params">url, data, option</span>) </span>&#123;</span><br><span class="line">  url += (url.indexOf(<span class="string">'?'</span>) &lt; <span class="number">0</span> ? <span class="string">'?'</span> : <span class="string">'&amp;'</span>) + param(data)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    originJsonp(url, option, (err, data) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">        resolve(data)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        reject(err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">param</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> url = <span class="string">''</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> data) &#123;</span><br><span class="line">    <span class="keyword">let</span> value = data[k] !== <span class="literal">undefined</span> ? data[k] : <span class="string">''</span></span><br><span class="line">    url += <span class="string">'&amp;'</span> + k + <span class="string">'='</span> + <span class="built_in">encodeURIComponent</span>(value)<span class="comment">/* encodeURIComponent(value)进行字符转义，如encodeURIComponent('百度')转为"%E7%99%BE%E5%BA%A6" */</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> url ? url.substring(<span class="number">1</span>) : <span class="string">''</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>我们把请求api数据相关的js放在<code>src/api</code>目录下</p><p><br></p><h3 id="src-api-config-js"><a href="#src-api-config-js" class="headerlink" title="src/api/config.js"></a>src/api/config.js</h3><p>这部分主要就是模拟qq音乐api的参数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> commonParams = &#123;</span><br><span class="line">  g_tk: <span class="number">5381</span>,</span><br><span class="line">  inCharset: <span class="string">'utf-8'</span>,</span><br><span class="line">  outCharset: <span class="string">'utf-8'</span>,</span><br><span class="line">  notice: <span class="number">0</span>,</span><br><span class="line">  format: <span class="string">'jsonp'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> options = &#123;</span><br><span class="line">  param: <span class="string">'jsonpCallback'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ERR_OK = <span class="number">0</span>  <span class="comment">/* 语义化一下 */</span></span><br></pre></td></tr></table></figure><p><br></p><h3 id="src-api-recommend-js"><a href="#src-api-recommend-js" class="headerlink" title="src/api/recommend.js:"></a>src/api/recommend.js:</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jsonp <span class="keyword">from</span> <span class="string">'common/js/jsonp'</span></span><br><span class="line"><span class="keyword">import</span> &#123;commonParams, options&#125; <span class="keyword">from</span> <span class="string">'./config'</span></span><br><span class="line"><span class="comment">// import axios from 'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getRecommend</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> url = <span class="string">'https://c.y.qq.com/musichall/fcgi-bin/fcg_yqqhomepagerecommend.fcg'</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> data = <span class="built_in">Object</span>.assign(&#123;&#125;, commonParams, &#123;</span><br><span class="line">    platform: <span class="string">'h5'</span>,</span><br><span class="line">    uin: <span class="number">0</span>,</span><br><span class="line">    needNewCode: <span class="number">1</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> jsonp(url, data, options)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><h3 id="webpack-base-conf-js"><a href="#webpack-base-conf-js" class="headerlink" title="webpack.base.conf.js"></a>webpack.base.conf.js</h3><p>添加多两个别名：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">alias: &#123;</span><br><span class="line">  &apos;@&apos;: resolve(&apos;src&apos;),</span><br><span class="line">  &apos;common&apos;: resolve(&apos;src/common&apos;),</span><br><span class="line">  &apos;components&apos;: resolve(&apos;src/components&apos;),</span><br><span class="line">  &apos;base&apos;: resolve(&apos;src/base&apos;),</span><br><span class="line">  &apos;api&apos;: resolve(&apos;src/api&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><h3 id="recommend-vue"><a href="#recommend-vue" class="headerlink" title="recommend.vue"></a>recommend.vue</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;recommend&quot; ref=&quot;recommend&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/ecmascript-6&quot;&gt;</span><br><span class="line">  import &#123;getRecommend&#125; from &apos;api/recommend&apos;</span><br><span class="line">  import &#123;ERR_OK&#125; from &apos;api/config&apos;</span><br><span class="line"></span><br><span class="line">  export default &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        recommends: [],</span><br><span class="line">        discList: []</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line">      this._getRecommend()</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      _getRecommend() &#123;</span><br><span class="line">        getRecommend().then((res) =&gt; &#123;</span><br><span class="line">          if (res.code === ERR_OK) &#123;</span><br><span class="line">            this.recommends = res.data.slider</span><br><span class="line">            console.log(res);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang=&quot;stylus&quot; rel=&quot;stylesheet/stylus&quot;&gt;</span><br></pre></td></tr></table></figure><p>看一下这时候有没有抓取到数据：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1560411184376.png" alt="1560411184376"></p><p><br><br></p><h2 id="轮播图组件"><a href="#轮播图组件" class="headerlink" title="轮播图组件"></a>轮播图组件</h2><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><p>这里用到一个插件<a href="https://github.com/ustbhuangyi/better-scroll" target="_blank" rel="noopener">better-scroll</a></p><p><a href="https://ustbhuangyi.github.io/better-scroll/doc/zh-hans/#better-scroll%20%E6%98%AF%E4%BB%80%E4%B9%88" target="_blank" rel="noopener">better-scroll文档</a></p><p><br><br></p><h3 id="插播一个小技巧：抽出一个“添加类名”组件dom-js"><a href="#插播一个小技巧：抽出一个“添加类名”组件dom-js" class="headerlink" title="插播一个小技巧：抽出一个“添加类名”组件dom.js"></a>插播一个小技巧：抽出一个“添加类名”组件dom.js</h3><p>在轮播图组件的编写过程中，编写 _setSliderWidth() 方法的代码中，要遍历某个节点的子节点，给它加上一个类名，这是一个常见的操作。比起直接在 _setSliderWidth() 里面实现，最好的方法是把该操作抽离成为一个js文件。</p><p>于是新建了src/common/js/dom.js，在里面实现了添加类名的操作并暴露出去：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * dom操作相关的代码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">hasClass</span>(<span class="params">el, className</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'(^|\\s)'</span> + className + <span class="string">'(\\s|$)'</span>)</span><br><span class="line">    <span class="keyword">return</span> reg.test(el.className)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addClass</span>(<span class="params">el, className</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (hasClass(el, className)) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> newClass = el.className.split(<span class="string">' '</span>)</span><br><span class="line">    newClass.push(className)</span><br><span class="line">    el.className = newClass.join(<span class="string">' '</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>而这个dom.js以后就专门来存放常见的dom操作。</p><p><br><br></p><h3 id="踩坑记录"><a href="#踩坑记录" class="headerlink" title="踩坑记录"></a>踩坑记录</h3><ol><li><p>recommend.vue中引用slider组件，而slider.vue中的 <code>_setSliderWidth()</code>方法里面循环渲染dom节点。但是我一开始的recommend.vue的代码中没有实现判断是否成功获取到了数据并渲染了节点，因为获取的是真实数据存在异步过程，如果没有加上这句<code>v-if=&quot;recommends.length&quot;</code>的话，可能存在recommend.vue页面还没有成功获取数据渲染节点，而引用slider组件导致slider中 <code>_setSliderWidth()</code>方法里面循环渲染dom节点出错，最终导致页面报销的状况。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;recommend&quot; ref=&quot;recommend&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;recommend-content&quot;&gt;</span><br><span class="line">        &lt;div v-if=&quot;recommends.length&quot; class=&quot;slider-wrapper&quot;&gt;&lt;!-- 注意这里用了v-if来确保只有当成功获取到数据后才将slider组件添加上，从而保证slider中的循环渲染成功 --&gt;</span><br><span class="line">            &lt;slider&gt;</span><br><span class="line">                &lt;div v-for=&quot;item in recommends&quot; :key=&quot;item.id&quot;&gt;</span><br><span class="line">                    &lt;a :href=&quot;item.linkUrl&quot;&gt;</span><br><span class="line">                        &lt;img :src=&quot;item.picUrl&quot; alt=&quot;&quot;&gt;</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/slider&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p><br></p></li><li><p>better-scroll默认会复制轮播图的首尾两张图（这里说成“图”不太准确，姑且这么说），因此通过api获得的轮播图图片只有5张，但是在使用better-scroll的时候生成了7个节点。相应的在slider.vue的<code>_setSliderWidth</code>中要设置增加两张图的宽度：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">_setSliderWidth(isResize) &#123;</span><br><span class="line">  <span class="keyword">this</span>.children = <span class="keyword">this</span>.$refs.sliderGroup.children;</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">let</span> width = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> sliderWidth = <span class="keyword">this</span>.$refs.slider.clientWidth;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.children.length; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> child = <span class="keyword">this</span>.children[i];</span><br><span class="line">    addClass(child, <span class="string">"slider-item"</span>);</span><br><span class="line">   </span><br><span class="line">    child.style.width = sliderWidth + <span class="string">"px"</span>;</span><br><span class="line">    width += sliderWidth;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.loop &amp;&amp; !isResize) &#123;</span><br><span class="line">    width += <span class="number">2</span> * sliderWidth; <span class="comment">/* 加多左右两个轮播图的宽度，为了实现无缝流畅滚动，不会噌的一下跳过去 */</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.$refs.sliderGroup.style.width = width + <span class="string">"px"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p></li><li><p>有个<strong>bug</strong></p><p>无法实现自动的无缝轮播，轮播到最后一张的时候就不动了，必须手动划一下才能无缝轮播。暂未解决，怀疑是better-scroll的问题。目前的妥协是最后一张直接跳转到第一张，就很难看。。。</p><p><br></p></li><li><p>实现窗口改变的时候自适应</p><p>在mounted钩子函数中监听一下窗口的改变事件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/* 监听窗口改变事件 */</span></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'resize'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.slider) &#123;<span class="comment">/* 如果slider还未初始化，直接退出 */</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>._setSliderWidth()</span><br><span class="line">  <span class="keyword">this</span>.slider.refresh()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br></p></li><li><p>优化：减少重复的数据请求</p><p>打开项目的时候轮播图会发起数据请求，但是当从首页推荐页切换路由到其他页面，再从其他页面切换回轮播图所在的首页推荐页面时，它又重新刷新发起了数据请求，这是没必要的，而且降低了性能。</p><p>可以使用<code>&lt;keepalive&gt;</code>标签将<code>&lt;router-view&gt;</code>包裹起来，将其dom缓存到内存中。这就避免了上述的情况。</p><p><br></p></li><li><p>优化：beforeDestroy清除计时器释放内存</p><p>路由切换的时候会触发vue的destroy，那么最好时把slider的计算器清除了以释放内存</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">beforeDestroy() &#123;</span><br><span class="line">  clearTimeout(this.timer)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li></ol><p><br><br></p><h2 id="【重点难点二】axios与后端接口代理"><a href="#【重点难点二】axios与后端接口代理" class="headerlink" title="【重点难点二】axios与后端接口代理"></a>【重点难点二】axios与后端接口代理</h2><p>先安装axios依赖</p><h3 id="修改代理"><a href="#修改代理" class="headerlink" title="修改代理"></a>修改代理</h3><p>在使用QQ音乐推荐页歌单列表的api时，发现无法通过ajax获取到。关键点是QQ音乐设置了请求头中的Host和Referer进行了限制：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1561392420142.png" alt="1561392420142"></p><p>因此需要解决这个跨域的问题。方法是<strong>修改代理</strong>。</p><p><br></p><h3 id="修改webpack-dev-conf-js"><a href="#修改webpack-dev-conf-js" class="headerlink" title="修改webpack.dev.conf.js"></a>修改webpack.dev.conf.js</h3><p><a href="https://github.com/ustbhuangyi/vue-music/issues/82" target="_blank" rel="noopener">【相关参考】</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">  devServer: &#123;</span><br><span class="line">    before(app) &#123;</span><br><span class="line">      app.get(<span class="string">'/api/getDiscList'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> url = <span class="string">'https://c.y.qq.com/splcloud/fcgi-bin/fcg_get_diss_by_tag.fcg'</span></span><br><span class="line">        axios.get(url, &#123;</span><br><span class="line">          headers: &#123;</span><br><span class="line">            referer: <span class="string">'https://c.y.qq.com/'</span>,</span><br><span class="line">            host: <span class="string">'c.y.qq.com'</span></span><br><span class="line">          &#125;,</span><br><span class="line">          params: req.query</span><br><span class="line">        &#125;).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">          res.json(response.data)</span><br><span class="line">        &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(e)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      </span><br><span class="line">      ...</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><h3 id="src-api-recommend-js-1"><a href="#src-api-recommend-js-1" class="headerlink" title="src/api/recommend.js"></a>src/api/recommend.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jsonp <span class="keyword">from</span> <span class="string">'common/js/jsonp'</span></span><br><span class="line"><span class="keyword">import</span> &#123; commonParams, options &#125; <span class="keyword">from</span> <span class="string">'./config'</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getRecommend</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">'https://c.y.qq.com/musichall/fcgi-bin/fcg_yqqhomepagerecommend.fcg'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> data = <span class="built_in">Object</span>.assign(&#123;&#125;, commonParams, &#123;</span><br><span class="line">        platform: <span class="string">'h5'</span>,</span><br><span class="line">        uin: <span class="number">0</span>,</span><br><span class="line">        needNewCode: <span class="number">1</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jsonp(url, data, options)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getDiscList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">'/api/getDiscList'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> data = <span class="built_in">Object</span>.assign(&#123;&#125;, commonParams, &#123;</span><br><span class="line">        platform: <span class="string">'yqq'</span>,</span><br><span class="line">        hostUin: <span class="number">0</span>,</span><br><span class="line">        sin: <span class="number">0</span>,</span><br><span class="line">        ein: <span class="number">29</span>,</span><br><span class="line">        sortId: <span class="number">5</span>,</span><br><span class="line">        needNewCode: <span class="number">0</span>,</span><br><span class="line">        categoryId: <span class="number">10000000</span>,</span><br><span class="line">        rnd: <span class="built_in">Math</span>.random(),</span><br><span class="line">        format: <span class="string">'json'</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> axios.get(url, &#123;</span><br><span class="line">        params: data</span><br><span class="line">    &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(res.data)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在recommend.vue中调用getDiscList()方法就能成功获取到数据了。</p><p><br></p><p>这时候启动项目，可以在chrome Network中看到发送了Ajax请求并成功获得了数据：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1560566255358.png" alt="1560566255358"></p><p><br><br></p><h2 id="歌单列表组件开发"><a href="#歌单列表组件开发" class="headerlink" title="歌单列表组件开发"></a>歌单列表组件开发</h2><p>通过上一步改变qq音乐api的接口代理，在recommend.vue调用getDiscList方法获取到数据，并渲染到页面上。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1560578229727.png" alt="1560578229727"></p><p>但是到这一步为止，页面尚无法上下滑动。还是需要better-scroll组件来创建一个歌单列表滚动组件。</p><p><br></p><h3 id="src-base-scroll-scroll-vue"><a href="#src-base-scroll-scroll-vue" class="headerlink" title="src/base/scroll/scroll.vue"></a>src/base/scroll/scroll.vue</h3><p>创建/src/base/scroll/scroll.vue:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div ref=&quot;wrapper&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/ecmascript-6&quot;&gt;</span><br><span class="line">  import BScroll from &apos;better-scroll&apos;</span><br><span class="line"></span><br><span class="line">  export default &#123;</span><br><span class="line">    props: &#123;</span><br><span class="line">      probeType: &#123;</span><br><span class="line">        type: Number,</span><br><span class="line">        default: 1</span><br><span class="line">      &#125;,</span><br><span class="line">      click: &#123;</span><br><span class="line">        type: Boolean,</span><br><span class="line">        default: true</span><br><span class="line">      &#125;,</span><br><span class="line">      data: &#123;</span><br><span class="line">        type: Array,</span><br><span class="line">        default: null</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted() &#123;</span><br><span class="line">      setTimeout(() =&gt; &#123;</span><br><span class="line">        this._initScroll()</span><br><span class="line">      &#125;, 20)</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      _initScroll() &#123;</span><br><span class="line">        if (!this.$refs.wrapper) &#123;</span><br><span class="line">          return</span><br><span class="line">        &#125;</span><br><span class="line">        this.scroll = new BScroll(this.$refs.wrapper, &#123;</span><br><span class="line">          probeType: this.probeType,</span><br><span class="line">          click: this.click</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      enable() &#123;</span><br><span class="line">        this.scroll &amp;&amp; this.scroll.enable()/* better-scroll的api，启用 better-scroll, 默认 开启 */</span><br><span class="line">      &#125;,</span><br><span class="line">      disable() &#123;</span><br><span class="line">        this.scroll &amp;&amp; this.scroll.disable()/* better-scroll的api，禁用 better-scroll，DOM 事件（如 touchstart、touchmove、touchend）的回调函数不再响应。 */</span><br><span class="line">      &#125;,</span><br><span class="line">      refresh() &#123;</span><br><span class="line">        this.scroll &amp;&amp; this.scroll.refresh()/* 重新计算 better-scroll，当 DOM 结构发生变化的时候务必要调用确保滚动的效果正常。 */</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    watch: &#123;</span><br><span class="line">      data() &#123;  /* 监听数据改变立即刷新 */</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">          this.refresh()</span><br><span class="line">        &#125;, 20)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang=&quot;stylus&quot; rel=&quot;stylesheet/stylus&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><br></p><h3 id="src-components-recommend-recommend-vue"><a href="#src-components-recommend-recommend-vue" class="headerlink" title="src/components/recommend/recommend.vue"></a>src/components/recommend/recommend.vue</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;recommend&quot; ref=&quot;recommend&quot;&gt;</span><br><span class="line">    &lt;scroll ref=&quot;scroll&quot; class=&quot;recommend-content&quot; :data=&apos;discList&apos;&gt;&lt;!-- 注意这里的:data如果没有加的话依旧是不能上下滑动的，因为scroll是在mounted时候初始化，由于数据获取存在异步性，可能mounted的时候尚未取到数据，整个列表dom的高度是没有被撑开的以至于better-scroll无法正确初始化。所以需要传入一个discList数据（discList有说明数据已经获取到了）触发scroll的watch里面的refresh --&gt;</span><br><span class="line">      &lt;div&gt; &lt;!-- 注意，better-scroll的scroll标签下只能是一个div包裹全部，如果这个div不把轮播图和列表都包裹起来的话，效果是只有歌单列表滚动，轮播图是固定的，那就糟了 --&gt;</span><br><span class="line">      &lt;div v-if=&quot;recommends.length&quot; class=&quot;slider-wrapper&quot;&gt;</span><br><span class="line">        &lt;!-- 注意这里用了v-if来确保只有当成功获取到数据后才将slider组件添加上，从而保证slider中的循环渲染成功 --&gt;</span><br><span class="line">        &lt;slider&gt;</span><br><span class="line">          &lt;div v-for=&quot;item in recommends&quot; :key=&quot;item.id&quot;&gt;</span><br><span class="line">            &lt;a :href=&quot;item.linkUrl&quot;&gt;</span><br><span class="line">              &lt;img  @load=&quot;loadImage&quot; :src=&quot;item.picUrl&quot;&gt;&lt;!-- 通过@load事件监听图片加载完成了没有，一旦获加载完就refresh scroll --&gt;</span><br><span class="line">            &lt;/a&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/slider&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;recommend-list&quot;&gt;</span><br><span class="line">        &lt;h1 class=&quot;list-title&quot;&gt;热门歌单推荐&lt;/h1&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">          &lt;li class=&quot;item&quot; v-for=&quot;item in discList&quot; :key=&quot;item.dissid&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;icon&quot;&gt;</span><br><span class="line">              &lt;img :src=&quot;item.imgurl&quot; width=&quot;60&quot; height=&quot;60&quot; alt&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;text&quot;&gt;</span><br><span class="line">                &lt;h2 class=&quot;name&quot; v-html=&quot;item.creator.name&quot;&gt;&lt;/h2&gt;</span><br><span class="line">                &lt;p class=&quot;desc&quot; v-html=&quot;item.dissname&quot;&gt;&lt;/p&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/scroll&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p><br></p><h3 id="这里遇到的坑"><a href="#这里遇到的坑" class="headerlink" title="这里遇到的坑"></a>这里遇到的坑</h3><ol><li><p>在上述recommend.vue中提到scroll标签中:data如果没有加的话依旧是不能上下滑动的，因为scroll是在mounted时候初始化，由于数据获取存在异步性，可能mounted的时候尚未取到数据，整个列表dom的高度是没有被撑开的。所以需要传入一个discList数据（discList有说明数据已经获取到了）触发scroll的refresh</p></li><li><p>那为什么传discList就行？传recommends行不行？答案是不行的。虽然他们都是异步获取数据，但是discList获取的速度比recommends的获取速度慢。如果传入的是recommends，虽然recommends已经获取到了，轮播图的高度也已经撑开了，但是下方的列表discList还没有完全获取到，所以scroll在初始化的时候页面的高度计算是有误的。</p></li><li><p>还有一个问题，拿到recommends就万事大吉了吗？不是。</p><p>对于discList歌单列表，里面的列表项是给定宽高的，所以一拿到discList就能确定宽高撑开dom。但是recommend部分的轮播图图片是没有给定宽高的，是按照百分比来设置的宽高，所以即使获得了recommends的数据，但是由于图片是通过链接引入的，这又是一个异步的过程，所以不能保证拿到了recommends的数据就能立刻加载出图片撑起宽高，在此完成之前就初始化scroll还是会出问题的。所以，可以给img标签监听load事件，一旦load就refresh scroll。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">loadImage() &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.checkloaded) &#123; <span class="comment">/* 无中生有搞个checkloaded变量来监测加载完成与否，一开始默认为undefined，只要有一张加载成功就改值为true，不用每张图都触发这个方法，加载得到一张图就可以确定宽高了 */</span></span><br><span class="line">    <span class="keyword">this</span>.checkloaded = <span class="literal">true</span> </span><br><span class="line">    <span class="keyword">this</span>.$refs.scroll.refresh()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li></ol><p>使用checkloaded也是<strong>常见的一种优化</strong>。</p><p><br></p><h3 id="这里总结一下better-scroll的渲染原理吧"><a href="#这里总结一下better-scroll的渲染原理吧" class="headerlink" title="这里总结一下better-scroll的渲染原理吧"></a>这里总结一下better-scroll的渲染原理吧</h3><p>它根据初始化的时机或者refresh的时机，那个时候scroll的父元素的高度和子元素的高度之差，算到scroll可以滚动的位置，所以我们去实例化或者refresh这个scroll的时候一定要保证dom是渲染完成的，才能正确计算他们的高度。一旦我们有数据变化引起dom变化或者其他dom结构变化，一定要重新refresh这个scroll。</p><p><br><br></p><h2 id="懒加载vue-lazyload"><a href="#懒加载vue-lazyload" class="headerlink" title="懒加载vue-lazyload"></a>懒加载vue-lazyload</h2><h3 id="vue-lazyload"><a href="#vue-lazyload" class="headerlink" title="vue-lazyload"></a><a href="https://github.com/hilongjw/vue-lazyload" target="_blank" rel="noopener">vue-lazyload</a></h3><p><br></p><h3 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a>代码编写</h3><ol><li><p>main.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> VueLazyLoad <span class="keyword">from</span> <span class="string">'vue-lazyload'</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueLazyLoad, &#123;</span><br><span class="line">    loading: <span class="built_in">require</span>(<span class="string">'./common/image/default-ldt.png'</span>)  <span class="comment">//loading时显示的图片</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>将recommend.vue中<code>img</code>标签的<code>:src</code>属性替换成<code>v-lazy</code>计即可</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1561427554510.png" alt="1561427554510"></p></li></ol><p><br></p><h2 id="loading组件"><a href="#loading组件" class="headerlink" title="loading组件"></a>loading组件</h2><p>效果：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1561428758666.png" alt="1561428758666"></p><p><br></p><p>要搞个这个东西，提升用户体验。</p><h3 id="src-base-loading-vue"><a href="#src-base-loading-vue" class="headerlink" title="src/base/loading.vue"></a>src/base/loading.vue</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;loading&quot;&gt;</span><br><span class="line">    &lt;img width=&quot;24&quot; height=&quot;24&quot; src=&quot;./loading.gif&quot;&gt;</span><br><span class="line">    &lt;p class=&quot;desc&quot;&gt;&#123;&#123;title&#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script type=&quot;text/ecmascript-6&quot;&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    props: &#123;</span><br><span class="line">      title: &#123;</span><br><span class="line">        type: String,</span><br><span class="line">        default: &apos;正在载入...&apos;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped lang=&quot;stylus&quot; rel=&quot;stylesheet/stylus&quot;&gt;</span><br><span class="line">  @import &quot;~common/stylus/variable&quot;</span><br><span class="line"></span><br><span class="line">  .loading</span><br><span class="line">    width: 100%</span><br><span class="line">    text-align: center</span><br><span class="line">    .desc</span><br><span class="line">      line-height: 20px</span><br><span class="line">      font-size: $font-size-small</span><br><span class="line">      color: $color-text-l</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>然后在recommend.vue中引用并嵌入即可。</p><p><br><br></p>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> 项目 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vuex笔记</title>
      <link href="/2019/06/03/Vuex%E7%AC%94%E8%AE%B0.html"/>
      <url>/2019/06/03/Vuex%E7%AC%94%E8%AE%B0.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>我这篇文章也放在我的GitHub上，里面还有相应的代码。建议移步<a href="https://github.com/Dunteng/learnVue/tree/master/%E5%AD%A6%E4%B9%A0Vuex#%E6%9C%AC%E6%96%87%E4%BB%A3%E7%A0%81" target="_blank" rel="noopener">GitHub</a>阅读本文章。</p><h1 id="本文代码"><a href="#本文代码" class="headerlink" title="本文代码"></a>本文代码</h1><ul><li>前导~state部分的全部代码： <a href="https://github.com/Dunteng/learnVue/tree/v1/%E5%AD%A6%E4%B9%A0Vuex/app" target="_blank" rel="noopener">点击</a></li><li>应用（一）代码： <a href="https://github.com/Dunteng/learnVue/tree/v2/%E5%AD%A6%E4%B9%A0Vuex/app" target="_blank" rel="noopener">点击</a></li><li>getters 应用（二）代码： <a href="https://github.com/Dunteng/learnVue/tree/v3/%E5%AD%A6%E4%B9%A0Vuex/app" target="_blank" rel="noopener">点击</a></li><li>mutations 应用（三）代码：<a href="https://github.com/Dunteng/learnVue/tree/v4/%E5%AD%A6%E4%B9%A0Vuex/app" target="_blank" rel="noopener">点击</a></li><li>actions 应用（四）代码：<a href="https://github.com/Dunteng/learnVue/tree/v5/%E5%AD%A6%E4%B9%A0Vuex/app" target="_blank" rel="noopener">点击</a></li></ul><p><br><br></p><h1 id="前导"><a href="#前导" class="headerlink" title="前导"></a>前导</h1><p>结合代码案例学习，本文的知识点会依附在这个代码里讲解，下面先来看一下这个代码的介绍，主要就是一个父组件Index.vue，两个子组件AddStudent.vue和StudentList.vue，之间有组件通讯。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562291573640.png" alt="1562291573640"></p><p><br></p><h2 id="父组件-Index-vue"><a href="#父组件-Index-vue" class="headerlink" title="父组件 Index.vue"></a>父组件 Index.vue</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;index&quot;&gt;</span><br><span class="line">    rock!我是index.vue</span><br><span class="line">    &lt;add-student @add=&quot;add&quot;&gt;&lt;/add-student&gt;</span><br><span class="line">    &lt;student-list :student=&quot;student&quot;&gt;&lt;/student-list&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import AddStudent from &quot;../components/AddStudent&quot;;</span><br><span class="line">import StudentList from &quot;../components/StudentList&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      student: []</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    add(name) &#123;</span><br><span class="line">      this.student.push(name);</span><br><span class="line">      console.log(this.student);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    AddStudent,</span><br><span class="line">    StudentList</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.index &#123;</span><br><span class="line">  background-color: rgb(72, 138, 182);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><br></p><h2 id="子组件-AddStudent-vue"><a href="#子组件-AddStudent-vue" class="headerlink" title="子组件 AddStudent.vue"></a>子组件 AddStudent.vue</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;AddStudent&quot;&gt;</span><br><span class="line">    &lt;h4&gt;我是addStudent&lt;/h4&gt;</span><br><span class="line">    &lt;span&gt;添加学生&lt;/span&gt;</span><br><span class="line">    &lt;input id=&quot;input&quot; type=&quot;text&quot; v-model=&quot;name&quot; /&gt;</span><br><span class="line">    &lt;button @click=&quot;add&quot;&gt;添加&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      name: &quot;&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    add() &#123;</span><br><span class="line">      this.$emit(&quot;add&quot;, this.name);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.AddStudent &#123;</span><br><span class="line">  border: 2px solid green;</span><br><span class="line">  background-color: green;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><br></p><h2 id="子组件-Student-List-vue"><a href="#子组件-Student-List-vue" class="headerlink" title="子组件 Student List.vue"></a>子组件 Student List.vue</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;StudentList&quot;&gt;</span><br><span class="line">    &lt;h4&gt;我是StudentList&lt;/h4&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li v-for=&quot;(item, index) in student&quot; :key=&quot;index+item&quot;&gt;&#123;&#123;item&#125;&#125;&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;&#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  props: [&quot;student&quot;]</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.StudentList &#123;</span><br><span class="line">  border: 2px solid red;</span><br><span class="line">  background-color: red;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><br><br></p><h1 id="state"><a href="#state" class="headerlink" title="state"></a>state</h1><h2 id="store-js"><a href="#store-js" class="headerlink" title="store.js"></a>store.js</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    name: <span class="string">'dunteng'</span>,</span><br><span class="line">    age: <span class="number">20</span>,</span><br><span class="line">    look: <span class="string">'handsome'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br></p><h2 id="store-state-xxx"><a href="#store-state-xxx" class="headerlink" title="$store.state.xxx"></a>$store.state.xxx</h2><p>vuex 里的 state 相当于一个公共数据池。</p><p>在 AddStudent.vue 中通过如下方式可以获取到：</p><ol><li><p>使用 $store.state.name 获取到</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562292413010.png" alt="1562292413010"></p><p>然后我修改一下add方法使得点击button按钮后修改 $store.state.name ，如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">add() &#123;</span><br><span class="line">  <span class="comment">// this.$emit("add", this.name);</span></span><br><span class="line">  <span class="keyword">this</span>.$store.state.name += <span class="string">" lin"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是<code></code>显示的部分并没有成功修改只有<code></code>才有被修改，这是因为<code>storeName</code>是在data中被定义的，之后<code>$store.state.name</code>和它是没关系的，影响不到。所以应该用<code>computed</code>来获取 state 的数据。</p></li><li><p>computed 获取 this.$store.state.name</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562292792863.png" alt="1562292792863"></p><p>这样，只要 state 里的数据发生改变，通过 computed 获取到的就能相应其改变。</p></li></ol><p><br></p><h2 id="mapState"><a href="#mapState" class="headerlink" title="mapState"></a>mapState</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>像上述那样拿到 state 中的 name ，继续获取到 state 中的其他数据：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562293651685.png" alt="1562293651685"></p><p>如果同时另一个组件也要同样的这些数据，那么就要在 StudentList 组件中重复上述的操作，这样是可行的，但是如果还有七八九十个组件也要这些数据，那么这样的操作很繁琐，冗余很大。</p><p>这就需要用到 <strong>mapState方法</strong> 了。这个方法的返回是一个<strong>对象</strong>，对象的每个key对应的value都是一个函数，有一点点像下面这个：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562294928788.png" alt="1562294928788"></p><p><br></p><h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><p>先引入才能使用。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;mapState&#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br></pre></td></tr></table></figure><p>然后结合 computed ，将 state 中的数据作为参数传入，</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">computed: mapState([<span class="string">"name"</span>, <span class="string">"age"</span>, <span class="string">"look"</span>]),</span><br></pre></td></tr></table></figure><p>而在当前组件中获得的数据名称和 state 中的一样。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562295563445.png" alt="1562295563445"></p><p>但是结果只显示了 age 和 look ，没有显示 name ，因为在 data 中定义了一个 name 属性，而 data 的优先级比 computed 高，所以无法正常获取到。</p><p>所以需要我们在使用 mapState 的时候重命名，如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">computed: mapState(&#123;</span><br><span class="line">  mapStateName: <span class="function"><span class="params">state</span> =&gt;</span> state.name,</span><br><span class="line">  mapStateAge: <span class="function"><span class="params">state</span> =&gt;</span> state.age,</span><br><span class="line">  mapStateOther: <span class="function"><span class="params">()</span> =&gt;</span> <span class="string">"你好吗"</span> <span class="comment">//我们甚至可以定义与state无关的变量</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure><p>但是除了 mapState ，我们在 computed 中也需要定义其他的计算属性，咋整？</p><p>像下面这样写是会报错的！</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562297668974.png" alt="1562297668974"></p><p>上面说了 mapState 返回的是一个<strong>对象</strong>，所以我们可以使用扩展运算符，如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  ...mapState(&#123;</span><br><span class="line">    mapStateName: <span class="function"><span class="params">state</span> =&gt;</span> state.name,</span><br><span class="line">    mapStateAge: <span class="function"><span class="params">state</span> =&gt;</span> state.age,</span><br><span class="line">    mapStateOther: <span class="function"><span class="params">()</span> =&gt;</span> <span class="string">"你好吗"</span></span><br><span class="line">  &#125;),</span><br><span class="line">  a()&#123;</span><br><span class="line">    retrun <span class="keyword">this</span>.$store.state.age+<span class="number">666</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><br></p><h2 id="应用（一）"><a href="#应用（一）" class="headerlink" title="应用（一）"></a>应用（一）</h2><p><a href="https://github.com/Dunteng/learnVue/tree/v2/%E5%AD%A6%E4%B9%A0Vuex/app" target="_blank" rel="noopener">【代码】</a></p><p>原案例中的两个子组件之间的传值是通过父组件来实现的，下面我们利用 vuex 的 state 来存储他们的公共资源。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562307401416.png" alt="1562307401416"></p><p><br></p><h3 id="父组件-Index-vue-1"><a href="#父组件-Index-vue-1" class="headerlink" title="父组件 Index.vue"></a>父组件 Index.vue</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;index&quot;&gt;</span><br><span class="line">    rock!我是index.vue</span><br><span class="line">    &lt;add-student&gt;&lt;/add-student&gt;</span><br><span class="line">    &lt;student-list&gt;&lt;/student-list&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import AddStudent from &quot;../components/AddStudent&quot;;</span><br><span class="line">import StudentList from &quot;../components/StudentList&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;&#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;&#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    AddStudent,</span><br><span class="line">    StudentList</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.index &#123;</span><br><span class="line">  background-color: rgb(72, 138, 182);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><br></p><h3 id="子组件-AddStudent-vue-1"><a href="#子组件-AddStudent-vue-1" class="headerlink" title="子组件 AddStudent.vue"></a>子组件 AddStudent.vue</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;AddStudent&quot;&gt;</span><br><span class="line">    &lt;h4&gt;我是addStudent&lt;/h4&gt;</span><br><span class="line">    &lt;span&gt;添加学生&lt;/span&gt;</span><br><span class="line">    &lt;input id=&quot;input&quot; type=&quot;text&quot; v-model=&quot;name&quot; /&gt;</span><br><span class="line">    &lt;button @click=&quot;add&quot;&gt;添加&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; mapState &#125; from &quot;vuex&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      name: &quot;&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    add() &#123;</span><br><span class="line">      // this.$emit(&quot;add&quot;, this.name);</span><br><span class="line">      this.$store.state.studentlist.push(this.name);</span><br><span class="line">      console.log(this.$store.state.studentlist);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.AddStudent &#123;</span><br><span class="line">  border: 2px solid green;</span><br><span class="line">  background-color: green;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><br></p><h3 id="子组件-StudentList-vue"><a href="#子组件-StudentList-vue" class="headerlink" title="子组件 StudentList.vue"></a>子组件 StudentList.vue</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;StudentList&quot;&gt;</span><br><span class="line">    &lt;h4&gt;我是StudentList&lt;/h4&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li v-for=&quot;(item, index) in studentlist&quot; :key=&quot;index+item&quot;&gt;&#123;&#123;item&#125;&#125;&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; mapState &#125; from &quot;vuex&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;&#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    ...mapState([&quot;studentlist&quot;]) //记得加引号。。。</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.StudentList &#123;</span><br><span class="line">  border: 2px solid red;</span><br><span class="line">  background-color: red;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><br><br></p><h1 id="getters"><a href="#getters" class="headerlink" title="getters"></a>getters</h1><h2 id="应用（二）"><a href="#应用（二）" class="headerlink" title="应用（二）"></a>应用（二）</h2><p>在应用（一）的基础上，要求输出：</p><blockquote><p>索引为0的： **姓名</p><p>索引为1和2的：姓名**</p><p>索引大于2的：++姓名++</p></blockquote><p>效果图：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562335007899.png" alt="1562335007899"></p><p><br></p><h3 id="不用getters的方案"><a href="#不用getters的方案" class="headerlink" title="不用getters的方案"></a>不用getters的方案</h3><p>在 StudentList.vue中的 <strong>computed</strong> 中进行数据处理</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  <span class="comment">// ...mapState(["studentlist"]) //记得加引号。。。</span></span><br><span class="line">  studentlist() &#123;</span><br><span class="line">    <span class="keyword">var</span> list = [];</span><br><span class="line">    <span class="keyword">this</span>.$store.state.studentlist.forEach(<span class="function">(<span class="params">element, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">        element = <span class="string">"**"</span> + element;</span><br><span class="line">        list.push(element);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index == <span class="number">1</span> || index == <span class="number">2</span>) &#123;</span><br><span class="line">        element = element + <span class="string">"**"</span>;</span><br><span class="line">        list.push(element);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        element = <span class="string">"++"</span> + element + <span class="string">"++"</span>;</span><br><span class="line">        list.push(element);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><h3 id="使用getters的方案"><a href="#使用getters的方案" class="headerlink" title="使用getters的方案"></a>使用getters的方案</h3><p>现在 store.js 中写 getters 代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">getters: &#123;</span><br><span class="line">  <span class="comment">//相当于计算属性</span></span><br><span class="line">  newstudentlist(state) &#123;</span><br><span class="line">    <span class="keyword">return</span> state.studentlist.map(<span class="function">(<span class="params">ele, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'**'</span> + ele</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index &lt; <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ele + <span class="string">'**'</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'++'</span> + ele + <span class="string">'++'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>在 StudentList 中直接使用 newstudentlist：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;StudentList&quot;&gt;</span><br><span class="line">    &lt;h4&gt;我是StudentList&lt;/h4&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li v-for=&quot;(item, index) in newstudentlist&quot; :key=&quot;index+item&quot;&gt;&#123;&#123;item&#125;&#125;&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; mapState &#125; from &quot;vuex&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;&#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    newstudentlist() &#123;</span><br><span class="line">      return this.$store.getters.newstudentlist;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><br></p><h3 id="mapGetters"><a href="#mapGetters" class="headerlink" title="mapGetters"></a>mapGetters</h3><p>和 mapState 类似的便捷方法</p><p>StudentList 中先引入 mapGetters ：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapState, mapGetters &#125; <span class="keyword">from</span> <span class="string">"vuex"</span>;</span><br><span class="line">。。。</span><br><span class="line">  computed: &#123;</span><br><span class="line">    <span class="comment">// newstudentlist() &#123;</span></span><br><span class="line">    <span class="comment">//   return this.$store.getters.newstudentlist;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    ...mapGetters([<span class="string">"newstudentlist"</span>])</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>也可以使用对象的方式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapState, mapGetters &#125; <span class="keyword">from</span> <span class="string">"vuex"</span>;</span><br><span class="line">。。。</span><br><span class="line">  computed: &#123;</span><br><span class="line">    <span class="comment">// newstudentlist() &#123;</span></span><br><span class="line">    <span class="comment">//   return this.$store.getters.newstudentlist;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//...mapGetters(["newstudentlist"])</span></span><br><span class="line">    </span><br><span class="line">    ...mapGetters(&#123;</span><br><span class="line">      newstudentlist: <span class="string">"newstudentlist"</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><br></p><h3 id="补充一点：getters自身可以作为参数传入getters属性的方法中"><a href="#补充一点：getters自身可以作为参数传入getters属性的方法中" class="headerlink" title="补充一点：getters自身可以作为参数传入getters属性的方法中"></a>补充一点：getters自身可以作为参数传入getters属性的方法中</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">getters: &#123;</span><br><span class="line">  <span class="comment">//相当于计算属性</span></span><br><span class="line">  newstudentlist(state, getters) &#123;<span class="comment">//传入了getters作为参数</span></span><br><span class="line">    <span class="keyword">return</span> state.studentlist.map(<span class="function">(<span class="params">ele, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'**'</span> + ele + getters.aaa<span class="comment">//使用了getters中的aaa</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index &lt; <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ele + <span class="string">'**'</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'++'</span> + ele + <span class="string">'++'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  aaa() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">666</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><br><br></p><h1 id="mutations"><a href="#mutations" class="headerlink" title="mutations"></a>mutations</h1><h2 id="关于严格模式"><a href="#关于严格模式" class="headerlink" title="关于严格模式"></a>关于严格模式</h2><p>上述应用程序代码写的是不规范的，当我们开启严格模式时就会报警告了。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562337035921.png" alt="1562337035921"></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562337084677.png" alt="1562337084677"></p><p>报错信息提示不要在 <strong>mutation</strong> 处理程序之外对vuex存储状态<strong>state</strong>进行更改。而我们恰恰就在 Addstudent.vue 的 add 方法中对 $store.state.studentlist 进行了更改：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562337274020.png" alt="1562337274020"></p><p>【记住：凡是要修改 <strong>state</strong> 的都要通过 <strong>mutation</strong> 来修改。 】</p><p><br></p><h2 id="应用（三）"><a href="#应用（三）" class="headerlink" title="应用（三）"></a>应用（三）</h2><p><a href="https://github.com/Dunteng/learnVue/tree/v4/%E5%AD%A6%E4%B9%A0Vuex/app" target="_blank" rel="noopener">【这部分代码】</a></p><p>先在 store.js 中编写 mutations ：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mutations: &#123;</span><br><span class="line">  changeStudent(state, param) &#123;</span><br><span class="line">    state.studentlist.push(param)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>第二个参数接受传入的外部参数。</p><p>在 AddStudent.vue 中：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  add() &#123;</span><br><span class="line">    <span class="keyword">this</span>.$store.commit(<span class="string">"changeStudent"</span>, <span class="keyword">this</span>.name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意写法，对象是 $store ，使用了 <strong>commit</strong>。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/dfagaha.GIF" alt="dfagaha"></p><p><br></p><p>在 mutation 属性中智能传递两个参数，如果我们想传递多个参数，可以把参数写进一个对象，然后这个对象作为参数写入 mutation 中。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mutations: &#123;</span><br><span class="line">  changeStudent(state, &#123; name, number &#125;) &#123;<span class="comment">//这里注意对象参数里面的元素命名形参和实参必须保持一致</span></span><br><span class="line">    state.studentlist.push(name + number)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>在 AddStudent.vue 中：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  add() &#123;</span><br><span class="line">    <span class="keyword">this</span>.$store.commit(<span class="string">"changeStudent"</span>, &#123; <span class="attr">name</span>: <span class="keyword">this</span>.name, <span class="attr">number</span>: <span class="number">12</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>【注意：注意对象参数里面的元素命名形参和实参必须保持一致】</p><p><br></p><h2 id="mapMutations"><a href="#mapMutations" class="headerlink" title="mapMutations"></a>mapMutations</h2><p>和 mapGetters 一样， mutations 也有便捷操作。</p><p>在 AddStudent.vue 中，先引入 mapMutations</p><p>然后在 methods 定义：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  add() &#123;</span><br><span class="line">    <span class="comment">// this.$emit("add", this.name);</span></span><br><span class="line">    <span class="comment">// this.$store.state.studentlist.push(this.name);</span></span><br><span class="line">    <span class="comment">// console.log(this.$store.state.studentlist);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// this.$store.commit("changeStudent", &#123; name: this.name, number: 12 &#125;);//mutations</span></span><br><span class="line">    </span><br><span class="line">  &#125;,</span><br><span class="line">  ...mapMutations([<span class="string">'changeStudent'</span>])    <span class="comment">//mutations里的方法叫什么这里就填什么</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样在 AddStudent.vue 中就有了 changeStudent 这一方法，直接使用即可。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;AddStudent&quot;&gt;</span><br><span class="line">    &lt;h4&gt;我是addStudent&lt;/h4&gt;</span><br><span class="line">    &lt;span&gt;添加学生&lt;/span&gt;</span><br><span class="line">    &lt;input id=&quot;input&quot; type=&quot;text&quot; v-model=&quot;name&quot; /&gt;</span><br><span class="line">    &lt;!-- &lt;button @click=&quot;add&quot;&gt;添加&lt;/button&gt; --&gt;</span><br><span class="line">    &lt;button @click=&quot;changeStudent(&#123;name,number:18&#125;)&quot;&gt;添加&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>如果想要<strong>重命名</strong>，如下操作：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  add() &#123;</span><br><span class="line">    <span class="comment">// this.$emit("add", this.name);</span></span><br><span class="line">    <span class="comment">// this.$store.state.studentlist.push(this.name);</span></span><br><span class="line">    <span class="comment">// console.log(this.$store.state.studentlist);</span></span><br><span class="line">    <span class="comment">// this.$store.commit("changeStudent", &#123; name: this.name, number: 12 &#125;);//mutations</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...mapMutations(['changeStudent'])    //mutations里的方法叫什么这里就填什么</span></span><br><span class="line">  ...mapMutations(&#123;</span><br><span class="line">    newChangeStudent: <span class="string">"changeStudent"</span> <span class="comment">//重命名</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在标签里触发这个 newChangeStudent 即可。</p><p><br><br></p><h1 id="actions"><a href="#actions" class="headerlink" title="actions"></a>actions</h1><h2 id="异步操作下的情况"><a href="#异步操作下的情况" class="headerlink" title="异步操作下的情况"></a>异步操作下的情况</h2><p>我们尝试在 mutations 中模拟一下异步操作，实现点击后过了1秒再执行 mutations 中的动作：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mutations: &#123;</span><br><span class="line">  changeStudent(state, &#123; name, number &#125;) &#123;<span class="comment">//这里注意对象参数里面的元素命名形参和实参必须保持一致</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      state.studentlist.push(name + number)</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>然后发现控制台报错：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562376986538.png" alt="1562376986538"></p><p>还是之前见过的报错信息，提示不要在 <strong>mutation</strong> 处理程序之外对vuex存储状态<strong>state</strong>进行更改。而我们在 mutations 里面的 setTimeout 下对 state 进行了修改，作用域不在 mutations 下，因此报错。</p><p>还有一点非常糟糕的是：如果我们这样写了，在点击按钮的时候用极端的时间点击了很多次，当后来我们想要调试的时候，回不到正确的 state 。我们通过 vue Devtool 调试，当我想要看第三次点击时的 state 时，结果左边跳到了初试的 state 状态，因为我的第三次点击时，第一次点击还不到1秒，state 还尚未被修改！如下图所示</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/faga.GIF" alt="faga"></p><p>于是我们可以使用 vuex 中的异步操作 <strong>actions</strong>。</p><p>mutations 是用来执行修改 state 中数据的操作，actions 也是，但是特别的是，actions 专门用来进行<strong>异步</strong>的修改操作。<br></p><h2 id="应用（四）"><a href="#应用（四）" class="headerlink" title="应用（四）"></a>应用（四）</h2><p>在 store.js 中：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mutations: &#123;</span><br><span class="line">  changeStudent(state, &#123; name, number &#125;) &#123;<span class="comment">//这里注意对象参数里面的元素命名形参和实参必须保持一致</span></span><br><span class="line">    state.studentlist.push(name + number)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">actions: &#123;</span><br><span class="line">  changeStudent(ctx, &#123; name, number &#125;) &#123;</span><br><span class="line">    <span class="comment">//这个参数ctx是上下文对象，相当于当前的$store</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      ctx.commit(<span class="string">'changeStudent'</span>, &#123; name, number &#125;)<span class="comment">//这里调用了mutations 中的changeStudent方法</span></span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 AddStudent.vue 中，通过 <strong>dispatch</strong> 来触发 actions ：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  add() &#123;</span><br><span class="line">    <span class="comment">// this.$emit("add", this.name);</span></span><br><span class="line">    <span class="comment">// this.$store.state.studentlist.push(this.name);</span></span><br><span class="line">    <span class="comment">// console.log(this.$store.state.studentlist);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// this.$store.commit("changeStudent", &#123; name: this.name, number: 12 &#125;);//mutations</span></span><br><span class="line">    <span class="keyword">this</span>.$store.dispatch(<span class="string">'changeStudent'</span>,&#123;<span class="attr">name</span>:<span class="keyword">this</span>.name,<span class="attr">number</span>:<span class="number">12</span>&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/dfagaga.GIF" alt="dfagaga"></p><p>在这个例子中，使用了 actions ，每次点击按钮的时候它都不是立即就执行 changeStudent 方法，而是每次都等候1秒再执行了，这就和用 mutations 内部 setTimeout 不一样，不是楞头地立即执行，导致 state 混乱。<br></p><h2 id="mapActions"><a href="#mapActions" class="headerlink" title="mapActions"></a>mapActions</h2><p>同样的，actions 也有便捷操作。mapActions 返回的也是一个对象，里面都是函数。</p><p>在 AddStudent.vue 的 methods 中创建 mapActions：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  ...mapActions([<span class="string">"changeStudent"</span>])<span class="comment">//actions里面的方法叫什么这里就写什么</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样 AddStudent.vue 中就有了 changeStudent 这样一个方法，可以像普通方法那样使用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;AddStudent&quot;&gt;</span><br><span class="line">    &lt;h4&gt;我是addStudent&lt;/h4&gt;</span><br><span class="line">    &lt;span&gt;添加学生&lt;/span&gt;</span><br><span class="line">    &lt;input id=&quot;input&quot; type=&quot;text&quot; v-model=&quot;name&quot; /&gt;</span><br><span class="line">    &lt;button @click=&quot;changeStudent(&#123;name,number:6&#125;)&quot;&gt;添加&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>如果要<strong>重命名</strong>，如下操作：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  ...mapActions(&#123;</span><br><span class="line">    newChangeStudent: <span class="string">"changeStudent"</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在标签中触发 newChangeStudent 方法即可。</p><p><br></p><p><br></p><h1 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h1><p>未完待续</p><p><br><br></p>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> Vuex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue音乐播放器（一）</title>
      <link href="/2019/06/01/01Vue%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8.html"/>
      <url>/2019/06/01/01Vue%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h1 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h1><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/djgalghl.jpg" alt=""></p><p><br><br></p><h1 id="vue-cli脚手架搭建"><a href="#vue-cli脚手架搭建" class="headerlink" title="vue cli脚手架搭建"></a>vue cli脚手架搭建</h1><h2 id="vue-init-webpack-vue-music-方式"><a href="#vue-init-webpack-vue-music-方式" class="headerlink" title="vue init webpack vue-music 方式"></a>vue init webpack vue-music 方式</h2><p>我之前安装的是vue cli3的版本，事实上<strong>cli3也能使用2.x模板</strong>：需要安装init模块</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @vue/cli-init // 安装这个模块</span><br><span class="line">// 就可以使用2.x的模板：vue init webpack my-project</span><br></pre></td></tr></table></figure><p>然后执行<code>vue init webpack vue-music</code>指令生成项目，同时需要配置一下部分插件的安装，具体如下：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1560070220037.png" alt=""></p><p>然后进入vue-music路径下执行<code>npm install</code>或者<code>cnpm install</code>进行安装，执行<code>npm run dev</code>运行项目，在<a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a>打开项目。【我这样做的时候，在npm install时会有些报错，然后使用cnpm install才ok】</p><p><br><br></p><h2 id="vue-create-vue-music-方式"><a href="#vue-create-vue-music-方式" class="headerlink" title="vue create vue-music 方式"></a>vue create vue-music 方式</h2><p>使用Vue Cli 3 的方式创建项目。</p><p>在选择配置时，选择了</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1560149666215.png" alt=""></p><p>其中css预处理器选择了stylus，没有选择路由的history模式，选择Eslint代码验证规则为&gt; ESLint with error prevention only，lint规则检测选择Lint on save （// 保存就检测）。</p><p>然后cd进入vue-music路径下，执行npm run serve,在localhost:8080打开项目</p><p><br><br></p><h1 id="项目目录准备"><a href="#项目目录准备" class="headerlink" title="项目目录准备"></a>项目目录准备</h1><p>把一开始src里面的文件夹删除了，然后构建如下目录。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1560153149793.png" alt=""></p><h2 id="stylus"><a href="#stylus" class="headerlink" title="stylus"></a>stylus</h2><p>其中的variable.styl文件专门定义变量，<strong>实现样式的语义化</strong>写法：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1560153216549.png" alt=""></p><p>reset.styl用于样式初始化</p><p>base.styl用于基础的样式，其中引用了variable.styl</p><p>icon.styl: 图标字体文件</p><p>index.styl: 里面按顺序一次引用了”./reset.styl”、 “./base.styl”、”./icon.styl”，注意顺序不能乱。</p><p>关于stylus还需要再安装stylus和stylus-loader，版本号见package.json</p><p><br><br></p><h2 id="初步的小demo"><a href="#初步的小demo" class="headerlink" title="初步的小demo"></a>初步的小demo</h2><p>此部分的<a href="https://github.com/Dunteng/Vue-Music-WebApp/tree/v1/vue-music" target="_blank" rel="noopener">代码</a></p><p>页面效果：</p><p><img src="https://github.com/Dunteng/images/blob/master/BlogImages/illustration/vuemusic/1560174717845.png?raw=true" alt=""></p><h3 id="App-vue"><a href="#App-vue" class="headerlink" title="App.vue"></a>App.vue</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"stylus"</span> <span class="attr">rel</span>=<span class="string">"stylesheet/stylus"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">@<span class="keyword">import</span> <span class="string">'~common/stylus/variable'</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-id">#app</span> &#123;</span></span><br><span class="line"><span class="undefined">  color: $color-theme;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="main-js"><a href="#main-js" class="headerlink" title="main.js"></a>main.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App'</span></span><br><span class="line"><span class="comment">// import router from './router'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'common/stylus/index.styl'</span></span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* eslint-disable no-new */</span></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="修改-eslintrc-js"><a href="#修改-eslintrc-js" class="headerlink" title="修改.eslintrc.js"></a>修改.eslintrc.js</h3><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1560174225507.png" alt=""></p><h3 id="webpack-base-conf-js添加别名"><a href="#webpack-base-conf-js添加别名" class="headerlink" title="webpack.base.conf.js添加别名"></a>webpack.base.conf.js添加别名</h3><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1560174286025.png" alt=""></p><h3 id="其他的坑"><a href="#其他的坑" class="headerlink" title="其他的坑"></a>其他的坑</h3><ol><li></li><li></li></ol><p><br><br></p><h1 id="页面骨架开发"><a href="#页面骨架开发" class="headerlink" title="页面骨架开发"></a>页面骨架开发</h1><p><a href="https://github.com/Dunteng/Vue-Music-WebApp/tree/v2/vue-music" target="_blank" rel="noopener">此部分的代码</a></p><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><h3 id="index-html加meta标签"><a href="#index-html加meta标签" class="headerlink" title="index.html加meta标签"></a>index.html加meta标签</h3><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1560180906762.png" alt=""></p><p><br><br></p><h3 id="package-json添加新的依赖"><a href="#package-json添加新的依赖" class="headerlink" title="package.json添加新的依赖"></a>package.json添加新的依赖</h3><p>npm i babel-runtime –save   //ES6语法转义相关</p><p>npm i babel-polyfill –save-dev    //ES6一些api的转义</p><p>npm i fastclick –save   //解决移动端点击300毫秒延迟现象</p><p>【<a href="https://www.vanadis.cn/2017/04/28/difference-between-babel-polyfill-and-babel-runtime" target="_blank" rel="noopener">babel-polyfill和babel-runtime的区别</a>】</p><h3 id="改写main-js"><a href="#改写main-js" class="headerlink" title="改写main.js"></a>改写main.js</h3><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAYkAAAE0CAYAAADZic8WAAAgAElEQVR4nOzd%0Af1BUZ57o/zdiFIGGJvKjicgQBP0qKIhkNIMScbwDLIyT+41mnJGbVCLJrVWs%0AzE751azi1NZKMsabO3dTQW/tREzNfjVxJqZq1itX2Ouo64+JGREx/sg3gqQH%0AcQXB0NC0Iv7g+8c5/ZM+0A0Njfp5VWXG7nPOc341z+c8n+fpfgIWL17ch7Ax%0AmUx89913/j4MMUKefvpp9Hq9vw9DPCJMJtMT/3kZ5+8DEEIIMXZJkBBCCKEp%0AID4+XtJNQggh3JKWhBBCCE3j/X0AQjzOSrds9nqbsq3v+PwYPC1zsHVdl4+F%0A8xMjS9JNQowid5Wsu0rTl5WvN0FisGPyVbARjw4ftiQW8/PlS0kwn6ei+jNa%0AfVewn02gaHs0+toblO97YH87J5zShffZtdVCi9dlBpK3JZbIk83sOTqEQ0oO%0AoeSNCJSBeWYObuikbgjFDIlP9q2cf6ZOfdl0k7LyXtvS9JI4CuN7qPmonap6%0A+1aGlZEUZwS53cZ6nxIA6L+tcxn3Bj3u9FWbWXirgvIqx7trIG/dD2n5cO+o%0AXG9vK3bH/9darrUf1+WelOOroDQwD695bC4lxZGc3Do69+ZJ8vinm3QrWJMb%0Awan9v+W8v4/FV+otlG+wqBX2KN9CH+zbsDKCTDrYtcG7ANuyr52yfWpFH+m6%0AtJc9G5pRgkXYkI7LJjaXhYlGTu61Hp2BvHUvwf4dtHzn/LrqxuDFDVYBu6t4%0APWltOHK3nafbutvOG+4CilaQ8Xw/3l3z9CWZcKZCAsQI8GENc4xP9h/zXXFj%0AjKn1weArCY8YIoMw1XdoBoi68uaR/WM33x8wOBnSkuDM5w7H0ELVh5+Tt24z%0AhXpgy2qMle+wx4MAYWWtHAdKNw30tD9YS0BrG2+ChqcVu7syhnt+/XlzzdNJ%0AdQrqoyOMProIGNV9+oNPgkTMzLdZnRKqvGg+zLunjzkte4mrmFLSSKCJyi+g%0A4Pl4+3pT3mTT1CtUdC6wlWG6tJudXzeqJahpLGuBTumsRHJzX2fyxVIuTS2j%0AIA6gm7PV26g2O29XsLyMAhyXe3p21idU9xxTICaXlJRTesRtCsQxReKaunFc%0A1r/soZtA0fZJXPzoPgutaSNzh1PazPm4wXjIs7SYYWUkxcl3+pfl9F4ghgig%0A3U0Bo5BGa9nXTtmAa6Sz9Dlo2DVQhWOi3YsA4Qujld93FxCs/+/fPgbta27I%0AyyKh8RR7RuEoouijiF4mAO8xcRT26H8+CRKtX2/j3a/VYBHef7k+ZRpXq3dz%0A6wevU5B6norqDl7KnU4ax5QUUNxSVnOYd/cfU9NDL5PbvI1qcyK5uUvRX9rN%0Au183Yg0Kqxe0OQWihOfLlHVON5K2oIyClMVUn1ZbNiOZbtJFUBh5k7IN7bYK%0ALu+sGgiSQ1hKB2UblIrdsDKS4pUh1DlUoAn5YdR81MyeejUPX3KHuvJelJy9%0A0g9Stu8BSsUeS1HrEPsw+h84hW+YObihmTq1f2D5yh4lCOWEqzn7dqWCzgmn%0AND+SvGb3OX5HLWfvYMqYRHqyRV03kPRka6vBOeiREUtpBjgFT3+m0VS2Csep%0AQrKmOt7h4JJVsPdPGNatJc/DdBM4P0V7mv+3LhtK5TyUjm9f8c2+Pb3mSlCv%0A2TWyiaa5PGAVvazgHp/xFOuZNKL7G0tG5y+x+TTVZsgFjBc/o5UVzsvN56mw%0AVvrms1w1pzE5DAhbyjxdE5W2VkUj1X8+zzTHAAPQfNjW8jh/rYmC1ChiYOQ7%0Az80d7LJ2ntb30GCOIGleINQ/gHoLexwqVaUCHY8BbEHCeMhe8dZdMlOYP4l0%0AeqlLDiKJDvbbWg69HK7toThlAhx17Kwdqh5qPrI+pT+grr6HzMhAAPIW6jDV%0A3rA/wR/t5GBKHAut5zWQegsnmyLs6yYHkaQzc3LfA+CB2iJTglJSva9aRr5k%0AID1Zj/GUa4XTQtWHOwADeU9Di+21Z4baT+C4vjf7sJav1Zk9UOezLyr44Q6R%0AVXh4zTNSSDA1cHiEWnYruMcq7jGX+wBcJpD/+YS0IKzGbMe1PiwRugCzdu7a%0AynjNoS/k+m959/pIHpmWB7R0QJLttcsIHgAGyHE138dkvR1x49HrdBRvj3Be%0Ap6nLs0NxStso+x00dRPxFAaUSns4/S91l8wULgzCgAXmTYLajkenMzHjh2RS%0Aw65arRVaqPpwr1dFDnW0kbt/e7KPgfoLtJZrrTvYcY6Oga65gbysBIyn9g5h%0AhKE2a0ppFfeI4qHTslk84AjddBHAFwRSx3hqGcfpsVuVDtuYPTNTl9p60EVg%0AwKFVEOZY+Y0lSq7ddEmpYNNLYp1H8AyWQokbj96xQ9Wln8Ar1rSNNzru2fal%0AjwkErIFigD4Ed47ewZgfRnpyDyRDw5hrLWhLn5mAqf5PPq1wPGlF+DLfPxa+%0AmzBqgSU2jSS9kZOaQd07jimlwYTRRy73yVVbGACnA8ZT2xdIHYF8QeBj06k9%0A5oJEzMyXlRTTdYArGFlK1sxEzlv7JFLjMV3a7Xn/grkNE2mkTIHzI9nCyAkl%0AU2fmoGOfga3iDSRvZQR6zZZEoJLmqb+hrH/0Dsb8aHs/wUhKDmF5RhDGQ0oU%0AqKvvITMjlPR9asvDel4eH0cvh2uheGUEpo4uygfpxxgz+g179T2toaLD+TLd%0ASHw7e7h8k24anK+GvU7jIf+dHltKaagW9N1ngUMZVwmklnF8yXhqCeTqI/or%0ASD4IEkpn8jxbWmUpm5Yv7TfKaUC6NFYvT1NfNFFp62Q+xif74efLX2dTirq4%0A+bDaie2pY3zyxXQ2PV/GJsD70U0DHXeEQ0rIOaVTV93BwjeiKd2uvDbWdmDK%0AcL7cCflxlOYr/3YevdTLng03Kdpu7dxVy1BHGbmOPircrqPQq9FAQWS+EUem%0AS7mgjP7ZRSTF2+MoBKwdy9ZyPdm30v8Sgemkp80PT8p2Td8FKdfW+qW6nHBK%0A8+25vYQ34sgc4Et1/fadloS+8dSIpsbcDQXVquT91SLQSjeNhRaKs3RSE000%0AHBl+UL/KOP6JibzPw37ppeGYxgOm8cDWMnlUU1T+/1mOKW+yKbXjMfuW9lim%0AfNms3cPKc0jU1NrJ0fwm+LCkU7Qli/Zdno9WGgp3Fa4nAcOTcn3RGvE0FTac%0A32/yVbAx5K2lePIpyvb67hMWRh+/osejdJOmAKAvAPCsWn0UUlSPRigTjxAl%0AtYbjCKkxr449W0fmaAcLAt5+s9pd2d50RHtb9mDvebMfX6aeWqp2DPJ9F+91%0AEcB6JnGQCbzPnaG1Kvps/2PnGjiscaAvoF+KqpFAzjKO3UzgMoHe738ESEvi%0ACfMw6Cle+cdw2j9q57OnzHQs6GDCdxOIropmXI+SMzXPGsr73RRNe47sp7Cl%0AgIZWzsi9L4Sn3LUqzjGef/dBxR2nBp+ngWAeMhGIClCqYUNfH+Pp43TAeH7a%0AFzzsffmC/4OEGFVNrzcR90kclkQL5plmog9HY0m00Dm387F9P353vL8vu3hE%0ALeaBrVXRxjiyCOWuvw9qlEmQeMJ0zu2kc24nAM98/gzjO8c/9u+Hn3PzMwBC%0AeMixVfGPBFHBBH8f0qiSICGEEB5YzAM20sOLhDxRrQkJEkII4aEw+gijj+ZH%0A9DsPQyGjm4QQwkNdBIzJYaoj6ckJh0IIIbwm05eOcU5zdTh9G92f1G8/d7hO%0AIfq471uIJ8/jn24a0nwSecxeuwyOruHCZcf3Z5DwylvoalzfHyG6FbyUAmer%0AS33zMyJCCOElmb7UrSpari1jdlIeXK6yvx39A2J0jTSORoAA5RdvzVepG6MB%0AwtTuv1949ee+hXiSyPSlGtoaGiEnlSiqaFPfC5kxg5Brx5TXs9azJPMWX/7L%0Axyg/yp3H7LWLMX/2Nsab6vqLtjF/Tpi6dSMXdrxvK8uj6xr2NNDRf4H1W+p/%0Ahpdy05SfTne67trXbND74ZEHVG3tP6XroNOX5oRTuvC+w/L+vyPl/CN/7n60%0A0P2+hRAjQ6Yv1XL5Im05yzDMgrbLADOIejaMtpqqwbZUzFrP/DntXNjxNm2o%0AAeOV1xyCira0BdaAB2D/hVyn4KlLY3VuE5X7SzmvW8Ga3AXk6o55dM0GvR9D%0A1H/6UjBEWqcv9YDL1KmGlZEUbwmhZajzagghhm10Rjep05eCdfpSF/2mLw1V%0Api+dokxfespl+lJT3HTSHLd3mb6UcGX60uGpouUaRCXlKS/VVFOLh6mmqKRE%0A2o7aWw6WE8do080gKnrwbc+fLuXd/aVUXOpWrs1+5fVOp59I7+ZstRr4vL1m%0Ag92Poaq3cLIpSJnCFYAJpMZbpy8dXHqKDuMhh58c39eFUTeJ9GRfHaAQwltj%0AtuN6LExf6phyuu2YahrUDEL0EJWzkyU5ju93DTSBqXec+ioaqa4uVf45BY+u%0A2UhxnL60JWcSCU132OPRlsoMeI5zbCh6PJ4UTwjhe2M2SIyJ6UttKacZmL1J%0ANana+o2OGiX+vGa26UsttKToMF7q9GpzxwmQhBD+N+a+TGedvvTSdeD6FYzE%0AkzUzUV1qnb70sJfTl8aTMmUoR6OmnDJfc59q0k1G+THfGSS8sowo24JvaPu2%0Ai6ic9Q7vjRJfXLNh6eViUxCRcRNIjejgsGuFrxuPAVC+7xBt71znAXX1PSTk%0Ah5M+KscphPCETF86CCXllNg/1XT5fS4k7WT22p3KekcP0Jaz2LbYcuJtvmQb%0A89XlAJjPeNRxPTy+uGbDY526ldobzmmvo50cTIlTpyUF46GbGPPDbIv7T50K%0AmDucRksJIUaX/3/gTyYdEkKIMWvMpZuEEEKMHRIkhBBCaPJ/ukkIIcSYJS0J%0AIYQQmiRICCGE0CRBQgghhCYJEkIIITRJkBBCCKFJpi8d4x7r6UuTQyh5Yzwn%0A+80ZMXKU+SruuZmnQgjhzpj9gT+fGep8Elaz1rMkJxGuHeDIAe9+4G/YHvPp%0AS9NzI6D2hktlrQYgXQ81DpMRCSH8Q6YvHYQyL8SBfrPUjYrHevpSda6Jcpcy%0AkoNIooODtZNYOC8Q6kdgmlLzffktKCE8JNOXDigPw9QuzKersFxznKUOpYWR%0AdJEvOxbbpii1fPUBX574BlBmokvlYxoj3mL2VGUTb386/FGbvtQbhpVhJDR1%0A9ZtrwjBvEvqOLurOwsKV6rwUgNLCiIB9XUS+Yf31WIfpTXPCKU25w672MNv0%0Ap6baG5S7THjUsq+dsmEduRBPlsDw8PB/GG4hlvaTnLh8hCt93ycjqJkTzUbb%0AstCohfwg5WmuVu/hRsxiXog2UnGslcSMOHovn6U1bB6LUuaS0Xucd/9tNyeu%0ATea55xfx9LWTXO1NJDf3JZ5p2M1vjn/OictGgpPyKYh6qO4jgqSkucyatoTo%0Aa8o6XWF5vBD9kBPNx7hw+Qgnrk1mdlIvf9r/39h/+QgnLp/kqqdp9Fkvkhp5%0AjSt/ruNe9CKmTxnPt980KMuifsCzaQuI663myJ4P+Pav0cQtWcpTfz2MyQIT%0AvreUZ+e8QOhfP+Dk/n/hW8tMUnN+QPeZP3N7kN2mLShj9YIlZERPgIkGMmYt%0AYdGsJczuM3KmvQPC5rFo2gwyrOd1bTKzM+Z4dM0GvR9D+QB4bQIvvjKRhj+Y%0AafjO8f1AFv7nCHrPdvDV2QCmF4YSZrytrjOOpBciyHw+kIaPWtj9+y66ZkRR%0A+P0ejv/lATwbRHbm02Tc+46ydzo4bnzA9wt1PG3bXggxFDJ96QCikhKxfPtn%0ALIDlm2+wTE11nh/CfIYvrf0UN/9MqzkMXaTD8msHbC0LLl+kjUhCHufpSz2V%0AM4kE8x3qXPsbkoNI0pm5eBSs81LYp0JVGA/Z+ynqLpkh4il1fgqUnxW3dqTX%0A99BgDiIyDiHEMIzZIbD6MHXSnKFMX+qT0VVKqqn1G7WSv/lnWs2JGGYNvFXw%0A5BkDLHUJIsPhZvrST6zTtvpx+tLBBZK3UIfxZP85IgzzJqFvumPryK67ZEaf%0AHGQPAu7YJjFyTx8TOMBSIcRgxuzoJr9PXzorlSjCiFqxk0TH95Py4LL2KKfb%0At74ZoNAuzKMxYbM/py8djNpaONlvitJA0pODQBdE6XbH93tIT7Zoj3IapBPa%0A1DoCHd9CPEHGXJCwTl9aeR3gCkaWkjUzkfNfN2KfinO3l9OXppEyBc5fH3x1%0Aq5DJkf2Hvc5azxKNUU4hi14jUdeo2TEdtWwZUeYzNN70/BiG5PrA18wXabhB%0A5YRTmq+Dpv7fo3A/7BUgkMh+w16V4bBJ8wKhX5CYQFG+DpPr7Hcqw8oIMnVm%0ADsp82UIMi0xf6tYMop4No63GpcVw+SJtOeooJwDdc8xf+5y6sJELO953Dh5T%0Al7Fk7TLl36MydSmMhelLtU0gNb6Hhmo3T/dqP8Vhp2CgzHudmRyEgR4AEvLj%0AKM1XlvYbvaSLoHh7hPrCLF+YE8IH/D+fxKM6fems9SzJvKVZ8Ycs2sb8iGOj%0A/wW8McywMpLiyK4hfktbaVVEnmxmj7vWQU44pQvvy3zYQvjYmEs3iceXfEdB%0AiEfPmB3dJIQQwv/8n24SQggxZklLQgghhCYJEkIIITRJkBBCCKFJgoQQQghN%0AEiSEEEJo8slPhbtKX7WZ5VPq+UtDt5ulBvLWvcWC+yf46obHJVK0ZTXL0oK5%0A8peruCtVjC2GvLX84mc/IvuFbLJfiKfr+IUx8SU35bimD/N4hvIZHsMyVlFa%0AnE1w/Rnc/smKJ5rvv0wXm8vCRCMn92r8CWb8kExq2FXr8z2PvthcSoojObl1%0A75j7+Yf0VZtZeKuC8io/VM2xuSx/Dmp2vUPV41CJuhrtz/AY/pyJx5/Pg4Qh%0ALQnOfK75YU6fmYDx1F4vn+Lq2LNV/jweGbGR6E0N1I3VAGFqH1arZmif4bHO%0ARMtYvV/Cr3z8Zbp0irZk0b5rh/snyCE8ERny1lL8nPpD142VlO2tc1q2nAZM%0Az2WSgJGDlVBYkGBfL2MVpTMvsetWlq0M0xnnp+v0VZsptP0WuIkah2O3Po3v%0A5yXb9sbKd9hTm07RlgL79KC4334g2mU7XqtM+098O5y7IW8txZNP2a+Fw3Vt%0AcbxejpyunfPxO10TW1mXSLWuY6ph14fVHleKhry1FCc39N/Gg7I170fGKkpn%0AtlPzdCaZehM1lQ0kFWSi9/LYhs3dZ3g45+Xmb8beCjR49Dlz+hvByEGHYxv0%0AcybEIHzaJ2HIe4kld0+x+8/u/2TTf7KS+IbPOeBF4rO74QzHj5/gSvAcMoKv%0AcfyCvezQpO/zg+eepmHXXv4jcQmL4xvYtec/SPxhAr3HL9ASO4fs+d8n4+6f%0AKCv/jOP1wXz/xwt5Ws29GvLWsjLuIrv+28f87+MnuBL8fQp/bM9XG+ZkMyc1%0Aw7b9leA5LEl/mit/OcWfj5/geH0wczJ6Obx1B384foLjxz3P6WqXfZVu0in6%0Au8X0VL5D+e9PcPy4mfgXC8gOVvp5QpO+73wtdEl8PyOYpuMXaFCvV9fUbKIb%0AKnh/9yGOHz/hcN0M5K37Kc9csC4zM/1nP2VOt5pf1yXx/YxZzHkhmoZd/53d%0AlWbicxeT2D14/j191WaKX8wmY0oQBD1DxgvZZL+QzRz1uAcre8D7ETuH7Pmz%0A6P3TO5wc/yMWz+/l8NZTTMhNJ2wUc+luP8PDOS8MzHkhntu19nMwzMkm/s45%0A/tLQwFeDfc4yVvGLxT0cVJddCc5mZf7Ttr67gT9nQgzOh6ObDKQn6zF+rZlo%0AIjXRRMN5Hz/zNZ6yPVEZT7l5ojTVsMv6BH3jPA0mPZGxyvEsfU7vtE1L1efU%0AmBJIzXC/fcv5Bkz6yIFnSvOGRtmGvCwSTDUctj3t1bGn0og+OW34+45NI4ka%0A9ttaU3UcPmMiYWa602rGSuuTah0XG0EfPfie6/a+Q9nWd9h1xqSc21bltWu/%0AiPuyPbgfDtfEdOZPfsjPD/wZHvJ5DeeIZiZgrLS3HFqqTmHUJ5Ee67DSSH6G%0AxWPPd30Sg3TmGfKySGg8xZ4xkPe0V3gm2gc5HlP9eXvguVFN+VbfHYdW2QaA%0A71pHJoUSG4len0Dxlkzn952mmzBy0eE+1u19x4cVslbZBjy5H/408GfYH+dl%0AwPA0JBRsprTA8X0TjhMgjuRnWDz+fBYk0mcmYKr/k0bFprYyTo2NzmfTzRaU%0AP161VWH7AzYQOVbm+Xw6BgPYrqchWg/4aO7T0c7je2wM349hfYZH9rykj0GM%0AJN+km6zDXrWGW6qtjMN+/iAb8l4iU2994lNSAglZubamd/80zyButGLCN2kD%0AR0pKIJOltnL7pyysQQTSKXLs4LaWccvkPj1VewmjPpPleWMt4eCD+zFcsbmU%0AbNlM6brc/tdtyJ9hT87LmgJV+i8KE12K0PyctVBXbyKhYBXprouE8BGftCQM%0AaUnoG08NOOxVu5UxYMnkrVtNpq0GLKB0S0G/UU4D0mc6pFacR37U7X0HVm12%0AWe7NE3YdeypTKLU19z0f3TSgG9WU74KSYnsawXSmgnK1Ummp+pya5NXqcZuo%0AqaxBXxDpVITzOjhcszr2bIWiLaspfc6+/lh4Gh3+/Rg5Q/8MD3ZeLp+hxkoO%0ANhaw0LkEzc9ZS9UOdrGW4i2bKbSuPmZbiuJR5IMhsL4f9uozGasozWqXPxgx%0APPJlNvEEe7wnHZIgIYQQwyI/8CeEEELT492SEEIIMSzSkhBCCKFJgoQQQghN%0AEiSEEEJokiAhhBBCkwQJIYQQmnw46dBifr58KQnm81RUf0ar7wr2u5BF25g/%0AJ0x91ciFHe/T5s8Din6N+SueI2TA48lj9tplRJnP8OW/fIzF07JnrWdJDsM+%0Ax5iZb7M6JVR91UTl/t9yfhjl+YphZSTFGfc4uKHT/RfjcsIpzdepL3qo+aid%0AqvpRPMB+JlC0PVqdU0L7eNJL4iiM9/J4c8IpzUf7WqgGvWbiseb76UvHGt0K%0A1uRGcGqolVT0a6TOgcbP1mC86dtDi1q2k8SOD/jyxDfebXjzY77c8bEaLCb7%0A9qB8QbeCl1LgbHUp1WZ/H4w3JlCUr8N4qJk9R31bcnpJHAvbb1C+74GXW/ay%0AZ0OzcmzbwwZdWwhf82GQOMYn+4/5rrixInIyIeZvaPNxgBh5VVzYUeWfXYdF%0AoDdfpW6sBgjzffffwE9+Cj1mTvo4QIyGuvLmkX3K17pm4rHnkyDhlFpoPsy7%0Ap485LXuJq5hS0kigicovoOD5ePt6U95k09QrVHQusJVhurSbnV9bJzhQ01jW%0AAp3SWYnk5r7O5IulXJpaRkEcQDdnq7dRbXbermB5Gcpv5VmXe3ZuIZMjgVvu%0AF85az5Ic+092th1dw4XLDts6pansy53en/oWS+aoK1w7wJEDVYNuP+gxO27n%0AUqa3ZVvXs3zleYsnJuxpoKP/Alur7gop1nvjkp5MW2C9j+B0r6a8yaapHZwN%0AT2OerpuzX1xl2vNp6L1Mb7bsa6dMa2Hc+H6/pmvnmPYBmm5SVt5rW6qkZIJs%0Ar62tEaf342MpzfBu+0Elh1DyRoR63Ga3KSFPy7auZ6p1bvEMeM1GQRh9dBHg%0AxyN4svkkSLR+vY13v1aDRXj/5fqUaVyt3s2tH7xOQep5Kqo7eCl3OmkcU1JA%0AcUtZzWHe3X9MrUheJrd5G9XmRHJzl6K/tJt3v27EGhRWL2hzCkQJz5cp65xu%0AVCqZlMVUn1ZbNkNMN0Ut28nsqdZXzzF/rfKTqfbKMo/ZSRc5suN9ZZVZ61mS%0As56oy2ouP/o1Uue0c2HH2/1y+5YTb3PkxMDpJqVydr/9YKzlhyzaxvyI/ss9%0ALdvbY3Cu4NNYvTwNcA368RQsf5qz1aV8ogbyH075jE+uK5+fgvDzVOxXKv2Y%0AmW+zOvdNWqz3Li6NyV+UUjm1jILnI6jcf5iU5QtI1zGstJZrJVq4Xaf8oqpD%0ARZ5eMomLG5rZA1gDRlGOWtkmh7A84x4HN7T3q6Bb9rVTtm/gdJM9599/+0HV%0AWyjfYFGDRf8/Z0/LHtYxjJC5PGAVvWxmkr8P5Yk2On0SzaepNkMuYLz4Ga2s%0AcF5uPk+FtdI3n+WqOY3JYUDYUubpmqi0VTCNVP/5PNMcAwxA82FbJXT+WhMF%0AqVHEwLA6z9sOrOEIakX57DduOn+ruHDA4eXli7TlLCYkGofUVCKGWdDmwdO/%0AszwS54TRdtT7AOGrskMWbWP2nHavOrDPny7lPGrlHn9V8wnf+IW1JXeMS81L%0AyQpLhOvx/DAlFOMX9m1av/4DZ+NfJ2UKyr02n+dP18EwFUyXDnOeeFI8Pm9t%0A1op8oI7cuvJOh1e9XGyChTGBgLXS15Ga00md16mqCSzNCMJ4aCQqZ8/KNqyM%0ApHAMdUzH8ZCN3CWX++QTwl1/H9ATbsx2XOvDEqELMHcMmgs1XnPoC7n+W969%0APpJHZufc2gDowvZAe/Njvjw6mSU5O1mSA3gzyig6lmC6aPXRRHTel51I4hzg%0A2rERCFJNXHK4P9bAAvFAN7e6fL5D33Aa9aQwWa9hvYXyQ+MpzY+jNB8wd7Br%0Aq8WzHH7yU+jpoaHZx8frcdk6MjOApi6/B4gw+vhbellNLxPpYz2TuCqj9P1u%0AzAYJU5faetBFYMChVRAWMUDeePSELNrG7KmOw0/zmL12sfNKl9/niNqKiFq2%0Ak/mv4FmguHmD28zw+TF7XnYjF3ZcxLB2GfMXfev96KshC1VakLZIG89k3QCr%0Aj5bkEEpcRj2ll8Q5Twx0tJOyo522ZcVb8CxQ1N/DNFLpFI/KNnNwwx1St0dT%0AsnIoo698o4h7/IK7RPEQgHOM5xoBzOIBlwn0yzEJxZgL0zEzX2aeTn3avH4F%0AI/FkzbR2DieSmxqvpho8ZG7DRDwpU0bgYM23uK3+M2rZMqIGWPV2R/9H5Nsd%0AXYQ8+wP1+w6Oqmi5FkZi3mtulg2Xp2VXceGzMzDnLWbP8vlBuHGMS82QkLqC%0AGPWdmJkLSFBTTP7XQ7v1iTwnnMJ47TVb2nvcvqdPDuo/LSq9XGwKInNliAXZ%0AtEIAACAASURBVJtlw+Vp2b3s+agDMmIpyvH5QQxoMQ84goV3uGMLEABzuc/v%0Auc0hLPyVLv5KF78PuM3vA27zK3r4O+6ygnss4D6z8E9ge1L4oCWhdCbPsz3x%0ALWXT8qX9RjkNSGfv5HT+4tUxPtkPP1/+Opusyefmw2ontqeO8ckX09n0fBmb%0AAG9HN2mxnDhG25xlDh3aZ2iban9Cdx09pDydO7ciLCc+pvHZt2xlOI5Eajuw%0AhgvLdtqXoTE6Cpi9dif2L9XNIOGVt0i03Y9lLFm7zOOynTimzJLcj5LypfOn%0AS2FBmctnYQx8MbPewsmmCArfiCMTwNxBTRMkqYtdO76Vp3PnVkTLvg5qtsRS%0AvF0dSeDQKV5X3gwlcfZlOIxAcklzJbwRR6bDl+rcd7rbRzkNWLbLOdpSZinO%0AI69GwjQe8it6WMx9j7dZ0Kesu2CAdU4HKFXapb5xmAmgmXFcI4AuAqRFMkT+%0An09iyptsSu147L6lLYToL4o+fsFdihjZIDQQCSTeGbN9EkKIx8dEYDW9/C13%0ACcO/z6VDaZF8QSCnn9Dq8sk8aw88DHrIuB6ly8Y8y0zHgg4mfDeB6KroJ/b9%0Ax5Xc65G913E85PfcJs6hz8GnAsDXccc1kPw4YBxL+kK1N3iMBYaHh/+DX4/A%0AfJYTVy97/gN0o+TaK9fQfa2je3o35plmDJUG+sb10fajtif2/YltE/19W0aE%0A3OuRvdddBPDvjOd7PCRhpALFEFwmkKsBgXxBIP+Hp/g3nmInE9jPU6xnEv/E%0ARNt/v2OCvw/Xb/zfJzFGdc7tpHOuMqTxmc+fYXzn+Cf+/fjdAwzpeYSNhWs7%0A1t4fqXu9mAf8ih6mjfCIpMsE0hUQwLW+AK4zji4CuKQO5nxS00ZDJUFCCDHq%0AXL8X4Q0JAKNLgoQQwi9cv2Ht6DKB/BvjJQCMARIkhBB+Zf2tpmXcs713lwCy%0ACKVNfv3V7x7vYStCiDGvmXGsYxIvEsI5tbUwkT7e4Y6fj0yABAkhxBhxjkBe%0AJJh1BNPMOHK5z2L5yQ2/k3STEGLMsX757kfc56cEy8+F+5EECSHEmBVFHxPp%0Ao1mSHn4jwwWEEGOW0nEtndf+JOFZCCGEJgkSQgghNEmQEEIIoUmChBBCCE0S%0AJIQQQmiSICGEEEKTBAkhhBCaJEgIIYTQJEFCCCGEJgkSQgghNEmQEEIIoUmC%0AhBBCCE0SJIQQQmiSICGEEEKTBAkhhBCaAsPDw//BN0Ut5ufLi/nx1MlcuXoZ%0Ai28KHQMmULQ9luzJFv5y8XGcnymQvC1TWBDYxVfGkd6Xci2X/acwsv/TBIKN%0At2n4boR2lRxCydvB9P6fu7Q4vJ1eEkfx8uHuezSv2Ujy7H4YVkbyi1eeosvl%0AWoonw+PfktCtYM3yN0nz93GMVTmhZNLB4aPebBNO6ZYQDF7vrJc9G5op23CT%0Aka5b03MjoLabuhHez5jwCNwP8ejy4cx0x/hk/zHfFTfGmFofzwnZ01N0GE82%0AP2ZPiBNIjTdzsrz/Pasrb34yAoevme8/Zp8R4SmfBImYmW+zOiVUedF8mHdP%0AH3Na9hJXMaWkkUATlV9AwfPx9vWmvMmmqVeo6FxgK8N0aTc7v25US1jMz5cv%0AJcFaoPk8FdWf0QpAIrm5rzP5YimXppZREAfQzdnqbVSbnbcrWF5GAY7LPT07%0A5WnLvUDytsSSqbMdHAc3dNoqofSSOArjrct6qPmonap6lCe/lPvURESQqeuh%0A5tAdkvIj0Js72LXVAisjWc4dTBkRJGDm4CEozNdB003KynsHLptA8rZEwL4u%0AIt+IVs/f+bhskkNYGG/mZLnL+znhlObbTgpT7Q3K9z1QUjhvRKBX3y/eHuF0%0A3i0rIylOvsOurRZbhWJw854Ww8pIiiO7bOeo7G88J23HPvD1tpcTRkJTF3tc%0AztV+7K7beXLNJlC0Pdr+OQTnp2+na+ZwP9T9Yr2GWO+dxj1xZ4j3oy4nnNJ8%0AnPfj7r1BtOxrp8zDdcXjxydBovXrbbz7tRoswvsv16dM42r1bm794HUKUs9T%0AUd3BS7nTSeMY5wHilrKaw7y7/5iSHsp9mdzmbVSbE8nNXYr+0m7e/boRa1BY%0AvaDNKRAlPF+mrHO6kbQFZRSkLKb6tNqy0a1gTW4Ep/b/VtmXz6gVVsdNyrb2%0A9ltqWBlJYUQHuzYolaNhZSTFb4TTYv3jjI8g8lAzB1PiKMy/x8ENN0ndHkZ6%0AsoU6QJ8xiYaPbtC+MpbChR3s+qiD5W9MIp1eWgYrmyAy34Caj5rZU68c58KV%0A3dTtc36yVlIyN1wqiwkU5T9FzUfNatBxUG+hfINFqWgW3u9f8Z+9gyljEunJ%0AFlvASk8OwlTf4ZOnUMPKCM3r7Xj8SzOg5iOXdazHrgae/ga6ZoHkbYlGX3uD%0AMtvrWCKtmyaHUOJ4zXLCKbXej3oL5YfGU5ofQd7Zdqriwr0LEMO5H0fvYMyP%0AJjWnkzo1nZieojxsSGtKeGp0+iSaT9ue3I0Xra0AB+bzVFgrffNZrppDmRwG%0ATFnKPF0Tp2ytikaq/3weU9x05z6G5sO2lsf5a00QHkXMiJ2MKieUTJ2Zg+Xu%0AKqwJLM0IwnjS/kfbsq+DGrOO1Bz1DbO9H8DkLnfe1GWrFBzL8ahswHjI2rJ4%0AQF19D/rIwH7HmBrfQ8NZd2m0IJLmua7vgXoLJ5sctk0OIkln5uQ+H6bq4ieR%0APtDynEkkmO9Q51qhekDzmqn9Nvs1zsMwbxLUdtgr8aPdzvfjaCe7aiEzN4S8%0AhTqMhzx/ilcM8X7Qy+HaHhJSJqivlXteUz1QkBXCmQ/7JHxLH5YIXYB58KdQ%0A4zWHvpDrv+Xd6yN5ZApDzFNgvjPAsfXQrpWlGrbhl21LyfSrTHvZ81EHJW/E%0AUpoBmqkqDXWXzBQuDMKABdTK01dPrS372jkYGUfhdh2FOKRdbAKVSniU+1gM%0AkUHo463Xy84xHdWyr4Maa8vTm0ECw7wfLWfvYFJboHU5kzTuuRDaxmyQMHWp%0ArQddBAawtz7C7DlYf2ppvQfJA60RRGQcYPuDDCRSN8DqXhlu2UoayHiy3f1i%0AaxoDNZW1PRw8rZiO3sGYH0Z6cg8kQ4MvWxE4djwrwzdLcAgU1paLV5Wwb/QP%0AWM7SS2JJqr9JTXI0JSsHXref4dyP+h4azLGk5nRCig7jpU7P9ysEY3AIbMzM%0Al5mna+LSdeD6FYzEkzUzUV2aSG5qPKZLhz3vXzC3YSKelCk+PtCjdzDqIli+%0A0l0aoJeLTZCw0D4s0bAyjASzl0NN3fJB2V4Me21pvdf/zeb7mHSTSHcbJHs5%0AXAuZKyNI6ujqn0cfTMRT6nlNoOiNgR4IHtDuMvhgxIa9upxveolj57nSetJn%0ARJCn9dCQo/RDnNzXS9W+DnC3bk44pdvjKC2Z4LYIK+/vxwOqTppJWBjJwghf%0AfP7Ek8YHLQmlM3me7Y9mKZuWL+03ymlAujRWL7f2MjRRaetkPsYn++Hny19n%0AU4q6uPmw2ontqWN88sV0Nj1fxibA+9FNWnrZs+EmRdsd0wz2VEBdeTOUxLmM%0AOBl8hI8nhlt2eooOU/0N9+u7jKSxjtRxqnjrLeyvnUTxG3Fk2vZvf7JtOauM%0AzDK5tlRcyk54I45Mh5FA1pSMcl491BzqQJ9v/Yi6jmxCGe1leyJX+1iqNfoN%0AVkZSnBFke62krDxM3bicr6n2BgeJJdW6/GgnZYRTarseDtdEPWfjIbUFVG/h%0AZFMEhW9Egm1E2gB8cD+U1p0Ofa1L6naQ+yEEQEB8fLx/v0Y85U02pXY4DGsV%0AI6rfsNJHdB8u+g2fFQ4mULQ9jHap/MUQjNk+CTFC6i2UbxjJHQSSt9Ld0NqR%0AJWP5taWXRJPQdFM6rMWQSJAQPuKQDnJKA4nheBj0kHE9SteheZaZjgUdTPhu%0AAtFV0YO+/3/9P3EsjwLuGfnt1nFYuyA9KcfwR+9/5EM8nvyfbhJCaGp6vYm4%0AT+KwJFowzzQTfTgaS6KFzrmdI/p++Dk334oVTyQJEkKMYZ1zO+mcqwxbfebz%0AZxjfOX5U3hfCSoKEEEIITWPuexJCCCHGDgkSQgghNEmQEEIIoUmChBBCCE0S%0AJIQQQmiSICGEEEKTBAkhhBCaJEgIIYTQJEFCCCGEJgkSQgghNEmQEEIIoUmC%0AhBBCCE0SJIQQQmiSICGEEEKTBAkhhBCaJEgIIYTQJEFCCCGEJgkSQgghNEmQ%0AEEIIoUmChBBiVIXR5+9DEF6QICGEGBVzecD73OEuAf4+FOGF8f4+ACHE4y2O%0Ah2zkLrncJ58Q7vr7gIRXfNuSmLWeJWt3qv9tIyHap6UPQR6zPTieqGVDON5Z%0A61mydj1RPjnOMSSmiz9mW8j2aOUifv2HCjZqrjyDhFd2MnuWz47uEZRIbm4Z%0AP5/io+J0K1iz/E3SPF0/eyMVFRvJ8tHuvRFGHxu5yxEsLOMemwniqiQvHjk+%0AvGN5zM5JpO3oGo7sWMORHW9jvOmbkqOW7WT+ohlD2LKKCzvWcGTHAdp8cyij%0A6AFbspv4TYzGYq8q85GQxcaKQqLP7ua94347iFH0iAa84+9x9NZcSrYXjepu%0Ai7jHESys4S4T6eMc47lGAHN5MKrHIYbPd+mm6FiCaaTxss9KHDVtB9ZwxN8H%0A8YjJ2vg66Zyj/L1T/j4UMYg9Gz5kSsU6fv3qHv7+dyO7r8U84Ff0MM0lGMzl%0APr/nvtN75xjP3QC41hfAdcbRRQCX1OfWc4yXtNQY4bsgETmZEM2Fecxeu8ye%0Amrl2gCMHquyLZ61nSU6i7aXlqw/48sQ3hCzaxvw5YcqbU99iyRz32zutB7Qd%0AXcMFT4JV9GvMX/GcetyNXNjxfv8Wh8axubIeg9by/h6wJfs686wXzTKZ3xwP%0A4Tjw2twmfmJQ389o4o/WVeqnsOpGD3uzb9mu9S/zb/FLAPT866EwPh6kbKvs%0ApHZ+mXzb9rqxNp5fttqXT3NYbqmfwqqGQIetiyicB3Xl79E/RLjca3C6poPf%0AK5ftzWf48l8+xsIMEl55C12Nff2QRduYH3GMIwe+JeGV1+DbdhLnJMK1A1xg%0AGbOnOpfvvG/H+z1D2b7qGLoV1n3bl0ct28nsqepmOTtZkqNeVo/vNcBifr58%0AKQkANFG5/7ecty7SrWBNbhp66+vmw7x7+ph90ylvsun5eIeympzK5ItSPrnO%0AAO+d4r3jP+bT7I1k/c7dPRu+aTzkV/Sw2CUQDGQu96EPFgywzlUCaQsIoLMP%0Avkb5DH6h/v9VAmmTTvARN+wg4fpHP3vtTuUfDhV51LJUWnas4QJgrQRmz6pS%0A/3jzmJ0TSeNna/qlpywn3ubICeWPNLFjoMq5nQs73vY+pXTzY77c8bEaLCb3%0AXz5rPUs0jm24x5CdZIGz8bxoAWul/l+TgjjeEMjH5+L5WH0v4hvnyhtCWHUo%0AREk3zQjsV/kPVrayvJ1fJk/gXw9FqkHF9YRu8RNdDC8eilT2k2HhtYYw+7qv%0AppJgvkJ5vzTTDBJeWUbwVx9w5MQ36uu30FkXz1rvfJ1mrWdJzjYS2q2pSeWz%0AYd/eG2EkPvsNX352i9QVy0j86gO+7HiN+Ul5cLmq375DFm1j/iuvqQFI3X7F%0AYho/W8OFm8pxJy6aQduJb9SWZv8g5Y2E5xdwtrqUT8yQtqCMggWLOX/6GLCY%0An+emYfqilJ3XwVrJr5nZxM6vG5UA8vzTnK0updqMGlAi1FKPcal5KQVTF8N1%0ANahMmU4CTVRedzmA313EWJDDwmw45cP0YBR9/IK7FNHru0IdTOMB09QRs7lq%0AAPqFyzptjONqgNICOd2nfMYvE0indZn0gwzLsIOEtSJX/uBx+zTeduB9h1dV%0AtFxbRuLkGYC1IggjZsYMjDe9rRjySJwTRtvRIQSIQc0gITMRy1cfDBogZs9p%0Ad98KGcDxhjCHyj2Qf/+PYObp7gOB2hv5pOy7vJh8m8ZajQABSsvj3ETl360T%0AacRMXAiotSlZhii4dbH/E+msH5PIGY2na/v1tF2ny+9zIWknieq9D1m0mCiz%0A1vaDa6v5GAuvAY00nvgGFtmXRSUp/WXWfVtOHKNtzmKiosGi3t+2o9Zg9Q1t%0A33aRGPEs9s/o8Bi/2KZU8sD5a00UPD+dNI7RMnMBCebzVNgq9WN88sV0NqXO%0AI+brRgwpaXBpt21bV+cvnScrVynrPJA2NR7Tpd32VorNt5jMheifhX5PFUMw%0AEVhNL3/LXb9/7yGKh0T1PQRggUZL5i4BnAtQ/rYu9Y3DTABfEMhpGeA5qNG5%0AQi4pGwBLh/VfVVz4LJb5K6zpJI20jzvRsQTTRWu7T49W9Sw6Hdy+NVAlkUji%0AHODaMe+DVIjFKW0EQItOa23flR1ynxiC+f+6h178s5O1E4uDGeh6BkeEgemG%0ANRb50AxC9BDlkCpSdKFR946srg5MRNhfd7bRqr32wMxnuWp+nZQpcP76YlLi%0Amjh1utHNiqe4fmsd0w1ZMMyEUxwP+T23iePhsMoZUAD4MvZMpI8FfUoAsaa3%0AfhwwjiV9ob7byWNq5INE9GvMV0c9WZvpUct24hQyrGkf1DTA2vWeBYqbN7jN%0AUEY9eeJbzGYYuNpu5MKOixjWLmP+om+9eAK+y2+yb0H9FF50TAH5JEYMUrZl%0A/NArJNW3tyzgJjvniWCnFqRSeaM+MNzu6MKx7vQ1j/uqRlpYBHpzBy3W1+FR%0AxIDtvsSEPY3togyqkbqmblZPXQxMJ6H5Cp+4XS+LKZPh5qXh90g0M45XCPa6%0AD8IrQwwQpwOUKs3aWmhjHA0EKC0J11a6fPHbI6OUrOvCbH3an7Xe3gnohuVW%0A/2bB7Y4uQp79gZuO8SparoWRmPfaAJ3mQ6WkHKJyBvsuRBUXPjsDc95yMzwy%0Ai40V+/hU47sErWb1Qxti4b86dCIrAmk2Q+IzGmM8ugOxhNzhBY0T1y57Ihda%0AbjNv3tCHz55qaYPJU/qPvW+/hUU3gyj1+yZRy94i0Rb4lOsZMufH9us568ck%0A6tTUEGD55hssU5cNOMxUCTKofQxh2is68fReDlyGxQRRSXmaaxRt38enf9jH%0Ar18dqJxEclPjMTWdpRVobb6KSZfGD23fo1jMD1NCMV78jFagpbMbffw8YtRl%0AP3fs4Fa1fn0aY9wC1qQ+zdlLx3DvWfQ6C6ZvPTnXwV1lHK8SzKuEcNUHKdLB%0AdBHA6YDxnA4Yzz8xkX9iIusI5qcEs4RQvkcY3yOMn/YF89O+YP6RIP4HE9nD%0AU5xmfP8AITw28i2Jmx/TeG0ns1eorQfzGRqvJWIb/t8vFdVF42fOfQyWEx/T%0A+OxbzF/7nPKGQ6d424E1XFi2074MhydGl7KjVuwkUS3feFOr092e7rKceJsv%0A2cZ8a2c8GiNabn7Ml0cnsyRnJ0uSXEZuuTWRP9YH80vbyCU9Z+uDmefSkvj4%0AXAyz81v5Y766b8dRRpYQ/rn+Dr/MtpehjG4avOyPz8XD3CaHkVH9RzcN6HcX%0AMRYUUvgqnHIcUnnzYy5+tY356r22fPUBF3gL60Ct/tfT5V7f/JgvP4P5KxzS%0AQrbRTd9grDpDjDUtaT7Dha8ime1hy8PdvbSX7Zm2AwdoW7uMJWuXKWV6Mbop%0A4fkyNqn/Nl3arXRKA5g/Y2c1rMl1Wa72UbR+/QfOxr/O6uVpQDdnqw9D7nSX%0A0tUO7PDz1GnlzzQHGwzPMQI5RghF3OMX3CVqCCmoZsbRHDDOaQTTOcbTQ5/z%0ACCZ58veLgPj4eLn0wmtZGysomX6F8tUjM6RSeCdtQRlZnQ7Bx0kWGyvWoT++%0AckS/JxFGH39LL6vpZaJLjX6ZQP6N8dwlgFr5LsQjRcaGiSE59d5u6pjL6xv9%0A8YMPwsmUNymIa+KU2wABRdvXkX7r4Ih/ka6LAN5jIksI4QBPOS2bxkP2MIGd%0ATOA04zktAeKRERgeHv4PwyngYdBDAu4rzUHzLDOtP27lzvfuEGwMfmLffzJc%0A49SBIJ5/6/8ms/UAp/7q7+N5Ak15k025/5lFUwM5W/0Bp9x9VSF7I28938I/%0Ar/ufXBulw+oigEM8xb8znhn0EctDxgPf4yH/yyV4iLFv2OmmptebiPskDkui%0ABfNMM9GHo7EkWuic2/nEvq+77KOhrEI8BpZxn430EMdDXiWEY9KJ/EgZdpDo%0AnNtJ59xOAJ75/BnGd45/4t+P3+34EwpCCOuX737EfX5KsKSaHiHScS2EGDVR%0A9DGRPpqlO/SRId9JF0KMGmU465PUd/fok3AuhBBCkwQJIYQQmiRICCGE0CRB%0AQgghhCYJEkIIITRJkBBCCKFJgoQQQghNEiSEEEJokiAhhBBCkwQJIYQQmiRI%0ACCGE0CRBQgghhCYJEkIIITRJkBBCCKFJgoQQQghNEiSEEEJokiAhhBBCkwQJ%0AIYQQmiRICCGE0CRBQgghhCYJEkIIITQFhoeH/4OvC01ftZnlU+r5S0O3w7sG%0A8tb9hNC/XKDF1zvUPhKKtqxm2QvZZL8wh+D6MzgdksPxFr+ovXw0uL1msbmU%0A/N1KfjTVzPELvrpq6RRteYlnNM/Vs2sm3IjNpeQnOv4y2L3KWEXp8me48per%0AyKUVY53vWxKxuSxMNHKyyvqHYiBv3VryYlto+c7xtc/37EYde7a+Q9nWSowj%0AUXxsLiVbVpE+EmX7zQhfs8dRbC4l63Ix3GjF5Pja7coG8rISMJ6qHsWHJSGG%0AbryvCzSkJcGZz6mzvdNC1Yefk7duM4V6YMtqjJXvsOeGr/c8dHV733E43jHk%0ARjXlW6v9fRRiMDeqKd+fS8mWAvRAaaKRg1v3ug8CsWkkUcP+2lE+RiGGyMdB%0AIp2lz0HDroGekUy0exUgDOStW02mXn3ZWEnZXscqPZ2iLQUk2IqvYdeHHj6l%0AxeZSUpyJUrTyh20v2UDeupdg/ykii63lW9dx3mfhls0UqudWs2sHVR6dn8t5%0AAaZbDme1ajOFier7Zyoor3I+I0PeWoqfs29srHyHPbaKx6Vsd9fE8dy9uWb9%0A9u163QaQsYrSmZfYdSvLtr3ruTmet3fXM52iLSlc3NXOQo3z0jru9FWbWXjL%0A9Ror1zDylON19ZCpXfNapi/JhPoKaUWIR4ZPg4QhL4uExlMurQRrZfsOB5es%0Agr1/wrBuLXn7PfvjT1+1mszvKin7sA7rH25JXovtDzp9VQH6MxWUVQ3hz876%0ApB6bS0lxpJsV9GQWZ1Gz6x323FD2vTDPQF1VHXu21tm2O+lpJal5XmpF5bDc%0A2rpxfR+A2FyWP2fi4NYdbvdryPsh7H+HshtgvWbL8847VIJ6MgsiObj1Herc%0ALh9AxiqKHfZtyFtL8bpcWjwNMokFFFNJ2dY6JWgU/JD0qr22sgqfrmHXVqUs%0AQ95aiotX0eLx9U2gsBj1vJRAvjSjWqnkBzruWyb0kw0w1Ko7NpeS5bB/ayVL%0AV8GeIzGUrMtlv5vAvDDRyMm9EiLEo8OHfRIG0pP1GL92/XNuoerDHVTdMGB4%0A2vG1J2Wmk5po5KCt5dBC1Skj+uQ0p3yv62tfMlZaj7WFunprZTJMamVxcO9w%0AklwJpGa4X9JStdfh+ro7bhM1u6wVr7rcw2uYPjMBY6W90m6pOoVRn0S6p31M%0Aphp2Wc+79hJG9BhiQWmF6p1y9S1Vn1Nj0j5PN4U7nFcdFxtBH20Y9Lhbbprs%0A57dqMyV5BsBApN7DVu+Naso/rKYlNkZpwVhfu6xmSEtC33hpbKY2hdDgu5ZE%0Axg/JpIZdmk3zFqo+3OtdmbEx6ElwSOeoTO22f9btrcCwbjXFWzIB17SLP/VP%0AJ/ns2G5UU14ZSWnBZkoL6J8uckqjqRq1i2u5aYJkT3asBPoE635tTLRrbeKV%0AQSrlfuflaaprkOO+0Y4pKwYD6aRixGQLqCZavEmN3qimXPMjrqRia3ZJiBCP%0AFp8FifSZCZjq/zQCudbBKoIWqj58hypQK5HNFDEWAoXDcY2E2r2UqeeYvmoz%0AxetQA0U6RcWZ4JCCM+StpXiydlGGaD18d8njezdygVhPZCxgq5gNRDpGumF2%0A5GsfdysmfQqGjEj0t/7Eyck/JD22Hf0AfQtey0ghwdTA4TE0YEMIT/gm3dRv%0A2KuP3DhPgymBwlUeDjK1DkEcLTdaMQ2Q9vF0O0PeWofOWu+13Op/1qab6r2I%0AzWX5c/p+y+3UNE+/NKHbPVFXbyKhYCSG/SrpoYQs+9BRQ14WCaYaDg87IHl2%0A3IZoaDjfQsstPalLItF/1+qjICHDXsWjyyctCSXXemoEcq0tVH1YAetWU7rF%0Aniewj4hxGdlkXWatVDJWUVpgX5pQvJlMhxEzriOElLSWF6N1qGNPZYo97ePx%0AaByX7Ror2XUmi+W25S7nlbia0ufs5+163Epry1oB1XH4TBbFtmMyUnPGRKZT%0AS0JPZvFmMq1bOz5hD3LNWqp2sIu1FDumAL0cHaV5Vfa+A6s221KHzuc1PAMf%0AdwvtpgIyk2vYVQUtNKAvzsR05k8+2DPKsFe9kZN+b90K4b2A+Pj4vuEVkU7R%0AlizaPR6qKMSTxf0QWyEeDT4IEkIIIR5X8gN/QgghNEmQEEIIoUmChBBCCE0S%0AJIQQQmiSICGEEEKTBAkhhBCaJEgIIYTQJEHCQ1kbK/h0e5HbZUXb9/HpH/Zp%0ALhdCiEeVz2emGz13+S9NrRATz/870fH9B+S3XydS5/r+MLy6jZJ5bVS+vMft%0AsoIEI5Uvv42bpUII8Uh7hFsSE7kYDgk9d53fftBD0m09F30VICji1wUJGCvd%0AB4EsQxQYL0qAEEI8lnzQkghlWvZcqL1CeHYGMQC0Uvu/a2m1rRNDxt9Yl0H3%0AlROcaOiG0Gksyg7nitO6gCGD/OmdnDh+le4B9nwuSE9h613mhk/knHXTu3fQ%0Ah+uU13e72GIO5KPIEPVH4u7yX5rMtE+J5FCguv7tdt5ov61uredgfJitLICs%0AjTkkGA/ys98N5doIIcSjzUfpplCmZ0/nyvFD1HaHMi17EdOTQmlt6EYJIhmE%0AXDnBoYZulICxiIzupm4pFQAADXpJREFUQ9S2dGPhGUJDoXWgaKBl4kSMtJJ6%0AN4xzEwEeMPf2bYw6d1ORunG3izfaJ3AwPpJzWAOGhRu2oJLFwukhGI9LO0EI%0A8WTyWbqptfYEV7sBumn9j25CdSHKgtAYnuEK5xqsUaCVK1e6iYmNASx0Wt8O%0AncYitbURGhoC5u4BWxEKl5STl6mmuT0mjDH2lkNLsA7j7TvMfWBd41n0Ogum%0Ab7XLeHZyCLdvDbCCEEI8wka+4zo0nNDQGBb9zXTn928AdNNtDmVKKISGhmO5%0AAaGhYAG6zRaPindMOd1wTDUN6gGGe5DQ2cQWp/eD7VNxZk8hGtxOZJS1sYKS%0AeSEYK1eyWlJRQojH1OiMbuq+otm/YDF3ExIaQ8wzcL22kymGULp1oVhueJh/%0AsqWcQjB4k2pSGfuNjnJw/Do3S6a7XXTqvdWcQhn+WrHxQ1a/d8qr/QohxKNg%0A5Ec3tVynNXQ6c5NCB1gplHDzdVq7u+GZ6UzRddvTUINSU07mDvepptsPiAWU%0AobGtDrPYBXIuOJiE1i7mapb9LSZzCPpntff+7S0LwZMHWEEIIR5hozAEVhnp%0AZJm+iPy/ybf9l6FOZNzdbSF0+nS40Qq0ct0cQ0yohW4vOrLPBenh9m30DqOc%0AAJgYxsFwE4VNTWxpuk6kLgajw+KW4Eg+iuxVl6v/tVtscyzDKU5esZCQvZGs%0AYVwBIYR4VMnMdIMq4td/KITKlfy9m76HrI0VlEw+ys82yAgoIcTj5xH+Mt1o%0A2cPfVxpJKNiGux/dONXSBpOnSEtDCPFYkiDhid+9TfnZKArc/TbT796m8tZc%0ASuS3m4QQjyFJNwkhhNAkLQkhhBCahh0kMjJifXEcQgghxiBpSQghhNAkQUII%0AIYQmCRJCCCE0jfmZ6aw/pAeA8eCIfGnNsDKS4ox7HNzQSZ3PSx+OCRRtj0Zf%0Ae4PyfQ8GX10IIXxszLckTr23mp+9vJLys579KqxvBZK3JZK8ZCA5hJLt4aT7%0A4SiEEMJfxnyQGDXm++pEQ67u0VI/2Dojy9QqrQghhH+MjXTTq9v4tMD6+6wW%0A6spX895xL7bP3khFyVw4O7Sf7G7Z106Zy3tKCipIebFdR6H6fvH2CIyHmtlz%0AFMgJpzRfZ9vG9r66/XI6OBkZS2G86/JA8rZEwL4uIt+IVn+Z1uwm3dXLng3N%0AXp+PEEL4iv9bEtkbqSiIoq58JT97eSU/q2wjvcT97ySNppZ97ZR91IHJ3MGu%0ADc3squ2BppuUbbBW9BMoSrlD2YZm5b9DZhLyndNR+oxYFrbf0FgeROYbYbR/%0ApGx/sElHYcmE0T5NIYQYkN+DRNbz0+HsbnvL4Xf/izpzAimvelHI8fdY/fLK%0AEZ34xxAZhKndMe3Ty57yXvvLo3cw8hSGZIdVmm7aO5zdLDceaqdKTWXVXTJD%0AxFMOP1MuhBD+5/d007OTQwhOWMenf1jn9L5RY/3REUjellgy1UxS8fYI5R/x%0AsZQmd7Brq4UWIL0kzpZKUvTYpz51K4jIOKBeY7FuPAbwS7+HEEK44/cgAXB7%0AiH0JI+cBVVubqVsZSXFkF2XlD8jbEkvkSec+h8J4x36ECRRtDxuk3B7aB+pi%0A8FPHuBBCaPF7umnPJSPB815nY/YwCsneSMUf9lGx0fezOthTTG4qeIdKPb0k%0A2mFq1P7SS6JJMN+hzm0rYgJF+TpM9T1eBIksNlbs49M/VAzv2gkhxAD835L4%0A3dv8jG18WrKPT0usbxqpfPlt9pDFxop1pNsGEBXy6R8KR+xLda4MkUEo+aNA%0AInU4pZJa9nVh3B5tS0WZajswxk9yLiA+mtLt6r/N9jSVVUJ+HKX5qNt7+4W5%0AU5y88jrp89Q5uL0ZDSaEEB4a9nwSGRmx1Nbe8NXxPDYMtlRVr5ulgf3SV0Py%0A6jY+LYjyfsiwEEJ4yP8tCTEEyrzbCUP5TokQQnhBgsQjaQ9///LIp9uEEELS%0ATUIIITT5fXSTEEKIsUuChBBCCE0SJIQQQmiSICGEEEKTBAkhhBCanqwgEWJh%0Ab34Xr/n7OJhBwis7mT3L38fhRkwXf8y24NEvfby6jU8rNuL7H0PRkL2RitHc%0AnxDiCQsSwnes84D87j36/TTjrPUsWbuTJcvyfLvP4+9x9NZcSrb7e7YRIZ4c%0AEiQeR1PeZNOCxSO4gyw2vjrXeR4QB1FJibQdPUDb1FSifLznPRs+pG5yIb/2%0AZr4RIcSQ+f8b1yEW9mY/4PChiczObyURwDKZ3xwPUX+z7gFbsq8zL0RdvyWG%0AF89NVF/c5Tf5d7lwPJCl2bcI6bctSvokw+SwQ73T7rOT2vll8m3bsn89FMbH%0A6qvX5jax1DyFf6bDtk5jbTy/bLVvn7WxgpJ5DPHnMfKYvXaZWpE2cmHH+7R5%0AW4Q71w9zNvV1NuVGUVH9Ga2Db9HPNIfrYqmfwqqGQPvCV39MOucod/vz7nkY%0ApnZhPl2F5doyDLOg7bK6aNZ6liRd5MuOxcyfo/ysuuWrD/jyxDcAhCzaRiof%0A0xjxFrOnKpu0HV3DhcuO5Z/iveM/5tPsjWS5a8UIIXxqjLQkTPwk30zH8Xhe%0APBRDY8gtXoxRlrw29zrzzDG8eCieFw9N4ayulb1JD5y3zX7A4UP9tyXEwt6M%0AXs4ej1e2Pz4Zi+NuY7r4ZfIE/vWQsvw39b38xCUfH5J8nV/qdOryYBJneJiv%0A90BUzmLMn63hyI4PaDQnkrhoho9KbqS6upTKzjRWL3+TNG83D7nFT9RzfrFW%0AT0iyxakfpyglgdtXTrqvoGelEmX+hrabcLuji6gkl5TT1GXMjzjGkR1rOPLZ%0AGZjzGgnRDrue8xaJHR8oy482EpWzvn9r5HcXMeqms1B+Il2IEef/loSqsTaS%0ArRaAiVxogaW6B9B6n9kGPf96yNpyCGTrN3r+OKOH7AZrayGYs8etT/+O2wby%0A2vRbUD9FLbe/154x0Vgbb2s5HG/Q8WKymRdCQjhu3cYymd+oLZfjNyb9/+3d%0AX0hbZxzG8Wf0osVMp2haqa6o61pmhf5x0oLMVa8mbgpjLY4J0ga2i65sSKkO%0AuquVYXaxm8nuSmkpWEoviptMYWwuLMXiisiqzLIZsVhmsqB4FlkvynaRaGLM%0Am1ZzluWM7+cqnPfEkyCcJ+/7ezk/vffiY72g+JO5/V7Pln/Nhr7v0WxQkqYV%0ACiyrqqhS0vQT33fw2EW1lCcf/VN3h3s1bMWPTIxe0O8v9cjzVo9Kk8bSSvjO%0AWtiuGVkqd0nRhK1XWbEUnEz9rd17qxQJfBU9dXpakRM1cmsoPkOyxnRnYCj6%0AOnhbC1ad8kskBWPjDwbWZhaauqdQ43G5dkqhYOJVAlqyXucR6UAW5EhIFOrn%0AhDWRy+OxG7frL+3Skqqal9SWeHqk2IZrPlZ5vlR1ZE631h3P093ESz3cEb8P%0ARVx65xsbLp2hidELmtjUO55V7YHjGh4dseHqlSrMN41Fl5oWRmM3+eBtLVgf%0ArF9ySiGveL/M4ViwPkQkSX7Nh89qX2m9xIIT8K/KkZBIZ32dwG7JNQYneNqZ%0ARPS8OQ3e7N1kqKQT0JKVXNmJqa6RWwVyn/gyWltatfc1aWrI+BdXwulmT8uy%0ANjQOTz+bAWCf3A6JyA79EplX2+HturxWrH56v1l5atu9ujT1SJ83hOVau71t%0A0w8P89R1ZFmnMgihzArXW/M0M4mDxy6q5bkJXbq5tcK1mflXvKu4RHowoO8G%0AEgKh+pyaGpOWnFbPf+WUqvJnkgrTce7WVrmtMc0Ek0cqVZgf0VIgw68C4Ily%0AOyS0TZ/4yvRxw7xuNcePbthtY+D7tUiv7p5XV3NYXcrTXd8uzTQ8ShgvkfSH%0Auprn4stZybujnKjsXbXoW306bMfy0kbXJmfV0vKGOuRXvKvFfrkrCxT6KWnG%0AMHVPocbYLidJyq/T0TN1scEUO7qeb1XTmdboa2tMd65e1oaSUmeNKqz76nP0%0APwlwBvpJYAuivcf33f9CnpTbYA2qz6np5XDqG7+iW2CPFo2sn4kYrl3oa9dH%0AVzb7uQFsVo5sgYWz+OW9Mi7VnlZ3lrehdnx2VofCXxMQQJYQEtgan1eewZAO%0AdWb32U2NxePqO0/rViBbWG4CABgxkwAAGGU8kwAA/H8xkwAAGBESAAAjQgIA%0AYGRLSNR3X1L/jevmVpa0nQQAR7IlJPxej94+2a7B8GGd7k4RBbSdBABHsnW5%0A6drkrPKKK1OP0XYSABwnizUJv7y+WVU0sOwEAE6R3cI1bScBwFHsDYnAolYq%0AamSuPAS0ZLmibScBADnP3pDweeXpW1TjjevqT1mk9ms+LO0sZcEJAJzA3qZD%0Anb3qb1hU38l2Q+dh2k4CgJPYX5MIz6dpTU/bSQBwkuwWrmNtJ3+k7SQAOEIW%0AQ6Je3Q0VmvV508w0AAC5xNaQ6DhQoZVw6rUk2k4CgPPYUriu776k92tdkmY1%0AeD7FPGG17aSHtpMA4CQ0HQIAGPGocACAUcbLTVffjObMhyOFGX8YAEBuYSYB%0AADAiJAAARoQEAMCIkAAAGBESAAAjQgIAYERIAACMCAkAgBEhAQAwIiQAAEaE%0ABADAiJAAABgREgAAI0ICAGBESAAAjAgJAIARIQEAMCIkAABGz+zZs+fv//pD%0AAABy0z+zU1TRYZj17QAAAABJRU5ErkJggg" alt=""></p><h2 id="页面入口"><a href="#页面入口" class="headerlink" title="页面入口"></a>页面入口</h2><h3 id="m-header组件"><a href="#m-header组件" class="headerlink" title="m-header组件"></a>m-header组件</h3><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1560241111052.png" alt=""></p><h4 id="m-header-vue"><a href="#m-header-vue" class="headerlink" title="m-header.vue"></a>m-header.vue</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;m-header&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;icon&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;h1 class=&quot;text&quot;&gt;Dunteng Music&lt;/h1&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/ecmascript-6&quot;&gt;</span><br><span class="line">  export default &#123;&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang=&quot;stylus&quot; rel=&quot;stylesheet/stylus&quot;&gt;</span><br><span class="line">  @import &quot;~common/stylus/variable&quot;</span><br><span class="line">  @import &quot;~common/stylus/mixin&quot;</span><br><span class="line"></span><br><span class="line">  .m-header</span><br><span class="line">    position: relative</span><br><span class="line">    height: 44px</span><br><span class="line">    text-align: center</span><br><span class="line">    color: $color-theme</span><br><span class="line">    font-size: 0</span><br><span class="line">    .icon</span><br><span class="line">      display: inline-block</span><br><span class="line">      vertical-align: top</span><br><span class="line">      margin-top: 6px</span><br><span class="line">      width: 30px</span><br><span class="line">      height: 32px</span><br><span class="line">      margin-right: 9px</span><br><span class="line">      bg-image(&apos;logo&apos;)</span><br><span class="line">      background-size: 30px 32px</span><br><span class="line">    .text</span><br><span class="line">      display: inline-block</span><br><span class="line">      vertical-align: top</span><br><span class="line">      line-height: 44px</span><br><span class="line">      font-size: $font-size-large</span><br><span class="line">    .mine</span><br><span class="line">      position: absolute</span><br><span class="line">      top: 0</span><br><span class="line">      right: 0</span><br><span class="line">      .icon-mine</span><br><span class="line">        display: block</span><br><span class="line">        padding: 12px</span><br><span class="line">        font-size: 20px</span><br><span class="line">        color: $color-theme</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="App-vue-1"><a href="#App-vue-1" class="headerlink" title="App.vue"></a>App.vue</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">      &lt;m-header&gt;&lt;/m-header&gt;</span><br><span class="line">      &lt;!-- &lt;MHeader&gt;&lt;/MHeader&gt;这样写也可以 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/ecmascript-6&quot;&gt;</span><br><span class="line">  import MHeader from &apos;components/m-header/m-header&apos; /*这里webpack.base.config.js配置components别名*/</span><br><span class="line">    </span><br><span class="line">    export default&#123;</span><br><span class="line">        components:&#123;</span><br><span class="line">            MHeader</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang=&quot;stylus&quot; rel=&quot;stylesheet/stylus&quot;&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="webpack-base-config-js中添加别名："><a href="#webpack-base-config-js中添加别名：" class="headerlink" title="webpack.base.config.js中添加别名："></a>webpack.base.config.js中添加别名：</h4><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1560241171207.png" alt=""></p><h4 id="这部分的效果图"><a href="#这部分的效果图" class="headerlink" title="这部分的效果图"></a>这部分的效果图</h4><p><img src="https://github.com/Dunteng/images/blob/master/BlogImages/illustration/vuemusic/1560241751607.png?raw=true" alt=""></p><p><br><br></p><h2 id="路由配置-顶部tab组件"><a href="#路由配置-顶部tab组件" class="headerlink" title="路由配置+顶部tab组件"></a>路由配置+顶部tab组件</h2><p>效果图：</p><p><img src="https://gitee.com/dunteng/imagebed/raw/4745c333848490b8cf05ce9b4e1c95a52fa1905f/images/2019-06-12_15-50-17.gif" alt=""></p><p>这部分的目录树：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1560325443000.png" alt=""></p><p>这部分开始建立起了路由。</p><p>以下是router/index.js的代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">import</span> Recommend <span class="keyword">from</span> <span class="string">'components/recommend/recommend'</span></span><br><span class="line"><span class="keyword">import</span> Singer <span class="keyword">from</span> <span class="string">'components/singer/singer'</span></span><br><span class="line"><span class="keyword">import</span> Rank <span class="keyword">from</span> <span class="string">'components/rank/rank'</span></span><br><span class="line"><span class="keyword">import</span> Search <span class="keyword">from</span> <span class="string">'components/search/search'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Router)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/'</span>,</span><br><span class="line">      redirect: <span class="string">'/recommend'</span> <span class="comment">/* 重定向到推荐页面，默认为首页 */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/recommend'</span>,</span><br><span class="line">      component: Recommend</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/singer'</span>,</span><br><span class="line">      component: Singer</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/rank'</span>,</span><br><span class="line">      component: Rank</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/search'</span>,</span><br><span class="line">      component: Search</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br></p><p>另外这里我给路由切换加了一个动画效果：</p><p>App.vue代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;m-header&gt;&lt;/m-header&gt;</span><br><span class="line">    &lt;!-- &lt;MHeader&gt;&lt;/MHeader&gt;这样写也可以,但是不推荐，应尽量符合代码规范 --&gt;</span><br><span class="line">    &lt;tab&gt;&lt;/tab&gt;</span><br><span class="line">    &lt;transition&gt;</span><br><span class="line">      &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/ecmascript-6&quot;&gt;</span><br><span class="line">import MHeader from &quot;components/m-header/m-header&quot;;</span><br><span class="line">import Tab from &quot;./components/tab/tab&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    MHeader,</span><br><span class="line">    Tab</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang=&quot;stylus&quot; rel=&quot;stylesheet/stylus&quot;&gt;</span><br><span class="line">// 实现路由切换动画效果</span><br><span class="line">.v-enter &#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">  transform: translateX(100%);</span><br><span class="line">&#125;</span><br><span class="line">.v-leave-to &#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">  transform: translateX(-100%);</span><br><span class="line">  position: absolute;</span><br><span class="line">&#125;</span><br><span class="line">.v-enter-active,</span><br><span class="line">.v-leave-active &#123;</span><br><span class="line">  transition: all 0.5s ease;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><br><br></p><h1 id="插播一条eslint的配置"><a href="#插播一条eslint的配置" class="headerlink" title="插播一条eslint的配置"></a>插播一条eslint的配置</h1><p>eslint默认缩进是2格，我用4格的他就报错，真的是烦死了。在网上看到有人说现在Google等大公司都提倡缩进2格，优点是可以节省行空间，一行可写的内容更多，但是视觉反馈没那么强烈，即缩进不明显而且复杂度警告能力减弱，多层嵌套的代码往往更难理解。所以我还是习惯使用4格缩进。</p><p>遂改之：<a href="https://segmentfault.com/q/1010000013682009" target="_blank" rel="noopener">https://segmentfault.com/q/1010000013682009</a></p><p><br><br></p><p>(未完待续)</p><p><br><br></p>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> 项目 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue父子组件传值和非父子组件传值</title>
      <link href="/2019/05/12/Vue%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E4%BC%A0%E5%80%BC%E5%92%8C%E9%9D%9E%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E4%BC%A0%E5%80%BC.html"/>
      <url>/2019/05/12/Vue%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E4%BC%A0%E5%80%BC%E5%92%8C%E9%9D%9E%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E4%BC%A0%E5%80%BC.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p><a href="https://github.com/Dunteng/demo/tree/master/Vue/%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E4%BC%A0%E5%80%BC%E5%92%8C%E9%9D%9E%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E4%BC%A0%E5%80%BC" target="_blank" rel="noopener">案例代码</a></p><p>实现如下的一个案例：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/demo/comp46546.GIF" alt=""></p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>该页面是一个<strong>父组件Form.vue</strong>，添加学生的这个input框部分是一个<strong>子组件addStudent.vue</strong>，下面的 li 显示学生的这部分是另一个<strong>子组件StudentList.vue</strong>。我们需要把addStudent.vue的数据传给StudentList.vue，但是他们是<strong>非父子组件关系</strong>。</p><p>因此需要先让 addStudent.vue 把数据传给它的父组件 Form.vue<strong>（子组件传值给父组件）</strong>，然后父组件 Form.vue 再将从子组件 addStudent.vue 获得的数据传给另一个子组件 StudentList.vue<strong>（父组件传值给子组件）</strong>。从而间接地实现<strong>非父子组件传值</strong>。</p><p><br></p><h3 id="子组件传值给父组件"><a href="#子组件传值给父组件" class="headerlink" title="子组件传值给父组件"></a>子组件传值给父组件</h3><p>通过子组件的一个事件触发一个方法，在 addStudent.vue 中是 addStu() 方法，<code>this.$emit(&quot;add&quot;, this.name);</code>  子组件向父组件派发一个方法，子组件将自身的数据作为参数向父组件传值，在另一头父组件 Form.vue 中引用的 add-student 标签里需要监听 “add” 事件，触发一个自身定义的方法 addFunc()，在这个方法内部实现获取数据并保存。</p><p><br></p><h3 id="父组件传值给子组件"><a href="#父组件传值给子组件" class="headerlink" title="父组件传值给子组件"></a>父组件传值给子组件</h3><p>父组件中引用的 student-list 标签绑定一个属性，如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;student-list :student=&quot;studentList&quot;&gt;&lt;/student-list&gt;</span><br></pre></td></tr></table></figure><p>其中的 studentList 就是这个父组件自身的数据。而另一方面，子组件 StudentList.vue 中，需要有 props属性来接受父组件传来的数据：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//   props: ["student"]  //简易写法</span></span><br><span class="line">props: &#123;</span><br><span class="line">  student: &#123;</span><br><span class="line">    type: <span class="built_in">Array</span>,</span><br><span class="line">    <span class="keyword">default</span>: <span class="string">""</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>之后就拿着 props 中的数据进行数据渲染即可。</p><p><br></p><h2 id="父组件Form-vue"><a href="#父组件Form-vue" class="headerlink" title="父组件Form.vue"></a>父组件Form.vue</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;form&quot;&gt;</span><br><span class="line">    &lt;h3&gt;我是addStudent组件和StudentList组件的父组件&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">    &lt;add-student @add=&quot;addFunc&quot;&gt;&lt;/add-student&gt;</span><br><span class="line">    &lt;hr /&gt;</span><br><span class="line">    &lt;student-list :student=&quot;studentList&quot;&gt;&lt;/student-list&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import StudentList from &quot;./StudentList&quot;;</span><br><span class="line">import addStudent from &quot;./addStudent&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      studentList: []</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    addFunc(param) &#123;</span><br><span class="line">      console.log(param);</span><br><span class="line">      this.studentList.push(param);</span><br><span class="line">      //   console.log(this.studentList);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    StudentList,</span><br><span class="line">    addStudent</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><br></p><h2 id="子组件addStudent-vue"><a href="#子组件addStudent-vue" class="headerlink" title="子组件addStudent.vue"></a>子组件addStudent.vue</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;addStudent&quot;&gt;</span><br><span class="line">    添加学生：</span><br><span class="line">    &lt;input type=&quot;text&quot; v-model=&quot;name&quot; /&gt;</span><br><span class="line">    &lt;button @click=&quot;addStu&quot;&gt;添加&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      name: &quot;&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    addStu() &#123;</span><br><span class="line">      this.$emit(&quot;add&quot;, this.name); //子组件向父组件派发一个方法，子组件向父组件传值</span><br><span class="line">      //注意这个this.$emit的this不能没写</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;   </span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><br></p><h2 id="子组件StudentList-vue"><a href="#子组件StudentList-vue" class="headerlink" title="子组件StudentList.vue"></a>子组件StudentList.vue</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;StudentList&quot;&gt;</span><br><span class="line">    学生列表：</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li v-for=&quot;(item,index) in student&quot; :key=&quot;index+item&quot;&gt;&#123;&#123;item&#125;&#125;&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;&#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  //   props: [&quot;student&quot;]  //简易写法</span><br><span class="line">  props: &#123;</span><br><span class="line">    student: &#123;</span><br><span class="line">      type: Array,</span><br><span class="line">      default: &quot;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><br></p><p>这种子组件比较少的还好说，如果是很多个子组件公用一个公共数据，这样的非父子组件传值方式就比较麻烦。可以采用Vuex。</p><p><br><br></p>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue写个日历组件</title>
      <link href="/2019/05/11/vue%E5%86%99%E4%B8%AA%E6%97%A5%E5%8E%86%E7%BB%84%E4%BB%B6.html"/>
      <url>/2019/05/11/vue%E5%86%99%E4%B8%AA%E6%97%A5%E5%8E%86%E7%BB%84%E4%BB%B6.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/calendar.jpg" alt=""></p><p><br></p><p>样式：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line"><span class="selector-class">.calendar</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.date-header</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.prev-month</span>,</span><br><span class="line"><span class="selector-class">.next-month</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">15px</span> solid transparent;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.prev-month</span> &#123;</span><br><span class="line">  <span class="attribute">border-right-color</span>: <span class="number">#007fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.next-month</span> &#123;</span><br><span class="line">  <span class="attribute">border-left-color</span>: <span class="number">#007fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.show-date</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#007fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.week-header</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.week-header</span> &gt; <span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#007fff</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.week-day</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.every-day</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">14.28%</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.other-day</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.now-day</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#007fff</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.active-day</span><span class="selector-pseudo">:not(.now-day)</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#007fff</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid <span class="number">#007fff</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">46px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>html:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"calendar"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"date-header"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"prev-month"</span> @<span class="attr">click</span>=<span class="string">"handlePrev"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"show-date"</span>&gt;</span>&#123;&#123; `$&#123;year&#125;年$&#123;month&#125;月$&#123;day&#125;日` &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"next-month"</span> @<span class="attr">click</span>=<span class="string">"handleNext"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"date-content"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"week-header"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>日<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>一<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>二<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>三<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>四<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>五<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>六<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"week-day"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"every-day"</span> <span class="attr">v-for</span>=<span class="string">"item in 42"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"item - beginDay &gt; 0 &amp;&amp; item - beginDay &lt;= curDays"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">:class</span>=<span class="string">"&#123;</span></span></span><br><span class="line"><span class="tag"><span class="string">                 'now-day': `$&#123;year&#125;-$&#123;month&#125;-$&#123;item - beginDay&#125;` === curDate,</span></span></span><br><span class="line"><span class="tag"><span class="string">                 'active-day': `$&#123;year&#125;-$&#123;month&#125;-$&#123;item - beginDay&#125;` === `$&#123;year&#125;-$&#123;month&#125;-$&#123;day&#125;`</span></span></span><br><span class="line"><span class="tag"><span class="string">               &#125;"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">:data-day</span>=<span class="string">"item - beginDay"</span></span></span><br><span class="line"><span class="tag">               @<span class="attr">click</span>=<span class="string">"handleChooseDay"</span></span></span><br><span class="line"><span class="tag">          &gt;</span></span><br><span class="line">            &#123;&#123; item - beginDay &#125;&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else-if</span>=<span class="string">"item - beginDay &lt;= 0"</span> <span class="attr">class</span>=<span class="string">"other-day"</span>&gt;</span>&#123;&#123; prevDays - beginDay + item&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span> <span class="attr">class</span>=<span class="string">"other-day"</span>&gt;</span>&#123;&#123; item - beginDay - curDays &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><p>JavaScript部分：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">'#app'</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      year: <span class="literal">null</span>,</span><br><span class="line">      month: <span class="literal">null</span>,</span><br><span class="line">      day: <span class="literal">null</span>,</span><br><span class="line">      curDate: <span class="literal">null</span>,</span><br><span class="line">      activeDay: <span class="literal">null</span></span><br><span class="line">    &#125;,</span><br><span class="line">    created () &#123;</span><br><span class="line">      <span class="keyword">this</span>.getInitTime();</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      getInitTime () &#123;</span><br><span class="line">        <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">        <span class="keyword">this</span>.year = date.getFullYear();</span><br><span class="line">        <span class="keyword">this</span>.month = date.getMonth() + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">this</span>.day = date.getDate();</span><br><span class="line">        <span class="keyword">this</span>.curDate = <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.year&#125;</span>-<span class="subst">$&#123;<span class="keyword">this</span>.month&#125;</span>-<span class="subst">$&#123;<span class="keyword">this</span>.day&#125;</span>`</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      computedDay (month) &#123;</span><br><span class="line">        <span class="keyword">const</span> day = <span class="keyword">this</span>.day;</span><br><span class="line">        <span class="keyword">const</span> year = <span class="keyword">this</span>.year;</span><br><span class="line">        <span class="keyword">const</span> allDay = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month, <span class="number">0</span>).getDate();</span><br><span class="line">        <span class="keyword">if</span>(day &gt; allDay) &#123;</span><br><span class="line">          <span class="keyword">this</span>.day = allDay;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      handlePrev () &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.month === <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="keyword">this</span>.month = <span class="number">12</span>;</span><br><span class="line">          <span class="keyword">this</span>.year --;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.month --;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.computedDay(<span class="keyword">this</span>.month);</span><br><span class="line">      &#125;,</span><br><span class="line">      handleNext () &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.month === <span class="number">12</span>) &#123;</span><br><span class="line">          <span class="keyword">this</span>.month = <span class="number">1</span>;</span><br><span class="line">          <span class="keyword">this</span>.year ++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.month ++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.computedDay(<span class="keyword">this</span>.month);</span><br><span class="line">      &#125;,</span><br><span class="line">      handleChooseDay (e) &#123;</span><br><span class="line">        <span class="keyword">this</span>.day = e.target.dataset.day;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;</span><br><span class="line">      beginDay () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="keyword">this</span>.year, <span class="keyword">this</span>.month - <span class="number">1</span>, <span class="number">1</span>).getDay();</span><br><span class="line">      &#125;,</span><br><span class="line">      curDays () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="keyword">this</span>.year, <span class="keyword">this</span>.month, <span class="number">0</span>).getDate();</span><br><span class="line">      &#125;,</span><br><span class="line">      prevDays () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="keyword">this</span>.year, <span class="keyword">this</span>.month - <span class="number">1</span>, <span class="number">0</span>).getDate();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p><br><br><br></p>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小案例 </tag>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webpack4复习笔记</title>
      <link href="/2019/05/10/webpack%E7%AC%94%E8%AE%B0.html"/>
      <url>/2019/05/10/webpack%E7%AC%94%E8%AE%B0.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p><br><br></p><h2 id="webpack的卸载"><a href="#webpack的卸载" class="headerlink" title="webpack的卸载"></a>webpack的卸载</h2><p>webpack4.x开始官方文档是说要单独安装webpack-cli所以如果是用4.+就需要卸载cli</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//删除全局webpack-cli  卸载uninstall可以简写成un，全局-g的完整写法是--global</span><br><span class="line">npm uninstall -g webpack-cli</span><br><span class="line">//删除本地（局部）webpack-cli</span><br><span class="line">npm uninstall webpack-cli</span><br><span class="line">//删除全局webpack</span><br><span class="line">npm uninstall -g webpack</span><br><span class="line">//删除本地webpack</span><br><span class="line">npm un webpack</span><br></pre></td></tr></table></figure><p><br><br></p><h2 id="webpack的安装与使用"><a href="#webpack的安装与使用" class="headerlink" title="webpack的安装与使用"></a>webpack的安装与使用</h2><p>在空文件夹pratice下执行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//全局安装，默认最新版本，可以使用@指定版本</span><br><span class="line">npm install webpack -g</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//可以使用cnpm淘宝镜像，这样速度更快</span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line">//用cnpm来安装。速度较快</span><br><span class="line">cnpm install webpack -g</span><br><span class="line"></span><br><span class="line">//在3版本及之前安装webpack的时候就一同把webpack-cli也下载了，但是webpack4开始需要手动安装webpack-cli</span><br><span class="line">//安装webpack-cli</span><br><span class="line">cnpm install webpack-cli -g</span><br><span class="line">//查看版本号</span><br><span class="line">webpack -v</span><br></pre></td></tr></table></figure><p>至此webpack安装成功。</p><p>然后执行webpack命令，结果报错：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/webpack4.jpg" alt=""></p><p>原因是webpack命令会默认打包<strong>该路径下src文件夹下的index.js文件</strong>，但是我们这个pratice是个空文件夹。我们可以新建一下src/index.js，然后再执行webpack就不会报错了。执行webpack后会自动生成一个dist文件夹，里面有将index.js打包好的main.js文件，默认是production压缩形式，可以执行<code>webpack --mode development</code>打包成未压缩的格式，方便阅读。</p><p>因为浏览器不支持require、import等那几个模块化变量，所以如果在src的js代码中使用了模块化，直接引用这样的js文件，浏览器是会报错的，所以需要通过webpack解析打包生成新的js文件，如上述的dist/main.js，然后引用这个js文件才ok。<br><br></p><h2 id="引入模块化的简单打包"><a href="#引入模块化的简单打包" class="headerlink" title="引入模块化的简单打包"></a>引入模块化的简单打包</h2><p>新建sum.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a+b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>新建minus.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a -b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>项目pratice中新建demo.js：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">'./sum.js'</span><span class="comment">/* 使用ES Module规范 */</span></span><br><span class="line"><span class="keyword">var</span> minus = <span class="built_in">require</span>(<span class="string">'./minus.js'</span>)<span class="comment">/* 使用commonjs规范 */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = sum(<span class="number">1</span>,<span class="number">5</span>);</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = minus(<span class="number">100</span>,<span class="number">9</span>);</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br></pre></td></tr></table></figure><p>引入了ES Module和commonJS的模块化代码，浏览器是不支持的，所以要使用webpack来打包生成目标js文件，但是这次我不想被默认地打包到dist/main.js中，故可以使用命令<code>webpack demo.js -o ./hh/bundle.js</code>将模块化代码打包到指定的路径下。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/webpack0.jpg" alt=""></p><p><br><br></p><h2 id="关于安装本地局部webpack"><a href="#关于安装本地局部webpack" class="headerlink" title="关于安装本地局部webpack"></a>关于安装本地局部webpack</h2><p>在此之前，我已经安装了<strong>全局的webpack</strong>，因此除了上述的项目路径下可以使用webpack指令，其他的路径也是可以使用的。但是最好再当前的项目路径下再安装一个<strong>本地局部的webpack</strong>。</p><p><strong>先在项目根路径下执行<code>npm init</code>指令进行项目初始化</strong>，该过程中可以一路回车。会生成一个package.json文件，里面会记录你的各种加载器loader、插件、webpack或者jQuery等等相关信息。这是非常方便的一个事情，举个例子：比如我拿到了别人给我的一个项目，package.json里面就记录了该项目所依赖的各种东西，比如webpack是3.0版本的，而我的全局webpack是4.0版本的，那么不用慌，我可以查看package.json里记录的信息，手动安装一次本地的webpack3.0。更方便的是我可以直接执行<code>npm install</code>指令自动下载package.json里面的所有依赖。</p><p>项目初始化完成后，执行<code>npm install webpack --save-dev</code>安装本地开发版本的webpack。之后会生成一个node modules的文件夹，里面都是安装下来的包。webpack-cli也是一样本地安装一次。</p><p><br><br></p><h2 id="关于webpack-config-js"><a href="#关于webpack-config-js" class="headerlink" title="关于webpack.config.js"></a>关于webpack.config.js</h2><p>webpack.config.js是webpack的默认配置文件，它的书写必须遵循CommonJs规范。它不是唯一的，一个项目可以有多个配置文件。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);<span class="comment">/* path是node里面的变量 */</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),<span class="comment">/* __dirname表示当前路径文件夹 */</span></span><br><span class="line">        filename: <span class="string">'my-first-webpack.bundle.js'</span><span class="comment">/* 打包文件的名字 */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">'development'</span>,<span class="comment">/* 设置打包出来的文件是未压缩的格式 */</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><br></p><h3 id="配置多个入口文件"><a href="#配置多个入口文件" class="headerlink" title="配置多个入口文件"></a>配置多个入口文件</h3><p>可以使用对象的方式</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);<span class="comment">/* path是node里面的变量 */</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        index: <span class="string">'./src/index.js'</span>,</span><br><span class="line">        app: <span class="string">'./src/app.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),<span class="comment">/* __dirname表示当前路径文件夹 */</span></span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span> <span class="comment">/* 注意这里用了[name] */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">'development'</span>,<span class="comment">/* 设置打包出来的文件是未压缩的格式 */</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>执行<code>webpack</code>指令后会在dist文件夹下生成对应的app.bundle.js和index.bundle.js。注意<code>filename: &#39;[name].bundle.js&#39;</code></p><p><br></p><h3 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h3><p>loader用于处理非js文件。在webpack中写相应的配置规则，并且安装相应的插件。下面以less-loader为例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//安装less-loader之前先安装less</span><br><span class="line">cnpm i style-loader less-loader css-loader less --save-dev</span><br></pre></td></tr></table></figure><p>修改webpack.config.js：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);<span class="comment">/* path是node里面的变量 */</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        index: <span class="string">'./src/index.js'</span>,</span><br><span class="line">        app: <span class="string">'./src/app.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),<span class="comment">/* __dirname表示当前路径文件夹 */</span></span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span> <span class="comment">/* 注意这里用了[name] */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.less$/</span>, <span class="attr">use</span>: [<span class="string">'style-loader'</span>,<span class="string">'css-loader'</span>,<span class="string">'less-loader'</span>] &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">'development'</span>,<span class="comment">/* 设置打包出来的文件是未压缩的格式 */</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>以下是常见的几个loader：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123; <span class="comment">// 配置所有第三方loader 模块的</span></span><br><span class="line">  rules: [ <span class="comment">// 第三方模块的匹配规则</span></span><br><span class="line">    &#123; <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="attr">use</span>: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>] &#125;, </span><br><span class="line">    &#123; <span class="attr">test</span>: <span class="regexp">/\.less$/</span>, <span class="attr">use</span>: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>, <span class="string">'less-loader'</span>] &#125;, </span><br><span class="line">    &#123; <span class="attr">test</span>: <span class="regexp">/\.scss$/</span>, <span class="attr">use</span>: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>, <span class="string">'sass-loader'</span>] &#125;, </span><br><span class="line">    &#123; <span class="attr">test</span>: <span class="regexp">/\.(jpg|png|gif|bmp|jpeg)$/</span>, <span class="attr">use</span>: <span class="string">'url-loader?limit=7631&amp;name=[hash:8]-[name].[ext]'</span> &#125;, <span class="comment">// 处理图片路径的loader</span></span><br><span class="line">    <span class="comment">// limit给定的值，是图片的大小，单位是byte， 如果我们引用的图片，大于或等于给定的limit值，则不会被转为base64格式的字符串， 如果图片小于给定的limit值，则会被转为base64的字符串</span></span><br><span class="line">    &#123; <span class="attr">test</span>: <span class="regexp">/\.(ttf|eot|svg|woff|woff2)$/</span>, <span class="attr">use</span>: <span class="string">'url-loader'</span> &#125;, <span class="comment">//处理字体文件的 loader </span></span><br><span class="line">    &#123; <span class="attr">test</span>: <span class="regexp">/\.js$/</span>, <span class="attr">use</span>: <span class="string">'babel-loader'</span>, <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span> &#125;, <span class="comment">//配置Babel来转换ES6语法</span></span><br><span class="line">    &#123; <span class="attr">test</span>: <span class="regexp">/\.vue$/</span>, <span class="attr">use</span>: <span class="string">'vue-loader'</span> &#125; <span class="comment">// 处理 .vue 文件的 loader</span></span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><br></p><h3 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h3><p>loader被用于转换某些非js类型的模块，而插件则可以执行范围更广的任务，包括：从打包优化和压缩，一直到重新定义环境中的变量等等。</p><p>想要使用一个插件，先安装下载，然后需要require()它，然后把它添加到<strong>plugins数组</strong>中。</p><p><code>cnpm i html-webpack-plugin -D</code>执行该指令安装插件。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);<span class="comment">/* path是node里面的变量 */</span></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>); <span class="comment">//通过 npm 安装</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        index: <span class="string">'./src/index.js'</span>,</span><br><span class="line">        app: <span class="string">'./src/app.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),<span class="comment">/* __dirname表示当前路径文件夹 */</span></span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span> <span class="comment">/* 注意这里用了[name] */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.less$/</span>, <span class="attr">use</span>: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>, <span class="string">'less-loader'</span>] &#125;,</span><br><span class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.ts$/</span>, <span class="attr">use</span>: <span class="string">'ts-loader'</span> &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin()<span class="comment">/* 这里可传参也可不传参 */</span></span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">'development'</span>,<span class="comment">/* 设置打包出来的文件是未压缩的格式 */</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>然后会在dist文件中生成index.html文件，里面自动引入了我们配置的js文件。</p><p><br><br></p><h2 id="JS-tree-shaking"><a href="#JS-tree-shaking" class="headerlink" title="JS tree shaking"></a><a href="https://webpack.docschina.org/guides/tree-shaking" target="_blank" rel="noopener">JS tree shaking</a></h2><p>项目文件 treeShaking，先项目初始化<code>npm init -y</code>，然后在生成的package.json里面添加<code>&quot;dev&quot;: &quot;webpack --mode development&quot;</code> ，之后就不用每次都执行那么长的指令了，直接<code>npm run dev</code>即可。同理也可以配置以下生产环境的指令<code>&quot;prod&quot;: &quot;webpack --mode production&quot;</code></p><p>js tree shaking通常用于描述移除 JavaScript 上下文中的未引用代码(dead-code)，就是把未使用到的js代码去掉，精简js代码。它依赖于 ES2015 模块语法的 <a href="http://exploringjs.com/es6/ch_modules.html#static-module-structure" target="_blank" rel="noopener">静态结构</a> 特性，例如 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import" target="_blank" rel="noopener"><code>import</code></a> 和 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export" target="_blank" rel="noopener"><code>export</code></a>。</p><p><br></p><h4 id="development-VS-production"><a href="#development-VS-production" class="headerlink" title="development VS production"></a>development VS production</h4><p>举个例子：</p><p>index.js:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;abc&#125; <span class="keyword">from</span> <span class="string">'../sum.js'</span>;</span><br><span class="line">abc();</span><br></pre></td></tr></table></figure><p>sum.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> abc = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'这是abc'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> heihei = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'这是heihei'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    abc,</span><br><span class="line">    heihei</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行npm run dev后生成main.js，事实上我们只引用到了sum.js中的abc，并没有使用heihei，但是在webpack生成的main.js中搜索heihei关键字，发现依旧生成了关于heihei的代码，这造成了不必要的冗余。</p><p>如果我们执行npm run prod生成main.js，我们发现没有生成关于heihei的代码，因为production模式下会自动去掉未使用的js代码，实现了tree shaking。</p><p><br></p><h4 id="webpack-deep-scope-plugin"><a href="#webpack-deep-scope-plugin" class="headerlink" title="webpack-deep-scope-plugin"></a>webpack-deep-scope-plugin</h4><p><code>Loadsh</code> 是一个一致性、模块化、高性能的 JavaScript 实用工具库。在数据操作时，我们经常会用的 loadsh 封装好的一些工具方法，但是并不想把整个包打包进项目里面。要用到 tree-shaking，必然要保证引用的模块都是 ES6 规范的。lodash-es 是着具备 ES6 模块化的版本，只需要直接引入就可以。 </p><p>先安装lodash-es： <code>cnpm i lodash-es -D</code></p><p>sum.js中引入lodash-es库：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lodash <span class="keyword">from</span> <span class="string">'lodash-es'</span></span><br><span class="line"><span class="keyword">var</span> abc = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'这是abc'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> isArray = <span class="function"><span class="keyword">function</span>(<span class="params">arg</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(lodash.isArray(arg)); <span class="comment">/* 判断传入的参数是否为数组 */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    abc,</span><br><span class="line">    isArray</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是index.js中仍然只使用abc：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;abc&#125; <span class="keyword">from</span> <span class="string">'../sum.js'</span>;</span><br><span class="line">abc();</span><br></pre></td></tr></table></figure><p>执行npm run dev，发现打包后的文件大小多达1.5Mb，相比于npm run prod生成的只有86Kb大小，因为它把lodash-es也打包进去了尽管我们index.js中并没有真正使用到lodash-es。但是尽管npm run prod生成的main.js确实比development的小，<strong>事实上它也打包了lodash-es里的代码了</strong>，只是比前者少了一点。因为npm run prod只能进行词法语法层面上的分析（sum.js中确实写了些关于lodash-es的代码），无法进行<strong>scope作用域</strong>上的分析，到底真正用没用它是不知道的。因此，<strong>npm run prod并不是最佳的tree shaking</strong>。</p><p>这里 就需要用到一个插件： <a href="https://github.com/vincentdchan/webpack-deep-scope-analysis-plugin" target="_blank" rel="noopener">webpack-deep-scope-plugin</a>。 先安装<code>npm i  webpack-deep-scope-plugin -D</code></p><p>在webpack.config.js中进行配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> WebpackDeepScopeAnalysisPlugin = <span class="built_in">require</span>(<span class="string">'webpack-deep-scope-plugin'</span>).default;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> WebpackDeepScopeAnalysisPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，执行<code>npm run prod</code>，我们发现打包出来的main.js大小不到1Kb。js tree shaking得到了较好的结果。</p><p><br><br></p><h2 id="CSS-tree-shaking"><a href="#CSS-tree-shaking" class="headerlink" title="CSS tree shaking"></a>CSS tree shaking</h2><p>首先关于css的，就一定要先安装好style-loader和css-loader，以及写好配置规则。<br></p><h3 id="单独抽离出css"><a href="#单独抽离出css" class="headerlink" title="单独抽离出css"></a>单独抽离出css</h3><p>然后需要安装一个插件<a href="https://github.com/webpack-contrib/mini-css-extract-plugin" target="_blank" rel="noopener">mini-css-extract-plugin</a>，用于单独抽离出css文件而非被写进main.js中。</p><p>写好配置规则：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> WebpackDeepScopeAnalysisPlugin = <span class="built_in">require</span>(<span class="string">'webpack-deep-scope-plugin'</span>).default;</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">'mini-css-extract-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="attr">use</span>: [MiniCssExtractPlugin.loader, <span class="string">'css-loader'</span>] &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> WebpackDeepScopeAnalysisPlugin(),</span><br><span class="line">        <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename: <span class="string">'[name].css'</span>,</span><br><span class="line">            <span class="comment">// chunkFilename: '[id].css',</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意的是，这里用MiniCssExtractPlugin.loader代替了之前的style-loader，style-loader是生成行间样式的，这个mini-css-extract-plugin插件可以生成一个main.css文件，然后我们就可以使用<code>&lt;link rel=&quot;stylesheet&quot; href=&quot;../dist//main.css&quot;&gt;</code>来引入css。在生成的dist/main.js中是没有关于demo.css的代码的，做到了单独抽离出css文件。</p><p><br></p><h3 id="css抖动"><a href="#css抖动" class="headerlink" title="css抖动"></a>css抖动</h3><p>渡一视频这里用到了一个新的插件<a href="https://github.com/webpack-contrib/purifycss-webpack" target="_blank" rel="noopener">purifycss-webpack</a>。但是这个插件已经被弃用了，用起来也有些bug，有些有被使用到的css没有被打包。我这里就不写了。</p><p><br><br></p><h2 id="复习一下处理css-less和postcss"><a href="#复习一下处理css-less和postcss" class="headerlink" title="复习一下处理css/less和postcss"></a>复习一下处理css/less和postcss</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br><span class="line">npm i webpack -D</span><br><span class="line">npm i webpack-cli -D</span><br><span class="line">npm i css-loader -D</span><br><span class="line">npm i style-loader -D</span><br><span class="line">npm i less -D</span><br><span class="line">npm i less-loader -D</span><br><span class="line">npm i mini-css-extract-plugin -D</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">//demo.css</span><br><span class="line">*&#123;</span><br><span class="line">    <span class="attribute">margin</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#000</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">100px</span> auto;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(45deg);</span><br><span class="line">    .box &#123;</span><br><span class="line">        <span class="selector-tag">position</span>: <span class="selector-tag">absolute</span>;</span><br><span class="line">        <span class="selector-tag">width</span>: 300<span class="selector-tag">px</span>;</span><br><span class="line">        <span class="selector-tag">height</span>: 300<span class="selector-tag">px</span>;</span><br><span class="line">        <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#000</span>;</span><br><span class="line">        <span class="selector-tag">top</span>: 40%;</span><br><span class="line">        <span class="selector-tag">left</span>: 40%;</span><br><span class="line">        <span class="selector-tag">text-align</span>: <span class="selector-tag">center</span>;</span><br><span class="line">        <span class="selector-tag">a</span>&#123;</span><br><span class="line">            <span class="attribute">color</span>: pink;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">30px</span>;</span><br><span class="line">            <span class="attribute">line-height</span>: <span class="number">300px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//demo.less</span></span><br><span class="line">*&#123;</span><br><span class="line">    <span class="attribute">margin</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#000</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">100px</span> auto;</span><br><span class="line">    <span class="attribute">transform</span>: rotate(<span class="number">45deg</span>);</span><br><span class="line">    <span class="selector-class">.box</span> &#123;</span><br><span class="line">        <span class="attribute">position</span>: absolute;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">        <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#000</span>;</span><br><span class="line">        <span class="attribute">top</span>: <span class="number">40%</span>;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">40%</span>;</span><br><span class="line">        <span class="attribute">text-align</span>: center;</span><br><span class="line">        <span class="selector-tag">a</span>&#123;</span><br><span class="line">            <span class="attribute">color</span>: pink;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">30px</span>;</span><br><span class="line">            <span class="attribute">line-height</span>: <span class="number">300px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"> <span class="keyword">import</span> <span class="string">'./demo.css'</span>;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//index.html</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/index.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">'mini-css-extract-plugin'</span>); <span class="comment">//单独抽离出css文件</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry:&#123;</span><br><span class="line">        index: <span class="string">'./index.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output:&#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>:&#123;</span><br><span class="line">        rules:[</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use:[</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: MiniCssExtractPlugin.loader,</span><br><span class="line">                        <span class="comment">// options:&#123;  &#125;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'css-loader'</span>,</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use:[</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: MiniCssExtractPlugin.loader,</span><br><span class="line">                        <span class="comment">// options:&#123;  &#125;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'css-loader'</span>,</span><br><span class="line"></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'less-loader'</span>,</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename: <span class="string">'[name].css'</span>,</span><br><span class="line">            <span class="comment">// chunkFilename: '[id].css',</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><h3 id="postcss"><a href="#postcss" class="headerlink" title="postcss"></a>postcss</h3><p>有个问题就是关于css3的兼容代码，像demo.less里面的<code>transform: rotate(45deg);</code>，需要写：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">transform</span>: <span class="selector-tag">rotate</span>(45<span class="selector-tag">deg</span>);</span><br><span class="line"><span class="selector-tag">-ms-transform</span>: <span class="selector-tag">rotate</span>(45<span class="selector-tag">deg</span>);        <span class="comment">/* IE 9 */</span></span><br><span class="line"><span class="selector-tag">-webkit-transform</span>: <span class="selector-tag">rotate</span>(45<span class="selector-tag">deg</span>);    <span class="comment">/* Safari and Chrome */</span></span><br><span class="line"><span class="selector-tag">-o-transform</span>: <span class="selector-tag">rotate</span>(45<span class="selector-tag">deg</span>);        <span class="comment">/* Opera */</span></span><br><span class="line"><span class="selector-tag">-moz-transform</span>: <span class="selector-tag">rotate</span>(45<span class="selector-tag">deg</span>);        <span class="comment">/* Firefox */</span></span><br></pre></td></tr></table></figure><p>基于postcss可以自动帮我们加上这些兼容的前缀。</p><p>另一个问题就是基于postcss可以解析cssnext的代码：</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//带有cssnext代码的demo.less</span></span><br><span class="line">*&#123;</span><br><span class="line">    <span class="attribute">margin</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#000</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">100px</span> auto;</span><br><span class="line">    <span class="attribute">transform</span>: rotate(<span class="number">45deg</span>);</span><br><span class="line">    <span class="selector-class">.box</span> &#123;</span><br><span class="line">        <span class="attribute">position</span>: absolute;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">        <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#000</span>;</span><br><span class="line">        <span class="attribute">top</span>: <span class="number">40%</span>;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">40%</span>;</span><br><span class="line">        <span class="attribute">text-align</span>: center;</span><br><span class="line">        <span class="selector-tag">a</span>&#123;</span><br><span class="line">            <span class="attribute">color</span>: pink;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">30px</span>;</span><br><span class="line">            <span class="attribute">line-height</span>: <span class="number">300px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:root</span>&#123;</span><br><span class="line">    <span class="attribute">--color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: var(--color);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><h3 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm i postcss postcss-loader autoprefixer cssnano postcss-cssnext -D</span><br></pre></td></tr></table></figure><p><strong>webpack.config.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">'mini-css-extract-plugin'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry:&#123;</span><br><span class="line">        index: <span class="string">'./index.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output:&#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>:&#123;</span><br><span class="line">        rules:[</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use:[</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: MiniCssExtractPlugin.loader,</span><br><span class="line">                        <span class="comment">// options:&#123;  &#125;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'css-loader'</span>,</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use:[</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: MiniCssExtractPlugin.loader,</span><br><span class="line">                        <span class="comment">// options:&#123;  &#125;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'css-loader'</span>,</span><br><span class="line"></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;   <span class="comment">/* 这部分要写在css-loader之后、less-loader之前 */</span></span><br><span class="line">                        loader: <span class="string">'postcss-loader'</span>,</span><br><span class="line">                        options:&#123;</span><br><span class="line">                            ident: <span class="string">'postcss'</span>,</span><br><span class="line">                            plugins:[</span><br><span class="line">                                <span class="built_in">require</span>(<span class="string">'postcss-cssnext'</span>)(), <span class="comment">/* 用于解析cssnext代码，并实现autoprefixer的功能 */</span></span><br><span class="line">                                <span class="comment">// require('autoprefixer')(),/* 用于自动添加兼容前缀 , 注意在数组里面不可以有分号*/</span></span><br><span class="line">                                <span class="built_in">require</span>(<span class="string">'cssnano'</span>)() <span class="comment">/* 用于压缩代码 */</span></span><br><span class="line">                            ]</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'less-loader'</span>,</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename: <span class="string">'[name].css'</span>,</span><br><span class="line">            <span class="comment">// chunkFilename: '[id].css',</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br></p><h2 id="单独抽离html文件"><a href="#单独抽离html文件" class="headerlink" title="单独抽离html文件"></a>单独抽离html文件</h2><p><br></p><h3 id="HtmlWebpackPlugin"><a href="#HtmlWebpackPlugin" class="headerlink" title="HtmlWebpackPlugin"></a><a href="https://webpack.docschina.org/plugins/html-webpack-plugin/" target="_blank" rel="noopener">HtmlWebpackPlugin</a></h3><p>npm install –save-dev html-webpack-plugin 安装之，然后再webpack.config.js中配置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename: <span class="string">'[name].css'</span>,</span><br><span class="line">            <span class="comment">// chunkFilename: '[id].css',</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            filename: <span class="string">'index.html'</span>,</span><br><span class="line">            template: <span class="string">'./index.html'</span>,</span><br><span class="line">            minify:&#123;</span><br><span class="line">                removeComments: <span class="literal">true</span>,  <span class="comment">/* 清理掉index.html里面的注释 */</span></span><br><span class="line">                collapseWhitespace: <span class="literal">true</span>, <span class="comment">/* 清理掉空格 */</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure><p>之后会生成dist/index.html，而且里面会自动引入所需要的css和 js，因此不必再src/index.html中手动加入了。 </p><p>事实上html-webpack-plugin还有很多可以配置的东西，网上都有。</p><p><br></p><h3 id="clean-webpack-plugin"><a href="#clean-webpack-plugin" class="headerlink" title="clean-webpack-plugin"></a><a href="https://github.com/johnagan/clean-webpack-plugin" target="_blank" rel="noopener">clean-webpack-plugin</a></h3><p>另外我们每次webpack要重新生成dist文件夹的时候，之前生成的一直都在着需要手动删除，比较麻烦，所以可以使用一个插件<code>clean-webpack-plugin</code>。 命令<code>npm i clean-webpack-plugin -D</code>执安装之。</p><p>然后再webpack.config.js中配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> CleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin()</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure><p>即可。</p><p><br><br></p><h2 id="提取公共JS代码"><a href="#提取公共JS代码" class="headerlink" title="提取公共JS代码"></a>提取公共JS代码</h2><p>存在一个情况，假如有a，b两个js文件，它俩都引入了一个相同的第三方库或者是相同的自定义的模块。那么当我们加载a文件的时候会把它打包出来，包括引用了的相同的库和模块，而加载b文件的时候也做了相同的事情，那么明明是相同的一个库或模块，却被打包了两次，这样就冗余了，降低了效率。我们将同一个代码/模块/库打包了多次，因此我们需要做到提取公共JS代码，避免上述情况发生，实现减少代码冗余，提高项目的加载速度。</p><p>注意的是，提取公共代码针对的是多入口文件，如果只有一个js文件的话是不成立的。提取公共代码至少是两个文件。</p><p><br></p><h3 id="案例一：-自定义公共业务代码"><a href="#案例一：-自定义公共业务代码" class="headerlink" title="案例一： 自定义公共业务代码"></a>案例一： 自定义公共业务代码</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这是一个公共模块 module.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">'module'</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//subPageA.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./module.js'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">'subPageA'</span>;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//subPageB.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./module.js'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">'subPageB'</span>;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pageA.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./subPageA.js'</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pageB.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./subPageB.js'</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">entry:&#123;</span><br><span class="line">    <span class="comment">// index: './index.js'</span></span><br><span class="line">    pageA: <span class="string">'./src/pageA.js'</span>,</span><br><span class="line">    pageB: <span class="string">'./src/pageB.js'</span>,</span><br><span class="line">&#125;,</span><br><span class="line">output:&#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    filename: <span class="string">'[name][hash:5].bundle.js'</span>,</span><br><span class="line">    chunkFilename: <span class="string">'[name][hash:5].js'</span></span><br><span class="line">&#125;,</span><br><span class="line">optimization:&#123;</span><br><span class="line">    splitChunks:&#123;</span><br><span class="line">        cacheGroups:&#123;</span><br><span class="line">            common:&#123;</span><br><span class="line">                name:<span class="string">"common"</span>, <span class="comment">/* 表示打包出来的公共模块的名字，不写的话就默认是chunkFilename */</span></span><br><span class="line">                chunks:<span class="string">'all'</span>, <span class="comment">/* 表示作用的范围 */</span></span><br><span class="line">                minSize: <span class="number">1</span>, <span class="comment">/* minSize表示生成公共代码块所需要最小的体积，默认是30kb */</span></span><br><span class="line">                minChunks: <span class="number">2</span><span class="comment">/* 表示公共模块被引用的最小次数，这里表示当一个模块被引用了2次以上就视为公共代码块 */</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>打包后的：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/webpack1.jpg" alt=""></p><p><br></p><h3 id="案例二：-从lodash中提取公共代码"><a href="#案例二：-从lodash中提取公共代码" class="headerlink" title="案例二： 从lodash中提取公共代码"></a>案例二： 从lodash中提取公共代码</h3><p>先安装一下lodash： cnpm i lodash -D</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pageA.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./subPageA.js'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span>; <span class="comment">//引用lodash</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pageB.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./subPageB.js'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span>; <span class="comment">//引用lodash</span></span><br></pre></td></tr></table></figure><p>注意的是，我们之前打包出来的公共js文件是我们自定义的公共模块，这里我们引用了第三方库lodash，最好是不要和我们自定义的模块一同被打包到一个公共js文件中，因此需要再配置一下。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">entry:&#123;</span><br><span class="line">    <span class="comment">// index: './index.js'</span></span><br><span class="line">    pageA: <span class="string">'./src/pageA.js'</span>,</span><br><span class="line">    pageB: <span class="string">'./src/pageB.js'</span>,</span><br><span class="line">&#125;,</span><br><span class="line">output:&#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    filename: <span class="string">'[name][hash:5].bundle.js'</span>,</span><br><span class="line">    chunkFilename: <span class="string">'[name][hash:5].js'</span></span><br><span class="line">&#125;,</span><br><span class="line">optimization:&#123;</span><br><span class="line">    splitChunks:&#123;</span><br><span class="line">        cacheGroups:&#123;</span><br><span class="line">            common:&#123;</span><br><span class="line">                name:<span class="string">"common"</span>, <span class="comment">/* 表示打包出来的公共模块的名字，不写的话就默认是chunkFilename */</span></span><br><span class="line">                chunks:<span class="string">'all'</span>, <span class="comment">/* 表示作用的范围 */</span></span><br><span class="line">                minSize: <span class="number">1</span>, <span class="comment">/* minSize表示生成公共代码块所需要最小的体积，默认是30kb */</span></span><br><span class="line">                minChunks: <span class="number">2</span>,<span class="comment">/* 表示公共模块被引用的最小次数，这里表示当一个模块被引用了2次以上就视为公共代码块 */</span></span><br><span class="line">                priority: <span class="number">1</span> <span class="comment">/* 设置优先级，低于vendor的 */</span></span><br><span class="line">            &#125;,</span><br><span class="line">            vendor:&#123;</span><br><span class="line">                name:<span class="string">'vendor'</span>,</span><br><span class="line">                test:<span class="regexp">/[\\/]node_modules[\\/]/</span>,<span class="comment">/* 表示匹配node_modules里的第三方库lodash */</span></span><br><span class="line">                priority: <span class="number">10</span>,<span class="comment">/* 设置优先级，先打包node_modules的*/</span></span><br><span class="line">                chunks: <span class="string">'all'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>打包之后：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/webpack2.jpg" alt=""></p><p><br><br></p><h2 id="处理图片"><a href="#处理图片" class="headerlink" title="处理图片"></a>处理图片</h2><p>项目根目录img</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br><span class="line">npm i webpack -D</span><br><span class="line">npm i webpack-cli -D</span><br><span class="line">npm i css-loader -D</span><br><span class="line">npm i style-loader -D</span><br><span class="line">npm i mini-css-extract-plugin -D</span><br><span class="line">npm i clean-webpack-plugin -D</span><br><span class="line">npm i html-webpack-plugin -D</span><br><span class="line"></span><br><span class="line">//处理图片要安装以下loader和插件</span><br><span class="line">cnpm i url-loader img-loader -D</span><br><span class="line">cnpm i file-loader -D</span><br><span class="line">npm install imagemin-pngquant -D</span><br><span class="line">npm i imagemin -D</span><br><span class="line">npm i html-loader -D</span><br></pre></td></tr></table></figure><p><br></p><p><a href="https://www.npmjs.com/package/img-loader" target="_blank" rel="noopener">关于img-loader</a>和<a href="https://github.com/imagemin/imagemin-pngquant" target="_blank" rel="noopener">imagemin-pngquant</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">var path = require(&quot;path&quot;);</span><br><span class="line">const MiniCssExtractPlugin = require(&apos;mini-css-extract-plugin&apos;); //单独抽离出css文件</span><br><span class="line">var HtmlWebpackPlugin = require(&apos;html-webpack-plugin&apos;);</span><br><span class="line">const CleanWebpackPlugin = require(&apos;clean-webpack-plugin&apos;);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        index: &apos;./index.js&apos;</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, &quot;dist&quot;),</span><br><span class="line">        filename: &apos;[name][hash:5].bundle.js&apos;</span><br><span class="line">    &#125;,</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.css$/,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: MiniCssExtractPlugin.loader,</span><br><span class="line">                        // options:&#123;  &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123; loader: &apos;css-loader&apos; &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123; // limit 给定的值，是图片的大小，单位是 byte， 如果我们引用的 图片，大于或等于给定的 limit值，则不会被转为base64格式的字符串， 如果 图片小于给定的 limit 值，则会被转为 base64的字符串</span><br><span class="line">                test: /\.(jpg|png|gif|bmp|jpeg)$/,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: &apos;url-loader&apos;,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            name: &apos;[name][hash:5].[ext]&apos;,</span><br><span class="line">                            /* 限制图片大小 */</span><br><span class="line">                            limit: 77967,</span><br><span class="line">                            outputPath: &apos;img&apos; /* 会创建dist/img文件夹 */</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    // use: &apos;url-loader?limit=7631&amp;name=[hash:8]-[name].[ext]&apos; </span><br><span class="line">                    &#123;</span><br><span class="line">                        loader:&apos;img-loader&apos;,</span><br><span class="line">                        options:&#123;</span><br><span class="line">                            plugins:[</span><br><span class="line">                                require(&apos;imagemin-pngquant&apos;)(&#123;</span><br><span class="line">                                    quality:[0.3,0.6]</span><br><span class="line">                                  &#125;),</span><br><span class="line">                            ]</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.(ttf|eot|svg|woff|woff2)$/,</span><br><span class="line">                use: &apos;url-loader&apos;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        new MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename: &apos;[name].css&apos;,</span><br><span class="line">            // chunkFilename: &apos;[id].css&apos;,</span><br><span class="line">        &#125;),</span><br><span class="line">        new HtmlWebpackPlugin(&#123;</span><br><span class="line">            filename: &apos;index.html&apos;,</span><br><span class="line">            template: &apos;./index.html&apos;,</span><br><span class="line">            // minify:&#123;</span><br><span class="line">            // removeComments: true,  /* 清理掉index.html里面的注释 */</span><br><span class="line">            // collapseWhitespace: true, /* 清理掉空格 */</span><br><span class="line">            // &#125;</span><br><span class="line">        &#125;),</span><br><span class="line">        new CleanWebpackPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上到这一步为止，只能处理css中的url，尚无法解析html中引用的图片路径，比如html中的<code>&lt;img src=&quot;./logo.png&quot; alt=&quot;&quot;&gt;</code>是会报错的。因此需要安装一个html-loader，然后在webpack.config.js中的module-&gt;rules添加一个test:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> &#123;</span><br><span class="line">    test:<span class="regexp">/\.html$/</span>,</span><br><span class="line">    use: [</span><br><span class="line">        &#123;</span><br><span class="line">            loader: <span class="string">'html-loader'</span>,</span><br><span class="line">            options:&#123;</span><br><span class="line">                attrs:[<span class="string">'img:src'</span>]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后就 ok 了</p><p><br><br></p><h2 id="webpack-dev-server开启本地服务器"><a href="#webpack-dev-server开启本地服务器" class="headerlink" title="webpack-dev-server开启本地服务器"></a>webpack-dev-server开启本地服务器</h2><p>先安装 ：  npm install webpack-dev-server -g    要全局安装</p><p>安装成功后执行命令<code>webpack-dev-server --open</code>就可以了，默认在localhost:8080端口，项目就启动了。但是要注意的是，该命令并没有把项目进行打包，所以最后发布的时候还是要用webpack指令进行打包。</p><p>它会实时监听代码的变化。</p><p><br></p><h3 id="devServer配置："><a href="#devServer配置：" class="headerlink" title="devServer配置："></a>devServer配置：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    ...</span><br><span class="line">    devServer:&#123;</span><br><span class="line">    port:&apos;9091&apos;,</span><br><span class="line">    // contentBase:&apos;dist&apos; /* 不填的话默认是项目根路径 */</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br></p><h2 id="进行数据交互"><a href="#进行数据交互" class="headerlink" title="进行数据交互"></a>进行数据交互</h2><p>mock一个假数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//data.json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;新裤子乐队&quot;,</span><br><span class="line">    &quot;birthday&quot;: &quot;1996&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//index.js</span><br><span class="line">var data = require(&apos;./data.json&apos;);</span><br><span class="line">console.log(data);</span><br></pre></td></tr></table></figure><p>然后就可以了。</p><p><br><br></p><p>再来说说使用ajax的：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</span><br><span class="line"><span class="keyword">var</span> data = <span class="built_in">require</span>(<span class="string">'./data.json'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(data);</span><br><span class="line"></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    url: <span class="string">'http://localhost:9091/data.json'</span>,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'ajax获取数据成功：'</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(data);</span><br><span class="line">    &#125;,</span><br><span class="line">    error:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'获取数据失败！'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br><br></p><h2 id="热更新-hot-module-replace"><a href="#热更新-hot-module-replace" class="headerlink" title="热更新 hot module replace"></a>热更新 hot module replace</h2><p>虽然说webpack-dev-server可以自动监听代码变化并自动刷新，但是它每次刷新都要整个页面刷新，整个页面的所有数据都要重新请求一遍，实际上修改的只是一部分，其他的是不必要重新请求的。这里引出了<strong>热更新</strong>这个概念。热更新，英文为 <strong>hot module replace</strong>，直译为“热模块替换”，这里的热模块就是被修改的那部分模块。</p><p>webpack中内置了热更新的插件，所以不必再下载，直接再webpack.config.js中配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">var</span> Webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);<span class="comment">//第一步</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    ...</span><br><span class="line">    plugins:[</span><br><span class="line">        ...,</span><br><span class="line">    <span class="comment">//第二步</span></span><br><span class="line">        <span class="keyword">new</span> Webpack.HotModuleReplacementPlugin(), <span class="comment">/* webpack内置的热更新插件 */</span></span><br><span class="line">    ],</span><br><span class="line">    devServer:&#123;</span><br><span class="line">        port: <span class="string">"9091"</span>,</span><br><span class="line">        <span class="comment">// contentBase: 'dist'  /* 默认是项目根路径 */</span></span><br><span class="line">        hot: <span class="literal">true</span>, <span class="comment">/* 开启热更新 */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样热更新基本实现了。<br></p><p><strong>【需要注意的是】：</strong></p><p>对于CSS，如果使用了MiniCssExtractPlugin单独抽离出来css文件，那么这个热更新是无效的。之对于使用style-loader的有效。</p><p>对于JS，目前这一步是无法实现对于js的热更新的 ，需要再js文件中添加如下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="built_in">module</span>.hot)&#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.accept();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样就实现了对于js代码的热更新。</p><p><br><br><br><br></p>]]></content>
      
      
      <categories>
          
          <category> webpack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES6数据劫持proxy&amp;reflect</title>
      <link href="/2019/04/03/ES6%E6%95%B0%E6%8D%AE%E5%8A%AB%E6%8C%81.html"/>
      <url>/2019/04/03/ES6%E6%95%B0%E6%8D%AE%E5%8A%AB%E6%8C%81.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="ES5数据劫持"><a href="#ES5数据劫持" class="headerlink" title="ES5数据劫持"></a>ES5数据劫持</h2><p>VUE的双向数据绑定的基础知识。</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/006ttwEMgy1g286elh0cuj30fy07twft.jpg" alt=""></p><p><strong>对对象的监测</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> oDiv = <span class="built_in">document</span>.getElementById(<span class="string">'show'</span>);</span><br><span class="line"><span class="keyword">var</span> oInput = <span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> oData = &#123;</span><br><span class="line">    valueObj: &#123;</span><br><span class="line">        value: <span class="string">'duntengOG'</span>,</span><br><span class="line">        name: <span class="string">'haha'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    sex: <span class="string">'aaa'</span>  </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">oInput.oninput = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    oData.value = <span class="keyword">this</span>.value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upDate</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    oDiv.innerText = oData.valueObj.value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upDate();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监控对象的某个属性是否发生改变</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Observer</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!data || <span class="keyword">typeof</span> data != <span class="string">'object'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// for (var prop in data) &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123;</span><br><span class="line">        definedRective(data, key, data[key]);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">definedRective</span> (<span class="params">data, key, val</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// AO</span></span><br><span class="line">    Observer(val);<span class="comment">//针对对象属性的监测</span></span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(data, key, &#123;</span><br><span class="line">        get () &#123;</span><br><span class="line">            <span class="comment">// console.log('get');</span></span><br><span class="line">            <span class="keyword">return</span> val;</span><br><span class="line">        &#125;,</span><br><span class="line">        set (newValue) &#123;</span><br><span class="line">            <span class="keyword">if</span> (newValue == val) <span class="keyword">return</span>;</span><br><span class="line">            val = newValue;</span><br><span class="line">            upDate();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Observer(oData);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(oData.valueObj);</span><br><span class="line">oData.valueObj.value = <span class="string">'haha'</span>;</span><br></pre></td></tr></table></figure><p>有个缺点就是如果之后该对象又新增了一个属性，则Observer是无法监测到的</p><p><strong>对数组的监测</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [];</span><br><span class="line"><span class="keyword">let</span> &#123;push&#125; = <span class="built_in">Array</span>.prototype;<span class="comment">//解构赋值定义一个push函数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upData</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'更新后的数组arr为：'</span>+arr);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(<span class="built_in">Array</span>.prototype, <span class="string">'push'</span>, &#123;</span><br><span class="line">    value: (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function">(<span class="params">...arg</span>) =&gt;</span> &#123;</span><br><span class="line">            push.apply(arr, arg);</span><br><span class="line">            upData();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)()</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">arr.push(<span class="number">1</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure><h2 id="ES6数据劫持"><a href="#ES6数据劫持" class="headerlink" title="ES6数据劫持"></a>ES6数据劫持</h2><p><strong>proxy &amp; reflect</strong></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/006ttwEMly1g29c5nx2b1j30ex08hab8.jpg" alt=""></p><p>ES6中新增的proxy&amp;reflect实现了数据劫持的功能，是ES6在较底层实现的功能所以不用babel转换。代码量比ES5的少了，而且不会出现像ES5那样在程序后续过程中新增监测对象属性监测不到的情况。但是proxy&amp;reflect的兼容性不好。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> oData = &#123;</span><br><span class="line">    val: <span class="string">'duntengOG'</span>,</span><br><span class="line">    _val: <span class="string">'aaaa'</span><span class="comment">//我们定义的私有属性，不想让别人知道</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> oProxyData = <span class="keyword">new</span> <span class="built_in">Proxy</span>(oData, &#123;</span><br><span class="line">    set(target, key, value, receiver) &#123;</span><br><span class="line">        <span class="comment">// console.log(target, key, value, receiver); target就是代理对象，key即操作的属性</span></span><br><span class="line">        <span class="built_in">Reflect</span>.set(target, key, value);</span><br><span class="line">        upDate();</span><br><span class="line">    &#125;,</span><br><span class="line">    get(target, key, receiver) &#123;</span><br><span class="line">        <span class="comment">// console.log(target, key, receiver);</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, key);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 还有has、deleteProperty。。。等操作，但不是很常见</span></span><br><span class="line">    has(target, key) &#123;</span><br><span class="line">        <span class="keyword">return</span> key.indexOf(<span class="string">'_'</span>) != <span class="number">-1</span> ? <span class="literal">false</span> : key <span class="keyword">in</span> oData;</span><br><span class="line">    &#125;,</span><br><span class="line">    deleteProperty() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 读写 控制</span></span><br><span class="line"><span class="built_in">console</span>.log(oProxyData.val);</span><br><span class="line">oProxyData.val = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upDate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'更新了'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">oProxyData.name = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// console.log( delete oProxyData.val );</span></span><br></pre></td></tr></table></figure><p>（完）</p><p>转载请注明出处。</p>]]></content>
      
      
      <categories>
          
          <category> ES6 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> ES6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>箭头函数看这篇就够了</title>
      <link href="/2019/04/01/%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0%E7%9C%8B%E8%BF%99%E7%AF%87%E5%B0%B1%E5%A4%9F%E4%BA%86.html"/>
      <url>/2019/04/01/%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0%E7%9C%8B%E8%BF%99%E7%AF%87%E5%B0%B1%E5%A4%9F%E4%BA%86.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h1 id="初试箭头函数"><a href="#初试箭头函数" class="headerlink" title="初试箭头函数"></a>初试箭头函数</h1><p><strong>作用：</strong>函数目的指向性更强，可读性更好，简化代码，提高开发效率</p><p><strong>特点：</strong></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/006ttwEMly1g26yir0e5ij30ey09775m.jpg" alt=""></p><p><strong>代码1：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> add = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//也可以这样写，省略return更加简洁</span></span><br><span class="line"><span class="keyword">let</span> add = <span class="function">(<span class="params">a,b</span>)=&gt;</span>(a+b);</span><br></pre></td></tr></table></figure><p><strong>代码2：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对象的应用</span></span><br><span class="line"><span class="keyword">let</span> func1 = <span class="function">(<span class="params">a,b,c</span>)=&gt;</span>(&#123;a,b,c&#125;);</span><br><span class="line"><span class="keyword">let</span> func2 = <span class="function">(<span class="params">a,b,c</span>)=&gt;</span>(&#123;<span class="attr">aa</span>:a,<span class="attr">bb</span>:b,<span class="attr">cc</span>:c&#125;);</span><br><span class="line"><span class="comment">// let func3 = (a,b,c)=&gt;&#123;aa:a,bb:b,cc:c&#125;;//如果不加圆括号是会报错的</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(func1(<span class="number">12</span>,<span class="number">35</span>,<span class="number">5</span>));</span><br><span class="line"><span class="built_in">console</span>.log(func2(<span class="number">12</span>,<span class="number">35</span>,<span class="number">5</span>));</span><br><span class="line"><span class="comment">// console.log(func3(12,35,5));</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/006ttwEMly1g26yyfgxeij307705nwec.jpg" alt=""></p><p><strong>代码3：</strong></p><p><strong>箭头函数必须用一个东西来存，可以使变量、属性或者使数组</strong>，想比于ES5中函数可以用function funC(a,b){}格式声明，箭头函数是不允许的。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用变量存</span></span><br><span class="line"><span class="keyword">let</span> sum = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line">sum();<span class="comment">//这样调用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//用对象属性存</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    fn: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.fn();<span class="comment">//这样调用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//用数组存</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;];</span><br><span class="line">arr[<span class="number">0</span>]();<span class="comment">//这样调用</span></span><br></pre></td></tr></table></figure><h1 id="高阶函数应用"><a href="#高阶函数应用" class="headerlink" title="高阶函数应用"></a>高阶函数应用</h1><p>数学和计算机科学中，高阶<strong>函数</strong>是至少满足下列一个条件的<strong>函数</strong>： 接受一个或多个<strong>函数</strong>作为输入参数，返回输出一个<strong>函数</strong></p><p>箭头函数在高阶函数的应用中可以使代码更加简便，下面来看一下对比：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//高阶函数之ES5的传统方法</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">y</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">z</span>) </span>&#123; </span><br><span class="line">            <span class="keyword">return</span> x+y+z;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sum1 = sum(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">var</span> sum2 = sum1(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">var</span> sum3 = sum2(<span class="number">3</span>);</span><br><span class="line"><span class="built_in">console</span>.log(sum3);<span class="comment">//成功输出6</span></span><br><span class="line"><span class="comment">/*************把上面的函数改成箭头函数语法**********************/</span></span><br><span class="line"><span class="keyword">let</span> sum = <span class="function">(<span class="params">x</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">y</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function">(<span class="params">z</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> x+y+z;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*************进一步省略return**********************/</span></span><br><span class="line"><span class="keyword">let</span> sum = <span class="function">(<span class="params">x</span>)=&gt;</span><span class="function">(<span class="params">y</span>)=&gt;</span><span class="function">(<span class="params">z</span>)=&gt;</span>(x+y+z);</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>));<span class="comment">//输出6</span></span><br></pre></td></tr></table></figure><h1 id="arguments"><a href="#arguments" class="headerlink" title="arguments"></a>arguments</h1><p><strong>内部arguments和this都是由定义时外围最接近一层的非箭头函数的arguments和this决定其值的</strong> </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 举个例子</span></span><br><span class="line"><span class="keyword">var</span>  myfun1 = <span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">arguments</span>,a,b);</span><br><span class="line">&#125;</span><br><span class="line">myfun1(<span class="number">12</span>,<span class="number">5</span>);<span class="comment">//可以正常输出arguments和12和5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myfun2 = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">arguments</span>, a, b)</span><br><span class="line">&#125;</span><br><span class="line">myfun2(<span class="number">12</span>, <span class="number">5</span>);<span class="comment">//报错，arguments未定义,myfun2函数外围没有非箭头函数</span></span><br></pre></td></tr></table></figure><p>再举个带外围非箭头函数的例子：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> myfun2 = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">arguments</span>, a, b)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'我是箭头函数的外围非箭头函数test'</span>);</span><br><span class="line">    myfun2(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test(<span class="number">12</span>,<span class="number">5</span>,<span class="number">6</span>);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/006ttwEMly1g27050audjj30e505n3yg.jpg" alt=""></p><p>再说另一个应用场景：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ES5中获取外围最近函数的arguments的做法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Curry</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> arg = <span class="built_in">arguments</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(arg, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Curry(<span class="string">'a'</span>, <span class="string">'b'</span>)(<span class="number">11</span>, <span class="number">22</span>);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ES5中获取外围最近函数的arguments的做法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Curry</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Curry(<span class="string">'a'</span>, <span class="string">'b'</span>)(<span class="number">1</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure><h1 id="this"><a href="#this" class="headerlink" title="this"></a>this</h1><p><strong>内部arguments和this都是由定义时外围最接近一层的非箭头函数的arguments和this决定其值的</strong></p><p>不过有一点不同，对于arguments如果外围没有非箭头函数，使用时是报错，提示arguments未定义；</p><p>而this如果外围没有非箭头函数，使用时不会报错，规定其值为<strong>window</strong>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sum = <span class="function"><span class="params">()</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line">sum();<span class="comment">//打印结果为window对象</span></span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//之所以用var定义a是为了把a挂载到window上</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="string">'outer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    a: <span class="string">'inner'</span>,</span><br><span class="line">    fn: <span class="function"><span class="params">()</span> =&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.a); <span class="comment">// 该箭头函数没有外围非箭头函数，this指向window</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.fn();<span class="comment">//如果安装ES5的写法结果时inner，但是结果是outer</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//之所以用var定义a是为了把a挂载到window上</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="string">'outer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    a: <span class="string">'inner'</span>,</span><br><span class="line">    fn()&#123;</span><br><span class="line">        test=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.a); <span class="comment">//此时this指向了fn的this也就是obj对象</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.fn()();<span class="comment">//结果为inner</span></span><br></pre></td></tr></table></figure><p><strong>比较实际的一个应用setTimeout：</strong></p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/006ttwEMly1g2715siovcj307h01o3ya.jpg" alt=""></p><p>setTimeout是window对象里的一个方法，其this是指向window的</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myObj = &#123;</span><br><span class="line">    ms: <span class="string">'hhhhh'</span>,</span><br><span class="line">    fn()&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.ms)</span><br><span class="line">        &#125;, <span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">myObj.fn();<span class="comment">//输出结果为undefined而非我们想要的hhhhh，因为setTimeout指向的this是window</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//针对上述情况的解决方法</span></span><br><span class="line"><span class="keyword">let</span> myObj = &#123;</span><br><span class="line">    ms: <span class="string">'hhhhh'</span>,</span><br><span class="line">    fn()&#123;</span><br><span class="line">        <span class="keyword">let</span> that = <span class="keyword">this</span>;<span class="comment">//把fn的this赋给that,that此时指向fn的对象myObj</span></span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(that.ms)</span><br><span class="line">        &#125;, <span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">myObj.fn();<span class="comment">//成功输出hhhhh，但是这样太麻烦了，事实上这样的写法就是ES6代码babel后的ES5写法</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用箭头函数直接搞定</span></span><br><span class="line"><span class="keyword">let</span> myObj = &#123;</span><br><span class="line">    ms: <span class="string">'hhhhh'</span>,</span><br><span class="line">    fn()&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.a)</span><br><span class="line">        &#125;, <span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">myObj.fn();<span class="comment">//成功输出hhhhh,利用了箭头函数this为外围非箭头函数fn的this</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ES6 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> ES6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jsonp实现百度搜索框功能</title>
      <link href="/2019/03/29/jsonp%E5%AE%9E%E7%8E%B0%E7%99%BE%E5%BA%A6%E6%90%9C%E7%B4%A2%E6%A1%86%E5%8A%9F%E8%83%BD.html"/>
      <url>/2019/03/29/jsonp%E5%AE%9E%E7%8E%B0%E7%99%BE%E5%BA%A6%E6%90%9C%E7%B4%A2%E6%A1%86%E5%8A%9F%E8%83%BD.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>由于ajax的同源策略，我们无法跨域请求数据，但是jsonp技术很好地解决了这个问题。本文利用百度搜索框接口结合jsonp技术实现获取百度关键字数据并完成百度搜索框功能：</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/006ttwEMly1g1jhdx8mg6g30dg08m124.gif" alt=""></p><p><br></p><p>我们可以直接在百度的搜索框上获取到它的接口，比如我们点击百度搜索文本框的时候，在chrome的network里可以看到它向一个url发起了请求，这个url也就是我们所需要的接口</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/006ttwEMly1g1jhovvqxvj311y0hdjso.jpg" alt=""></p><p>把这个url取出来：<a href="https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su?wd=&amp;json=1&amp;p=3&amp;sid=&amp;req=2&amp;sc=eb&amp;csor=0&amp;cb=jQuery110202521957712722107_1553828892769&amp;_=1553828892771" target="_blank" rel="noopener">https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su?wd=&amp;json=1&amp;p=3&amp;sid=&amp;req=2&amp;sc=eb&amp;csor=0&amp;cb=jQuery110202521957712722107_1553828892769&amp;_=1553828892771</a></p><p>去除一些我们不需要的参数，最终得到<a href="https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su?wd=&amp;cb=jQuery110202521957712722107_1553828892769" target="_blank" rel="noopener">https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su?wd=&amp;cb=jQuery110202521957712722107_1553828892769</a></p><p>其中wd表示我们要搜索的关键字，cb是百度规定的回调函数，我们尝试把wd赋值为汉字“中”，</p><p>即：<a href="https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su?wd=中&amp;cb=jQuery110202521957712722107_1553828892769" target="_blank" rel="noopener">https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su?wd=中&amp;cb=jQuery110202521957712722107_1553828892769</a></p><p>然后用浏览器打开</p><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/006ttwEMly1g1jht01m2bj30eh064jrl.jpg" alt=""></p><p>可以看到服务器返回了一个函数的调用，jQuery110202521957712722107_1553828892769是函数名字，里面的参数是一段json数据。</p><p>基于这些，我们可以自己写一个jsonp的代码来实现这个功能</p><p><br></p><p>简单的样式：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">style</span>&gt;</span><br><span class="line">    * &#123;</span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">list-style</span>: none;</span><br><span class="line">        <span class="attribute">text-decoration</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-tag">a</span>&#123;  </span><br><span class="line">        <span class="attribute">display</span>: block;</span><br><span class="line">        <span class="attribute">color</span>: black;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">        <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(172, 220, 235);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-tag">a</span><span class="selector-pseudo">:visited</span>&#123;</span><br><span class="line">        <span class="attribute">color</span>: black;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">        <span class="attribute">position</span>: absolute;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">        <span class="attribute">margin-left</span>: -<span class="number">200px</span>;</span><br><span class="line">        <span class="attribute">margin-top</span>: <span class="number">200px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">input</span> &#123;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">34px</span>;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">ul</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: none;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">        <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="selector-tag">body</span>&gt;</span><br><span class="line">    &lt;div class="wrapper"&gt;</span><br><span class="line">        &lt;input type="text"&gt;</span><br><span class="line">        &lt;<span class="selector-tag">ul</span>&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> &lt;/body&gt;</span><br></pre></td></tr></table></figure><p><br></p><p>关键的jsonp代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">        oUl = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'ul'</span>)[<span class="number">0</span>];</span><br><span class="line">        oInput = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'input'</span>)[<span class="number">0</span>];</span><br><span class="line">        oInput.oninput = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> value = <span class="keyword">this</span>.value;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> oScript = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">            oScript.src = <span class="string">"https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su?wd="</span> + value + <span class="string">"&amp;cb=doJson"</span>;</span><br><span class="line">            <span class="built_in">document</span>.body.appendChild(oScript);</span><br><span class="line">            <span class="built_in">document</span>.body.removeChild(oScript);<span class="comment">//用完就删，拔吊无情</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">doJson</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> s = data.s;</span><br><span class="line">            <span class="keyword">var</span> str = <span class="string">""</span>;</span><br><span class="line">            <span class="keyword">if</span> (s.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                s.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">ele, index</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span>(index&lt;<span class="number">5</span>)&#123;</span><br><span class="line">                    <span class="comment">// 只显示5行</span></span><br><span class="line">                    str += (<span class="string">"&lt;li&gt;&lt;a href=https://www.baidu.com/s?wd="</span>+ele+<span class="string">" target=_block&gt;"</span> + ele + <span class="string">"&lt;/a&gt;&lt;/li&gt;"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                oUl.innerHTML = str;</span><br><span class="line">                oUl.style.display = <span class="string">"block"</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                oUl.style.display = <span class="string">"none"</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p><br><br>（完）<br><br></p>]]></content>
      
      
      <categories>
          
          <category> 跨域 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 小案例 </tag>
            
            <tag> 跨域 </tag>
            
            <tag> jsonp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jQ.Ajax实现瀑布流相册</title>
      <link href="/2019/03/20/jQ.Ajax%E5%AE%9E%E7%8E%B0%E7%80%91%E5%B8%83%E6%B5%81%E7%9B%B8%E5%86%8C.html"/>
      <url>/2019/03/20/jQ.Ajax%E5%AE%9E%E7%8E%B0%E7%80%91%E5%B8%83%E6%B5%81%E7%9B%B8%E5%86%8C.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>.本文使用jQuery的ajax技术读取数据，为了实现跨域采用了代理的方法。ajax直接访问的url为服务器中的getPics.php文件，在php文件中访问了目标接口<a href="http://www.wookmark.com/api/json/popular" target="_blank" rel="noopener">http://www.wookmark.com/api/json/popular</a></p><p>效果看一下：</p><p><img src="https://github.com/Dunteng/images/blob/master/BlogImages/illustration/006ttwEMgy1g1jzyydu1hg30s60lcqvg.gif?raw=true" alt=""></p><p><br><br><strong>JS核心代码</strong>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 使用立即执行函数（函数自调用）防止全局污染</span></span><br><span class="line">    <span class="keyword">var</span> num = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> oLi = $(<span class="string">'li'</span>);</span><br><span class="line">    <span class="keyword">var</span> flag = <span class="literal">false</span>;<span class="comment">//起到锁的作用，防止ajax在渲染过程中一直请求数据</span></span><br><span class="line">    getData();</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!flag &amp;&amp; <span class="built_in">window</span>.dataFlag != <span class="string">'[]'</span>) &#123;</span><br><span class="line">            flag = <span class="literal">true</span>;<span class="comment">//上锁</span></span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                type: <span class="string">"GET"</span>,</span><br><span class="line">                url: <span class="string">"http://localhost/web/ajax/waterfall_Image/src/getPics.php?cpage="</span> + num,</span><br><span class="line">                success: addDom,</span><br><span class="line">                beforeSend: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    $(<span class="string">'.loading'</span>).show();</span><br><span class="line">                &#125;,</span><br><span class="line">                error: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">'ERROR'</span>);</span><br><span class="line">                &#125;,</span><br><span class="line">                complete: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                    <span class="built_in">window</span>.dataFlag = data.responseText;<span class="comment">//加个dataFlag，用于监测数据是否已经完全取空</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            num++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">addDom</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        $(<span class="string">'.loading'</span>).hide();</span><br><span class="line">        <span class="keyword">var</span> dataList = <span class="built_in">JSON</span>.parse(data);</span><br><span class="line">        <span class="built_in">console</span>.log(dataList);</span><br><span class="line">        <span class="keyword">if</span> (dataList.length) &#123;</span><br><span class="line">            dataList.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">ele, index</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> iDiv = $(<span class="string">'&lt;div class="item"&gt;&lt;/div&gt;'</span>);</span><br><span class="line">                <span class="keyword">var</span> imgBox = $(<span class="string">"&lt;div class='image'&gt;&lt;/div&gt;"</span>);</span><br><span class="line">                <span class="keyword">var</span> oImg = <span class="keyword">new</span> Image();</span><br><span class="line">                <span class="keyword">var</span> oP = $(<span class="string">'&lt;p&gt;&lt;/p&gt;'</span>);</span><br><span class="line">                oP.text(ele.title);</span><br><span class="line">                oImg.src = ele.preview;</span><br><span class="line">                oImg.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    imgBox.append(oImg);</span><br><span class="line">                    iDiv.append(imgBox).append(oP);</span><br><span class="line">                    <span class="keyword">var</span> index = getMinList(oLi);</span><br><span class="line">                    $(oLi[index]).append(iDiv);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        flag = <span class="literal">false</span>; <span class="comment">//ajax获取并且页面数据渲染完成了，该flag为false，使下次loading时得以继续Ajax请求数据</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getMinList</span>(<span class="params">dom</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> minHeight = <span class="built_in">parseInt</span>($(dom[<span class="number">0</span>]).css(<span class="string">'height'</span>));</span><br><span class="line">        <span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; dom.length; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> height = <span class="built_in">parseInt</span>($(dom[i]).css(<span class="string">'height'</span>));</span><br><span class="line">            <span class="keyword">if</span> (height &lt; minHeight) &#123;</span><br><span class="line">                minHeight = height;</span><br><span class="line">                index = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    $(<span class="built_in">window</span>).scroll(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> scrollHeight = $(<span class="built_in">window</span>).scrollTop();</span><br><span class="line">        <span class="keyword">var</span> clientHeight = $(<span class="built_in">window</span>).height();</span><br><span class="line">        <span class="keyword">var</span> minLiH = <span class="built_in">parseInt</span>($(oLi[getMinList(oLi)]).css(<span class="string">'height'</span>));</span><br><span class="line">        <span class="keyword">if</span> (scrollHeight + clientHeight &gt; minLiH) &#123;</span><br><span class="line">            getData();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure><p><strong>php文件代码：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* getPics.php */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">'Content-type:text/html; charset="utf-8"'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">API:</span></span><br><span class="line"><span class="comment">getPics.php</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">参数</span></span><br><span class="line"><span class="comment">cpage : 获取数据的页数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">$cpage = <span class="keyword">isset</span>($_GET[<span class="string">'cpage'</span>]) ? $_GET[<span class="string">'cpage'</span>] : <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">$url = <span class="string">'http://www.wookmark.com/api/json/popular?page='</span> . $cpage;</span><br><span class="line"></span><br><span class="line">$content = file_get_contents($url);</span><br><span class="line">$content = iconv(<span class="string">'gbk'</span>, <span class="string">'utf-8'</span>, $content);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $content;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> jQuery </tag>
            
            <tag> Ajax </tag>
            
            <tag> 瀑布流 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>拖拽方块记录Cookie</title>
      <link href="/2019/03/16/JS%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84Cookie%E6%93%8D%E4%BD%9C.html"/>
      <url>/2019/03/16/JS%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84Cookie%E6%93%8D%E4%BD%9C.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>Cookie是由服务器端生成，发送给User-Agent（一般是浏览器），（服务器告诉浏览器设置一下cookie），浏览器会将Cookie以key/value保存到某个目录下的文本文件内，下次请求同一网站时就发送该Cookie给服务器（前提是浏览器设置为启用cookie）。Cookie就是一个小型文件（浏览器对cookie的内存大小是有限制的——-用来记录一些信息）。</p><p>Cookie实际上主要是web服务器开发人员设置的，前端开发人员较少使用cookie。但是我们得学会简单操作cookie （大概流程如下）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> manageCookie = &#123;</span><br><span class="line">setCookie: <span class="function"><span class="keyword">function</span> (<span class="params">name, value, time</span>) </span>&#123; </span><br><span class="line"><span class="built_in">document</span>.cookie = name+<span class="string">'='</span>+value+<span class="string">';max-age='</span>+time;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>;<span class="comment">//返回manageCookie用于实现链式函数调用</span></span><br><span class="line"> &#125;,</span><br><span class="line"> removeCookie: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">this</span>.setCookie(name,<span class="string">''</span>,<span class="number">-1</span>) <span class="comment">//直接把max-age设置为负数使之过期，浏览器会自动删除过期cookie</span></span><br><span class="line"> &#125;,</span><br><span class="line"> getCookie: <span class="function"><span class="keyword">function</span>(<span class="params">name, callback</span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> allCookieArr = <span class="built_in">document</span>.cookie.split(<span class="string">', '</span>);<span class="comment">//注意用逗号和一个空格来切分cookie值！</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i&lt;allCookieArr.length; i++)&#123;</span><br><span class="line"><span class="keyword">var</span> itemCookieArr = allCookieArr[i].split(<span class="string">'='</span>);</span><br><span class="line"><span class="keyword">if</span>(itemCookieArr[<span class="number">0</span>]==name)&#123;</span><br><span class="line">callback(itemCookieArr[<span class="number">1</span>]);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>;<span class="comment">//同样也是返回manageCookie实现链式调用</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">callback(<span class="literal">undefined</span>);<span class="comment">//如果循环结束都没有找到name对应的值，则调用undefined</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>;<span class="comment">//返回manageCookie实现链式调用</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">manageCookie</span><br><span class="line">.setCookie(<span class="string">'color'</span>, <span class="string">'red'</span>, <span class="number">10000</span>)</span><br><span class="line">.setCookie(<span class="string">'dunteng'</span>, <span class="string">'great'</span>, <span class="string">'10000000'</span>)</span><br><span class="line">.removeCookie(<span class="string">'color'</span>)</span><br><span class="line">.getCookie(<span class="string">'dunteng'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br><br></p><p>结合上述核心功能实现一个小demo：鼠标拖拽方块改变其坐标，下次打开页面的时候通过cookie记忆呈现上次离开网页时的方块状态。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"demo"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">var</span> oDemo = <span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> manageCookie = &#123;</span><br><span class="line">        setCookie: <span class="function"><span class="keyword">function</span> (<span class="params">name, value, data</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// expires</span></span><br><span class="line">            <span class="comment">// var oDate = new Date();</span></span><br><span class="line">            <span class="comment">// oDate.setDate(oDate.getDate() + date);</span></span><br><span class="line">            <span class="comment">// document.cookie = key + '=' + val + ';expires=' + oDate;</span></span><br><span class="line">            </span><br><span class="line">            <span class="built_in">document</span>.cookie = name + <span class="string">'='</span> + value + <span class="string">';max-age='</span> + data; </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        removeCookie: <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.setCookie(name, <span class="string">''</span>, <span class="number">-1</span>); </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        getCookie: <span class="function"><span class="keyword">function</span> (<span class="params">name, callback</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> allCookieArr = <span class="built_in">document</span>.cookie.split(<span class="string">'; '</span>);</span><br><span class="line">            <span class="keyword">var</span> len = allCookieArr.length;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">                <span class="keyword">var</span> itemCookieArr = allCookieArr[i].split(<span class="string">'='</span>);</span><br><span class="line">                <span class="keyword">if</span>(itemCookieArr[<span class="number">0</span>] == name) &#123;</span><br><span class="line">                    callback(itemCookieArr[<span class="number">1</span>]);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">this</span>; </span><br><span class="line">                &#125; </span><br><span class="line">            &#125;</span><br><span class="line">            callback(<span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> drag = &#123;</span><br><span class="line">        init: <span class="function"><span class="keyword">function</span>(<span class="params">dom</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.dom = dom;</span><br><span class="line">            <span class="keyword">var</span> _this = <span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">this</span>.bindEvent();</span><br><span class="line">            manageCookie.getCookie(<span class="string">'newLeft'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                </span><br><span class="line">                _this.dom.style.left = data + <span class="string">'px'</span>;</span><br><span class="line">            &#125;).getCookie(<span class="string">'newTop'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                _this.dom.style.top = data + <span class="string">'px'</span>;</span><br><span class="line">                <span class="keyword">return</span> data;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        bindEvent: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.dom.onmousedown = <span class="keyword">this</span>.mouseDown.bind(<span class="keyword">this</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        mouseDown: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">document</span>.onmousemove = <span class="keyword">this</span>.mouseMove.bind(<span class="keyword">this</span>);</span><br><span class="line">            <span class="built_in">document</span>.onmouseup = <span class="keyword">this</span>.mouseUp.bind(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.disY = e.clientY - <span class="keyword">this</span>.dom.offsetTop;</span><br><span class="line">            <span class="keyword">this</span>.disX = e.clientX - <span class="keyword">this</span>.dom.offsetLeft;</span><br><span class="line">        &#125;,</span><br><span class="line">        mouseMove: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.newLeft = e.clientX - <span class="keyword">this</span>.disX;</span><br><span class="line">            <span class="keyword">this</span>.newTop = e.clientY - <span class="keyword">this</span>.disY;</span><br><span class="line">            <span class="keyword">this</span>.dom.style.left = <span class="keyword">this</span>.newLeft + <span class="string">'px'</span>;</span><br><span class="line">            <span class="keyword">this</span>.dom.style.top = <span class="keyword">this</span>.newTop + <span class="string">'px'</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        mouseUp: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">document</span>.onmousemove = <span class="literal">null</span>;</span><br><span class="line">            <span class="built_in">document</span>.onmouseup = <span class="literal">null</span>;</span><br><span class="line">            manageCookie.setCookie(<span class="string">'newLeft'</span>, <span class="keyword">this</span>.newLeft, <span class="number">10000</span>).setCookie(<span class="string">'newTop'</span>,<span class="keyword">this</span>.newTop, <span class="number">10000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    drag.init(oDemo);</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>（完）<br><br></p>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 小案例 </tag>
            
            <tag> Cookie </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>封装Jsonp代码</title>
      <link href="/2019/03/14/%E5%B0%81%E8%A3%85jsonp%E4%BB%A3%E7%A0%81.html"/>
      <url>/2019/03/14/%E5%B0%81%E8%A3%85jsonp%E4%BB%A3%E7%A0%81.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>jsonp的封装代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsonp</span> (<span class="params">url, params, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> funcName = <span class="string">'jsonp_'</span> + <span class="built_in">Date</span>.now() + <span class="built_in">Math</span>.random().toString().substr(<span class="number">2</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> params === <span class="string">'object'</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> tempArr = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> params) &#123;</span><br><span class="line">      <span class="keyword">var</span> value = params[key]</span><br><span class="line">      tempArr.push(key + <span class="string">'='</span> + value)</span><br><span class="line">    &#125;</span><br><span class="line">    params = tempArr.join(<span class="string">'&amp;'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</span><br><span class="line">  script.src = url + <span class="string">'?'</span> + params + <span class="string">'&amp;callback='</span> + funcName</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(script)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>[funcName] = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    callback(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> <span class="built_in">window</span>[funcName]</span><br><span class="line">    <span class="built_in">document</span>.body.removeChild(script)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">jsonp(<span class="string">'http://localhost/jsonp/server.php'</span>, &#123; <span class="attr">id</span>: <span class="number">123</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">jsonp(<span class="string">'http://localhost/jsonp/server.php'</span>, &#123; <span class="attr">id</span>: <span class="number">123</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>例子中的server.php代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$conn = mysqli_connect(&apos;localhost&apos;, &apos;root&apos;, &apos;123456&apos;, &apos;demo&apos;);</span><br><span class="line"></span><br><span class="line">$query = mysqli_query($conn, &apos;select * from users&apos;);</span><br><span class="line"></span><br><span class="line">while ($row = mysqli_fetch_assoc($query)) &#123;</span><br><span class="line">  $data[] = $row;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (empty($_GET[&apos;callback&apos;])) &#123;</span><br><span class="line">  header(&apos;Content-Type: application/json&apos;);</span><br><span class="line">  echo json_encode($data);</span><br><span class="line">  exit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 如果客户端采用的是 script 标记对我发送的请求</span><br><span class="line">// 一定要返回一段 JavaScript</span><br><span class="line">header(&apos;Content-Type: application/javascript&apos;);</span><br><span class="line">$result = json_encode($data);</span><br><span class="line"></span><br><span class="line">$callback_name = $_GET[&apos;callback&apos;];</span><br><span class="line"></span><br><span class="line">echo &quot;typeof &#123;$callback_name&#125; === &apos;function&apos; &amp;&amp; &#123;$callback_name&#125;(&#123;$result&#125;)&quot;;</span><br></pre></td></tr></table></figure><p><br><br></p><p>（完）</p><p><br><br></p>]]></content>
      
      
      <categories>
          
          <category> 跨域 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 跨域 </tag>
            
            <tag> jsonp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>优化AJAX的JS封装代码</title>
      <link href="/2019/03/13/%E4%BE%9D%E6%AD%A4%E4%BC%98%E5%8C%96AJAX%E7%9A%84%E5%B0%81%E8%A3%85%E4%BB%A3%E7%A0%81.html"/>
      <url>/2019/03/13/%E4%BE%9D%E6%AD%A4%E4%BC%98%E5%8C%96AJAX%E7%9A%84%E5%B0%81%E8%A3%85%E4%BB%A3%E7%A0%81.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>为了一步步地理清封装步骤，我打算逐步封装ajax函数的功能，分成了以下6个版本：</p><h2 id="Version-1"><a href="#Version-1" class="headerlink" title="Version 1"></a>Version 1</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ajax</span> (<span class="params">method, url, params</span>) </span>&#123;</span><br><span class="line">      xhr.open(method, url)</span><br><span class="line">      xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>) <span class="comment">//针对post的设置请求头</span></span><br><span class="line"></span><br><span class="line">      params = params || <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">      xhr.send(params)</span><br><span class="line">      xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) <span class="keyword">return</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.responseText)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">ajax(<span class="string">'GET'</span>,<span class="string">'xxx.php'</span>,<span class="string">'id=1'</span>);</span><br><span class="line">ajax(<span class="string">'POST'</span>,<span class="string">'xxx.php'</span>,<span class="string">'key1=value1&amp;key2=value2'</span>);</span><br></pre></td></tr></table></figure><p><strong>说明：</strong> </p><ul><li>未兼容低版本 IE</li><li>这种方法在传参数的时候只能上例所示的格式，无法用json格式；</li><li>当method为get的时候，参数没正确地加在url后面无法起到作用；</li><li>method为get时也是设置了(‘Content-Type’, ‘application/x-www-form-urlencoded’)的请求头，但是这是不必要的。</li><li>把函数的结果写死了，总是console.log(this.responseText)</li></ul><p><br><br></p><h2 id="Version-2"><a href="#Version-2" class="headerlink" title="Version 2"></a>Version 2</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ajax</span> (<span class="params">method, url, params</span>) </span>&#123;</span><br><span class="line">      method = method.toUpperCase() <span class="comment">//统一为大写，避免实参为小写的情况造成下面匹配时出错</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">//解决XMLHttpRequest在ie6不兼容的问题</span></span><br><span class="line">      <span class="keyword">var</span> xhr = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">if</span>(<span class="built_in">window</span>.XMLHttpRequest)&#123;</span><br><span class="line">xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">'Microsoft.XMLHttp'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">        </span><br><span class="line">      <span class="keyword">if</span> (method === <span class="string">'GET'</span>) &#123;</span><br><span class="line">        url += <span class="string">'?'</span> + params</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      xhr.open(method, url)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> data = <span class="literal">null</span></span><br><span class="line">      <span class="keyword">if</span> (method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">        xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>)</span><br><span class="line">        data = params</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      xhr.send(data)</span><br><span class="line">      xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) <span class="keyword">return</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.responseText)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">ajax(<span class="string">'GET'</span>,<span class="string">'xxx.php'</span>,<span class="string">'id=1'</span>);</span><br><span class="line">ajax(<span class="string">'POST'</span>,<span class="string">'xxx.php'</span>,<span class="string">'key1=value1&amp;key2=value2'</span>);</span><br></pre></td></tr></table></figure><p><strong>说明：</strong></p><ul><li>实现了IE低版本的兼容并实现了method各自对应的传参方式</li><li>这种方法在传参数的时候只能上例所示的格式，无法用json格式；</li><li>把函数的结果写死了，总是console.log(this.responseText)</li></ul><p><br><br></p><h2 id="Version-3"><a href="#Version-3" class="headerlink" title="Version 3"></a>Version 3</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ajax</span> (<span class="params">method, url, params</span>) </span>&#123;</span><br><span class="line">      method = method.toUpperCase()</span><br><span class="line">      <span class="keyword">var</span> xhr = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">if</span>(<span class="built_in">window</span>.XMLHttpRequest)&#123;</span><br><span class="line">xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">'Microsoft.XMLHttp'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 将 object 类型的参数转换为 key=value&amp;key=value</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> params === <span class="string">'object'</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> tempArr = []</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> params) &#123;</span><br><span class="line">          <span class="keyword">var</span> value = params[key]</span><br><span class="line">          tempArr.push(key + <span class="string">'='</span> + value)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// tempArr =&gt; [ 'key1=value1', 'key2=value2' ]</span></span><br><span class="line">        params = tempArr.join(<span class="string">'&amp;'</span>)</span><br><span class="line">        <span class="comment">// params =&gt; 'key1=value1&amp;key2=value2'</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (method === <span class="string">'GET'</span>) &#123;</span><br><span class="line">        url += <span class="string">'?'</span> + params</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      xhr.open(method, url)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> data = <span class="literal">null</span></span><br><span class="line">      <span class="keyword">if</span> (method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">        xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>)</span><br><span class="line">        data = params</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      xhr.send(data)</span><br><span class="line">      xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) <span class="keyword">return</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.responseText)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">ajax(<span class="string">'GET'</span>,<span class="string">'xxx.php'</span>,<span class="string">'id=1'</span>);</span><br><span class="line">ajax(<span class="string">'POST'</span>,<span class="string">'xxx.php'</span>,<span class="string">'key1=value1&amp;key2=value2'</span>);</span><br><span class="line">ajax(<span class="string">'GET'</span>, <span class="string">'time.php'</span>, &#123; <span class="attr">id</span>: <span class="number">1</span> &#125;)</span><br><span class="line">ajax(<span class="string">'POST'</span>, <span class="string">'add.php'</span>, &#123; <span class="attr">key1</span>: <span class="string">'value1'</span>, <span class="attr">key2</span>: <span class="string">'value2'</span> &#125;)</span><br></pre></td></tr></table></figure><p><strong>说明：</strong></p><ul><li>弥补了无法使用json传参的缺陷，既能用字符串形式传参也能用json</li><li>仍然把函数结果写死了</li></ul><p><br><br></p><h2 id="尝试在Ajax中return出数据"><a href="#尝试在Ajax中return出数据" class="headerlink" title="尝试在Ajax中return出数据"></a>尝试在Ajax中return出数据</h2><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/ajaxreturn1.jpg" alt=""></p><p><br><br></p><h2 id="Version-4"><a href="#Version-4" class="headerlink" title="Version 4"></a><del>Version 4</del></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ajax</span> (<span class="params">method, url, params</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> res = <span class="literal">null</span>  <span class="comment">//用于返回值</span></span><br><span class="line"></span><br><span class="line">      method = method.toUpperCase()</span><br><span class="line">      <span class="keyword">var</span> xhr = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">if</span>(<span class="built_in">window</span>.XMLHttpRequest)&#123;</span><br><span class="line">xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">'Microsoft.XMLHttp'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 将 object 类型的参数转换为 key=value&amp;key=value</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> params === <span class="string">'object'</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> tempArr = []</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> params) &#123;</span><br><span class="line">          <span class="keyword">var</span> value = params[key]</span><br><span class="line">          tempArr.push(key + <span class="string">'='</span> + value)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// tempArr =&gt; [ 'key1=value1', 'key2=value2' ]</span></span><br><span class="line">        params = tempArr.join(<span class="string">'&amp;'</span>)</span><br><span class="line">        <span class="comment">// params =&gt; 'key1=value1&amp;key2=value2'</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (method === <span class="string">'GET'</span>) &#123;</span><br><span class="line">        url += <span class="string">'?'</span> + params</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      xhr.open(method, url, <span class="literal">false</span>) <span class="comment">//async参数为false，使用同步而非异步</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> data = <span class="literal">null</span></span><br><span class="line">      <span class="keyword">if</span> (method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">        xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>)</span><br><span class="line">        data = params</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">// 不应该在封装的函数中主观的处理响应结果</span></span><br><span class="line">        <span class="comment">// console.log(this.responseText)</span></span><br><span class="line">        <span class="comment">// 无法在内部包含的函数中通过 return 给外部函数的调用返回结果</span></span><br><span class="line">        <span class="comment">// return this.responseText</span></span><br><span class="line">        <span class="comment">// 由于异步模式下 这里的代码最后执行 所以不可能在外部通过返回值的方式返回数据</span></span><br><span class="line">        res = <span class="keyword">this</span>.responseText</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      xhr.send(data) <span class="comment">//使用了同步的策略，只能把send（）置于最后</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> res</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result = ajax(<span class="string">"GET"</span>,<span class="string">"xxx.php"</span>,&#123;<span class="attr">id</span>: <span class="number">1</span>&#125;);</span><br><span class="line"><span class="keyword">var</span> result2 = ajax(<span class="string">"POST"</span>,<span class="string">"xxx.php"</span>,&#123;<span class="attr">key1</span>: <span class="string">'value1'</span>, <span class="attr">key2</span>: <span class="string">'value2'</span>&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line">alert(result2);</span><br></pre></td></tr></table></figure><p>说明：</p><ul><li>函数有返回值，没有把函数写死</li><li>但是使用了同步的策略，这是非常不好的</li></ul><p><br><br></p><h2 id="Version-5"><a href="#Version-5" class="headerlink" title="Version 5"></a>Version 5</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// 封装者</span></span><br><span class="line">  <span class="comment">// =============================</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ajax</span> (<span class="params">method, url, params, done</span>) </span>&#123;</span><br><span class="line">    method = method.toUpperCase()</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">window</span>.XMLHttpRequest)&#123;</span><br><span class="line">xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"> &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">'Microsoft.XMLHttp'</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> params === <span class="string">'object'</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> tempArr = []</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> params) &#123;</span><br><span class="line">        <span class="keyword">var</span> value = params[key]</span><br><span class="line">        tempArr.push(key + <span class="string">'='</span> + value)</span><br><span class="line">      &#125;</span><br><span class="line">      params = tempArr.join(<span class="string">'&amp;'</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">'GET'</span>) &#123;</span><br><span class="line">      url += <span class="string">'?'</span> + params</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    xhr.open(method, url, <span class="literal">true</span>)<span class="comment">//async默认为true，即为异步策略</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> data = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">      xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>)</span><br><span class="line">      data = params</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) <span class="keyword">return</span></span><br><span class="line">      <span class="comment">// 不应该在封装的函数中主观的处理响应结果</span></span><br><span class="line">      <span class="comment">// console.log(this.responseText)</span></span><br><span class="line">      <span class="comment">// 你说我太主观，那么你告诉我应该做什么</span></span><br><span class="line">      done(<span class="keyword">this</span>.responseText)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    xhr.send(data)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 调用者</span></span><br><span class="line">  <span class="comment">// ============================</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> onDone = <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ajax(<span class="string">'get'</span>, <span class="string">'time.php'</span>, &#123;&#125;, onDone)</span><br></pre></td></tr></table></figure><p><strong>说明：</strong></p><p><strong>为什么return出来的是undefined？为什么取不出一个正确的return值？</strong>因为Ajax是异步的操作，在获取数据完成之前，就已经执行了return res(计划中获取到的数据)，所以是无法正确return出我们想要的结果的。</p><p>既然取不出一个return值，那么换个思路，使用<strong>回调函数</strong>让封装者替我们实现我们想要的效果.</p><p>使用的是异步策略，在异步的情况下使用回调函数时比较多的。</p><p>但是这段代码还是比较凌乱的</p><p><br><br></p><h2 id="Version-6"><a href="#Version-6" class="headerlink" title="Version 6"></a>Version 6</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajaxFunc</span>(<span class="params">method,url,data,callback,flag</span>)</span>&#123;</span><br><span class="line">flag = flag||<span class="literal">true</span>;<span class="comment">//默认采用异步模式</span></span><br><span class="line">method = method.toUpperCase();</span><br><span class="line"><span class="keyword">var</span> xhr = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">window</span>.XMLHttpRequest)&#123;</span><br><span class="line">xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">'Microsoft.XMLHttp'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当参数以json格式传入时，转化成字符串&amp;格式</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> data === <span class="string">'object'</span>) &#123;</span><br><span class="line"><span class="keyword">var</span> tempArr = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> data) &#123;</span><br><span class="line"><span class="keyword">var</span> value = data[key]</span><br><span class="line">tempArr.push(key + <span class="string">'='</span> + value)</span><br><span class="line">&#125;</span><br><span class="line">data = tempArr.join(<span class="string">'&amp;'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(method == <span class="string">'GET'</span>)&#123;</span><br><span class="line">url +=(<span class="string">'?'</span>+ data);</span><br><span class="line">xhr.open(method,url,flag);</span><br><span class="line">xhr.send();</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(method == <span class="string">'POST'</span>)&#123;</span><br><span class="line">xhr.open(method,url,flag);</span><br><span class="line">xhr.setRequestHeader(<span class="string">'Content-type'</span>,<span class="string">'application/x-www-form-urlencoded'</span>);</span><br><span class="line">xhr.send(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">this</span>.readyState == <span class="number">4</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">this</span>.status == <span class="number">200</span>)&#123;</span><br><span class="line">callback(<span class="keyword">this</span>.responseText);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"ERROR!"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//测试代码：</span></span><br><span class="line">ajaxFunc(<span class="string">'GET'</span>, <span class="string">'post.php'</span>, <span class="string">""</span>, myfun1, <span class="literal">true</span>);</span><br><span class="line">ajaxFunc(<span class="string">'POST'</span>, <span class="string">'post.php'</span>, <span class="string">"username=jiji&amp;age=450"</span>, myfun2, <span class="literal">true</span>);</span><br><span class="line">ajaxFunc(<span class="string">'POST'</span>, <span class="string">'post.php'</span>, &#123;<span class="attr">username</span>: <span class="string">'jiji'</span>,<span class="attr">age</span>: <span class="number">45</span>&#125;, myfun2, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure><p>这个是Ajax比较像样的封装函数了。</p><p><br><br></p><p>(完)</p><p><br><br></p>]]></content>
      
      
      <categories>
          
          <category> Ajax </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> Ajax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>处理机调度与死锁</title>
      <link href="/2019/03/07/03%E5%A4%84%E7%90%86%E6%9C%BA%E8%B0%83%E5%BA%A6%E4%B8%8E%E6%AD%BB%E9%94%81.html"/>
      <url>/2019/03/07/03%E5%A4%84%E7%90%86%E6%9C%BA%E8%B0%83%E5%BA%A6%E4%B8%8E%E6%AD%BB%E9%94%81.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h1 id="1-处理机调度"><a href="#1-处理机调度" class="headerlink" title="1. 处理机调度"></a>1. 处理机调度</h1><h2 id="1-1-概念"><a href="#1-1-概念" class="headerlink" title="1.1 概念"></a>1.1 概念</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0qn1rcznjj30yg0iuwsp.jpg" alt=""></p><h2 id="1-2-处理机调度的层级"><a href="#1-2-处理机调度的层级" class="headerlink" title="1.2 处理机调度的层级"></a>1.2 处理机调度的层级</h2><h4 id="高级调度（作业调度）"><a href="#高级调度（作业调度）" class="headerlink" title="高级调度（作业调度）"></a>高级调度（作业调度）</h4><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0qn7g121ij30w70ij4di.jpg" alt=""></p><h4 id="中级调度（内存调度）"><a href="#中级调度（内存调度）" class="headerlink" title="中级调度（内存调度）"></a>中级调度（内存调度）</h4><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0qnc0pbvlj30wf0ibtoi.jpg" alt=""></p><h4 id="低级调度（进程调度）"><a href="#低级调度（进程调度）" class="headerlink" title="低级调度（进程调度）"></a>低级调度（进程调度）</h4><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0qnf09rtjj30yz0j0wt7.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0qnglyoguj30vh0eo466.jpg" alt=""></p><h4 id="三者对比"><a href="#三者对比" class="headerlink" title="三者对比"></a>三者对比</h4><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0qnnrgywcj30tg0edwqg.jpg" alt=""></p><h1 id="2-进程调度"><a href="#2-进程调度" class="headerlink" title="2. 进程调度"></a>2. 进程调度</h1><h2 id="2-1-进程调度的时机"><a href="#2-1-进程调度的时机" class="headerlink" title="2.1 进程调度的时机"></a>2.1 进程调度的时机</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0qnwfh3koj311y0lbqnb.jpg" alt=""></p><h2 id="2-2-进程调度的方式"><a href="#2-2-进程调度的方式" class="headerlink" title="2.2 进程调度的方式"></a>2.2 进程调度的方式</h2><p>抢占式与非抢占式</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0qnzipw35j30y60hwk4h.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0qo2jvefuj30xs0g37fy.jpg" alt=""></p><h1 id="3-调度算法的评价指标"><a href="#3-调度算法的评价指标" class="headerlink" title="3. 调度算法的评价指标"></a>3. 调度算法的评价指标</h1><h2 id="3-1-CPU利用率"><a href="#3-1-CPU利用率" class="headerlink" title="3.1 CPU利用率"></a>3.1 CPU利用率</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0qo86gipvj311y0lbwzf.jpg" alt=""></p><h2 id="3-2-系统吞吐量"><a href="#3-2-系统吞吐量" class="headerlink" title="3.2 系统吞吐量"></a>3.2 系统吞吐量</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0qobu3h9gj30tr0etgql.jpg" alt=""></p><h2 id="3-3-周转时间"><a href="#3-3-周转时间" class="headerlink" title="3.3 周转时间"></a>3.3 周转时间</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0qog48uogj311y0lbqne.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0qogvefzoj311y0lb4c8.jpg" alt=""></p><h2 id="3-4-等待时间"><a href="#3-4-等待时间" class="headerlink" title="3.4 等待时间"></a>3.4 等待时间</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0qoospfudj30x00in1dn.jpg" alt=""></p><h2 id="3-5-响应时间"><a href="#3-5-响应时间" class="headerlink" title="3.5 响应时间"></a>3.5 响应时间</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0qoq58r6dj30ye06omzt.jpg" alt=""></p><h1 id="4-调度算法"><a href="#4-调度算法" class="headerlink" title="4.调度算法"></a>4.调度算法</h1><h2 id="即可用于作业调度又可用于进程调度的算法："><a href="#即可用于作业调度又可用于进程调度的算法：" class="headerlink" title="即可用于作业调度又可用于进程调度的算法："></a>即可用于作业调度又可用于进程调度的算法：</h2><h2 id="4-1-先来先服务算法（FCFS）"><a href="#4-1-先来先服务算法（FCFS）" class="headerlink" title="4.1  先来先服务算法（FCFS）"></a>4.1  先来先服务算法（FCFS）</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r2jsocr3j311y0lb4ho.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r2npdcghj311y0lbakv.jpg" alt=""></p><h2 id="4-2-短作业优先（SJF）"><a href="#4-2-短作业优先（SJF）" class="headerlink" title="4.2  短作业优先（SJF）"></a>4.2  短作业优先（SJF）</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r2wgvr19j311y0lbww9.jpg" alt=""></p><p>平均等待时间、平均周转时间最少</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r322qnbxj311y0lbws8.jpg" alt=""></p><h2 id="4-3-高响应比优先（HRRN）"><a href="#4-3-高响应比优先（HRRN）" class="headerlink" title="4.3  高响应比优先（HRRN）"></a>4.3  高响应比优先（HRRN）</h2><p> <img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r395uu82j311y0lbh2w.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r3adxwd6j311y0lb15a.jpg" alt=""></p><h3 id="三者对比-1"><a href="#三者对比-1" class="headerlink" title="三者对比"></a>三者对比</h3><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r3b74deoj311y0lbas1.jpg" alt=""></p><h2 id="4-4-优先级调度算法"><a href="#4-4-优先级调度算法" class="headerlink" title="4.4 优先级调度算法"></a>4.4 优先级调度算法</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r3wndj9pj311y0lb16c.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r3zgw9pjj311y0lb7lr.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r413z5qnj311y0lb4jn.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r41o2tmlj311y0lbakk.jpg" alt=""></p><h2 id="只用于进程调度的算法"><a href="#只用于进程调度的算法" class="headerlink" title="只用于进程调度的算法"></a>只用于进程调度的算法</h2><h2 id="4-5-轮转时间片算法"><a href="#4-5-轮转时间片算法" class="headerlink" title="4.5 轮转时间片算法"></a>4.5 轮转时间片算法</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r3rtvyg0j311y0lbqgr.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r3q2z967j311y0lbdz5.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r3swa9ptj311y0lbk3o.jpg" alt=""></p><h2 id="4-6-多级反馈队列调度算法"><a href="#4-6-多级反馈队列调度算法" class="headerlink" title="4.6 多级反馈队列调度算法"></a>4.6 多级反馈队列调度算法</h2><p>过程见视频，较复杂，注意理解<img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r4b6mv8jj311y0lbdvw.jpg" alt=""></p><h1 id="5-死锁"><a href="#5-死锁" class="headerlink" title="5. 死锁"></a>5. 死锁</h1><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>个进程互相等待对方手里的资源，这些资源都没有被释放，导致各进程都阻塞，无法向前推进的现象。</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0saev0rp5j311y0lb7ud.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0sai40aw1j30wv0d246u.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0saj2o2t7j311y0lb7jh.jpg" alt=""></p><h3 id="死锁的处理"><a href="#死锁的处理" class="headerlink" title="死锁的处理"></a>死锁的处理</h3><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0sarh7ddvj30xj0gqqd8.jpg" alt=""></p><h3 id="1-预防死锁"><a href="#1-预防死锁" class="headerlink" title="1. 预防死锁"></a>1. 预防死锁</h3><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0sawzwpzsj311y0lb14f.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0sazjmbm5j311y0lbn8r.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0sb2rxbw0j311y0lbdvr.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0sb3dqekvj311y0lb4dn.jpg" alt=""></p><h3 id="2-避免死锁"><a href="#2-避免死锁" class="headerlink" title="2.  避免死锁"></a>2.  避免死锁</h3><p><strong>安全状态：</strong></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0sbft08umj31re0u07ah.jpg" alt=""></p><h3 id="银行家算法"><a href="#银行家算法" class="headerlink" title="银行家算法"></a>银行家算法</h3><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0sbhm7ixbj311y0lb1e0.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0sbky5t6yj30xr0acwk3.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0sbzb5dwmj311y0lbdvt.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0sbzvasmgj311y0lb49q.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0sc188qr7j311y0lbk1r.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0sc5w292uj311y0lbx3y.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0sc8aran4j311y0lbk1y.jpg" alt=""></p><h3 id="3-死锁的监测与解除"><a href="#3-死锁的监测与解除" class="headerlink" title="3. 死锁的监测与解除"></a>3. 死锁的监测与解除</h3><p>这部分重要，看视频：<a href="https://www.bilibili.com/video/av40376808?p=32" target="_blank" rel="noopener">https://www.bilibili.com/video/av40376808?p=32</a></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0sckz7n0oj311y0lbtjq.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>进程的描述与控制</title>
      <link href="/2019/03/06/02%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%8F%8F%E8%BF%B0%E4%B8%8E%E6%8E%A7%E5%88%B6.html"/>
      <url>/2019/03/06/02%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%8F%8F%E8%BF%B0%E4%B8%8E%E6%8E%A7%E5%88%B6.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h1 id="第二章"><a href="#第二章" class="headerlink" title="第二章"></a>第二章</h1><h2 id="1-前趋图和程序执行"><a href="#1-前趋图和程序执行" class="headerlink" title="1. 前趋图和程序执行"></a>1. 前趋图和程序执行</h2><h3 id="1-1-前趋图"><a href="#1-1-前趋图" class="headerlink" title="1.1 前趋图"></a>1.1 前趋图</h3><p>见课本p32、p33</p><h3 id="1-2-程序顺序执行"><a href="#1-2-程序顺序执行" class="headerlink" title="1.2 程序顺序执行"></a>1.2 程序顺序执行</h3><p>程序执行有固定的时序，</p><p><strong>特征：</strong> 顺序性、可再现性、封闭性</p><h3 id="1-3-程序并发执行"><a href="#1-3-程序并发执行" class="headerlink" title="1.3 程序并发执行"></a>1.3 程序并发执行</h3><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0publkgx4j30q40bewfa.jpg" alt="      "></p><p>与顺序执行的特征相反： 间断性、不可再现性、非封闭性（由资源共享造成）</p><p>结合pdf第9页左右例子理解</p><h2 id="2-进程的描述"><a href="#2-进程的描述" class="headerlink" title="2. 进程的描述"></a>2. 进程的描述</h2><h3 id="2-1-进程的定义与特征"><a href="#2-1-进程的定义与特征" class="headerlink" title="2.1 进程的定义与特征"></a>2.1 进程的定义与特征</h3><h4 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h4><p>是程序的一次执行过程，是进程实体的运行过程，是系统进行资源分配和调度 的一个独立单位。</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pw2y75xxj30ya0i6k3r.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pw75wembj30uv0ivtha.jpg" alt=""></p><h4 id="特征："><a href="#特征：" class="headerlink" title="特征："></a>特征：</h4><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pwls8evtj310d0kzk7h.jpg" alt=""></p><h4 id="进程和程序的区别："><a href="#进程和程序的区别：" class="headerlink" title="进程和程序的区别："></a>进程和程序的区别：</h4><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pumkycuaj30ov0d7acu.jpg" alt=""></p><h3 id="2-2-进程的状态及转换"><a href="#2-2-进程的状态及转换" class="headerlink" title="2.2 进程的状态及转换"></a>2.2 进程的状态及转换</h3><h4 id="基本状态："><a href="#基本状态：" class="headerlink" title="基本状态："></a>基本状态：</h4><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0puoshfafj30el0br3z2.jpg" alt=""></p><h4 id="创建状态和终止状态"><a href="#创建状态和终止状态" class="headerlink" title="创建状态和终止状态"></a>创建状态和终止状态</h4><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pwt7tdmbj30zj0k1ne6.jpg" alt=""></p><h3 id="2-3-挂起操作与激活操作"><a href="#2-3-挂起操作与激活操作" class="headerlink" title="2.3 挂起操作与激活操作"></a>2.3 挂起操作与激活操作</h3><p>见书本p38\p39</p><h3 id="2-4-进程控制块PCB"><a href="#2-4-进程控制块PCB" class="headerlink" title="2.4 进程控制块PCB"></a>2.4 进程控制块PCB</h3><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pv2jjpexj30ow1nnqgj.jpg" alt=""></p><h2 id="3-进程控制"><a href="#3-进程控制" class="headerlink" title="3. 进程控制"></a>3. 进程控制</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pwv8sr4dj30yn0jx11q.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0px2pngb0j311y0lbkaj.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0px6rffx3j311y0lc7iw.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pxc7k4t4j311y0lcgzx.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pxlzge2pj311y0lbtt8.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pxny9oswj311y0lbwsi.jpg" alt=""></p><h2 id="4-进程同步"><a href="#4-进程同步" class="headerlink" title="4. 进程同步"></a>4. 进程同步</h2><h3 id="4-1-进程同步（进程的直接制约关系）"><a href="#4-1-进程同步（进程的直接制约关系）" class="headerlink" title="4.1 进程同步（进程的直接制约关系）"></a>4.1 进程同步（进程的直接制约关系）</h3><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r4z2trshj311y0lban2.jpg" alt=""></p><h3 id="4-2-进程互斥（进程的间接制约关系）"><a href="#4-2-进程互斥（进程的间接制约关系）" class="headerlink" title="4.2 进程互斥（进程的间接制约关系）"></a>4.2 进程互斥（进程的间接制约关系）</h3><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r50gtecyj311y0lbk8u.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r5160ahej311y0lbdv0.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r52a2mpvj30sd0fstg7.jpg" alt=""></p><h3 id="4-3-硬件同步机制（进程互斥的硬件方法）"><a href="#4-3-硬件同步机制（进程互斥的硬件方法）" class="headerlink" title="4.3 硬件同步机制（进程互斥的硬件方法）"></a>4.3 硬件同步机制（进程互斥的硬件方法）</h3><h4 id="关中断"><a href="#关中断" class="headerlink" title="关中断"></a>关中断</h4><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0rvfs46pdj311y0lbqe2.jpg" alt=""></p><h4 id="TestAndSet指令"><a href="#TestAndSet指令" class="headerlink" title="TestAndSet指令"></a>TestAndSet指令</h4><p>简称TS指令或TSL指令</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0rvloygu5j311y0lbtox.jpg" alt=""></p><h4 id="Swap指令"><a href="#Swap指令" class="headerlink" title="Swap指令"></a>Swap指令</h4><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0rvnnbwdrj311y0lb17l.jpg" alt=""></p><h3 id="4-4读者-写者问题"><a href="#4-4读者-写者问题" class="headerlink" title="4.4读者-写者问题"></a>4.4读者-写者问题</h3><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r59jvg0nj311y0lbasa.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r5ih7bjqj311y0lb1fj.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0r5t5rjxfj311y0lbqee.jpg" alt=""></p><h3 id="4-5-哲学家进餐问题"><a href="#4-5-哲学家进餐问题" class="headerlink" title="4.5 哲学家进餐问题"></a>4.5 哲学家进餐问题</h3><p><a href="https://www.bilibili.com/video/av40376808?p=20" target="_blank" rel="noopener">https://www.bilibili.com/video/av40376808?p=20</a></p><h3 id="4-6-信号量机制"><a href="#4-6-信号量机制" class="headerlink" title="4.6 信号量机制"></a>4.6 信号量机制</h3><h4 id="整形信号量"><a href="#整形信号量" class="headerlink" title="整形信号量"></a>整形信号量</h4><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0s7nzlu76j311y0lbwx0.jpg" alt=""></p><h4 id="记录型信号量"><a href="#记录型信号量" class="headerlink" title="记录型信号量"></a>记录型信号量</h4><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0s89nuj9fj311y0la19h.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0s7w0at66j311y0lbngk.jpg" alt=""></p><h4 id="信号量机制实现进程互斥"><a href="#信号量机制实现进程互斥" class="headerlink" title="信号量机制实现进程互斥"></a>信号量机制实现进程互斥</h4><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0s81qzpn7j311y0lb7oj.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0s84ho17hj311y0lbwtw.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0s85q4vzbj311y0lbap7.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0s86jdp0mj311y0lb4ge.jpg" alt=""></p><h3 id="4-7-生产者消费者问题"><a href="#4-7-生产者消费者问题" class="headerlink" title="4.7 生产者消费者问题"></a>4.7 生产者消费者问题</h3><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0s8ykmm7nj30ud0jiaga.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0s8slzfkxj311y0lbtzn.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0s8twoliuj30xn0560xb.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0s8uh02lkj311y0lbnlx.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0s91zhzvsj311y0lbatk.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0s94en3cfj311y0lbh2v.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0s95ciaasj311y0lbwr3.jpg" alt=""></p><h2 id="5-管程"><a href="#5-管程" class="headerlink" title="5. 管程"></a>5. 管程</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0s8at0ft2j311y0lbqdo.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0s8ccvbmuj30o70ffafx.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0s8i3pf46j311y0lbneb.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0s8jct50gj311y0lbncx.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0s8jyzcsoj311y0lb4a3.jpg" alt=""></p><h2 id="6-进程通信"><a href="#6-进程通信" class="headerlink" title="6. 进程通信"></a>6. 进程通信</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pxsey6f2j311y0lbk29.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pxvb7o6tj311y0lbdtv.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pxy26zsij311y0lbh03.jpg" alt=""></p><h2 id="7-线程"><a href="#7-线程" class="headerlink" title="7. 线程"></a>7. 线程</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pydawsr8j311y0lbtro.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pyfqf1d0j30yy0jjqil.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pyitai0jj311y0lbwtz.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pyl12f9qj30re0ksajl.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pyq0moqsj311y0lbdpo.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pypjsb9kj311y0lb47v.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0ql8dox1bj30vi0jktjc.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0qmlg8cbej30yb0k5aj0.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0qmm2uwxrj30zo0k1qcp.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0qmn9b6hbj30x40jm7d2.jpg" alt=""></p><h2 id="8-进程、线程和作业的概念区分"><a href="#8-进程、线程和作业的概念区分" class="headerlink" title="8. 进程、线程和作业的概念区分"></a>8. 进程、线程和作业的概念区分</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0qomkpz36j30oq0kygow.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>操作系统引言</title>
      <link href="/2019/03/05/01OS%E5%BC%95%E8%A8%80.html"/>
      <url>/2019/03/05/01OS%E5%BC%95%E8%A8%80.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h1 id="第一章"><a href="#第一章" class="headerlink" title="第一章"></a>第一章</h1><h2 id="1-操作系统的定义："><a href="#1-操作系统的定义：" class="headerlink" title="1. 操作系统的定义："></a>1. 操作系统的定义：</h2><p>​    操作系统是直接控制和管理计算机硬件、软件资源的最 基本的系统软件，用以方便用户充分、有效的利用这些资源 并增强整个计算机的处理能力</p><h2 id="2-操作系统的目标-amp-作用"><a href="#2-操作系统的目标-amp-作用" class="headerlink" title="2. 操作系统的目标&amp;作用"></a>2. 操作系统的目标&amp;作用</h2><h3 id="2-1-目标："><a href="#2-1-目标：" class="headerlink" title="2.1 目标："></a>2.1 目标：</h3><p><strong>方便性、有效性、</strong>可扩充性、开放性</p><h3 id="2-2-作用："><a href="#2-2-作用：" class="headerlink" title="2.2 作用："></a>2.2 作用：</h3><p>​        1.OS作为用户于计算机硬件系统之间的接口</p><p>​        2.作为计算机资源的管理者</p><p>​        3. 作为扩展机器实现了对计算机资源的抽象    </p><h2 id="3-单批道处理系统"><a href="#3-单批道处理系统" class="headerlink" title="3. 单批道处理系统"></a>3. 单批道处理系统</h2><p>概念：系统对作业的处理都是成批进行的、且内存中始终只保持 一道作业，称为单道批处理系统（simple batch system）。</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0pssg5tfej30hx0acn0h.jpg" alt=""><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0psu5ylsqj30la0c8q54.jpg" alt=""></p><h2 id="4-多批道处理系统"><a href="#4-多批道处理系统" class="headerlink" title="4. 多批道处理系统"></a>4. 多批道处理系统</h2><h3 id="4-1-基本概念"><a href="#4-1-基本概念" class="headerlink" title="4.1 基本概念"></a>4.1 基本概念</h3><p>多道：内存中同时存放几个作业； </p><p>宏观上并行运行：都处于运行状态，但都未运行完；</p><p>微观上串行运行：各作业交替使用CPU</p><h3 id="4-2-特征"><a href="#4-2-特征" class="headerlink" title="4.2 特征"></a>4.2 特征</h3><p>多道性、无序性、调度性（作业调度、进程调度）</p><h3 id="4-3-多道批处理系统的优缺点"><a href="#4-3-多道批处理系统的优缺点" class="headerlink" title="4.3 多道批处理系统的优缺点"></a>4.3 多道批处理系统的优缺点</h3><p>优点： 资源利用率高：CPU和内存利用率较高； 作业吞吐量大：单位时间内完成的工作总量大； </p><p>缺点：  用户交互性差：整个作业完成后或中间出错时，才与用户交互，不利于调试和修改； </p><p>​    作业平均周转时间长：短作业的周转时间显著增长</p><h2 id="5-分时系统"><a href="#5-分时系统" class="headerlink" title="5. 分时系统"></a>5. 分时系统</h2><h3 id="5-1-概念："><a href="#5-1-概念：" class="headerlink" title="5.1 概念："></a>5.1 概念：</h3><p>指一台主机上连接了多个带有显示器和键盘 的终端，同时允许多个用户共享主机中的资源，各 个用户都可通过自己的终端以交互方式使用计算机。 </p><h3 id="5-2-分时的目的："><a href="#5-2-分时的目的：" class="headerlink" title="5.2 分时的目的："></a>5.2 分时的目的：</h3><p>多个程序分时共享硬件和软件资源(即： 多任务)。多个用户分享使用同一台计算机(即：多用户) 。 </p><h3 id="5-3-分时的定义："><a href="#5-3-分时的定义：" class="headerlink" title="5.3 分时的定义："></a>5.3 分时的定义：</h3><p>把计算机的系统资源（尤其是CPU时间） 进行时间上的分割，每个时间段称为一个时间片 （time slice），每个用户依次轮流使用时间片。</p><h2 id="6-批处理系统和分时系统的区别"><a href="#6-批处理系统和分时系统的区别" class="headerlink" title="6. 批处理系统和分时系统的区别"></a>6. 批处理系统和分时系统的区别</h2><h3 id="6-1-批处理系统"><a href="#6-1-批处理系统" class="headerlink" title="6.1 批处理系统"></a>6.1 批处理系统</h3><p>从字面上理解，就是一批一批的处理任务的一种系统，严格的定义，就是指<strong>用户将一批作业提交给操作系统后就不再干预，由操作系统控制它们自动运行</strong>。这种采用批量处理作业技术的操作系统称为批处理操作系统。简单地理解就是我手中有一大堆作业（相当一个程序）要运行，我一个一个的放入内存中执行效率会很慢，因为我要人为的去装载程序（早期的机器会把程序写到磁带中，然后人为地放到专门处理程序的机器中），所以我一次性放一批的作业，让操作系统自己去运行它，而我不需要干涉，这样我就省了很多力气 ，如下图 </p><p><img src="https://img-blog.csdn.net/20170329153105707?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzAxMzc2MTE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p><h3 id="6-2-分时系统"><a href="#6-2-分时系统" class="headerlink" title="6.2 分时系统"></a>6.2 分时系统</h3><p>分时操作系统：“分时”的含义是指多个用户使用同一台计算机，多个程序分时（分时间片）共享硬件和软件资源。分时操作系统是指在一台主机上连接多个带有显示器和键盘的终端，同时允许多个用户通过主机的终端，以交互方式使用计算机，共享主机中的资源。，<strong>分时操作系统将CPU的时间划分成若干个片段，称为时间片</strong>，操作系统以时间片为单位，轮流为每个终端用户服务 ，如下图 </p><p><img src="https://img-blog.csdn.net/20170329152411531?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzAxMzc2MTE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p><h3 id="6-3-总结"><a href="#6-3-总结" class="headerlink" title="6.3 总结"></a>6.3 总结</h3><p>  从他们的定义我们大概可以总结出：<br>批处理系统没有人机交互，而分时系统允许多个用户同时使用<br>批处理系统中允许程序长时间地占用CPU，而分时系统不允许</p><p>多道程序按不按时间片来分配时间 多道程序没有时间片的概念  </p><h2 id="7-操作系统的基本特征"><a href="#7-操作系统的基本特征" class="headerlink" title="7. 操作系统的基本特征"></a>7. 操作系统的基本特征</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0ptfk7v13j30l20f7wj4.jpg" alt=""></p><h2 id="8-操作系统的主要功能"><a href="#8-操作系统的主要功能" class="headerlink" title="8. 操作系统的主要功能"></a>8. 操作系统的主要功能</h2><h3 id="8-1-处理机管理"><a href="#8-1-处理机管理" class="headerlink" title="8.1 处理机管理"></a>8.1 处理机管理</h3><p>也可以理解为进程管理</p><p>它又分为 【进程控制】【进程同步】 【进程通信】 【调度】</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0ptomyfnqj30mm0vwtjm.jpg" alt=""></p><h3 id="8-2-存储管理"><a href="#8-2-存储管理" class="headerlink" title="8.2 存储管理"></a>8.2 存储管理</h3><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0ptpxeuk6j30m70eggpw.jpg" alt=""></p><h3 id="8-3-设备管理"><a href="#8-3-设备管理" class="headerlink" title="8.3 设备管理"></a>8.3 设备管理</h3><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0ptslx1sdj30na0esn25.jpg" alt=""></p><h3 id="8-4-文件管理"><a href="#8-4-文件管理" class="headerlink" title="8.4 文件管理"></a>8.4 文件管理</h3><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0ptty0c21j30mg0ap76f.jpg" alt=""></p><h3 id="8-5-用户接口"><a href="#8-5-用户接口" class="headerlink" title="8.5 用户接口"></a>8.5 用户接口</h3><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0ptzk5gwgj30kd0er0vh.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>正则表达式验证密码的强度</title>
      <link href="/2019/03/05/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E9%AA%8C%E8%AF%81%E5%AF%86%E7%A0%81%E7%9A%84%E5%BC%BA%E5%BA%A6.html"/>
      <url>/2019/03/05/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E9%AA%8C%E8%AF%81%E5%AF%86%E7%A0%81%E7%9A%84%E5%BC%BA%E5%BA%A6.html</url>
      
        <content type="html"><![CDATA[ <meta name="referrer" content="no-referrer"><p>密码: 数字,字母,特殊符号</p><p>密码: 只有数字- 或者是只有字母,或者是只有特殊符号—1级—弱</p><p>两两组合: 数字和字母, 数字和特殊符号, 字母和特殊符号   —–2级—-中</p><p>三者都有: 数字和字母和特殊符号——3级—–强</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;style type=<span class="string">"text/css"</span>&gt;</span><br><span class="line">  #dv&#123;</span><br><span class="line">    width: <span class="number">300</span>px;</span><br><span class="line">    height:<span class="number">200</span>px;</span><br><span class="line">    position: absolute;</span><br><span class="line">    left:<span class="number">300</span>px;</span><br><span class="line">    top:<span class="number">100</span>px;</span><br><span class="line">  &#125;</span><br><span class="line">  .strengthLv0 &#123;</span><br><span class="line">    height: <span class="number">6</span>px;</span><br><span class="line">    width: <span class="number">120</span>px;</span><br><span class="line">    border: 1px solid #ccc;</span><br><span class="line">    padding: <span class="number">2</span>px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .strengthLv1 &#123;</span><br><span class="line">    background: red;</span><br><span class="line">    height: <span class="number">6</span>px;</span><br><span class="line">    width: <span class="number">40</span>px;</span><br><span class="line">    border: 1px solid #ccc;</span><br><span class="line">    padding: <span class="number">2</span>px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .strengthLv2 &#123;</span><br><span class="line">    background: orange;</span><br><span class="line">    height: <span class="number">6</span>px;</span><br><span class="line">    width: <span class="number">80</span>px;</span><br><span class="line">    border: 1px solid #ccc;</span><br><span class="line">    padding: <span class="number">2</span>px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .strengthLv3 &#123;</span><br><span class="line">    background: green;</span><br><span class="line">    height: <span class="number">6</span>px;</span><br><span class="line">    width: <span class="number">120</span>px;</span><br><span class="line">    border: 1px solid #ccc;</span><br><span class="line">    padding: <span class="number">2</span>px;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/style&gt;</span></span><br><span class="line"><span class="regexp">&lt;body&gt;</span></span><br><span class="line"><span class="regexp">&lt;div id="dv"&gt;</span></span><br><span class="line"><span class="regexp">  &lt;label for="pwd"&gt;密码&lt;/</span>label&gt;</span><br><span class="line">  &lt;input type=<span class="string">"text"</span> id=<span class="string">"pwd"</span> maxlength=<span class="string">"16"</span>&gt;<span class="xml"><span class="comment">&lt;!--课外话题--&gt;</span></span></span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;em&gt;密码强度：&lt;/em&gt;</span><br><span class="line">    &lt;em id="strength"&gt;&lt;/em&gt;</span><br><span class="line">    &lt;div id="strengthLevel" class="strengthLv0"&gt;&lt;/div&gt;</span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">my$</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">  <span class="comment">//获取文本框注册键盘抬起事件</span></span><br><span class="line">  my$(<span class="string">"pwd"</span>).onkeyup=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//每次键盘抬起都要获取文本框中的内容,验证文本框中有什么东西,得到一个级别,然后下面的div显示对应的颜色</span></span><br><span class="line">    <span class="comment">//如果密码的长度是小于6的,没有必要判断</span></span><br><span class="line"><span class="comment">//    if(this.value.length&gt;=6)&#123;</span></span><br><span class="line"><span class="comment">//     var lvl= getLvl(this.value);</span></span><br><span class="line"><span class="comment">//      my$("strengthLevel").className="strengthLv"+lvl;</span></span><br><span class="line"><span class="comment">//    &#125;else&#123;</span></span><br><span class="line"><span class="comment">//      my$("strengthLevel").className="strengthLv0";</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">    my$(<span class="string">"strengthLevel"</span>).className=<span class="string">"strengthLv"</span>+(<span class="keyword">this</span>.value.length&gt;=<span class="number">6</span>?getLvl(<span class="keyword">this</span>.value) :<span class="number">0</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//给我密码,我返回对应的级别</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getLvl</span>(<span class="params">pwd</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> lvl=<span class="number">0</span>;<span class="comment">//默认是0级</span></span><br><span class="line">    <span class="comment">//密码中是否有数字,或者是字母,或者是特殊符号</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="regexp">/[0-9]/</span>.test(pwd))&#123;</span><br><span class="line">      lvl++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断密码中有没有字母</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="regexp">/[a-zA-Z]/</span>.test(pwd))&#123;</span><br><span class="line">      lvl++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断密码中有没有特殊符号</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="regexp">/[^0-9a-zA-Z_]/</span>.test(pwd))&#123;</span><br><span class="line">      lvl++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> lvl;<span class="comment">//最小的值是1,最大值是3</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/  /</span><span class="regexp">/获取文本框注册键盘抬起事件</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/  my$("pwd").onkeyup=function () &#123;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/    /</span><span class="regexp">/每次键盘抬起都要获取文本框中的内容,验证文本框中有什么东西,得到一个级别,然后下面的div显示对应的颜色</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/    /</span><span class="regexp">/如果密码的长度是小于6的,没有必要判断</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/    if(this.value.length&gt;=6)&#123;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/      var lvl=getLvl(this.value);</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/      if(lvl==1)&#123;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/        /</span><span class="regexp">/弱</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/        my$("strengthLevel").className="strengthLv1";</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/      &#125;else if(lvl==2)&#123;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/        my$("strengthLevel").className="strengthLv2";</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/      &#125;else if(lvl==3)&#123;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/        my$("strengthLevel").className="strengthLv3";</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/      &#125;else&#123;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/        my$("strengthLevel").className="strengthLv0";</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/      &#125;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/    &#125;else&#123;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/      my$("strengthLevel").className="strengthLv0";</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/    &#125;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/  &#125;;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/  /</span><span class="regexp">/给我密码,我返回对应的级别</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/  function getLvl(pwd) &#123;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/    var lvl=0;/</span><span class="regexp">/默认是0级</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/    /</span><span class="regexp">/密码中是否有数字,或者是字母,或者是特殊符号</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/    if(/</span>[<span class="number">0</span><span class="number">-9</span>]/.test(pwd))&#123;</span><br><span class="line"><span class="comment">//      lvl++;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//    //判断密码中有没有字母</span></span><br><span class="line"><span class="comment">//    if(/[a-zA-Z]/.test(pwd))&#123;</span></span><br><span class="line"><span class="comment">//      lvl++;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//    //判断密码中有没有特殊符号</span></span><br><span class="line"><span class="comment">//    if(/[^0-9a-zA-Z_]/.test(pwd))&#123;</span></span><br><span class="line"><span class="comment">//      lvl++;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//    return lvl;//1  3</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 正则表达式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 小案例 </tag>
            
            <tag> 正则表达式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>继承</title>
      <link href="/2019/03/04/%E7%BB%A7%E6%89%BF.html"/>
      <url>/2019/03/04/%E7%BB%A7%E6%89%BF.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>继承: 首先继承是一种关系，类(class)与类之间的关系，JS中没有类，但是可以通过构造函数模拟类，然后通过原型来实现继承。继承也是为了数据共享，JS中的继承也是为了实现数据共享。下面介绍三种继承方法。</p><h1 id="通过改变原型指向实现继承"><a href="#通过改变原型指向实现继承" class="headerlink" title="通过改变原型指向实现继承"></a>通过改变原型指向实现继承</h1><p>这是一个Person构造函数，用于构造Person类的对象：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age,sex</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name=name;</span><br><span class="line">  <span class="keyword">this</span>.sex=sex;</span><br><span class="line">  <span class="keyword">this</span>.age=age;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.eat=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"人可以吃东西"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">Person.prototype.sleep=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"人在睡觉"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">Person.prototype.play=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"生活就是不一样的玩法而已"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>这是一个Student构造函数，用于构造Student类的对象：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name,age,sex，score</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name=name;</span><br><span class="line">  <span class="keyword">this</span>.sex=sex;</span><br><span class="line">  <span class="keyword">this</span>.age=age;</span><br><span class="line">  <span class="keyword">this</span>.score = score;</span><br><span class="line">&#125;</span><br><span class="line">Student.prototype.eat=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"吃东西"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">Student.prototype.sleep=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"在睡觉"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">Student.prototype.play=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"在玩耍"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">Student.prototype.study=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"学习很累很累的哦."</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>可以看见，Student构造函数的很多属性和Person构造函数的属性是一致的，这样就造成了一种冗余。因此，可以让Student继承Person来减少冗余：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">score</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">this</span>.score=score;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//改变学生的原型的指向即可</span></span><br><span class="line">   Student.prototype=<span class="keyword">new</span> Person(<span class="string">"小明"</span>,<span class="number">10</span>,<span class="string">"男"</span>);</span><br><span class="line">   Student.prototype.study=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">"学习很累很累的哦."</span>);</span><br><span class="line">   &#125;;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> stu=<span class="keyword">new</span> Student(<span class="number">100</span>);<span class="comment">//创建Student实例</span></span><br></pre></td></tr></table></figure><h1 id="借用构造函数来实现继承"><a href="#借用构造函数来实现继承" class="headerlink" title="借用构造函数来实现继承"></a>借用构造函数来实现继承</h1><p>​    为了数据共享,改变原型指向，做到了继承—通过改变原型指向实现的继承，但是这种方法有个<strong>缺陷</strong>：因为改变原型指向的同时实现继承，直接初始化了属性，继承过来的属性的值都是一样的了，所以。这就是问题，只能重新调用对象的属性进行重新赋值，显然这样太麻烦了。</p><p>​    <strong>解决方案</strong>:继承的时候，不用改变原型的指向，直接调用父级的构造函数的方式来为属性赋值就可以了：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, sex, weight</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">this</span>.name = name;</span><br><span class="line">     <span class="keyword">this</span>.age = age;</span><br><span class="line">     <span class="keyword">this</span>.sex = sex;</span><br><span class="line">     <span class="keyword">this</span>.weight = weight;</span><br><span class="line">   &#125;</span><br><span class="line">   Person.prototype.sayHi = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">"您好"</span>);</span><br><span class="line">   &#125;;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name,age,sex,weight,score</span>) </span>&#123;</span><br><span class="line">     <span class="comment">//借用构造函数</span></span><br><span class="line">     Person.call(<span class="keyword">this</span>,name,age,sex,weight);</span><br><span class="line">     <span class="keyword">this</span>.score = score;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> stu1 = <span class="keyword">new</span> Student(<span class="string">"小明"</span>,<span class="number">10</span>,<span class="string">"男"</span>,<span class="string">"10kg"</span>,<span class="string">"100"</span>);</span><br><span class="line">   <span class="built_in">console</span>.log(stu1.name, stu1.age, stu1.sex, stu1.weight, stu1.score);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> stu2 = <span class="keyword">new</span> Student(<span class="string">"小红"</span>,<span class="number">20</span>,<span class="string">"女"</span>,<span class="string">"20kg"</span>,<span class="string">"120"</span>);</span><br><span class="line">   <span class="built_in">console</span>.log(stu2.name, stu2.age, stu2.sex, stu2.weight, stu2.score);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> stu3 = <span class="keyword">new</span> Student(<span class="string">"小丽"</span>,<span class="number">30</span>,<span class="string">"保密"</span>,<span class="string">"30kg"</span>,<span class="string">"130"</span>);</span><br><span class="line">   <span class="built_in">console</span>.log(stu3.name, stu3.age, stu3.sex, stu3.weight, stu3.score);</span><br><span class="line"></span><br><span class="line">stu3.sayHi();<span class="comment">//报错！无法调用父级构造函数的方法，因为无法继承方法</span></span><br></pre></td></tr></table></figure><p><strong>事实上，这个方法却带来了另一个缺陷:父级类别中的方法不能继承!!!</strong></p><h1 id="组合继承"><a href="#组合继承" class="headerlink" title="组合继承"></a>组合继承</h1><p>​    原型实现继承</p><p>​    借用构造函数实现继承</p><p>​    组合继承:原型继承+借用构造函数继承</p><p>​    <strong>组合继承的方法是比较好的一种方式，避免了上述两种方式的缺陷。</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age,sex</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name=name;</span><br><span class="line">  <span class="keyword">this</span>.age=age;</span><br><span class="line">  <span class="keyword">this</span>.sex=sex;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.sayHi=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"很高兴见到你"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name,age,sex,score</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//借用构造函数:属性值重复的问题</span></span><br><span class="line">  Person.call(<span class="keyword">this</span>,name,age,sex);</span><br><span class="line">  <span class="keyword">this</span>.score=score;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//改变原型指向----继承</span></span><br><span class="line">Student.prototype=<span class="keyword">new</span> Person();<span class="comment">//不传参数值。</span></span><br><span class="line">Student.prototype.eat=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"吃东西"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> stu=<span class="keyword">new</span> Student(<span class="string">"小黑"</span>,<span class="number">20</span>,<span class="string">"男"</span>,<span class="string">"100分"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(stu.name,stu.age,stu.sex,stu.score);</span><br><span class="line">stu.sayHi();</span><br><span class="line">stu.eat();</span><br><span class="line"><span class="keyword">var</span> stu2=<span class="keyword">new</span> Student(<span class="string">"小白"</span>,<span class="number">18</span>,<span class="string">"男人"</span>,<span class="string">"85分"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(stu2.name,stu2.age,stu2.sex,stu2.score);</span><br><span class="line">stu2.sayHi();</span><br><span class="line">stu2.eat();</span><br><span class="line"></span><br><span class="line"><span class="comment">//属性和方法都被继承了</span></span><br></pre></td></tr></table></figure><h1 id="拷贝继承"><a href="#拷贝继承" class="headerlink" title="拷贝继承"></a>拷贝继承</h1><p><strong>拷贝继承：</strong>把一个对象中的属性或者方法直接复制到另一个对象中</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.age=<span class="number">10</span>;</span><br><span class="line">Person.prototype.sex=<span class="string">"男"</span>;</span><br><span class="line">Person.prototype.height=<span class="number">100</span>;</span><br><span class="line">Person.prototype.play=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"玩的好开心"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> obj2=&#123;&#125;;</span><br><span class="line"><span class="comment">//Person的构造中有原型prototype,prototype就是一个对象,那么里面,age,sex,height,play都是该对象中的属性或者方法</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> Person.prototype)&#123;</span><br><span class="line">  obj2[key]=Person.prototype[key];</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.dir(obj2);</span><br><span class="line">obj2.play();</span><br></pre></td></tr></table></figure><p><br><br></p><p>（完）</p><p><br><br></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS电商上线项目</title>
      <link href="/2019/02/28/dianshang01.html"/>
      <url>/2019/02/28/dianshang01.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h1 id="架构设计"><a href="#架构设计" class="headerlink" title="架构设计"></a>架构设计</h1><ul><li><p>前后端完全分离</p></li><li><p>分层架构</p><p>逻辑层–数据层–工具层</p><p>通过层级的划分来进行系统的解耦，提高系统可扩展性和可维护性</p></li><li><p>模块化</p><p>达到进一步解耦的效果，让系统通过组件的拼装来完成业务的实现。</p><p>模块化的另一个好处：支持团队的并行开发，提高整个团队的效率</p></li></ul><p><br></p><h2 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h2><p>HTML+CSS+JavaScript+jQuery（Ajax和DOM操作）</p><p><br></p><h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><ul><li><p>webpack</p><p>对代码进行基于CommonJs的模块化打包集成</p></li><li><p>node.js</p></li><li><p>npm</p></li><li><p>shell脚本</p><p>用于制作自动化脚本发布工具</p></li><li><p>Charles</p><p>用于请求劫持</p></li><li><p>Git</p><p><br></p></li></ul><h1 id="开发安排"><a href="#开发安排" class="headerlink" title="开发安排"></a>开发安排</h1><h2 id="准备部分"><a href="#准备部分" class="headerlink" title="准备部分"></a>准备部分</h2><ul><li>基础框架的搭建<ul><li>双平台的开发环境安装</li><li>git仓库的规范化用法</li><li>webpack脚手架搭建实战</li></ul></li><li><p>通用模块</p><ul><li><p>可高复用工具类设计与封装</p></li><li><p>通用模块设计与独立打包方法</p></li><li><p>高逼格UI开发经验与技巧</p><p><br></p></li></ul></li></ul><h2 id="业务部分"><a href="#业务部分" class="headerlink" title="业务部分"></a>业务部分</h2><ul><li>用户模块<ul><li>数据安全性处理方案</li><li>表单同步/异步验证</li><li>基于JavaScript的小型SPA开发</li></ul></li><li>商品模块<ul><li>jQuery插件模块化改造</li><li>独立组建抽离技巧</li><li>多功能列表开发</li></ul></li><li>购物车模块<ul><li>商品状态随时验证方法</li><li>模块内部方法调用方式</li><li>非form提交时的数据验证</li></ul></li><li>订单模块<ul><li>modal式组件封装思想</li><li>城市级联操作</li><li>复杂表单回填</li></ul></li><li>支付模块<ul><li>支付宝支付功能对接</li><li>支付状态动态监测</li><li>支付成功回执处理</li></ul></li><li>管理后台<ul><li>管理后天实现思路</li><li>React框架及其组件化</li><li>React-Router的使用</li></ul></li><li>访问数据分析<ul><li>PV / UV</li><li>流量来源监控</li><li>用户特征分析</li></ul></li><li>SEO优化<ul><li>SEO原理</li><li>关键词的设计</li><li>SEO监控</li></ul></li><li>线上部署<ul><li>线上服务器环境搭建</li><li>自动化发布脚本编写</li><li>域名规划与nginx配置</li></ul></li><li>可用性监控<ul><li>外部监控原理</li><li>第三方监控的设置</li><li>更高级的监控方式</li></ul></li></ul><p><br></p><h1 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h1><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0mjkhkl8tj30q90dcdol.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0mjnb9yh9j30ob09un0z.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0mjorrwkij30o40bm780.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0mjpfza5ij30j30a2mzz.jpg" alt=""></p><p><br><br></p><h1 id="架构设计与技术选型"><a href="#架构设计与技术选型" class="headerlink" title="架构设计与技术选型"></a>架构设计与技术选型</h1><h2 id="架构设计-1"><a href="#架构设计-1" class="headerlink" title="架构设计"></a>架构设计</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0mjtko8v5j30kn08s0uy.jpg" alt=""><br></p><h2 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0mjvdkhrzj30k20a80v1.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0mjyk0guij30lh0a8aev.jpg" alt=""></p><p>（了解一下这几种模块化方案，本项目采用common JS）</p><p><br><br></p><p>一个web应用的入口式网页页面，而每一个页面都有一个主模块，用来组织各个子模块的逻辑关系，从而形成一个功能完整的页面，我们可以把主模块和各个子模块放在同一层，称之为<strong>逻辑层</strong>，而逻辑层需要和<strong>后端服务</strong>进行数据交互。我们把这些数据交互的方法都划分到一个个的service模块里，我们把这些service模块又划分为一个层，称之为<strong>数据层</strong>，所有的数据交换都要由数据层来和服务器进行，不允许业务模块和服务器直接进行跨层的对接。最后我们需要划分一个最底层的层级，用来提供支持整个系统的通用工具，称之为<strong>工具层</strong>。</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0mk3e6bomj30n60de7a2.jpg" alt=""></p><p><br></p><h2 id="技术选型-1"><a href="#技术选型-1" class="headerlink" title="技术选型"></a>技术选型</h2><h3 id="需要考虑的东西"><a href="#需要考虑的东西" class="headerlink" title="需要考虑的东西"></a>需要考虑的东西</h3><ul><li><p>软件过程模型</p><ul><li>瀑布模型</li><li>螺旋模型</li><li>敏捷开发</li></ul><p>软件过程的不同所带来的开发过程也不同</p></li><li><p>前后端分离</p><p>分离方式的不同会影响到开发效率</p></li><li><p>构建工具</p></li><li><p>框架</p></li><li><p>代码版本控制软件</p></li><li><p>发布上线的方案</p></li></ul><p><br></p><h3 id="本项目的选择"><a href="#本项目的选择" class="headerlink" title="本项目的选择"></a>本项目的选择</h3><ul><li><p>软件过程：敏捷开发</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0mkp9cropj30li0aywi2.jpg" alt=""></p></li><li><p>前后端采用完全分离的方式</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0ml71m3xtj30ik0ajmze.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0ml5apemcj30if0a0ad2.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0ml7o2i58j30jr09amzx.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0ml87sncyj30iu0ayn07.jpg" alt=""></p></li><li><p>框架选型</p><p>使用 jQuery 来进行 Ajax 操作和 DOM 操作</p></li><li><p>构建工具</p><p>webpack</p></li><li><p>版本控制</p><p>Git</p></li><li><p>发布上线</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0mlejuhmtj30dl0bzdin.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0mlfpuajvj30dk0c6tbk.jpg" alt=""></p></li></ul><p><br><br></p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul><li>使用敏捷开发思想</li><li>前后端完全分离</li><li>commonJs + webpack 实现模块化</li><li>框架使用 jQuery</li><li>版本控制 git</li></ul><p><br><br></p><h1 id="前后端配合方式和数据接口定义"><a href="#前后端配合方式和数据接口定义" class="headerlink" title="前后端配合方式和数据接口定义"></a>前后端配合方式和数据接口定义</h1><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0n3843zlvj30ld0d4jss.jpg" alt=""></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0n39a2hx3j30l90d60un.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 项目 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>导航细线边框的实现</title>
      <link href="/2019/02/25/%E5%AF%BC%E8%88%AA%E7%BB%86%E7%BA%BF%E8%BE%B9%E6%A1%86%E7%9A%84%E5%AE%9E%E7%8E%B0.html"/>
      <url>/2019/02/25/%E5%AF%BC%E8%88%AA%E7%BB%86%E7%BA%BF%E8%BE%B9%E6%A1%86%E7%9A%84%E5%AE%9E%E7%8E%B0.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>要实现如下边框：</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0wjv0k2coj30aq08x74s.jpg" alt=""></p><p>一般不要直接给每个盒子加border：1px solid #ccc，这样会使中间的边框线重合变成了2px的线，太粗，不好看。</p><h2 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h2><p>只给盒子的下边框和右边框加border,贴边的消除border</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.nav-item</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/*border: 1rpx solid #ccc;/*不建议这样写，这样会造成中间的分割线为2rpx*/</span></span><br><span class="line">  <span class="attribute">border-right</span>: <span class="number">1</span>rpx solid <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1</span>rpx solid <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.nav-item</span><span class="selector-pseudo">:nth-child(3n)</span>&#123;</span><br><span class="line">  <span class="attribute">border-right</span>: <span class="number">0</span> none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h2><p>使用伪元素加定位</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.nav-item</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: red;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.nav-item</span><span class="selector-pseudo">:nth-child(3n)</span><span class="selector-pseudo">::after</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>更好的方式是将上述代码封装起来，以便多次调用：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.bdr</span>&#123;    </span><br><span class="line">    <span class="comment">/* 2.3.子绝父相 */</span></span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bdr</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="comment">/* 2.1.通过伪元素绘制一像素的右边框 */</span></span><br><span class="line">    <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">1</span>rpx;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#ddd</span>;</span><br><span class="line">    <span class="comment">/* 2.2.定位，不占位置 */</span></span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小案例 </tag>
            
            <tag> html/css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>遍历DOM树</title>
      <link href="/2019/02/16/%E9%81%8D%E5%8E%86DOM%E6%A0%91.html"/>
      <url>/2019/02/16/%E9%81%8D%E5%8E%86DOM%E6%A0%91.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  第一个函数:给我根节点,我会找到所有的子节点:forDOM(根节点)</span></span><br><span class="line"><span class="comment">//  获取这个根节点的子节点</span></span><br><span class="line"><span class="comment">//  var children=根节点的.children</span></span><br><span class="line"><span class="comment">//  调用第二个函数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  第二个函数:给我所有的子节点,我把每个子节点的名字显示出来(children)</span></span><br><span class="line"><span class="comment">//  for(var i=0;i&lt;children.length;i++)&#123;</span></span><br><span class="line"><span class="comment">//    每个子节点</span></span><br><span class="line"><span class="comment">//    var child=children[i];</span></span><br><span class="line"><span class="comment">//    f1(child);给我节点,我显示该节点的名字</span></span><br><span class="line"><span class="comment">//    child是子节点,但是如果child里面还有子节点,此时child就是爹了</span></span><br><span class="line"><span class="comment">//    child.children&amp;&amp;第一个函数(child)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//获取页面中的根节点--根标签</span></span><br><span class="line">  <span class="keyword">var</span> root=<span class="built_in">document</span>.documentElement;<span class="comment">//html</span></span><br><span class="line">  <span class="comment">//函数遍历DOM树</span></span><br><span class="line">  <span class="comment">//根据根节点,调用fn的函数,显示的是根节点的名字</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">forDOM</span>(<span class="params">root1</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//调用f1,显示的是节点的名字</span></span><br><span class="line">   <span class="comment">// f1(root1);</span></span><br><span class="line">    <span class="comment">//获取根节点中所有的子节点</span></span><br><span class="line">    <span class="keyword">var</span> children=root1.children;</span><br><span class="line">    <span class="comment">//调用遍历所有子节点的函数</span></span><br><span class="line">    forChildren(children);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//给我所有的子节点,我把这个子节点中的所有的子节点显示出来</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">forChildren</span>(<span class="params">children</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//遍历所有的子节点</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;children.length;i++)&#123;</span><br><span class="line">      <span class="comment">//每个子节点</span></span><br><span class="line">      <span class="keyword">var</span> child=children[i];</span><br><span class="line">      <span class="comment">//显示每个子节点的名字</span></span><br><span class="line">      f1(child);</span><br><span class="line">      <span class="comment">//判断child下面有没有子节点,如果还有子节点,那么就继续的遍历</span></span><br><span class="line">      child.children&amp;&amp;forDOM(child);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//函数调用,传入根节点</span></span><br><span class="line">  forDOM(root);</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"节点的名字:"</span>+node.nodeName);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><br><br><br><br><br></p><p>( 完 )</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>css的权重问题</title>
      <link href="/2019/02/02/css%E7%9A%84%E6%9D%83%E9%87%8D%E9%97%AE%E9%A2%98.html"/>
      <url>/2019/02/02/css%E7%9A%84%E6%9D%83%E9%87%8D%E9%97%AE%E9%A2%98.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="CSS优先级"><a href="#CSS优先级" class="headerlink" title="CSS优先级"></a>CSS优先级</h2><p>定义CSS样式时，经常出现两个或更多规则应用在同一元素上，这时就会出现优先级的问题。</p><p>在考虑权重时，初学者还需要注意一些特殊的情况，具体如下：</p><p>继承样式的权重为0。即在嵌套结构中，不管父元素样式的权重多大，被子元素继承时，他的权重都为0，也就是说子元素定义的样式会覆盖继承来的样式。</p><p>行内样式优先。应用style属性的元素，其行内样式的权重非常高，可以理解为远大于100。总之，他拥有比上面提高的选择器都大的优先级。</p><p>权重相同时，CSS遵循就近原则。也就是说靠近元素的样式具有最大的优先级，或者说排在最后的样式优先级最大。</p><p>CSS定义了一个!important命令，该命令被赋予最大的优先级。也就是说不管权重如何以及样式位置的远近，!important都具有最大优先级。</p><h2 id="计算权重"><a href="#计算权重" class="headerlink" title="计算权重"></a>计算权重</h2><p>关于CSS权重，我们需要一套计算公式来去计算，这个就是 CSS Specificity，我们称为CSS 特性或称非凡性，它是一个衡量CSS值优先级的一个标准 具体规范入如下：</p><p>specificity用一个四位的数 字串(CSS2是三位)来表示，更像四个级别，值从左到右，左面的最大，一级大于一级，数位之间没有进制，级别之间不可超越。</p><table><thead><tr><th>继承或者* 的贡献值</th><th>0,0,0,0</th></tr></thead><tbody><tr><td>每个元素（标签）贡献值为</td><td>0,0,0,1</td></tr><tr><td>每个类，伪类贡献值为</td><td>0,0,1,0</td></tr><tr><td>每个ID贡献值为</td><td>0,1,0,0</td></tr><tr><td>每个行内样式贡献值</td><td>1,0,0,0</td></tr><tr><td>每个!important贡献值 重要的</td><td>∞ 无穷大</td></tr></tbody></table><p>权重是可以叠加的</p><p>比如的例子：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">div ul  li   ------&gt;      0,0,0,3</span><br><span class="line"></span><br><span class="line">.nav ul li   ------&gt;      0,0,1,2</span><br><span class="line"></span><br><span class="line">a:hover      -----—&gt;      0,0,1,1</span><br><span class="line"></span><br><span class="line">.nav a       ------&gt;      0,0,1,1   </span><br><span class="line"></span><br><span class="line">#nav p       -----&gt;       0,1,0,1</span><br></pre></td></tr></table></figure><p>👀 注意：</p><ol><li>数位之间没有进制 比如说： 0,0,0,5 + 0,0,0,5 =0,0,0,10 而不是 0,0, 1, 0， 所以不会存在10个div能赶上一个类选择器的情况。</li><li>继承的 权重是 0</li></ol><p>总结优先级：</p><ol><li>使用了 !important声明的规则。</li><li>内嵌在 HTML 元素的 style属性里面的声明。</li><li>使用了 ID 选择器的规则。</li><li>使用了类选择器、属性选择器、伪元素和伪类选择器的规则。</li><li>使用了元素选择器的规则。</li><li>只包含一个通用选择器的规则。</li><li>同一类选择器则遵循就近原则。</li></ol><h2 id="来练练"><a href="#来练练" class="headerlink" title="来练练"></a>来练练</h2><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/006ttwEMgy1g19engqkklj30zk0iqtao.jpg" alt=""></p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/006ttwEMgy1g19eo6bptuj30pv0imabj.jpg" alt=""></p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/006ttwEMgy1g19eouc6loj30zk0iq75z.jpg" alt=""></p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/006ttwEMgy1g19epf43toj30t30i20ul.jpg" alt=""></p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/006ttwEMgy1g19epy7amkj30t10h0wfg.jpg" alt=""></p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/006ttwEMgy1g19eqn3wrzj30wm0ipwgo.jpg" alt=""></p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/006ttwEMgy1g19erfs9scj30rw0id75v.jpg" alt=""></p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/006ttwEMgy1g19ersuzobj30qc0fj3zo.jpg" alt=""></p><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/006ttwEMgy1g19etc9v5pj30t20gmmyn.jpg" alt=""></p><p><br><br></p><h2 id="important"><a href="#important" class="headerlink" title="!important"></a>!important</h2><p>来给一个属性提高权重。这个属性的权重就是无穷大。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">p&#123;</span><br><span class="line">color:red !important;</span><br><span class="line">&#125;</span><br><span class="line">#para1&#123;</span><br><span class="line">color:blue;</span><br><span class="line">&#125;</span><br><span class="line">.spec&#123;</span><br><span class="line">color:green;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>!important需要强调3点：</p><p>1） !important提升的是一个属性，而不是一个选择器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">p&#123;</span><br><span class="line">color:red !important;   → 只写了这一个!important，所以就字体颜色属性提升权重</span><br><span class="line">font-size: 100px ;      → 这条属性没有写!important，所以没有提升权重</span><br><span class="line">&#125;</span><br><span class="line">#para1&#123;</span><br><span class="line">color:blue;</span><br><span class="line">font-size: 50px;</span><br><span class="line">&#125;</span><br><span class="line">.spec&#123;</span><br><span class="line">color:green;</span><br><span class="line">font-size: 20px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2） !important无法提升继承的权重，该是0还是0</p><p>3）!important不影响就近原则</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/006ttwEMgy1g19ez4pgnoj30k20bv3yr.jpg" alt=""></p><p>还有!important这个挂逼注意一下。</p><p>（完）</p><p><br><br></p>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> html/css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS封装动画函数</title>
      <link href="/2019/01/14/JS%E5%B0%81%E8%A3%85%E8%BF%90%E5%8A%A8%E5%87%BD%E6%95%B0.html"/>
      <url>/2019/01/14/JS%E5%B0%81%E8%A3%85%E8%BF%90%E5%8A%A8%E5%87%BD%E6%95%B0.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>本文介绍JavaScript实现动画效果的封装函数，将从匀速水平移动开始，在此基础上不断增加新功能，如二级标题所示。</p><h2 id="匀速水平移动动画"><a href="#匀速水平移动动画" class="headerlink" title="匀速水平移动动画"></a>匀速水平移动动画</h2><p>这哥们可以用来写轮播图。</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0anhy7p0zg30to08qn5g.gif" alt=""></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    * &#123;</span></span><br><span class="line"><span class="undefined">      margin: 0;</span></span><br><span class="line"><span class="undefined">      padding: 0;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    input &#123;</span></span><br><span class="line"><span class="undefined">      margin-top: 20px;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    div &#123;</span></span><br><span class="line"><span class="undefined">      margin-top: 30px;</span></span><br><span class="line"><span class="undefined">      width: 200px;</span></span><br><span class="line"><span class="undefined">      height: 100px;</span></span><br><span class="line"><span class="undefined">      background-color: green;</span></span><br><span class="line"><span class="undefined">      position: absolute;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"移动到400px"</span> <span class="attr">id</span>=<span class="string">"btn1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"移动到800px"</span> <span class="attr">id</span>=<span class="string">"btn2"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><p>JavaScript代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">my$</span>(<span class="params">id</span>)</span>&#123;<span class="keyword">return</span> <span class="built_in">document</span>.getElementById(id);&#125;</span><br><span class="line">  <span class="comment">//div要移动,要脱离文档流---position:absolute</span></span><br><span class="line">  <span class="comment">//如果样式的代码是在style的标签中设置,外面是获取不到</span></span><br><span class="line">  <span class="comment">//如果样式的代码是在style的属性设置,外面是可以获取</span></span><br><span class="line">  <span class="comment">//获取div的当前位置</span></span><br><span class="line">  <span class="comment">//console.log(my$("dv").offsetLeft);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//点击第一个按钮移动到400px</span></span><br><span class="line"></span><br><span class="line">  my$(<span class="string">"btn1"</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    animate(my$(<span class="string">"dv"</span>), <span class="number">400</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//点击第二个按钮移动到800px</span></span><br><span class="line"></span><br><span class="line">  my$(<span class="string">"btn2"</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    animate(my$(<span class="string">"dv"</span>), <span class="number">800</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//动画函数---任意一个元素移动到指定的目标位置</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">animate</span>(<span class="params">element, target</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//先清理定时器，防止多次点击产生多个定时器</span></span><br><span class="line">    clearInterval(element.timeId);</span><br><span class="line">    <span class="comment">//一会要清理定时器(只产生一个定时器)</span></span><br><span class="line">    element.timeId = setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">//获取div的当前的位置</span></span><br><span class="line">      <span class="keyword">var</span> current = element.offsetLeft;<span class="comment">//数字类型,没有px</span></span><br><span class="line">      <span class="comment">//div每次移动多少像素---步数</span></span><br><span class="line">      <span class="keyword">var</span> step = <span class="number">10</span>;</span><br><span class="line">      step = current &lt; target ? step : -step;</span><br><span class="line">      <span class="comment">//每次移动后的距离</span></span><br><span class="line">      current += step;</span><br><span class="line">      <span class="comment">//判断当前移动后的位置是否到达目标位置</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">Math</span>.abs(target - current) &gt; <span class="built_in">Math</span>.abs(step)) &#123;</span><br><span class="line">        element.style.left = current + <span class="string">"px"</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//清理定时器</span></span><br><span class="line">        clearInterval( element.timeId );</span><br><span class="line">        element.style.left = target + <span class="string">"px"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">20</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><h2 id="变速水平移动动画（缓动）"><a href="#变速水平移动动画（缓动）" class="headerlink" title="变速水平移动动画（缓动）"></a>变速水平移动动画（缓动）</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0fcx30nygg30uo068n5s.gif" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="comment">//点击按钮移动div</span></span><br><span class="line"></span><br><span class="line">  my$(<span class="string">"btn1"</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    animate(my$(<span class="string">"dv"</span>), <span class="number">400</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  my$(<span class="string">"btn2"</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    animate(my$(<span class="string">"dv"</span>), <span class="number">800</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//匀速动画</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">animate</span>(<span class="params">element, target</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//清理定时器</span></span><br><span class="line">    clearInterval(element.timeId);</span><br><span class="line">    element.timeId = setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">//获取元素的当前位置</span></span><br><span class="line">      <span class="keyword">var</span> current = element.offsetLeft;</span><br><span class="line">      <span class="comment">//移动的步数</span></span><br><span class="line">      <span class="keyword">var</span> step = (target-current)/<span class="number">10</span>;</span><br><span class="line">      step = step&gt;<span class="number">0</span>?<span class="built_in">Math</span>.ceil(step):<span class="built_in">Math</span>.floor(step);</span><br><span class="line">      current += step;</span><br><span class="line">      element.style.left = current + <span class="string">"px"</span>;</span><br><span class="line">      <span class="keyword">if</span>(current==target) &#123;</span><br><span class="line">        <span class="comment">//清理定时器</span></span><br><span class="line">        clearInterval(element.timeId);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//测试代码:</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"目标位置:"</span>+target+<span class="string">",当前位置:"</span>+current+<span class="string">",每次移动步数:"</span>+step);</span><br><span class="line">    &#125;, <span class="number">20</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><h2 id="封装getStyle"><a href="#封装getStyle" class="headerlink" title="封装getStyle()"></a>封装getStyle()</h2><p>在进一步写动画改变属性函数之前，我们先来封装一个getStyle()函数，一会儿要用到。</p><p>先来看一段css代码：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   //CSS部分，这个div有个id值"dv"</span><br><span class="line"><span class="selector-tag">div</span>&#123;</span><br><span class="line">     <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">     <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">     <span class="attribute">background-color</span>: purple;</span><br><span class="line">     <span class="attribute">left</span>:<span class="number">100px</span>;</span><br><span class="line">     <span class="attribute">top</span>:<span class="number">0</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>然后我们想打印出这个div的left值，执行代码console.log(document.getElementById(“dv”).offsetLeft); 我们期望看到控制台输出100，然而并没有。因为没有脱标，只有加上了position: absolute之后才会如愿输出100。</p><p>如果我们就是不想加上position: absolute，又要怎样获取呢？有两种方法：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//谷歌,火狐支持</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">window</span>.getComputedStyle(my$(<span class="string">"dv"</span>),<span class="literal">null</span>).left);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.getComputedStyle(my$(<span class="string">"dv"</span>),<span class="literal">null</span>)[<span class="string">"left"</span>]);</span><br><span class="line"><span class="comment">//IE8支持</span></span><br><span class="line"><span class="built_in">console</span>.log(my$(<span class="string">"dv"</span>).currentStyle.left);</span><br></pre></td></tr></table></figure><p><br></p><p>接下来时兼容代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">getStyle</span>(<span class="params">element,attr</span>) </span>&#123;</span><br><span class="line">   <span class="comment">//判断浏览器是否支持这个方法</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">window</span>.getComputedStyle? <span class="built_in">window</span>.getComputedStyle(element,<span class="literal">null</span>)[attr]:element.currentStyle[attr];</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(getStyle(<span class="built_in">document</span>.getElementById(<span class="string">"dv"</span>),<span class="string">"left"</span>));</span><br></pre></td></tr></table></figure><p>完成。这个函数可以得到一个元素的任意一个样式属性值，字符串类型。</p><p><br></p><p><br></p><h2 id="动画之改变单个属性的值"><a href="#动画之改变单个属性的值" class="headerlink" title="动画之改变单个属性的值"></a>动画之改变单个属性的值</h2><p>在上述动画封装函数的基础上，我们可以进一步写出修改属性值的动画函数，当然这个函数依旧可以实现水平移动动画的效果。</p><p>先看效果：</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0fiu2f7zyg30le0hg464.gif" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">my$</span>(<span class="params">id</span>)</span>&#123;   <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(id);     &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">  my$(<span class="string">"btn1"</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//获取div此时left的当前位置,达到目标400</span></span><br><span class="line">   <span class="comment">// animate(my$("dv"),"left",400);</span></span><br><span class="line">    <span class="comment">//获取div此时的宽度,达到目标400</span></span><br><span class="line">    animate(my$(<span class="string">"dv"</span>),<span class="string">"width"</span>,<span class="number">400</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  my$(<span class="string">"btn2"</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">      animate(my$(<span class="string">"dv"</span>), <span class="string">"height"</span>, <span class="number">600</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//获取任意的一个属性的当前的属性值: left---&gt;此时的left属性的值,width---当前的元素的宽</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getStyle</span>(<span class="params">element,attr</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//判断浏览器是否支持这个方法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">window</span>.getComputedStyle? <span class="built_in">window</span>.getComputedStyle(element,<span class="literal">null</span>)[attr]:element.currentStyle[attr];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//element---元素</span></span><br><span class="line">  <span class="comment">//attr---属性名字，在原来animate的基础上加了一个形参attr</span></span><br><span class="line">  <span class="comment">//target---目标位置</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">animate</span>(<span class="params">element,attr ,target</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//清理定时器</span></span><br><span class="line">    clearInterval(element.timeId);</span><br><span class="line">    element.timeId = setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">//获取元素的当前位置</span></span><br><span class="line">      <span class="keyword">var</span> current = <span class="built_in">parseInt</span>(getStyle(element,attr));<span class="comment">//getStyle返回字符串类型转为数字类型</span></span><br><span class="line">      <span class="comment">//移动的步数</span></span><br><span class="line">      <span class="keyword">var</span> step = (target-current)/<span class="number">10</span>;</span><br><span class="line">      step = step&gt;<span class="number">0</span>?<span class="built_in">Math</span>.ceil(step):<span class="built_in">Math</span>.floor(step);</span><br><span class="line">      current += step;</span><br><span class="line">      element.style[attr] = current + <span class="string">"px"</span>;</span><br><span class="line">      <span class="keyword">if</span>(current==target) &#123;</span><br><span class="line">        <span class="comment">//清理定时器</span></span><br><span class="line">        clearInterval(element.timeId);</span><br><span class="line">      &#125;</span><br><span class="line">              <span class="comment">//测试代码</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"目标:"</span>+target+<span class="string">",当前:"</span>+current+<span class="string">",每次的移动步数:"</span>+step);</span><br><span class="line">    &#125;, <span class="number">20</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><h2 id="动画之改变多个属性的值"><a href="#动画之改变多个属性的值" class="headerlink" title="动画之改变多个属性的值"></a>动画之改变多个属性的值</h2><p>在上面改变单个属性的函数代码基础上，使用json格式来存储所要的目的状态。</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0fkx87bhng30sc0he481.gif" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">my$</span>(<span class="params">id</span>) </span>&#123;   <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(id);    &#125;</span><br><span class="line">  <span class="comment">//点击按钮,改变宽度到达一个目标值,高度到达一个目标值</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//获取任意一个元素的任意一个属性的当前的值---当前属性的位置值</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getStyle</span>(<span class="params">element,attr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">window</span>.getComputedStyle? <span class="built_in">window</span>.getComputedStyle(element,<span class="literal">null</span>)[attr]:element.currentStyle[attr]||<span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">animate</span>(<span class="params">element,json</span>) </span>&#123;</span><br><span class="line">    clearInterval(element.timeId);</span><br><span class="line">    element.timeId=setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> flag=<span class="literal">true</span>;<span class="comment">//默认,假设,全部到达目标</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">var</span> attr <span class="keyword">in</span> json)&#123;</span><br><span class="line">        <span class="comment">//获取元素这个属性的当前的值</span></span><br><span class="line">        <span class="keyword">var</span> current=<span class="built_in">parseInt</span>(getStyle(element,attr));</span><br><span class="line">        <span class="comment">//当前的属性对应的目标值</span></span><br><span class="line">        <span class="keyword">var</span> target=json[attr];</span><br><span class="line">        <span class="comment">//移动的步数</span></span><br><span class="line">        <span class="keyword">var</span> step=(target-current)/<span class="number">10</span>;</span><br><span class="line">        step=step&gt;<span class="number">0</span>?<span class="built_in">Math</span>.ceil(step):<span class="built_in">Math</span>.floor(step);</span><br><span class="line">        current+=step;<span class="comment">//移动后的值</span></span><br><span class="line">        element.style[attr]=current+<span class="string">"px"</span>;</span><br><span class="line">        <span class="keyword">if</span>(current!=target)&#123;</span><br><span class="line">          flag=<span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">        <span class="comment">//清理定时器</span></span><br><span class="line">        clearInterval(element.timeId);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//测试代码</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"目标:"</span>+target+<span class="string">",当前:"</span>+current+<span class="string">",每次的移动步数:"</span>+step);</span><br><span class="line">    &#125;,<span class="number">20</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  my$(<span class="string">"btn1"</span>).onclick=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      animate(my$(<span class="string">"dv"</span>),&#123;<span class="string">"width"</span>:<span class="number">400</span>,<span class="string">"height"</span>:<span class="number">500</span>,<span class="string">"left"</span>:<span class="number">500</span>,<span class="string">"top"</span>:<span class="number">80</span>&#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><h2 id="动画之回调函数"><a href="#动画之回调函数" class="headerlink" title="动画之回调函数"></a>动画之回调函数</h2><p><strong>回调是什么？</strong></p><p><strong>简单讲：</strong> 回调是指在另一个函数执行完成<strong>之后</strong>被调用的函数  ——  因此得名“回调”。</p><p><strong>稍复杂地讲：</strong> 在 JavaScript 中，函数也是对象。因此，函数可以传入函数作为参数，也可以被其他函数返回。这样的函数称为<strong>高阶函数</strong>。被作为参数传入的函数就叫做<strong>回调函数</strong>。</p><p>如果我们想要实现下图中的效果，则需要在动画函数中加入作为参数的回调函数。</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g0fkvg88dxg30sm0h8jvg.gif" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">my$</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//获取任意一个元素的任意一个属性的当前的值---当前属性的位置值</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getStyle</span>(<span class="params">element,attr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">window</span>.getComputedStyle? <span class="built_in">window</span>.getComputedStyle(element,<span class="literal">null</span>)[attr]:element.currentStyle[attr]||<span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//element---元素</span></span><br><span class="line">  <span class="comment">//json---对象---多个属性及多个目标值</span></span><br><span class="line">  <span class="comment">//fn---函数</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">animate</span>(<span class="params">element,json,fn</span>) </span>&#123;</span><br><span class="line">    clearInterval(element.timeId);</span><br><span class="line">    element.timeId=setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> flag=<span class="literal">true</span>;<span class="comment">//默认,假设,全部到达目标</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">var</span> attr <span class="keyword">in</span> json)&#123;</span><br><span class="line">        <span class="comment">//获取元素这个属性的当前的值</span></span><br><span class="line">        <span class="keyword">var</span> current=<span class="built_in">parseInt</span>(getStyle(element,attr));</span><br><span class="line">        <span class="comment">//当前的属性对应的目标值</span></span><br><span class="line">        <span class="keyword">var</span> target=json[attr];</span><br><span class="line">        <span class="comment">//移动的步数</span></span><br><span class="line">        <span class="keyword">var</span> step=(target-current)/<span class="number">10</span>;</span><br><span class="line">        step=step&gt;<span class="number">0</span>?<span class="built_in">Math</span>.ceil(step):<span class="built_in">Math</span>.floor(step);</span><br><span class="line">        current+=step;<span class="comment">//移动后的值</span></span><br><span class="line">        element.style[attr]=current+<span class="string">"px"</span>;</span><br><span class="line">        <span class="keyword">if</span>(current!=target)&#123;</span><br><span class="line">          flag=<span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">        <span class="comment">//清理定时器</span></span><br><span class="line">        clearInterval(element.timeId);</span><br><span class="line">        <span class="comment">//所有的属性到达目标才能使用这个函数,前提是用户传入了这个函数</span></span><br><span class="line">        <span class="keyword">if</span>(fn)&#123;</span><br><span class="line">          fn();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">//测试代码</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"目标:"</span>+target+<span class="string">",当前:"</span>+current+<span class="string">",每次的移动步数:"</span>+step);</span><br><span class="line">    &#125;,<span class="number">20</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  my$(<span class="string">"btn1"</span>).onclick=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> json1=&#123;<span class="string">"width"</span>:<span class="number">400</span>,<span class="string">"height"</span>:<span class="number">500</span>,<span class="string">"left"</span>:<span class="number">500</span>,<span class="string">"top"</span>:<span class="number">80</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    animate(my$(<span class="string">"dv"</span>), json1, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> json2=&#123;<span class="string">"width"</span>:<span class="number">40</span>,<span class="string">"height"</span>:<span class="number">50</span>,<span class="string">"left"</span>:<span class="number">50</span>,<span class="string">"top"</span>:<span class="number">10</span>&#125;;</span><br><span class="line">        animate(my$(<span class="string">"dv"</span>),json2,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> json3=&#123;<span class="string">"width"</span>:<span class="number">450</span>,<span class="string">"height"</span>:<span class="number">500</span>,<span class="string">"left"</span>:<span class="number">550</span>,<span class="string">"top"</span>:<span class="number">80</span>&#125;;</span><br><span class="line">          animate(my$(<span class="string">"dv"</span>),json3);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p><br><br></p><h2 id="动画之改变透明度与层级"><a href="#动画之改变透明度与层级" class="headerlink" title="动画之改变透明度与层级"></a>动画之改变透明度与层级</h2><p>改变透明度和层级这两部分需要进行if判断，代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">my$</span>(<span class="params">id</span>)</span>&#123; <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(id);&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//获取任意一个元素的任意一个属性的当前的值---当前属性的位置值</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getStyle</span>(<span class="params">element, attr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">window</span>.getComputedStyle ? <span class="built_in">window</span>.getComputedStyle(element, <span class="literal">null</span>)[attr] : element.currentStyle[attr] || <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">animate</span>(<span class="params">element, json, fn</span>) </span>&#123;</span><br><span class="line">    clearInterval(element.timeId);<span class="comment">//清理定时器</span></span><br><span class="line">    <span class="comment">//定时器,返回的是定时器的id</span></span><br><span class="line">    element.timeId = setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> flag = <span class="literal">true</span>;<span class="comment">//默认,假设,全部到达目标</span></span><br><span class="line">      <span class="comment">//遍历json对象中的每个属性还有属性对应的目标值</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> json) &#123;</span><br><span class="line">        <span class="comment">//判断这个属性attr中是不是opacity</span></span><br><span class="line">        <span class="keyword">if</span> (attr == <span class="string">"opacity"</span>) &#123;</span><br><span class="line">          <span class="comment">//获取元素的当前的透明度,当前的透明度放大100倍</span></span><br><span class="line">          <span class="keyword">var</span> current = getStyle(element, attr) * <span class="number">100</span>;</span><br><span class="line">          <span class="comment">//目标的透明度放大100倍</span></span><br><span class="line">          <span class="keyword">var</span> target = json[attr] * <span class="number">100</span>;</span><br><span class="line">          <span class="keyword">var</span> step = (target - current) / <span class="number">10</span>;</span><br><span class="line">          step = step &gt; <span class="number">0</span> ? <span class="built_in">Math</span>.ceil(step) : <span class="built_in">Math</span>.floor(step);</span><br><span class="line">          current += step;<span class="comment">//移动后的值</span></span><br><span class="line">          element.style[attr] = current / <span class="number">100</span>;<span class="comment">//原先放大100倍现在就要缩小100倍</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (attr == <span class="string">"zIndex"</span>) &#123; <span class="comment">//判断这个属性attr中是不是zIndex</span></span><br><span class="line">          <span class="comment">//层级改变就是直接改变这个属性的值</span></span><br><span class="line">          element.style[attr] = json[attr];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">//普通的属性</span></span><br><span class="line">          <span class="comment">//获取元素这个属性的当前的值</span></span><br><span class="line">          <span class="keyword">var</span> current = <span class="built_in">parseInt</span>(getStyle(element, attr));</span><br><span class="line">          <span class="comment">//当前的属性对应的目标值</span></span><br><span class="line">          <span class="keyword">var</span> target = json[attr];</span><br><span class="line">          <span class="comment">//移动的步数</span></span><br><span class="line">          <span class="keyword">var</span> step = (target - current) / <span class="number">10</span>;</span><br><span class="line">          step = step &gt; <span class="number">0</span> ? <span class="built_in">Math</span>.ceil(step) : <span class="built_in">Math</span>.floor(step);</span><br><span class="line">          current += step;<span class="comment">//移动后的值</span></span><br><span class="line">          element.style[attr] = current + <span class="string">"px"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//是否到达目标</span></span><br><span class="line">        <span class="keyword">if</span> (current != target) &#123;</span><br><span class="line">          flag = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">        <span class="comment">//清理定时器</span></span><br><span class="line">        clearInterval(element.timeId);</span><br><span class="line">        <span class="comment">//所有的属性到达目标才能使用这个函数,前提是用户传入了这个函数</span></span><br><span class="line">        <span class="keyword">if</span> (fn) &#123;</span><br><span class="line">          fn();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//测试代码</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"目标:"</span> + target + <span class="string">",当前:"</span> + current + <span class="string">",每次的移动步数:"</span> + step);</span><br><span class="line">    &#125;, <span class="number">20</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//zIndex:1000</span></span><br><span class="line">  <span class="comment">//透明度: 数字类型----小数---放大100倍</span></span><br><span class="line">  my$(<span class="string">"btn1"</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> json1 = &#123;<span class="string">"width"</span>: <span class="number">400</span>, <span class="string">"height"</span>: <span class="number">500</span>, <span class="string">"left"</span>: <span class="number">500</span>, <span class="string">"top"</span>: <span class="number">80</span>, <span class="string">"opacity"</span>: <span class="number">0.2</span>&#125;;</span><br><span class="line">    animate(my$(<span class="string">"dv"</span>), json1, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      animate(my$(<span class="string">"dv"</span>), &#123;<span class="string">"width"</span>: <span class="number">40</span>, <span class="string">"height"</span>: <span class="number">50</span>, <span class="string">"left"</span>: <span class="number">0</span>, <span class="string">"top"</span>: <span class="number">0</span>, <span class="string">"opacity"</span>: <span class="number">1</span>, <span class="string">"zIndex"</span>: <span class="number">1000</span>&#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p><br>至此JavaScript封装动画函数实现暂告一段落。<br></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 小案例 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS实现全选与全不选</title>
      <link href="/2019/01/13/JS%E5%AE%9E%E7%8E%B0%E5%85%A8%E9%80%89%E4%B8%8E%E5%85%A8%E4%B8%8D%E9%80%89.html"/>
      <url>/2019/01/13/JS%E5%AE%9E%E7%8E%B0%E5%85%A8%E9%80%89%E4%B8%8E%E5%85%A8%E4%B8%8D%E9%80%89.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>先来看效果图：</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g04wyzjpdag30ay08ghdt.gif" alt=""><br><br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    * &#123;</span></span><br><span class="line"><span class="undefined">      padding: 0;</span></span><br><span class="line"><span class="undefined">      margin: 0;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.wrap</span> &#123;</span></span><br><span class="line"><span class="undefined">      width: 300px;</span></span><br><span class="line"><span class="undefined">      margin: 100px auto 0;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    table &#123;</span></span><br><span class="line"><span class="undefined">      border-collapse: collapse;</span></span><br><span class="line"><span class="undefined">      border-spacing: 0;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#c0c0c0</span>;</span></span><br><span class="line"><span class="undefined">      width: 300px;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    th,</span></span><br><span class="line"><span class="undefined">    td &#123;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#d0d0d0</span>;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">color</span>: <span class="selector-id">#404060</span>;</span></span><br><span class="line"><span class="undefined">      padding: 10px;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    th &#123;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">background-color</span>: <span class="selector-id">#09c</span>;</span></span><br><span class="line"><span class="undefined">      font: bold 16px "微软雅黑";</span></span><br><span class="line"><span class="css">      <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    td &#123;</span></span><br><span class="line"><span class="undefined">      font: 14px "微软雅黑";</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    tbody tr &#123;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">background-color</span>: <span class="selector-id">#f0f0f0</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-tag">tbody</span> <span class="selector-tag">tr</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="undefined">      cursor: pointer;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">background-color</span>: <span class="selector-id">#fafafa</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"j_cbAll"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>菜名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>饭店<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">id</span>=<span class="string">"j_tb"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>红烧肉<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>章鱼饭馆<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>爆炒冰溜子<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>章鱼饭馆<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>油炸榴莲<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>章鱼饭馆<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>大肠刺身<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>章鱼饭馆<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><p>JavaScript代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">my$</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">        &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="comment">//获取全选的这个复选框</span></span><br><span class="line">  <span class="keyword">var</span> ckAll = my$(<span class="string">"j_cbAll"</span>);</span><br><span class="line">  <span class="comment">//获取tbody中所有的小复选框</span></span><br><span class="line">  <span class="keyword">var</span> cks = my$(<span class="string">"j_tb"</span>).getElementsByTagName(<span class="string">"input"</span>);</span><br><span class="line">  <span class="comment">//点击全选的这个复选框,获取他当前的状态,然后设置tbody中所有复选框的状态</span></span><br><span class="line">  ckAll.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//console.log(this.checked);</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; cks.length; i++) &#123;</span><br><span class="line">      cks[i].checked = <span class="keyword">this</span>.checked;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//获取tbody中所有的复选框,分别注册点击事件</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;cks.length;i++)&#123;</span><br><span class="line">    cks[i].onclick=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> flag=<span class="literal">true</span>;<span class="comment">//默认都被选中了</span></span><br><span class="line">      <span class="comment">//判断是否所有的复选框都选中</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;cks.length;j++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!cks[j].checked)&#123;</span><br><span class="line">          <span class="comment">//没选中就进来了</span></span><br><span class="line">          flag=<span class="literal">false</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//全选的这个复选框的状态就是flag这个变量的值</span></span><br><span class="line">      ckAll.checked=flag;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 小案例 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>绑定/解绑事件兼容代码</title>
      <link href="/2019/01/13/%E7%BB%91%E5%AE%9A%E8%A7%A3%E7%BB%91%E4%BA%8B%E4%BB%B6%E5%85%BC%E5%AE%B9%E4%BB%A3%E7%A0%81.html"/>
      <url>/2019/01/13/%E7%BB%91%E5%AE%9A%E8%A7%A3%E7%BB%91%E4%BA%8B%E4%BB%B6%E5%85%BC%E5%AE%B9%E4%BB%A3%E7%A0%81.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>为元素绑定( 多个 )事件(DOM)除了用<strong>对象.onclick=fn</strong>这类的方式（这种方式无法绑定多个事件，如果写了多个事件则会发生覆盖），还有：<br>  1 对象.addEventListener(“事件类型”,事件处理函数,false)–谷歌、火狐和IE9、10、11支持,IE8不支持<br>  2 对象.attachEvent(“有on的事件类型”,事件处理函数)–谷歌不支持,火狐不支持,IE8支持，但是IE11不支持</p><h2 id="addEventListener"><a href="#addEventListener" class="headerlink" title="addEventListener"></a>addEventListener</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//为按钮绑定点击事件</span></span><br><span class="line">  <span class="comment">//参数1:事件的类型---事件的名字,没有on</span></span><br><span class="line">  <span class="comment">//参数2:事件处理函数---函数(命名函数,匿名函数)</span></span><br><span class="line">  <span class="comment">//参数3:布尔类型</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//为同一个元素绑定多个相同的事件--</span></span><br><span class="line"> my$(<span class="string">"btn"</span>).addEventListener(<span class="string">"click"</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="comment">//my$函数封装了getElementById</span></span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"哈哈哈"</span>);</span><br><span class="line"> &#125;,<span class="literal">false</span>);</span><br><span class="line"> my$(<span class="string">"btn"</span>).addEventListener(<span class="string">"click"</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"嘿嘿嘿"</span>);</span><br><span class="line"> &#125;,<span class="literal">false</span>);</span><br><span class="line"> my$(<span class="string">"btn"</span>).addEventListener(<span class="string">"click"</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"喵喵喵"</span>);</span><br><span class="line"> &#125;,<span class="literal">false</span>);</span><br><span class="line"> my$(<span class="string">"btn"</span>).addEventListener(<span class="string">"click"</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"呜呜呜"</span>);</span><br><span class="line"> &#125;,<span class="literal">false</span>);</span><br></pre></td></tr></table></figure><p><br></p><p>##attachEvent</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//参数1:事件类型---事件名字，有on</span></span><br><span class="line"><span class="comment">//参数2:事件处理函数---函数(命名函数,匿名函数)</span></span><br><span class="line"></span><br><span class="line">my$(<span class="string">"btn"</span>).attachEvent(<span class="string">"onclick"</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"哈哈哈哈哈"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">my$(<span class="string">"btn"</span>).attachEvent(<span class="string">"onclick"</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"吼吼吼吼吼"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">my$(<span class="string">"btn"</span>).attachEvent(<span class="string">"onclick"</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"嘻嘻嘻嘻嘻"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><br></p><h2 id="两者的区别"><a href="#两者的区别" class="headerlink" title="两者的区别"></a>两者的区别</h2><p>总结绑定事件的区别:addEventListener()和attachEvent()</p><ul><li>相同点: 都可以为元素绑定事件</li><li>不同点:</li><li>1.方法名不一样</li><li>2.参数个数不一样addEventListener三个参数,attachEvent两个参数</li><li>3.addEventListener 谷歌,火狐,IE11支持,IE8不支持；attachEvent 谷歌火狐不支持,IE11不支持,IE8支持</li><li>4.this不同,addEventListener 中的this是当前绑定事件的对象，attachEvent中的this是window</li><li>5.addEventListener中事件的类型(事件的名字)没有on；attachEvent中的事件的类型(事件的名字)有on</li></ul><h2 id="绑定-解绑兼容性代码"><a href="#绑定-解绑兼容性代码" class="headerlink" title="绑定/解绑兼容性代码"></a>绑定/解绑兼容性代码</h2><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g06fa3y3t1g307q0dcdp2.gif" alt=""></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>测试草稿<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"添加"</span> <span class="attr">id</span>=<span class="string">"btn"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"删除"</span> <span class="attr">id</span>=<span class="string">"del"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>JavaScript部分：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">my$</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//绑定事件的兼容代码</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">addEventListener</span>(<span class="params">element,type,fn</span>)</span>&#123;<span class="comment">//调用时此处的fn可以是匿名函数也可以是命名函数的函数名</span></span><br><span class="line">            <span class="keyword">if</span>(element.addEventListener)&#123;</span><br><span class="line">                element.addEventListener(type,fn,<span class="literal">false</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(element.attachEvent)&#123;</span><br><span class="line">                element.attachEvent(<span class="string">"on"</span>+type,fn);<span class="comment">//注意此处的"on"不可省略</span></span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                element[<span class="string">"on"</span>+type]=fn;</span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//解绑事件的兼容代码</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">removeEventListener</span>(<span class="params">element,type,fnName</span>)</span>&#123;</span><br><span class="line">            <span class="comment">/*注意此处参数必须是函数名而不是匿名函数，匿名函数无效！</span></span><br><span class="line"><span class="comment">            两个人（匿名函数）长得一模一样，都没有名字（函数命名），但是不能说他们就是同一个人（函数）*/</span></span><br><span class="line">            <span class="keyword">if</span>(element.removeEventListener)&#123;</span><br><span class="line">                element.removeEventListener(type,fnName,<span class="literal">false</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(element.detachEvent)&#123;</span><br><span class="line">                element.detachEvent(<span class="string">"on"</span>+type,fnName);<span class="comment">//注意此处的"on"不可省略</span></span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                element[<span class="string">"on"</span>+type]=<span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> pObj = <span class="built_in">document</span>.createElement(<span class="string">"p"</span>);</span><br><span class="line">            pObj.innerText = <span class="string">"来了老弟~"</span>;</span><br><span class="line">            my$(<span class="string">"dv"</span>).appendChild(pObj);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> spanObj = <span class="built_in">document</span>.createElement(<span class="string">"span"</span>);</span><br><span class="line">            spanObj.innerText = <span class="string">"好嗨哟~"</span>;</span><br><span class="line">            my$(<span class="string">"dv"</span>).appendChild(spanObj);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        addEventListener(my$(<span class="string">"btn"</span>),<span class="string">"click"</span>,f1);</span><br><span class="line">        addEventListener(my$(<span class="string">"btn"</span>),<span class="string">"click"</span>,f2);</span><br><span class="line"></span><br><span class="line">        my$(<span class="string">"del"</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            removeEventListener(my$(<span class="string">"btn"</span>),<span class="string">"click"</span>,f1);</span><br><span class="line">            removeEventListener(my$(<span class="string">"btn"</span>),<span class="string">"click"</span>,f2);</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p><br><br><br><br></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS搜索框自动提示</title>
      <link href="/2019/01/13/JS%E6%90%9C%E7%B4%A2%E6%A1%86%E8%87%AA%E5%8A%A8%E6%8F%90%E7%A4%BA.html"/>
      <url>/2019/01/13/JS%E6%90%9C%E7%B4%A2%E6%A1%86%E8%87%AA%E5%8A%A8%E6%8F%90%E7%A4%BA.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p><br></p><p>效果展示：</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g08f80sqi4g30e80bq1kx.gif" alt=""></p><p>html部分：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">  &lt;<span class="selector-tag">style</span>&gt;</span><br><span class="line">    <span class="selector-id">#box</span> &#123;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">450px</span>;</span><br><span class="line">      <span class="attribute">margin</span>: <span class="number">200px</span> auto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#txt</span> &#123;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">350px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#pop</span> &#123;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">350px</span>;</span><br><span class="line">      <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#pop</span> <span class="selector-tag">ul</span> &#123;</span><br><span class="line">      <span class="attribute">margin</span>: <span class="number">10px</span>;</span><br><span class="line">      <span class="attribute">padding</span>: <span class="number">0px</span>;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">      <span class="attribute">list-style-type</span>: none;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#pop</span> <span class="selector-tag">ul</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;<span class="selector-tag">body</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;div id="box"&gt;</span><br><span class="line">  &lt;input type="text" id="txt" value=""&gt;</span><br><span class="line">  &lt;input type="button" value="搜索" id="btn"&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure><p><br>JavaScript：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">my$</span>(<span class="params">id</span>)</span>&#123; <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(id);&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setInnerText</span>(<span class="params">element, text</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> element.textContent == <span class="string">"undefined"</span>) &#123;</span><br><span class="line">        element.innerText = text;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        element.textContent = text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> keyWords = [</span><br><span class="line">  <span class="string">"小林才是最纯洁的"</span>, </span><br><span class="line">  <span class="string">"小林才是最帅的"</span>, </span><br><span class="line">  <span class="string">"小明是最胖的"</span>, </span><br><span class="line">  <span class="string">"小明是最高的"</span>, </span><br><span class="line">  <span class="string">"三国是我最喜欢的"</span>, </span><br><span class="line">  <span class="string">"三星note7会爆炸"</span>,</span><br><span class="line">  <span class="string">"苹果好吃"</span>, </span><br><span class="line">  <span class="string">"苹果此次召回还是没有中国"</span>];</span><br><span class="line">  <span class="comment">//获取文本框注册键盘抬起事件</span></span><br><span class="line">  my$(<span class="string">"txt"</span>).onkeyup = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//每一次的键盘抬起都判断页面中有没有这个div</span></span><br><span class="line">    <span class="keyword">if</span>(my$(<span class="string">"dv"</span>))&#123;</span><br><span class="line">      <span class="comment">//删除一次</span></span><br><span class="line">      my$(<span class="string">"box"</span>).removeChild(my$(<span class="string">"dv"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取文本框输入的内容</span></span><br><span class="line">    <span class="keyword">var</span> text = <span class="keyword">this</span>.value;</span><br><span class="line">    <span class="comment">//临时数组--空数组-------&gt;存放对应上的数据</span></span><br><span class="line">    <span class="keyword">var</span> tempArr = [];</span><br><span class="line">    <span class="comment">//把文本框输入的内容和数组中的每个数据对比</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; keyWords.length; i++) &#123;</span><br><span class="line">      <span class="comment">//是否是最开始出现的</span></span><br><span class="line">      <span class="keyword">if</span> (keyWords[i].indexOf(text) == <span class="number">0</span>) &#123;</span><br><span class="line">        tempArr.push(keyWords[i]);<span class="comment">//追加</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果文本框是空的,临时数组是空的,不用创建div</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.value.length == <span class="number">0</span> || tempArr.length == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//如果页面中有这个div,删除这个div</span></span><br><span class="line">      <span class="keyword">if</span> (my$(<span class="string">"dv"</span>)) &#123;</span><br><span class="line">        my$(<span class="string">"box"</span>).removeChild(my$(<span class="string">"dv"</span>));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//创建div,把div加入id为box的div中</span></span><br><span class="line">    <span class="keyword">var</span> dvObj = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span><br><span class="line">    my$(<span class="string">"box"</span>).appendChild(dvObj);</span><br><span class="line">    dvObj.id = <span class="string">"dv"</span>;</span><br><span class="line">    dvObj.style.width = <span class="string">"350px"</span>;</span><br><span class="line">    <span class="comment">//dvObj.style.height="100px";//肯定是不需要的，由内容撑开</span></span><br><span class="line">    dvObj.style.border = <span class="string">"1px solid green"</span>;</span><br><span class="line">    <span class="comment">//循环遍历临时数组,创建对应的p标签</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; tempArr.length; i++) &#123;</span><br><span class="line">      <span class="comment">//创建p标签</span></span><br><span class="line">      <span class="keyword">var</span> pObj = <span class="built_in">document</span>.createElement(<span class="string">"p"</span>);</span><br><span class="line">      <span class="comment">//把p加到div中</span></span><br><span class="line">      dvObj.appendChild(pObj);</span><br><span class="line">      setInnerText(pObj, tempArr[i]);</span><br><span class="line">      pObj.style.margin = <span class="number">0</span>;</span><br><span class="line">      pObj.style.padding = <span class="number">0</span>;</span><br><span class="line">      pObj.style.cursor = <span class="string">"pointer"</span>;</span><br><span class="line">      pObj.style.marginTop = <span class="string">"5px"</span>;</span><br><span class="line">      pObj.style.marginLeft = <span class="string">"5px"</span>;</span><br><span class="line">      <span class="comment">//鼠标进入</span></span><br><span class="line">      pObj.onmouseover = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.style.backgroundColor = <span class="string">"yellow"</span>;</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="comment">//鼠标离开</span></span><br><span class="line">      pObj.onmouseout = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.style.backgroundColor = <span class="string">""</span>;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p><br><br><br></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 小案例 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自定义属性操作案例</title>
      <link href="/2019/01/13/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B1%9E%E6%80%A7%E6%93%8D%E4%BD%9C%E6%A1%88%E4%BE%8B.html"/>
      <url>/2019/01/13/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B1%9E%E6%80%A7%E6%93%8D%E4%BD%9C%E6%A1%88%E4%BE%8B.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>为了练习一下自定义属性操作，做了一个tab栏切换的demo</p><h2 id="自定义属性操作"><a href="#自定义属性操作" class="headerlink" title="自定义属性操作"></a>自定义属性操作</h2><ul><li>getAttribute() 获取标签行内属性</li><li>setAttribute() 设置标签行内属性</li><li>removeAttribute() 移除标签行内属性</li><li>与element.属性的区别: 上述三个方法用于获取任意的行内属性。</li></ul><h2 id="tab栏切换案例"><a href="#tab栏切换案例" class="headerlink" title="tab栏切换案例"></a>tab栏切换案例</h2><h3 id="别人写的："><a href="#别人写的：" class="headerlink" title="别人写的："></a>别人写的：</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head lang=<span class="string">"en"</span>&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  &lt;title&gt;<span class="xml"><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line">  &lt;style&gt;</span><br><span class="line">    * &#123;</span><br><span class="line">      margin: <span class="number">0</span>;</span><br><span class="line">      padding: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ul &#123;</span><br><span class="line">      list-style-type: none;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .box &#123;</span><br><span class="line">      width: <span class="number">400</span>px;</span><br><span class="line">      height: <span class="number">300</span>px;</span><br><span class="line">      border: 1px solid #ccc;</span><br><span class="line">      margin: <span class="number">100</span>px auto;</span><br><span class="line">      overflow: hidden;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .hd &#123;</span><br><span class="line">      height: <span class="number">45</span>px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .hd span &#123;</span><br><span class="line">      display: inline-block;</span><br><span class="line">      width: <span class="number">90</span>px;</span><br><span class="line">      background-color: pink;</span><br><span class="line">      line-height: <span class="number">45</span>px;</span><br><span class="line">      text-align: center;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .hd span.current &#123;</span><br><span class="line">      background-color: purple;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .bd li &#123;</span><br><span class="line">      height: <span class="number">255</span>px;</span><br><span class="line">      background-color: purple;</span><br><span class="line">      display: none;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .bd li.current &#123;</span><br><span class="line">      display: block;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;<span class="regexp">/style&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"box"</span> id=<span class="string">"box"</span>&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"hd"</span>&gt;</span><br><span class="line">    &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"current"</span>&gt;体育&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    &lt;span&gt;娱乐&lt;/</span>span&gt;</span><br><span class="line">    &lt;span&gt;新闻&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    &lt;span&gt;综合&lt;/</span>span&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div class="bd"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;ul&gt;</span></span><br><span class="line"><span class="regexp">      &lt;li class="current"&gt;我是体育模块&lt;/</span>li&gt;</span><br><span class="line">      &lt;li&gt;我是娱乐模块&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">      &lt;li&gt;我是新闻模块&lt;/</span>li&gt;</span><br><span class="line">      &lt;li&gt;我是综合模块&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/u</span>l&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br><span class="line">&lt;script src=<span class="string">"common.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//获取最外面的div</span></span><br><span class="line">  <span class="keyword">var</span> box=my$(<span class="string">"box"</span>);</span><br><span class="line">  <span class="comment">//获取的是里面的第一个div</span></span><br><span class="line">  <span class="keyword">var</span> hd=box.getElementsByTagName(<span class="string">"div"</span>)[<span class="number">0</span>];</span><br><span class="line">  <span class="comment">//获取的是里面的第二个div</span></span><br><span class="line">  <span class="keyword">var</span> bd=box.getElementsByTagName(<span class="string">"div"</span>)[<span class="number">1</span>];</span><br><span class="line">  <span class="comment">//获取所有的li标签</span></span><br><span class="line">  <span class="keyword">var</span> list=bd.getElementsByTagName(<span class="string">"li"</span>);</span><br><span class="line">  <span class="comment">//获取所有的span标签</span></span><br><span class="line">  <span class="keyword">var</span> spans=hd.getElementsByTagName(<span class="string">"span"</span>);</span><br><span class="line">  <span class="comment">//循环遍历的方式,添加点击事件</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;spans.length;i++)&#123;</span><br><span class="line">    <span class="comment">//在点击之前就把索引保存在span标签中</span></span><br><span class="line">    spans[i].setAttribute(<span class="string">"index"</span>,i);</span><br><span class="line">    spans[i].onclick=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">//第一件事,所有的span的类样式全部移除</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;spans.length;j++)&#123;</span><br><span class="line">        spans[j].removeAttribute(<span class="string">"class"</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//第二件事,当前被点击的span应用类样式</span></span><br><span class="line">      <span class="keyword">this</span>.className=<span class="string">"current"</span>;</span><br><span class="line">      <span class="comment">//span被点击的时候获取存储的索引值</span></span><br><span class="line">      <span class="comment">//alert(this.getAttribute("index"));</span></span><br><span class="line">      <span class="keyword">var</span> num=<span class="keyword">this</span>.getAttribute(<span class="string">"index"</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//获取所有的li标签,每个li标签先全部隐藏</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">var</span> k=<span class="number">0</span>;k&lt;list.length;k++)&#123;</span><br><span class="line">        list[k].removeAttribute(<span class="string">"class"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//当前被点击的span对应的li标签显示</span></span><br><span class="line">      list[num].className=<span class="string">"current"</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><p>效果图：</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g02x9y808rj30d709et8k.jpg" alt=""></p><p><br></p><h3 id="我写的："><a href="#我写的：" class="headerlink" title="我写的："></a>我写的：</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">    &lt;title&gt;测试草稿&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    * &#123;</span><br><span class="line">        margin: <span class="number">0</span>;</span><br><span class="line">        padding: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .box &#123;</span><br><span class="line">        height: <span class="number">250</span>px;</span><br><span class="line">        width: <span class="number">200</span>px;</span><br><span class="line">        margin:<span class="number">100</span>px auto;</span><br><span class="line">    &#125;</span><br><span class="line">    .hd &#123;</span><br><span class="line">        height: <span class="number">50</span>px;</span><br><span class="line">        width: <span class="number">200</span>px;</span><br><span class="line">        background-color: red;</span><br><span class="line">    &#125;</span><br><span class="line">    .hd ul &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        height: <span class="number">100</span>%;</span><br><span class="line">        widows: <span class="number">100</span>%;</span><br><span class="line">        justify-content:center;</span><br><span class="line">        align-items: center;</span><br><span class="line">    &#125;</span><br><span class="line">    .hd li &#123;</span><br><span class="line">        flex: <span class="number">1</span>;</span><br><span class="line">        text-align: center;</span><br><span class="line">        list-style: none;</span><br><span class="line">    &#125;</span><br><span class="line">    .hd li.current &#123;</span><br><span class="line">        background-color: yellow;</span><br><span class="line">    &#125;</span><br><span class="line">    .bd &#123;</span><br><span class="line">        width: <span class="number">200</span>px;</span><br><span class="line">        height: <span class="number">200</span>px;</span><br><span class="line">        background-color:pink;</span><br><span class="line">    &#125;</span><br><span class="line">    .bd li &#123;</span><br><span class="line">        list-style: none;</span><br><span class="line">        display: none;</span><br><span class="line">    &#125;</span><br><span class="line">    .bd li.current &#123;</span><br><span class="line">        display: block;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/style&gt;</span></span><br><span class="line"><span class="regexp">&lt;body&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div class="box" id="box"&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div class="hd" &gt;</span></span><br><span class="line"><span class="regexp">            &lt;ul&gt;</span></span><br><span class="line"><span class="regexp">                &lt;li class="current"&gt;魏&lt;/</span>li&gt;</span><br><span class="line">                &lt;li&gt;蜀&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">                &lt;li&gt;吴&lt;/</span>li&gt;</span><br><span class="line">            &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"bd"</span>&gt;</span><br><span class="line">            &lt;ul&gt;</span><br><span class="line">                &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"current"</span>&gt;曹操&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">                &lt;li&gt;刘备&lt;/</span>li&gt;</span><br><span class="line">                &lt;li&gt;孙权&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/u</span>l&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">my$</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> box = my$(<span class="string">"box"</span>);</span><br><span class="line">        <span class="keyword">var</span> hd = box.getElementsByTagName(<span class="string">"div"</span>)[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">var</span> bd = box.getElementsByTagName(<span class="string">"div"</span>)[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> hdlist = hd.getElementsByTagName(<span class="string">"li"</span>);</span><br><span class="line">        <span class="keyword">var</span> bdlist = bd.getElementsByTagName(<span class="string">"li"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;hdlist.length; i++)&#123;</span><br><span class="line">            hdlist[i].num = i;<span class="comment">//点语法添加属性</span></span><br><span class="line">            hdlist[i].onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;hdlist.length;j++)&#123;</span><br><span class="line">                    hdlist[j].removeAttribute(<span class="string">"class"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">this</span>.setAttribute(<span class="string">"class"</span>,<span class="string">"current"</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> k=<span class="number">0</span>;k&lt;bdlist.length;k++)&#123;</span><br><span class="line">                    bdlist[k].removeAttribute(<span class="string">"class"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                bdlist[<span class="keyword">this</span>.num].setAttribute(<span class="string">"class"</span>,<span class="string">"current"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><p>效果图：</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1g02xbgn3t7j308108mmwy.jpg" alt=""></p><p><br><br></p>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 小案例 </tag>
            
            <tag> html/css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浅谈js匿名函数</title>
      <link href="/2019/01/12/%E6%B5%85%E8%B0%88js%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0.html"/>
      <url>/2019/01/12/%E6%B5%85%E8%B0%88js%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="匿名函数与函数表达式"><a href="#匿名函数与函数表达式" class="headerlink" title="匿名函数与函数表达式"></a>匿名函数与函数表达式</h2><p>​    与匿名函数相对的是命名函数——如果函数有名字就是命名函数，反之即为匿名函数。</p><p>​    函数的一般定义方式为函数声明：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> 函数名(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">// 函数体</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用方式为：函数名();</span></span><br></pre></td></tr></table></figure><p>​    函数的另一种定义方式：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 函数体</span></span><br><span class="line">&#125;;<span class="comment">//由于是赋值过程所以结尾必须加分号</span></span><br><span class="line"><span class="comment">//调用方式为：fn();</span></span><br><span class="line"><span class="comment">//把一个匿名函数赋给一个变量，即为函数表达式</span></span><br></pre></td></tr></table></figure><h2 id="函数声明与函数表达式"><a href="#函数声明与函数表达式" class="headerlink" title="函数声明与函数表达式"></a>函数声明与函数表达式</h2><p>​    乍一看会觉得函数声明的方式来定义函数比较方便，但是函数声明和函数表达式是存在区别的。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//函数声明</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"林深时见鹿"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    f1();<span class="comment">//输出“溪午不闻钟”而非“林深时见鹿”，因为f1被下面的函数声明覆盖了</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"溪午不闻钟"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    f1();<span class="comment">//输出“溪午不闻钟”</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//函数表达式</span></span><br><span class="line">    <span class="keyword">var</span> f2 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"林深时见鹿"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    f2();<span class="comment">//输出“林深时见鹿”</span></span><br><span class="line">    f2 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"溪午不闻钟"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    f2();<span class="comment">//输出“溪午不闻钟”</span></span><br><span class="line"><span class="comment">//函数表达式由于是变量赋值的形式，所以不存在函数覆盖的情况</span></span><br></pre></td></tr></table></figure><h2 id="匿名函数自调用"><a href="#匿名函数自调用" class="headerlink" title="匿名函数自调用"></a>匿名函数自调用</h2><p>​    <strong>匿名函数自调用也叫做“立即执行函数”</strong>，在声明的同时立即直接执行，一次性。</p><p>​    一般如以下两种形式：</p><blockquote><p>(function (){}());  W3C建议第一种</p><p>(function (){})();</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//函数自调用</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"野竹分青霭"</span>);</span><br><span class="line">&#125;());</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"飞泉挂碧峰"</span>)</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p><br></p><p>立即执行函数，执行后即被释放。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//例子1</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">123</span>;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="number">234</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(a + b);</span><br><span class="line">&#125;());</span><br><span class="line"></span><br><span class="line"><span class="comment">//例子2：带参数</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">a,b,c</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a+b+c*<span class="number">2</span>);</span><br><span class="line">&#125;(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//例子3：有返回值</span></span><br><span class="line"><span class="keyword">var</span> num = (<span class="function"><span class="keyword">function</span>(<span class="params">a,b,c,</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> d = a+b+c*<span class="number">2</span><span class="number">-2</span>;</span><br><span class="line">    <span class="keyword">return</span> d;</span><br><span class="line">&#125;(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>));</span><br></pre></td></tr></table></figure><h2 id="循环添加事件时不宜使用匿名函数"><a href="#循环添加事件时不宜使用匿名函数" class="headerlink" title="循环添加事件时不宜使用匿名函数"></a>循环添加事件时不宜使用匿名函数</h2><p>在下面这个例子中要显示li的高亮，不推荐写这样的代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//为li添加鼠标进入事件</span><br><span class="line">   liObj.onmouseover = function()&#123;</span><br><span class="line">       this.style.backgroundColor = &quot;red&quot;;</span><br><span class="line">   &#125;;</span><br><span class="line">   //为li添加鼠标离开事件</span><br><span class="line">   liObj.onmouseout = function()&#123;</span><br><span class="line">       this.style.backgroundColor = &quot;&quot;;</span><br><span class="line">   &#125;;</span><br></pre></td></tr></table></figure><p>这种匿名函数的写法不会错，但是每次循环都会产生一个匿名函数占用内存，这样子效率不高，浪费空间。</p><p>所以我们推荐在循环添加事件的时候用命名函数：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">my$</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">var</span> kungfu = [<span class="string">"降龙十八掌"</span>, <span class="string">"黯然销魂掌"</span>, <span class="string">"葵花宝典"</span>, <span class="string">"九阴真经"</span>, <span class="string">"吸星大法"</span>, <span class="string">"如来神掌"</span>, <span class="string">"化骨绵掌"</span>, <span class="string">"玉女心经"</span>, <span class="string">"极乐神功"</span>, <span class="string">"辟邪剑谱"</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">//点击按钮动态的创建列表,把列表加到div中</span></span><br><span class="line">  my$(<span class="string">"btn"</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//创建ul,把ul立刻加入到父级元素div中</span></span><br><span class="line">    <span class="keyword">var</span> ulObj = <span class="built_in">document</span>.createElement(<span class="string">"ul"</span>);</span><br><span class="line">    my$(<span class="string">"dv"</span>).appendChild(ulObj);</span><br><span class="line">    <span class="comment">//动态的创建li,加到ul中</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; kungfu.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> liObj = <span class="built_in">document</span>.createElement(<span class="string">"li"</span>);</span><br><span class="line">      <span class="comment">//设置li中间的文字内容</span></span><br><span class="line">      liObj.innerHTML = kungfu[i];</span><br><span class="line">      ulObj.appendChild(liObj);</span><br><span class="line">      <span class="comment">//为li添加鼠标进入事件</span></span><br><span class="line">      liObj.onmouseover = mouseoverHandle;</span><br><span class="line">      <span class="comment">//为li添加鼠标离开事件</span></span><br><span class="line">      liObj.onmouseout = mouseoutHandle;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//此位置.按钮的点击事件的外面</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">mouseoverHandle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.style.backgroundColor = <span class="string">"red"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">mouseoutHandle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.style.backgroundColor = <span class="string">""</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//如果是循环的方式添加事件,推荐用命名函数</span></span><br><span class="line">  <span class="comment">//如果不是循环的方式添加事件,推荐使用匿名函数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>字符串小练习</title>
      <link href="/2019/01/09/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B0%8F%E6%A1%88%E4%BE%8B.html"/>
      <url>/2019/01/09/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B0%8F%E6%A1%88%E4%BE%8B.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="案例一：找到这个字符串中所有的-o-出现的位置"><a href="#案例一：找到这个字符串中所有的-o-出现的位置" class="headerlink" title="案例一：找到这个字符串中所有的 o 出现的位置"></a>案例一：找到这个字符串中所有的 o 出现的位置</h2><p>“hello wod odd ott fbo nhyo”</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"hello wod odd ott fbo nhyo"</span>;</span><br><span class="line"><span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//var index = str.indexOf('o',index);</span></span><br><span class="line"><span class="comment">//index++;</span></span><br><span class="line"><span class="keyword">while</span>((index = str.indexOf(<span class="string">'o'</span>,index))!=<span class="number">-1</span>)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(index);</span><br><span class="line">    index++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="案例一升级版：找到这个字符串中所有的“你好啊”出现的位置"><a href="#案例一升级版：找到这个字符串中所有的“你好啊”出现的位置" class="headerlink" title="案例一升级版：找到这个字符串中所有的“你好啊”出现的位置"></a>案例一升级版：找到这个字符串中所有的“你好啊”出现的位置</h2><p>“李白你好啊你好啊杜甫说你好啊我也说你好啊”</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"李白你好啊你好啊杜甫说你好啊我也说你好啊"</span>;</span><br><span class="line"><span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> key = <span class="string">'你好啊'</span>;</span><br><span class="line"><span class="keyword">while</span>((index = str.indexOf(key,index))!=<span class="number">-1</span>)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(index);</span><br><span class="line">    index+=key.length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>所以案例一的代码可以进行一下优化，如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"hello wod odd ott fbo nhyo"</span>;</span><br><span class="line"><span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> key = <span class="string">'o'</span>;</span><br><span class="line"><span class="keyword">while</span>((index = str.indexOf(key,index))!=<span class="number">-1</span>)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(index);</span><br><span class="line">    index+=key.length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="案例二：找到字符串中每个字符出现了多少次"><a href="#案例二：找到字符串中每个字符出现了多少次" class="headerlink" title="案例二：找到字符串中每个字符出现了多少次"></a>案例二：找到字符串中每个字符出现了多少次</h2><p>我写的臃肿版：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str3 = <span class="string">"whatOareYyouYnoYshaHleiHoHmyHgod"</span>;</span><br><span class="line"><span class="keyword">var</span> length = str3.length;</span><br><span class="line"><span class="keyword">var</span> arr = [];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; length; i++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; arr.length; j++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(arr[j]==str3[i])&#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(j == arr.length)&#123;</span><br><span class="line">        arr[arr.length]=str3[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(arr);</span><br><span class="line"><span class="keyword">var</span> num = [];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++)&#123;</span><br><span class="line">    num[i]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; length; j++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(str3[j]==arr[i])&#123;</span><br><span class="line">            num[i]++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'字符'</span>+arr[i]+<span class="string">'出现了'</span>+num[i]+<span class="string">'次'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>简洁版：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str3 = <span class="string">"whatOareYyouYnoYshaHleiHoHmyHgod"</span>;</span><br><span class="line">  <span class="comment">//第一步:把所有的字母全部变成小写</span></span><br><span class="line">  str3 = str3.toLocaleLowerCase();</span><br><span class="line">  <span class="comment">//第二步:创建一个空对象,目的:把字母作为键,次数作为值</span></span><br><span class="line">  <span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line">  <span class="comment">//第三步,遍历字符串,获取每个字母</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; str3.length; i++) &#123;</span><br><span class="line">    <span class="comment">//判断obj这个对象中有没有这个字母(字母---键)</span></span><br><span class="line">    <span class="keyword">var</span> key = str3[i];<span class="comment">//每个字母</span></span><br><span class="line">    <span class="keyword">if</span> (obj[key]) &#123;<span class="comment">//判断obj中有没有这个键</span></span><br><span class="line">      <span class="comment">//对象中有这个字母了</span></span><br><span class="line">      obj[key]++;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//对象中没有这个字母,那就把字母加到对象中,并且给这个字母一个出现的次数,默认1次</span></span><br><span class="line">      obj[key] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//遍历对象,显示每个字母的次数</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> obj)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key+<span class="string">"这个字母出现了"</span>+obj[key]+<span class="string">"次"</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 小案例 </tag>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript中的值传递和地址传递（引用传递）</title>
      <link href="/2019/01/07/JavaScript%E4%B8%AD%E7%9A%84%E5%80%BC%E4%BC%A0%E9%80%92%E5%92%8C%E5%9C%B0%E5%9D%80%E4%BC%A0%E9%80%92%EF%BC%88%E5%BC%95%E7%94%A8%E4%BC%A0%E9%80%92%EF%BC%89.html"/>
      <url>/2019/01/07/JavaScript%E4%B8%AD%E7%9A%84%E5%80%BC%E4%BC%A0%E9%80%92%E5%92%8C%E5%9C%B0%E5%9D%80%E4%BC%A0%E9%80%92%EF%BC%88%E5%BC%95%E7%94%A8%E4%BC%A0%E9%80%92%EF%BC%89.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="简单类型和复杂类型"><a href="#简单类型和复杂类型" class="headerlink" title="简单类型和复杂类型"></a>简单类型和复杂类型</h2><p>我们先来理清一下几种数据类型。原始的数据类型就有： number,string,boolean,undefined, null,object。进一步划分为值类型和引用类型。</p><p><strong>值类型：</strong>简单数据类型，基本数据类型，在存储时，变量中存储的是值本身，因此叫做值类型。</p><p><strong>引用类型：</strong>复杂数据类型，在存储时，变量中存储的仅仅是地址（引用），因此叫做引用数据类型。</p><p>1、基本类型(又称简单类型、值类型): number,string,boolean</p><p>2、复杂类型(引用类型):object</p><p>3、空类型:undefined,null</p><p>值类型的值在哪一块空间中存储? 栈中存储</p><p>引用类型的值在哪一块空间中存储?对象在堆上存储,地址在栈上存储。</p><p>var num=10;//值类型,值在栈上</p><p>var obj={};//复杂类型,对象在堆,地址(引用)在栈</p><p>值类型之间传递,传递的是值</p><p>引用类型之间传递,传递的是地址(引用)</p><p>值类型作为函数的参数,传递的是值</p><p>引用类型作为函数的参数,传递的是地址</p><h2 id="数据类型在内存中的存储"><a href="#数据类型在内存中的存储" class="headerlink" title="数据类型在内存中的存储"></a>数据类型在内存中的存储</h2><h3 id="堆和栈"><a href="#堆和栈" class="headerlink" title="堆和栈"></a>堆和栈</h3><ul><li><p>堆和栈</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">堆栈空间分配区别：</span><br><span class="line">　　1、栈（操作系统）：由操作系统自动分配释放 ，存放函数的参数值，局部变量的值等。其操作方式类似于数据结构中的栈；</span><br><span class="line">　　2、堆（操作系统）： 存储复杂类型(对象)，一般由程序员分配释放， 若程序员不释放，由垃圾回收机制回收，分配方式倒是类似于链表。</span><br></pre></td></tr></table></figure></li><li><p>注意：JavaScript中没有堆和栈的概念，此处我们用堆和栈来讲解，目的方便理解和方便以后的学习。</p></li></ul><h3 id="基本类型在内存中的存储"><a href="#基本类型在内存中的存储" class="headerlink" title="基本类型在内存中的存储"></a>基本类型在内存中的存储</h3><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1fzgkaitpicj30n70fgt8v.jpg" alt=""></p><h3 id="复杂类型在内存中的存储"><a href="#复杂类型在内存中的存储" class="headerlink" title="复杂类型在内存中的存储"></a>复杂类型在内存中的存储</h3><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1fzgkbgb44oj30p00cz3zh.jpg" alt=""></p><h3 id="基本类型作为函数的参数"><a href="#基本类型作为函数的参数" class="headerlink" title="基本类型作为函数的参数"></a>基本类型作为函数的参数</h3><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1fzgkc4enzbj30o60g3jrv.jpg" alt=""></p><h3 id="复杂类型作为函数的参数"><a href="#复杂类型作为函数的参数" class="headerlink" title="复杂类型作为函数的参数"></a>复杂类型作为函数的参数</h3><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1fzgkchu8lhj30xb0lfwfm.jpg" alt=""></p><h2 id="例题练习"><a href="#例题练习" class="headerlink" title="例题练习"></a>例题练习</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下面代码输出的结果</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age,salary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.age = age;</span><br><span class="line">  <span class="keyword">this</span>.salary = salary;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params">person</span>) </span>&#123;</span><br><span class="line">  person.name = <span class="string">"ls"</span>;</span><br><span class="line">  person = <span class="keyword">new</span> Person(<span class="string">"aa"</span>,<span class="number">18</span>,<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Person(<span class="string">"zs"</span>,<span class="number">18</span>,<span class="number">1000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(p.name);<span class="comment">//zs</span></span><br><span class="line">f1(p);</span><br><span class="line"><span class="built_in">console</span>.log(p.name);<span class="comment">//ls</span></span><br></pre></td></tr></table></figure><p><strong>答案：</strong></p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1fzgjz1hw08j309907gmx5.jpg" alt=""><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1fzgkwqtyikj30y00fj0tw.jpg" alt=""></p><p>思考：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. </span></span><br><span class="line"><span class="keyword">var</span> num1 = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">var</span> num2 = num1;</span><br><span class="line">num1 = <span class="number">20</span>;</span><br><span class="line"><span class="built_in">console</span>.log(num1);</span><br><span class="line"><span class="built_in">console</span>.log(num2);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2. </span></span><br><span class="line"><span class="keyword">var</span> num = <span class="number">50</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">    num = <span class="number">60</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(num);</span><br><span class="line">&#125;</span><br><span class="line">f1(num);</span><br><span class="line"><span class="built_in">console</span>.log(num);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 重点</span></span><br><span class="line"><span class="keyword">var</span> num1 = <span class="number">55</span>;</span><br><span class="line"><span class="keyword">var</span> num2 = <span class="number">66</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params">num, num1</span>) </span>&#123;</span><br><span class="line">  num = <span class="number">100</span>;</span><br><span class="line">  num1 = <span class="number">100</span>;</span><br><span class="line">  num2 = <span class="number">100</span>;<span class="comment">//注意是隐式全局变量</span></span><br><span class="line">  <span class="built_in">console</span>.log(num);</span><br><span class="line">  <span class="built_in">console</span>.log(num1);</span><br><span class="line">  <span class="built_in">console</span>.log(num2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f1(num1, num2);</span><br><span class="line"><span class="built_in">console</span>.log(num1);</span><br><span class="line"><span class="built_in">console</span>.log(num2);</span><br><span class="line"><span class="built_in">console</span>.log(num);</span><br></pre></td></tr></table></figure><p><strong>答案：</strong></p><p>1、</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1fzgjtae7g3j306p045q2r.jpg" alt=""></p><p>2、</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1fzgjvexo2gj305i04fmwz.jpg" alt=""></p><p>3、</p><p><img src="http://ww1.sinaimg.cn/large/006ttwEMgy1fzgjqnz30gj30bf0ajaa5.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>flex伸缩弹性布局常用属性</title>
      <link href="/2018/12/15/flex%E5%B8%83%E5%B1%80%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7.html"/>
      <url>/2018/12/15/flex%E5%B8%83%E5%B1%80%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="伸缩布局-CSS3"><a href="#伸缩布局-CSS3" class="headerlink" title="伸缩布局(CSS3)"></a>伸缩布局(CSS3)</h2><p>CSS3在布局方面做了非常大的改进，使得我们对块级元素的布局排列变得十分灵活，适应性非常强，其强大的伸缩性，在响应式开中可以发挥极大的作用。</p><p><br></p><p>主轴：Flex容器的主轴主要用来配置Flex项目，默认是水平方向</p><p>侧轴：与主轴垂直的轴称作侧轴，默认是垂直方向的</p><p>方向：默认主轴从左向右，侧轴默认从上到下</p><p>主轴和侧轴并不是固定不变的，通过flex-direction可以互换。</p><p><img src="http://wx3.sinaimg.cn/large/006ttwEMgy1fy6udwb0ndj30ju08r0u6.jpg" alt=""></p><p>Flex布局的语法规范经过几年发生了很大的变化，也给Flexbox的使用带来一定的局限性，因为语法规范版本众多，浏览器支持不一致，致使Flexbox布局使用不多<br></p><h2 id="各属性详解"><a href="#各属性详解" class="headerlink" title="各属性详解"></a>各属性详解</h2><p><br>1.flex子项目在主轴的缩放比例，不指定flex属性，则不参与伸缩分配</p><p>min-width  最小值      min-width: 280px  最小宽度  不能小于 280</p><p>max-width: 1280px  最大宽度  不能大于 1280</p><p><br></p><p>2.flex-direction调整主轴方向（默认为水平方向）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flex-direction：row</span><br></pre></td></tr></table></figure><p>flex容器的主轴被定义为与文本方向相同。 主轴起点和主轴终点与内容方向相同。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flex-direction：row-reverse</span><br></pre></td></tr></table></figure><p>表现和row相同，但是置换了主轴起点和主轴终点</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flex-direction：column</span><br></pre></td></tr></table></figure><p>flex容器的主轴和块轴相同。主轴起点与主轴终点和书写模式的前后点相同</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flex-direction：column-reverse</span><br></pre></td></tr></table></figure><p>表现和<code>column</code>相同，但是置换了主轴起点和主轴终点</p><p>  可以仿写<a href="http://m.ctrip.com/html5/" target="_blank" rel="noopener">携程网手机端</a>页面练习flex布局</p><p><br></p><p>3、justify-content调整主轴对齐（水平对齐）</p><p>子盒子如何在父盒子里面水平对齐</p><table><thead><tr><th>值</th><th>描述</th><th>白话文</th></tr></thead><tbody><tr><td>flex-start</td><td>默认值。项目位于容器的开头。</td><td>让子元素从父容器的开头开始排序但是盒子顺序不变</td></tr><tr><td>flex-end</td><td>项目位于容器的结尾。</td><td>让子元素从父容器的后面开始排序但是盒子顺序不变</td></tr><tr><td>center</td><td>项目位于容器的中心。</td><td>让子元素在父容器中间显示</td></tr><tr><td>space-between</td><td>项目位于各行之间留有空白的容器内。</td><td>左右的盒子贴近父盒子，中间的平均分布空白间距</td></tr><tr><td>space-around</td><td>项目位于各行之前、之间、之后都留有空白的容器内。</td><td>相当于给每个盒子添加了左右margin外边距</td></tr></tbody></table><p><br>4、align-items调整侧轴对齐（垂直对齐）</p><p>子盒子如何在父盒子里面垂直对齐（单行）</p><table><thead><tr><th>值</th><th>描述</th><th>白话文</th></tr></thead><tbody><tr><td>stretch</td><td>默认值。项目被拉伸以适应容器。</td><td>让子元素的高度拉伸适用父容器（子元素不给高度的前提下)</td></tr><tr><td>center</td><td>项目位于容器的中心。</td><td>垂直居中</td></tr><tr><td>flex-start</td><td>项目位于容器的开头。</td><td>垂直对齐开始位置 上对齐</td></tr><tr><td>flex-end</td><td>项目位于容器的结尾。</td><td>垂直对齐结束位置 底对齐</td></tr><tr><td></td><td></td></tr></tbody></table><p><br>5、flex-wrap控制是否换行</p><p>当我们子盒子内容宽度多于父盒子的时候如何处理</p><table><thead><tr><th>值</th><th>描述</th></tr></thead><tbody><tr><td>nowrap</td><td>默认值。规定灵活的项目不拆行或不拆列。  不换行，则 收缩（压缩） 显示  强制一行内显示</td></tr><tr><td>wrap</td><td>规定灵活的项目在必要的时候拆行或拆列。</td></tr><tr><td>wrap-reverse</td><td>规定灵活的项目在必要的时候拆行或拆列，但是以相反的顺序。</td></tr><tr><td></td><td></td></tr><tr><td></td></tr></tbody></table><p><br>6、flex-flow是flex-direction、flex-wrap的简写形式</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">flex-flow</span>: <span class="selector-tag">flex-direction</span>  <span class="selector-tag">flex-wrap</span>;</span><br></pre></td></tr></table></figure><p>白话记：    flex-flow: 排列方向   换不换行; </p><p>两个中间用空格</p><p>例如：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">display</span>: <span class="selector-tag">flex</span>;</span><br><span class="line"><span class="comment">/* flex-direction: row;</span></span><br><span class="line"><span class="comment">flex-wrap: wrap;   这两句话等价于下面的这句话*/</span></span><br><span class="line"><span class="selector-tag">flex-flow</span>: <span class="selector-tag">column</span> <span class="selector-tag">wrap</span>;  <span class="comment">/* 两者的综合 */</span></span><br></pre></td></tr></table></figure><p><br>7、align-content堆栈（由flex-wrap产生的独立行）多行垂直对齐方式齐</p><p>align-content是针对flex容器里面多轴(多行)的情况,align-items是针对一行的情况进行排列。</p><p>必须对父元素设置自由盒属性display:flex;，并且设置排列方式为横向排列flex-direction:row;并且设置换行，flex-wrap:wrap;这样这个属性的设置才会起作用。</p><table><thead><tr><th>值</th><th>描述</th><th>测试</th></tr></thead><tbody><tr><td>stretch</td><td>默认值。项目被拉伸以适应容器。</td><td></td></tr><tr><td>center</td><td>项目位于容器的中心。</td><td></td></tr><tr><td>flex-start</td><td>项目位于容器的开头。</td><td></td></tr><tr><td>flex-end</td><td>项目位于容器的结尾。</td><td></td></tr><tr><td>space-between</td><td>项目位于各行之间留有空白的容器内。</td><td></td></tr><tr><td>space-around</td><td>项目位于各行之前、之间、之后都留有空白的容器内。</td></tr></tbody></table><p><br>8、order控制子项目的排列顺序，正序方式排序，从小到大</p><p>用css 来控制盒子的前后顺序。  用order 就可以</p><p>用整数值来定义排列顺序，数值小的排在前面。可以为负值。 默认值是 0</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">order</span>: 1;</span><br></pre></td></tr></table></figure><p><br><br><br></p>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> html/css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浅谈BFC</title>
      <link href="/2018/12/10/%E6%B5%85%E8%B0%88BFC.html"/>
      <url>/2018/12/10/%E6%B5%85%E8%B0%88BFC.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p><strong>BFC(Block formatting context)</strong></p><p>直译为”块级格式化上下文”。它是一个独立的渲染区域，只有Block-level box参与， 它规定了内部的Block-level Box如何布局，并且与这个区域外部毫不相干。</p><p>白话文： 孩子在家里愿意怎么折腾都行，但是出了家门口，你就的乖乖的，不能影响外面的任何人。</p><p><br></p><h3 id="元素的显示模式"><a href="#元素的显示模式" class="headerlink" title="元素的显示模式"></a>元素的显示模式</h3><p>我们前面讲过 元素的显示模式 display。 </p><p>分为 块级元素   行内元素  行内块元素 ，其实，它还有很多其他显示模式。</p><p><img src="http://wx3.sinaimg.cn/large/006ttwEMgy1fy5juu4ov4j30a20dkjrx.jpg" alt=""><br></p><h3 id="哪些元素会具有BFC的条件"><a href="#哪些元素会具有BFC的条件" class="headerlink" title="哪些元素会具有BFC的条件"></a>哪些元素会具有BFC的条件</h3><p>不是所有的元素模式都能产生BFC，w3c 规范： </p><p>display 属性为 block, list-item, table 的元素，会产生BFC.</p><p>这个三个都是用来布局最为合理的元素，因为他们就是用来可视化布局。</p><p>注意其他的，display属性，比如 line 等等，他们创建的是 IFC ，我们暂且不研究。</p><p>这个BFC 有着具体的布局特性： </p><p><img src="http://wx1.sinaimg.cn/large/006ttwEMgy1fy5juujfrkg30dw0dwt8n.gif" alt=""></p><p>有宽度和高度 ， 有 外边距margin  有内边距padding 有边框 border。<br></p><h3 id="什么情况下可以让元素产生BFC"><a href="#什么情况下可以让元素产生BFC" class="headerlink" title="什么情况下可以让元素产生BFC"></a>什么情况下可以让元素产生BFC</h3><p>以上盒子具有BFC条件了，就是说有资质了，但是怎样触发才会产生BFC，从而创造这个封闭的环境呢？<br>同样，要给这些元素添加如下属性就可以触发BFC。</p><blockquote><p>-float属性不为none</p><p>-position为absolute或fixed</p><p>-display为inline-block, table-cell, table-caption, flex, inline-flex</p><p>-overflow不为visible。</p></blockquote><p><br></p><h3 id="BFC元素所具有的特性"><a href="#BFC元素所具有的特性" class="headerlink" title="BFC元素所具有的特性"></a>BFC元素所具有的特性</h3><p>BFC布局规则特性：</p><p>1.在BFC中，盒子从顶端开始垂直地一个接一个地排列.</p><p>2.盒子垂直方向的距离由margin决定。属于同一个BFC的两个相邻盒子的margin会发生重叠，不属于同一个BFC的两个相邻盒子的margin不会发生重叠。（一般非BFC区域内的两个相邻盒子的margin也是会发生重叠）</p><p>3.在BFC中，每一个盒子的左外边缘（margin-left）会触碰到容器的左边缘(border-left)内侧，只是接触不会压住border（对于从右到左的格式来说，则触碰到右边缘）。</p><p>4.BFC的区域不会与浮动盒子产生交集，而是紧贴浮动边缘。</p><p>5.计算BFC的高度时，自然也会检测浮动或者定位的盒子高度。</p><p><br></p><h3 id="BFC的主要用途"><a href="#BFC的主要用途" class="headerlink" title="BFC的主要用途"></a>BFC的主要用途</h3><p>BFC能用来做什么？</p><p>(1) 清除元素内部浮动</p><p>只要把父元素设为BFC就可以清理子元素的浮动了，最常见的用法就是在父元素上设置overflow: hidden样式，对于IE6加上zoom:1就可以了。</p><p>主要用到 <strong>计算BFC的高度时，自然也会检测浮动或者定位的盒子高度</strong>这一特性</p><p>清除浮动前：<img src="http://wx2.sinaimg.cn/large/006ttwEMgy1fy5jwcv0kuj30ah090q2p.jpg" alt=""></p><p>清除浮动后：<img src="http://wx1.sinaimg.cn/large/006ttwEMgy1fy5jwdc1bkj309p08cmwx.jpg" alt=""></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">    &lt;<span class="selector-tag">style</span>&gt;</span><br><span class="line">        <span class="selector-class">.father</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">            <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span><br><span class="line">            <span class="comment">/* float: left;   给father 创建了BFC*/</span></span><br><span class="line">            <span class="comment">/*position: absolute; 给father 创建了BFC*/</span></span><br><span class="line">            <span class="comment">/*display: inline-block; 给father 创建了BFC*/</span></span><br><span class="line">            <span class="attribute">overflow</span>: hidden;   <span class="comment">/*给father创建了BFC*/</span></span><br><span class="line">            <span class="attribute">zoom</span>: <span class="number">1</span>; <span class="comment">/*兼容ie6 */</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.son1</span>, <span class="selector-class">.son2</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: pink;</span><br><span class="line">            <span class="attribute">float</span>: left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.son2</span> &#123;</span><br><span class="line">            <span class="attribute">background-color</span>: purple;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;<span class="selector-tag">body</span>&gt;</span><br><span class="line">&lt;div class="father"&gt;</span><br><span class="line">    &lt;div class="son1"&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class="son2"&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure><p><br></p><p>(2) 解决外边距合并问题</p><p>外边距合并的问题。</p><p>主要用到 <strong>盒子垂直方向的距离由margin决定，属于同一个BFC的两个相邻盒子的margin会发生重叠，不属于统一BFC的相邻盒子不会margin重叠</strong>这一特性</p><p>属于同一个BFC的两个相邻盒子的margin会发生重叠，那么我们创建不属于同一个BFC，就不会发生margin重叠了。<img src="http://wx3.sinaimg.cn/large/006ttwEMgy1fy5jwchk3tj30fk0caq2w.jpg" alt=""></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">    &lt;<span class="selector-tag">style</span>&gt;</span><br><span class="line">        <span class="selector-class">.father</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">            <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.son1</span>, <span class="selector-class">.son2</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: pink;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.son1</span> &#123;</span><br><span class="line">            <span class="attribute">margin-bottom</span>: <span class="number">50px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.over</span> &#123;</span><br><span class="line">            <span class="attribute">overflow</span>: hidden;<span class="comment">/*形成BFC区域*/</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.son2</span> &#123;</span><br><span class="line">            <span class="attribute">background-color</span>: purple;</span><br><span class="line">            <span class="attribute">margin-top</span>: <span class="number">100px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;<span class="selector-tag">body</span>&gt;</span><br><span class="line">&lt;div class="father"&gt;</span><br><span class="line">    &lt;div class="over"&gt; &lt;!--over隔开，那么 son1 就和son1 不是同一BFC--&gt;</span><br><span class="line">        &lt;div class="son1"&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class="son2"&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure><p><br></p><p>(3) 制作右侧自适应的盒子问题</p><p>主要用到<strong>普通流体元素BFC后，为了和浮动元素不产生任何交集，顺着浮动边缘形成自己的封闭上下文</strong></p><p><img src="http://wx4.sinaimg.cn/large/006ttwEMgy1fy5jwdxel9j30d20f4t8z.jpg" alt=""></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">    &lt;<span class="selector-tag">style</span>&gt;</span><br><span class="line">        <span class="selector-class">.father</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">            <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#000</span>;</span><br><span class="line">            <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.box</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: pink;</span><br><span class="line">            <span class="attribute">float</span>: left;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.txt</span> &#123;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: purple;</span><br><span class="line">            <span class="attribute">overflow</span>: hidden;  <span class="comment">/*给txt 创建BFC 区域 在不和浮动产生交集 紧贴制浮动的边缘 */</span></span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;<span class="selector-tag">body</span>&gt;</span><br><span class="line">&lt;div class="father"&gt;</span><br><span class="line">    &lt;div class="box"&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class="txt"&gt;我可以制作右侧自适应的盒子我可以制作右侧自适应的盒子我可以制作右侧自适应的盒子</span><br><span class="line">        我可以制作右侧自适应的盒子我可以制作右侧自适应的盒子我可以制作右侧自适应的盒子我可以制作右侧自适应的盒子</span><br><span class="line">        我可以制作右侧自适应的盒子我可以制作右侧自适应的盒子我可以制作右侧自适应的盒子</span><br><span class="line">        我可以制作右侧自适应的盒子我可以制作右侧自适应的盒子我可以制作右侧自适应的盒子&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure><p><br></p><h3 id="BFC-总结"><a href="#BFC-总结" class="headerlink" title="BFC 总结"></a>BFC 总结</h3><p>BFC就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素。反之也如此。包括浮动，和外边距合并等等，因此，有了这个特性，我们布局的时候就不会出现意外情况了。</p>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> html/css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>外边距塌陷问题</title>
      <link href="/2018/12/08/%E5%A4%96%E8%BE%B9%E8%B7%9D%E5%A1%8C%E9%99%B7%E9%97%AE%E9%A2%98.html"/>
      <url>/2018/12/08/%E5%A4%96%E8%BE%B9%E8%B7%9D%E5%A1%8C%E9%99%B7%E9%97%AE%E9%A2%98.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="外边距合并"><a href="#外边距合并" class="headerlink" title="外边距合并"></a>外边距合并</h2><p>使用margin定义块元素的垂直外边距时，可能会出现外边距的合并。</p><h3 id="相邻块元素垂直外边距的合并"><a href="#相邻块元素垂直外边距的合并" class="headerlink" title="相邻块元素垂直外边距的合并"></a>相邻块元素垂直外边距的合并</h3><p>当上下相邻的两个块元素相遇时，如果上面的元素有下外边距margin-bottom，下面的元素有上外边距margin-top，则他们之间的垂直间距不是margin-bottom与margin-top之和，而是两者中的较大者。这种现象被称为相邻块元素垂直外边距的合并（也称外边距塌陷）。</p><p><img src="http://wx1.sinaimg.cn/mw690/006ttwEMgy1fy0xzlda0nj30e008lq2t.jpg" alt=""></p><p>解决方案一： 避免这样写就好了。。。。</p><p>解决方案二：详见我的另一篇博文<a href="https://dunteng.github.io/[object%20Object]2018/12/10/%E6%B5%85%E8%B0%88BFC.html#BFC%E7%9A%84%E4%B8%BB%E8%A6%81%E7%94%A8%E9%80%94">利用BFC机制解决外边距合并问题</a></p><h3 id="嵌套块元素垂直外边距的合并"><a href="#嵌套块元素垂直外边距的合并" class="headerlink" title="嵌套块元素垂直外边距的合并"></a>嵌套块元素垂直外边距的合并</h3><p>对于两个嵌套关系的块元素，如果父元素没有上内边距及边框，则父元素的上外边距会与子元素的上外边距发生合并，合并后的外边距为两者中的较大者，即使父元素的上外边距为0，也会发生合并。</p><p><img src="http://wx2.sinaimg.cn/mw690/006ttwEMgy1fy0xzb8o6vj30e005fwec.jpg" alt=""></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">      <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">* &#123;</span></span><br><span class="line"><span class="undefined">margin: 0;</span></span><br><span class="line"><span class="undefined">padding: 0;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-class">.baba</span> &#123;</span></span><br><span class="line"><span class="css"><span class="comment">/* border-top: 1px solid black; */</span></span></span><br><span class="line"><span class="undefined">height: 100px;</span></span><br><span class="line"><span class="undefined">width: 100px;</span></span><br><span class="line"><span class="undefined">background-color: red;</span></span><br><span class="line"><span class="undefined">margin-top: 30px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="css"><span class="selector-class">.erzi</span> &#123;</span></span><br><span class="line"><span class="undefined">height: 50px;</span></span><br><span class="line"><span class="undefined">width: 50px;</span></span><br><span class="line"><span class="undefined">background-color: pink;</span></span><br><span class="line"><span class="undefined">margin-top: 10px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">      </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"baba"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"erzi"</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br>观察下图erzi块的效果，erzi与baba之间没有margin撑开，不是我们想要的效果<img src="http://wx1.sinaimg.cn/large/006ttwEMgy1fy0zwmwqw8j311y0heq3o.jpg" alt=""></p><p><br>父元素的上外边距会与子元素的上外边距发生合并，合并后的外边距为两者中的较大者<img src="http://wx4.sinaimg.cn/large/006ttwEMgy1fy0zwnceysj311y0heaau.jpg" alt=""></p><p>解决方案：</p><ol><li>可以为父元素定义1像素的上边框或上内边距。</li><li>可以为父元素添加overflow:hidden。</li></ol><p><br>解决该问题后，erzi块与baba块有了我们想要的margin<img src="http://wx1.sinaimg.cn/large/006ttwEMgy1fy0zwnq65qj311y0hemxw.jpg" alt=""></p><p><img src="http://wx3.sinaimg.cn/large/006ttwEMgy1fy0zwo350qj311y0hedgm.jpg" alt=""></p><p><br><br>待续。。。。</p><p><br><br></p>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> html/css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>字体图标的使用</title>
      <link href="/2018/12/08/%E5%AD%97%E4%BD%93%E5%9B%BE%E6%A0%87%E7%9A%84%E4%BD%BF%E7%94%A8.html"/>
      <url>/2018/12/08/%E5%AD%97%E4%BD%93%E5%9B%BE%E6%A0%87%E7%9A%84%E4%BD%BF%E7%94%A8.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h1 id="字体格式"><a href="#字体格式" class="headerlink" title="字体格式"></a>字体格式</h1><p>不同浏览器所支持的字体格式是不一样的，我们有必要了解一下有关字体格式的知识。</p><p>1、TureType(.ttf)格式</p><p>.ttf字体是Windows和Mac的最常见的字体，是一种RAW格式，支持这种字体的浏览器有IE9+、Firefox3.5+、Chrome4+、Safari3+、Opera10+、iOS Mobile、Safari4.2+；</p><p>2、OpenType(.otf)格式</p><p>.otf字体被认为是一种原始的字体格式，其内置在TureType的基础上，支持这种字体的浏览器有Firefox3.5+、Chrome4.0+、Safari3.1+、Opera10.0+、iOS Mobile、Safari4.2+；</p><p>3、Web Open Font Format(.woff)格式</p><p>woff字体是Web字体中最佳格式，他是一个开放的TrueType/OpenType的压缩版本，同时也支持元数据包的分离，支持这种字体的浏览器有IE9+、Firefox3.5+、Chrome6+、Safari3.6+、Opera11.1+；</p><p>4、Embedded Open Type(.eot)格式</p><p>.eot字体是IE专用字体，可以从TrueType创建此格式字体，支持这种字体的浏览器有IE4+；</p><p>5、SVG(.svg)格式</p><p>.svg字体是基于SVG字体渲染的一种格式，支持这种字体的浏览器有Chrome4+、Safari3.1+、Opera10.0+、iOS Mobile Safari3.2+；</p><p>了解了上面的知识后，我们就需要为不同的浏览器准备不同格式的字体，通常我们会通过字体生成工具帮我们生成各种格式的字体，因此无需过于在意字体格式间的区别差异。</p><h1 id="字体图标"><a href="#字体图标" class="headerlink" title="字体图标"></a>字体图标</h1><p>图片是有诸多优点的，但是缺点很明显，比如图片不但增加了总文件的大小，还增加了很多额外的”http请求”，这都会大大降低网页的性能的。更重要的是图片不能很好的进行“缩放”，因为图片放大和缩小会失真。 我们学习移动端响应式，很多情况下希望我们的图标是可以缩放的。此时，一个非常重要的技术出现了，就是字体图标（iconfont).</p><h2 id="字体图标优点"><a href="#字体图标优点" class="headerlink" title="字体图标优点"></a>字体图标优点</h2><p>可以做出跟图片一样可以做的事情，改变透明度、旋转度，等等..<br>但是本质其实是文字，可以很随意的改变颜色、产生阴影、透明效果等等…<br>本身体积更小，但携带的信息并没有削减。<br>几乎支持所有的浏览器<br>移动端设备必备良药…</p><h2 id="字体图标使用流程"><a href="#字体图标使用流程" class="headerlink" title="字体图标使用流程"></a>字体图标使用流程</h2><p>总体来说，字体图标按照如下流程：</p><p><img src="http://wx2.sinaimg.cn/large/006ttwEMgy1fy4ayku0rmj30xt0a8mxz.jpg" alt=""></p><h3 id="设计字体图标"><a href="#设计字体图标" class="headerlink" title="设计字体图标"></a>设计字体图标</h3><p>假如图标是我们公司单独设计，那就需要第一步了，这个属于UI设计人员的工作， 他们在 illustrator 或 Sketch 这类矢量图形软件里创建 icon图标， 比如下图：</p><p><img src="http://wx3.sinaimg.cn/large/006ttwEMgy1fy4ayliklzj30dc05wwf5.jpg" alt=""></p><p>  之后保存为svg格式，然后给我们前端人员就好了。 </p><p>  其实第一步，我们不需要关心，只需要给我们这些图标就可以了，如果图标是大众的，网上本来就有的，可以直接跳过第一步，进入第三步。</p><h3 id="上传生成字体包"><a href="#上传生成字体包" class="headerlink" title="上传生成字体包"></a>上传生成字体包</h3><p>   当UI设计人员给我们svg文件的时候，我们需要转换成我们页面能使用的字体文件， 而且需要生成的是兼容性的适合各个浏览器的。</p><p>​    推荐网站： <a href="http://icomoon.io" target="_blank" rel="noopener">http://icomoon.io</a></p><p><strong>icomoon字库</strong></p><p>IcoMoon成立于2011年，推出的第一个自定义图标字体生成器，它允许用户选择他们所需要的图标，使它们成一字型。 内容种类繁多，非常全面。</p><p>   推荐网站： <a href="http://www.iconfont.cn/" target="_blank" rel="noopener">http://www.iconfont.cn/</a></p><p><strong>阿里icon font字库</strong></p><p><a href="http://www.iconfont.cn/" target="_blank" rel="noopener">http://www.iconfont.cn/</a></p><p>这个是阿里妈妈M2UX的一个icon font字体图标字库，包含了淘宝图标库和阿里妈妈图标库。可以使用AI制作图标上传生成。 一个字，免费，免费！！</p><p><strong>fontello</strong></p><p><a href="http://fontello.com/" target="_blank" rel="noopener">http://fontello.com/</a></p><p>在线定制你自己的icon font字体图标字库，也可以直接从GitHub下载整个图标集，该项目也是开源的。</p><p><strong>Font-Awesome</strong></p><p><a href="http://fortawesome.github.io/Font-Awesome/" target="_blank" rel="noopener">http://fortawesome.github.io/Font-Awesome/</a></p><p>这是我最喜欢的字库之一了，更新比较快。目前已经有369个图标了。</p><p><strong>Glyphicon Halflings</strong></p><p><a href="http://glyphicons.com/" target="_blank" rel="noopener">http://glyphicons.com/</a></p><p>这个字体图标可以在Bootstrap下免费使用。自带了200多个图标。</p><p><strong>Icons8</strong></p><p><a href="https://icons8.com/" target="_blank" rel="noopener">https://icons8.com/</a></p><p>提供PNG免费下载，像素大能到500PX</p><p><img src="http://wx4.sinaimg.cn/large/006ttwEMgy1fy4aym7ehpj30gm08vq38.jpg" alt="1513132290173"></p><h3 id="下载兼容字体包"><a href="#下载兼容字体包" class="headerlink" title="下载兼容字体包"></a>下载兼容字体包</h3><p>刚才上传完毕， 网站会给我们把UI做的svg图片转换为我们的字体格式， 然后下载下来就好了</p><p>当然，我们不需要自己专门的图标，是想网上找几个图标使用，以上2步可以直接省略了， 直接到刚才的网站上找喜欢的下载使用吧。</p><p><img src="http://wx4.sinaimg.cn/large/006ttwEMgy1fy4ayjisn4j30k70db750.jpg" alt=""></p><p><img src="http://wx4.sinaimg.cn/large/006ttwEMgy1fy4ayk46x9j30lx0g53z3.jpg" alt=""></p><h3 id="字体引入到HTML"><a href="#字体引入到HTML" class="headerlink" title="字体引入到HTML"></a>字体引入到HTML</h3><p>得到压缩包之后，最后一步，是最重要的一步了， 就是字体文件已经有了，我们需要引入到我们页面中。</p><ol><li><p>首先把 以下4个文件放入到 fonts文件夹里面。 通俗的做法</p><p><img src="http://wx4.sinaimg.cn/large/006ttwEMgy1fy4aymmz4oj30bo06wweh.jpg" alt=""></p><h5 id="第一步：在样式里面声明字体：-告诉别人我们自己定义的字体"><a href="#第一步：在样式里面声明字体：-告诉别人我们自己定义的字体" class="headerlink" title="第一步：在样式里面声明字体： 告诉别人我们自己定义的字体"></a>第一步：在样式里面声明字体： 告诉别人我们自己定义的字体</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">'icomoon'</span>;</span><br><span class="line">  <span class="attribute">src</span>:  <span class="built_in">url</span>(<span class="string">'fonts/icomoon.eot?7kkyc2'</span>);<span class="comment">/*注意路径不要照搬，看实际位置*/</span></span><br><span class="line">  <span class="attribute">src</span>:  <span class="built_in">url</span>(<span class="string">'fonts/icomoon.eot?7kkyc2#iefix'</span>) <span class="built_in">format</span>(<span class="string">'embedded-opentype'</span>),</span><br><span class="line">    <span class="built_in">url</span>(<span class="string">'fonts/icomoon.ttf?7kkyc2'</span>) <span class="built_in">format</span>(<span class="string">'truetype'</span>),</span><br><span class="line">    <span class="built_in">url</span>(<span class="string">'fonts/icomoon.woff?7kkyc2'</span>) <span class="built_in">format</span>(<span class="string">'woff'</span>),</span><br><span class="line">    <span class="built_in">url</span>(<span class="string">'fonts/icomoon.svg?7kkyc2#icomoon'</span>) <span class="built_in">format</span>(<span class="string">'svg'</span>);</span><br><span class="line">  <span class="attribute">font-weight</span>: normal;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="第二步：给盒子使用字体"><a href="#第二步：给盒子使用字体" class="headerlink" title="第二步：给盒子使用字体"></a>第二步：给盒子使用字体</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">span</span> &#123;</span><br><span class="line"><span class="attribute">font-family</span>: <span class="string">"icomoon"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="第三步：盒子里面添加结构"><a href="#第三步：盒子里面添加结构" class="headerlink" title="第三步：盒子里面添加结构"></a>第三步：盒子里面添加结构</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">span</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line"> <span class="attribute">content</span>: <span class="string">"\e900"</span>;</span><br><span class="line">&#125;</span><br><span class="line">或者  </span><br><span class="line">&lt;span&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure><h3 id="追加新图标到原来库里面"><a href="#追加新图标到原来库里面" class="headerlink" title="追加新图标到原来库里面"></a>追加新图标到原来库里面</h3><p>如果工作中，原来的字体图标不够用了，我们需要添加新的字体图标，但是原来的不能删除，继续使用，此时我们需要这样做</p><p>把压缩包里面的selection.json 从新上传，然后，选中自己想要新的图标，从新下载压缩包，替换原来文件即可。</p><p><img src="http://wx1.sinaimg.cn/large/006ttwEMgy1fy4ayilxtvj30dx0cc0ti.jpg" alt=""></p></li></ol><p><br><br><br><br></p>]]></content>
      
      
      
        <tags>
            
            <tag> html/css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>实现微信滑动门</title>
      <link href="/2018/12/07/%E5%AE%9E%E7%8E%B0%E5%BE%AE%E4%BF%A1%E6%BB%91%E5%8A%A8%E9%97%A8.html"/>
      <url>/2018/12/07/%E5%AE%9E%E7%8E%B0%E5%BE%AE%E4%BF%A1%E6%BB%91%E5%8A%A8%E9%97%A8.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="滑动门出现的背景"><a href="#滑动门出现的背景" class="headerlink" title="滑动门出现的背景"></a>滑动门出现的背景</h2><p>制作网页时，为了美观，常常需要为网页元素设置特殊形状的背景，比如微信导航栏，有凸起和凹下去的感觉，最大的问题是里面的字数不一样多，按照传统思维，这就意味着要多张长度不同的背景图片，不过有更好的解决方法。</p><p><img src="http://wx4.sinaimg.cn/large/006ttwEMgy1fy49ltwng4j30xq0dcdi1.jpg" alt=""></p><p>为了使各种特殊形状的背景能够自适应元素中文本内容的多少，出现了CSS滑动门技术。它从新的角度构建页面，使各种特殊形状的背景能够自由拉伸滑动，以适应元素内部的文本内容，可用性更强。 最常见于各种导航栏的滑动门。</p><h2 id="核心技术"><a href="#核心技术" class="headerlink" title="核心技术"></a>核心技术</h2><p>核心技术就是利用CSS精灵（主要是背景位置）和盒子padding撑开宽度, 以便能适应不同字数的导航栏。</p><p>一般的经典布局都是这样的：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>导航栏内容<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><p>两张背景图：</p><p>一张是凸起的：</p><p><img src="http://wx3.sinaimg.cn/large/006ttwEMgy1fy49gsni0vj30ao00x0bn.jpg" alt=""></p><p>另一张是凹陷的：</p><p><img src="http://wx4.sinaimg.cn/large/006ttwEMgy1fy49gs3rmtj30ao00x0az.jpg" alt=""></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">url</span>(images/wx.jpg)  repeat-x; </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.nav</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line"><span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.nav</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line"><span class="comment">/*1. a 左边放 左圆角   但是文字需要往右走 15px*/</span></span><br><span class="line"><span class="attribute">height</span>: <span class="number">33px</span>;</span><br><span class="line"><span class="attribute">line-height</span>: <span class="number">33px</span>;</span><br><span class="line"><span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line"><span class="attribute">text-decoration</span>: none;</span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">url</span>(images/to.png) no-repeat;</span><br><span class="line"><span class="attribute">display</span>: inline-block;</span><br><span class="line"><span class="attribute">padding-left</span>: <span class="number">15px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.nav</span>  <span class="selector-tag">span</span> &#123;</span><br><span class="line"><span class="comment">/*2. span 右边放右圆角   但是文字需要往左走 15px*/</span></span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">url</span>(images/to.png) no-repeat right;</span><br><span class="line"><span class="attribute">display</span>: inline-block;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">33px</span>;</span><br><span class="line"><span class="attribute">padding-right</span>: <span class="number">15px</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.nav</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>, <span class="selector-class">.nav</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line"><span class="attribute">background-image</span>: <span class="built_in">url</span>(images/ao.png);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;<span class="selector-tag">body</span>&gt;</span><br><span class="line">&lt;ul class="nav"&gt;</span><br><span class="line">&lt;<span class="selector-tag">li</span>&gt;</span><br><span class="line">      &lt;a href="#"&gt;</span><br><span class="line">      &lt;span&gt;首页&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">&lt;/li&gt;</span><br><span class="line">&lt;<span class="selector-tag">li</span>&gt;</span><br><span class="line">      &lt;a href="#"&gt;</span><br><span class="line">      &lt;span&gt;三个字&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">&lt;/li&gt;</span><br><span class="line">&lt;<span class="selector-tag">li</span>&gt;</span><br><span class="line">      &lt;a href="#"&gt;</span><br><span class="line">      &lt;span&gt;新闻客户端&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">&lt;/li&gt;</span><br><span class="line"></span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure><p><strong>实现效果：</strong></p><p><img src="http://wx2.sinaimg.cn/large/006ttwEMgy1fy49v5c8vuj30a7069wen.jpg" alt=""></p><h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><ol><li>a 设置 背景左侧，padding撑开合适宽度。    </li><li>span 设置背景右侧， padding撑开合适宽度 剩下由文字继续撑开宽度。</li><li>之所以a包含span就是因为 整个导航都是可以点击的。</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> 小案例 </tag>
            
            <tag> html/css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vertical-align</title>
      <link href="/2018/12/07/vertical-align.html"/>
      <url>/2018/12/07/vertical-align.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>让带有宽度的块级元素居中对齐，是margin: 0 auto;</p><p>让文字居中对齐，是 text-align: center;</p><p>本文讲一下垂直居中的属性.</p><p><br></p><h3 id="图片、表单和文字对齐"><a href="#图片、表单和文字对齐" class="headerlink" title="图片、表单和文字对齐"></a>图片、表单和文字对齐</h3><p>vertical-align 垂直对齐， 这个看上去很美好的一个属性， 实际有着不可捉摸的脾气。<br></p><p><img src="http://wx2.sinaimg.cn/large/006ttwEMgy1fy4740ts24j30ku0410th.jpg" alt=""><br><br></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vertical-align : baseline |top |middle |bottom</span><br></pre></td></tr></table></figure><p><strong>vertical-align 不影响块级元素中的内容对齐，它只针对于 行内元素或者行内块元素，特别是行内块元素， 通常用来控制图片/表单与文字的对齐</strong>。</p><p>默认的图片会和文字基线对齐，我们可以通过vertical-align 控制图片和文字的垂直关系了。 </p><p><br></p><h3 id="去除图片底侧空白缝隙"><a href="#去除图片底侧空白缝隙" class="headerlink" title="去除图片底侧空白缝隙"></a>去除图片底侧空白缝隙</h3><p>有个很重要特性你要记住： 图片或者表单等行内块元素，他的底线会和父级盒子的基线对齐。这样会造成一个问题，就是图片底侧会有一个空白缝隙。</p><p>解决的方法就是：  </p><p>1.给img vertical-align:middle | top等等。  让图片不要和基线对齐。</p><p><img src="http://wx2.sinaimg.cn/large/006ttwEMgy1fy47418d8ej30he08cab3.jpg" alt=""></p><p>2.给img 添加 display：block; 转换为块级元素就不会存在问题了。</p><p><img src="http://wx4.sinaimg.cn/large/006ttwEMgy1fy4741w8mnj30kp0a0404.jpg" alt=""></p><p><br><br><br><br></p>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> html/css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>绝对定位的盒子水平/垂直居中</title>
      <link href="/2018/12/06/%E7%BB%9D%E5%AF%B9%E5%AE%9A%E4%BD%8D%E7%9B%92%E5%AD%90%E6%B0%B4%E5%B9%B3%E5%B1%85%E4%B8%AD.html"/>
      <url>/2018/12/06/%E7%BB%9D%E5%AF%B9%E5%AE%9A%E4%BD%8D%E7%9B%92%E5%AD%90%E6%B0%B4%E5%B9%B3%E5%B1%85%E4%B8%AD.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><p>普通的盒子是左右margin 改为 auto就可， 但是对于绝对定位就无效了</p><p>定位的盒子也可以水平或者垂直居中，有一个算法。</p><ol><li><p>首先left 50%   父盒子的一半大小</p></li><li><p>然后margin-left的值设为负数的自己盒子宽度的一半值就可以了</p><p>另外可以使用CSS3的translate来做更方便，避免了人工计算<a id="more"></a></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">style</span>&gt;</span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">499.9999px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">background</span>: pink;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>:<span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">top</span>:<span class="number">50%</span>;</span><br><span class="line">  <span class="comment">/* margin-left: -250px; */</span></span><br><span class="line">  <span class="attribute">transform</span>:<span class="built_in">translate</span>(-50%,-50%);  <span class="comment">/* 走的自己的一半 */</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;<span class="selector-tag">body</span>&gt;</span><br><span class="line">    &lt;div class="box"&gt;&lt;/div&gt;   </span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure><p><br><br><br><br><br></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> html/css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浅谈清除（闭合）浮动</title>
      <link href="/2018/12/05/%E6%B5%85%E8%B0%88%E6%B8%85%E9%99%A4%EF%BC%88%E9%97%AD%E5%90%88%EF%BC%89%E6%B5%AE%E5%8A%A8.html"/>
      <url>/2018/12/05/%E6%B5%85%E8%B0%88%E6%B8%85%E9%99%A4%EF%BC%88%E9%97%AD%E5%90%88%EF%BC%89%E6%B5%AE%E5%8A%A8.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h2 id="为什么要清除浮动"><a href="#为什么要清除浮动" class="headerlink" title="为什么要清除浮动"></a>为什么要清除浮动</h2><p>由于浮动元素不再占用原文档流的位置，所以它会对后面的元素排版产生影响，为了解决这些问题，此时就需要在该元素中清除浮动。</p><p>准确地说，并不是清除浮动，而是<strong>清除浮动后造成的影响</strong></p><p>如果浮动一开始就是一个美丽的错误，那么请用正确的方法挽救它。</p><h2 id="清除浮动本质"><a href="#清除浮动本质" class="headerlink" title="清除浮动本质"></a>清除浮动本质</h2><p>我们一般不直接给定父级元素的高度，更希望子元素可以撑起父级元素。</p><p>清除浮动主要为了解决父级元素高度为0，因为子级浮动引起无法撑起父级元素的问题。</p><p><img src="http://wx3.sinaimg.cn/large/006ttwEMgy1fy35tsuml3j30gp09hdh5.jpg" alt=""></p><p><img src="http://wx1.sinaimg.cn/large/006ttwEMgy1fy35ts9v92j30gq05iwfn.jpg" alt=""><br></p><h2 id="清除浮动的方法"><a href="#清除浮动的方法" class="headerlink" title="清除浮动的方法"></a>清除浮动的方法</h2><p>其实本质叫做闭合浮动更好一些, 记住，清除浮动就是把浮动的盒子圈到里面，让父盒子闭合出口和入口不让他们出来影响其他元素。最最暴力的方法是给父级元素加上高度，但是这显然不是一个好方法。</p><p>在CSS中，clear属性用于清除浮动，其基本语法格式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">选择器&#123;clear:属性值;&#125;   clear 清除</span><br></pre></td></tr></table></figure><table><thead><tr><th>属性值</th><th>描述</th></tr></thead><tbody><tr><td>left</td><td>不允许左侧有浮动元素（清除左侧浮动的影响）</td></tr><tr><td>right</td><td>不允许右侧有浮动元素（清除右侧浮动的影响）</td></tr><tr><td>both</td><td>同时清除左右两侧浮动的影响</td></tr></tbody></table><p><br></p><h3 id="1-额外标签法"><a href="#1-额外标签法" class="headerlink" title="1. 额外标签法"></a>1. 额外标签法</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">是W3C推荐的做法是通过在浮动元素末尾添加一个空的标签例如 <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">”clear:both”</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>，或则其他标签br等亦可。</span><br></pre></td></tr></table></figure><p>优点： 通俗易懂，书写方便</p><p>缺点： 添加许多无意义的标签，结构化较差。<br></p><h3 id="2-父级添加overflow属性方法"><a href="#2-父级添加overflow属性方法" class="headerlink" title="2. 父级添加overflow属性方法"></a>2. 父级添加overflow属性方法</h3><p>可以通过触发BFC的方式，可以实现清除浮动效果。（BFC后面讲解）</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">可以给父级添加： overflow为 hidden|auto|scroll  都可以实现。</span><br></pre></td></tr></table></figure><p>优点：  代码简洁</p><p>缺点：  内容增多时候容易造成不会自动换行导致内容被隐藏掉，无法显示需要溢出的元素。<br></p><h3 id="3-父级标签使用after伪元素清除浮动"><a href="#3-父级标签使用after伪元素清除浮动" class="headerlink" title="3. 父级标签使用after伪元素清除浮动"></a>3. 父级标签使用after伪元素清除浮动</h3><p><strong>:after 方式为空元素的升级版，好处是不用单独加标签了</strong> </p><p>使用方法：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="selector-class">.clearfix</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">     <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">     <span class="attribute">display</span>: block;</span><br><span class="line">     <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">     <span class="attribute">clear</span>: both;</span><br><span class="line">     <span class="attribute">visibility</span>: hidden;</span><br><span class="line">&#125;   </span><br><span class="line"></span><br><span class="line"> .clearfix &#123;*zoom: 1;&#125;   /* IE6、7 专有 */</span><br></pre></td></tr></table></figure><p>优点： 符合闭合浮动思想  结构语义化正确</p><p>缺点： 由于IE6-7不支持:after，使用 zoom:1触发 hasLayout。</p><p>代表网站： 百度、淘宝网、网易等</p><p><img src="http://wx2.sinaimg.cn/large/006ttwEMgy1fy35tt9hxkj30u80ho41p.jpg" alt=""></p><p>注意： content:””   尽量不带点</p><p><br></p><h3 id="4-父级标签使用before和after双伪元素清除浮动"><a href="#4-父级标签使用before和after双伪元素清除浮动" class="headerlink" title="4. 父级标签使用before和after双伪元素清除浮动"></a>4. 父级标签使用before和after双伪元素清除浮动</h3><p>使用方法：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">:before</span>,<span class="selector-class">.clearfix</span><span class="selector-pseudo">:after</span> &#123; </span><br><span class="line">  <span class="attribute">content</span>:<span class="string">""</span>;</span><br><span class="line">  <span class="attribute">display</span>:table;  <span class="comment">/* 这句话可以出发BFC BFC可以清除浮动,BFC我们后面讲 */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line"> <span class="attribute">clear</span>:both;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.clearfix</span> &#123;</span><br><span class="line">  *zoom:1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>优点：  代码更简洁</p><p>缺点：  由于IE6-7不支持:after，使用 zoom:1触发 hasLayout。</p><p>代表网站： 小米、腾讯等<br><br><br><br></p>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> html/css </tag>
            
            <tag> 清除浮动 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数组常用方法</title>
      <link href="/2018/08/22/%E6%95%B0%E7%BB%84.html"/>
      <url>/2018/08/22/%E6%95%B0%E7%BB%84.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"><h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><h4 id="数组的常用方法（ES3）"><a href="#数组的常用方法（ES3）" class="headerlink" title="数组的常用方法（ES3）"></a>数组的常用方法（ES3）</h4><ul><li><p>改变原数组的</p><ul><li><p>push()    在原数组最后位添加</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [];</span><br><span class="line">    arr.push(<span class="number">10</span>);   <span class="comment">//[10]</span></span><br><span class="line">    arr.push(<span class="number">11</span>);   <span class="comment">//[10,11]</span></span><br><span class="line">    arr.push(<span class="number">9</span>);    <span class="comment">//[10,11,9]</span></span><br><span class="line">    arr.push(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>)     <span class="comment">//[10,11,9,1,2,3,4,5,6,7]</span></span><br></pre></td></tr></table></figure><p><em>手动实现一下push方法</em></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.myPush = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="built_in">arguments</span>.length; i++)&#123;</span><br><span class="line">            <span class="keyword">this</span>[<span class="keyword">this</span>.length] = <span class="built_in">arguments</span>[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.length;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><br></p></li><li><p>pop()            把原数组的最后一位剪切出来，pop方法无视传参</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">    arr.pop();      <span class="comment">//[1,2]</span></span><br><span class="line">    arr.pop();      <span class="comment">//[1]</span></span><br></pre></td></tr></table></figure><p><br></p></li><li><p>shift()           把原数组的第一位删除</p></li><li><p>unshift()       在原数组的第一位添加，都是添加，只是和push的方向不同。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">    arr.unshift(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(arr);  <span class="comment">//[0,1,2,3]</span></span><br><span class="line">    arr.unshift(<span class="number">-3</span>,<span class="number">-2</span>,<span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(arr);  <span class="comment">//[-3,-2,-1,0,1,2,3,]</span></span><br><span class="line">    arr.shift();</span><br><span class="line">    <span class="built_in">console</span>.log(arr);  <span class="comment">//[-2,-1,0,1,2,3,]</span></span><br></pre></td></tr></table></figure><p><br></p></li><li><p>sort()             升序数组</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">4</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">2</span>];   <span class="comment">//无序的数组</span></span><br><span class="line">arr.sort();</span><br><span class="line"><span class="built_in">console</span>.log(arr);   <span class="comment">//得：[1,2,3,4,9]</span></span><br></pre></td></tr></table></figure><p>那么 <code>var arr = [4,3,9,1,2];</code>   的话就是   <code>[1,2,3,4,9,10]</code>咯？</p><p>很遗憾，不是，结果是   <code>[1, 10, 2, 3, 4, 9]</code></p><p>为什么呢？因为sort方法提供的升序排序是按照ascii码值继续排序，那么可以用sort（）方法来达到我们想要得到的结果吗？可以，因为sort还提供了一个编程接口，允许我们在sort方法中传入一个参数，这个参数要是一个方法，在方法里面让我们自己来编写排序规则。</p><p>但是这个方法有两个一定要的约定：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">4</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">2</span>];</span><br><span class="line">arr.sort(<span class="function"><span class="keyword">function</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line"><span class="comment">//这是我们自己的升序规则</span></span><br><span class="line">    <span class="keyword">if</span>(x&gt;y)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>​    * <strong>1.必须写两个参数</strong></p><p>​    <strong>*2.看返回值</strong></p><p>​        <strong>*当返回值是负数时，x依然在前，y在后</strong></p><p>​        <strong>*当返回值是正数时，y在前，x在后</strong></p><p>​        <strong>*当返回值是0时，不动</strong></p><p>那么sort括号里的函数是什么时候，怎么执行，执行多少次？</p><p>首先，第一次调用匿名函数传入的x，y分别是arr数组中的第一位和第二位，也就是拿4跟3比</p><p>4&gt;3吗？是，返回1，返回值正数，所以换一下位置，3在前4在后，</p><p><code>匿名函数执行第一次后arr数组： [3,4,9,1,2]</code></p><p>第二次执行，第一位变成3了，拿第一位和第三位比，3&gt;9吗？不大，返回-1，返回值负数，x，也就是3依然在前，y（9）在后。</p><p>第三次执行，x是3，y是1，结果arr数组： [1,3,4,9,2]</p><p>第四次，x是1，y是2，结果arr数组： [1,3,4,9,2]</p><p>第五次了，第一位已经和其他位全部比完，x从第二位拿，x是3，y是4</p><p>如此循环下去。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">4</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">2</span>];</span><br><span class="line">arr.sort(<span class="function"><span class="keyword">function</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line"><span class="comment">//这是我们自己的升序规则</span></span><br><span class="line">    <span class="keyword">if</span>(x&gt;y)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>上面代码中如果判断条件是x&lt;y就是降序功能，数值大的在前小的在后。</p><p>优化代码：</p><p>依然是升序，既然我们需要 一个返回结果，x和y作比较，x大于y返回结果要是一个正数，那么直接</p><p><code>return   x - y</code>  就满足了上述要求。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">4</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">2</span>];</span><br><span class="line">arr.sort(<span class="function"><span class="keyword">function</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line"><span class="comment">//这是我们自己的升序规则</span></span><br><span class="line"><span class="keyword">return</span> x-y;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>x大于y那么相减肯定是正数，反之是负数。</p><p>如果是要降序，则判断条件改为<code>y-x</code>。</p><p><br></p></li><li><p>reverse         颠倒原数组元素</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>];</span><br><span class="line"><span class="built_in">console</span>.log(arr.reverse());    <span class="comment">//['c','b','a']</span></span><br></pre></td></tr></table></figure><p><br></p></li><li><p>splice（参数1，参数2，参数3）           </p><p>参数1：从下标是几开始切？</p><p>参数2：切多少？</p><p>参数3：在切口处添加新数据</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>];</span><br><span class="line">    <span class="comment">//两个参数的</span></span><br><span class="line">    arr.splice(<span class="number">1</span>,<span class="number">1</span>);      <span class="comment">//从下标是1的地方开始切，切一个长度的数据</span></span><br><span class="line">    <span class="built_in">console</span>.log(arr);     <span class="comment">//['a','c']</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>];</span><br><span class="line">    <span class="comment">//三个参数的，假如要实现将数组arr添加一位数据变成[1,2,3,4,5]?</span></span><br><span class="line">    arr.splice(<span class="number">3</span>,<span class="number">0</span>,<span class="number">4</span>);  </span><br><span class="line"><span class="comment">//在下标是3的地方，切除0个(也就是没有切，所以光标也就是切口，在数字5的前面)，添加一个数据4</span></span><br><span class="line">    <span class="built_in">console</span>.log(arr); <span class="comment">//[1,2,3,4,5]</span></span><br></pre></td></tr></table></figure><p><strong>注意：参数1可以为负数</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">arr.splice(<span class="number">-1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="built_in">console</span>.log(arr);   <span class="comment">//[1,2]</span></span><br></pre></td></tr></table></figure><p><strong>-1 代表倒数第几位</strong></p><p><br></p><p><br></p></li></ul></li><li><p>不改变原数组的，返回一个新数组出来。</p><ul><li><p>concat()      连接两个数组</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr1 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">const</span> arr2 = [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>];</span><br><span class="line">    <span class="built_in">console</span>.log(arr1.concat(arr2));</span><br></pre></td></tr></table></figure><p>拼接完之后控制台打印的结果是 [1,2,3,4,5,6,7] ， arr1和arr2都没有改变。</p><p><br></p></li><li><p>join()       数组转换为字符串</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">var</span> str = arr.join(<span class="string">'-'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span>(str) +<span class="string">' : '</span> + str);  </span><br><span class="line"><span class="comment">//控制台</span></span><br><span class="line"><span class="comment">//string : 1-2-3</span></span><br></pre></td></tr></table></figure><p>join函数不传参数默认用逗号<code>,</code>连接。</p><p>数组转换为字符串是用join，与之对应的，字符串转换数组是split( )</p><p><strong>字符串的split( )函数</strong></p><p>split（  按照字符串中的什么拆分为数组 ）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">'a-b-c-d-e-f-g'</span>;</span><br><span class="line"><span class="keyword">var</span> arr = str.split(<span class="string">'-'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(arr);   <span class="comment">//(7) ["a", "b", "c", "d", "e", "f", "g"]</span></span><br></pre></td></tr></table></figure></li><li><p>slice()      截取</p><p>slice（）</p><p>无参数，截取整个数组。</p><p>slice（<code>从下标多少开始截取到最后</code>）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"><span class="keyword">var</span> newArr = arr.slice(<span class="number">2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(newArr);  <span class="comment">//[3,4,5]</span></span><br></pre></td></tr></table></figure><p>参数如果是负数则表示从倒数第几位开始截取。</p><p>slice( <code>从下标多少开始截取</code>，<code>截取到第几下标</code> )</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"><span class="keyword">var</span> newArr = arr.slice(<span class="number">0</span>,<span class="number">2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(newArr);  <span class="comment">//[1,2]</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><h3 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h3><p>1、给一个有序的数组，如何操作才可以让这个有序的数组乱序？</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//有序的数组使之乱序</span></span><br><span class="line">    <span class="keyword">const</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>];</span><br><span class="line">    <span class="built_in">console</span>.log( arr.sort(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="built_in">Math</span>.random() - <span class="number">0.5</span>; &#125;) );</span><br></pre></td></tr></table></figure><p>2、颠倒字符串 str=’abcde’ 为  ‘edcba’</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">'abcde'</span>;</span><br><span class="line"><span class="keyword">var</span> arr = [];</span><br><span class="line"><span class="comment">//字符串转换为数组</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;str.length;i++)&#123;</span><br><span class="line">    arr.push(str.charAt(i));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//颠倒数组</span></span><br><span class="line">arr.reverse();</span><br><span class="line"><span class="comment">//数组转换字符串，正则表达式去掉逗号</span></span><br><span class="line">str = arr.join().replace(<span class="regexp">/,/g</span>, <span class="string">""</span>);</span><br><span class="line"><span class="built_in">console</span>.log(str);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
