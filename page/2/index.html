<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="都会好的  总会有的">
<meta property="og:type" content="website">
<meta property="og:title" content="Dunteng&#39;s Blog">
<meta property="og:url" content="https://dunteng.github.io/page/2/index.html">
<meta property="og:site_name" content="Dunteng&#39;s Blog">
<meta property="og:description" content="都会好的  总会有的">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dunteng&#39;s Blog">
<meta name="twitter:description" content="都会好的  总会有的">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'GX48388M0Z',
      apiKey: '24910416df90ea04217402b818109cef',
      indexName: 'index',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://dunteng.github.io/page/2/">





  <title>Dunteng's Blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?6ffc4435fb9941ca00fb4c7e08d8fca2";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Dunteng's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dunteng.github.io/[object Object]2019/10/02/express搭建静态文件服务器.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dunteng Lin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunteng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]2019/10/02/express搭建静态文件服务器.html" itemprop="url">使用express搭建静态文件服务器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-02T00:00:00+08:00">
                2019-10-02
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]2019/10/02/express搭建静态文件服务器.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/[object Object]2019/10/02/express搭建静态文件服务器.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="搭建静态文件服务器"><a href="#搭建静态文件服务器" class="headerlink" title="搭建静态文件服务器"></a>搭建静态文件服务器</h2><p>之前用过原生的node.js来写服务器👉（<a href="https://dunteng.github.io/[object%20Object]2019/09/30/net%E6%A8%A1%E5%9D%97%E5%86%99%E5%BE%AE%E5%9E%8Bnode%E6%9C%8D%E5%8A%A1%E5%99%A8.html">net服务器</a>，<a href="https://dunteng.github.io/[object%20Object]2019/10/01/%E4%BD%BF%E7%94%A8http%E6%A8%A1%E5%9D%97%E9%87%8D%E6%9E%84%E5%BE%AE%E5%9E%8B%E6%9C%8D%E5%8A%A1%E5%99%A8.html">http服务器</a>）</p>
<p>今天用express，比起<strong>原生node.js</strong>来太简单了！</p>
<p>先<code>npm init</code>初始化项目文件夹，运行<code>npm install express --save</code>安装express.</p>
<p>index.js服务器启动文件👇</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> express();<span class="comment">//创建express实例</span></span><br><span class="line"></span><br><span class="line">app.use(express.static(<span class="string">"page"</span>));</span><br><span class="line">app.listen(<span class="number">12306</span>);</span><br></pre></td></tr></table></figure>
<p>项目架构如下👇</p>
<p><img src="https://pic2.zhimg.com/v2-30bad54d291afaa93d00b03e257fb535_r.jpg" alt=""></p>
<p>运行<code>node index.js</code>，然后在浏览器中访问<a href="http://127.0.0.1:12306/index.html" target="_blank" rel="noopener">http://127.0.0.1:12306/index.html</a>和<a href="http://127.0.0.1:12306/test.html" target="_blank" rel="noopener">http://127.0.0.1:12306/test.html</a>就直接显示出相应的页面了。<strong>太他妈方便了！</strong></p>
<p><br></p>
<p>写一下配置文件和对应的处理文件稍微规范化一点👇</p>
<p><img src="https://pic3.zhimg.com/v2-6380ca214c7bf0c61be476f8cc1fbf0a_r.jpg" alt=""></p>
<p>📌<strong>config.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> globalConfig = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> conf = fs.readFileSync(<span class="string">'./server.conf'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> configArr = conf.toString().split(<span class="string">"\r\n"</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; configArr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> itemArr = configArr[i].replace(<span class="regexp">/\s+/g</span>, <span class="string">""</span>).split(<span class="string">'='</span>);</span><br><span class="line">    globalConfig[itemArr[<span class="number">0</span>]] = itemArr[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(globalConfig);</span><br><span class="line"><span class="built_in">module</span>.exports = globalConfig;</span><br></pre></td></tr></table></figure>
<p><br><br></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dunteng.github.io/[object Object]2019/10/01/使用http模块重构微型服务器.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dunteng Lin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunteng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]2019/10/01/使用http模块重构微型服务器.html" itemprop="url">使用http模块重构微型服务器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-01T00:00:00+08:00">
                2019-10-01
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]2019/10/01/使用http模块重构微型服务器.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/[object Object]2019/10/01/使用http模块重构微型服务器.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>之前写过一个用net模块构建的微型服务器，👉<a href="https://dunteng.github.io/[object%20Object]2019/09/30/%E5%86%99%E4%B8%80%E4%B8%AA%E5%BE%AE%E5%9E%8Bnode%E6%9C%8D%E5%8A%A1%E5%99%A8.html">链接</a></p>
<p>现在用http模块来重构一下。👉<a href="https://github.com/Dunteng/node.js/tree/master/http%E9%87%8D%E6%9E%84%E5%BE%AE%E5%9E%8B%E6%9C%8D%E5%8A%A1%E5%99%A8" target="_blank" rel="noopener">GitHub仓库</a></p>
<h2 id="http模块的初步使用"><a href="#http模块的初步使用" class="headerlink" title="http模块的初步使用"></a>http模块的初步使用</h2><p><strong>配置文件server.conf，用以配置服务器信息</strong>👇</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">port=<span class="number">12306</span></span><br><span class="line">page_path=page</span><br><span class="line">static_file_type=.html|.js|.css|.jpg|.png|.gif|.ico|.json</span><br></pre></td></tr></table></figure>
<p>其中的静态资源信息用以后面判断请求是静态资源还是动态资源。</p>
<p>静态资源主要就是一些写好固定的文件，比如写好的html文件、图片、css、js等，</p>
<p>动态资源就涉及到了可能会与业务逻辑处理有关，需要ajax处理或者涉及数据库，动态生成的数据。</p>
<p>这里我们暂且简化概念，把后缀名为<code>.html|.js|.css|.jpg|.png|.gif|.ico|.json</code>的路径请求视为静态数据，其余的视为动态。具体由不同的操作，下文会处理。</p>
<p><br></p>
<p><strong>配置文件处理config.js，用以处理配置文件信息</strong>👇</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> conf = fs.readFileSync(<span class="string">'./server.conf'</span>);</span><br><span class="line"><span class="comment">// console.log(typeof conf);//这哥们是个对象</span></span><br><span class="line"><span class="keyword">var</span> confArr = conf.toString().split(<span class="string">'\n'</span>);<span class="comment">//将conf字符串化后根据换行符分割成数组</span></span><br><span class="line"><span class="comment">// console.log(confArr);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> globalConfig = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> confArr) &#123;</span><br><span class="line">    <span class="keyword">var</span> itemArr = confArr[i].replace(<span class="regexp">/\s+/g</span>, <span class="string">""</span>).split(<span class="string">'='</span>);<span class="comment">//去掉所有空格并用'='拆分</span></span><br><span class="line">    <span class="comment">// console.log(itemArr);</span></span><br><span class="line">    globalConfig[itemArr[<span class="number">0</span>]] = itemArr[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (globalConfig.static_file_type) &#123;</span><br><span class="line">    globalConfig.static_file_type = globalConfig.static_file_type.split(<span class="string">"|"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"配置文件异常，缺少:static_file_type"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// console.log(globalConfig);</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = globalConfig;</span><br></pre></td></tr></table></figure>
<p>处理完配置文件后导出，长这个样子👇</p>
<p><img src="https://pic4.zhimg.com/v2-87d153cd7dc81bf29e2c1ccc5145f72b_r.jpg" alt=""></p>
<p><br></p>
<p><strong>duntengServer.js 服务器端文件</strong>👇</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> globalConfig = <span class="built_in">require</span>(<span class="string">'./config'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'新的连接已建立'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(request.url);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> urlObj = url.parse(request.url);</span><br><span class="line">    <span class="keyword">var</span> pathName = url.parse(request.url).pathname;</span><br><span class="line">    <span class="keyword">var</span> params = url.parse(request.url).query;</span><br><span class="line">    <span class="keyword">var</span> paramsObj = url.parse(request.url, <span class="literal">true</span>).query;</span><br><span class="line">    <span class="built_in">console</span>.log(urlObj);</span><br><span class="line">    <span class="built_in">console</span>.log(pathName);</span><br><span class="line">    <span class="built_in">console</span>.log(params);</span><br><span class="line">    <span class="built_in">console</span>.log(paramsObj);</span><br><span class="line">&#125;).listen(globalConfig.port);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(globalConfig);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是静态数据请求还是动态数据请求</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isStaticsRequest</span>(<span class="params">pathName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; globalConfig.static_file_type.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> temp = globalConfig.static_file_type[i];</span><br><span class="line">        <span class="keyword">if</span> (pathName.indexOf(temp) == pathName.length - temp.length) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来尝试启动它，浏览器访问<a href="http://127.0.0.1:12306/index.html?a=1&amp;b=3" target="_blank" rel="noopener">http://127.0.0.1:12306/index.html?a=1&amp;b=3</a></p>
<p>终端输出如下👇</p>
<p><img src="https://pic1.zhimg.com/v2-bccefe3e22d1c4410b99c644ccf30b68_r.jpg" alt=""></p>
<p><br></p>
<h2 id="处理静态数据请求"><a href="#处理静态数据请求" class="headerlink" title="处理静态数据请求"></a>处理静态数据请求</h2><p>从上一步可以得到浏览器的请求头信息，最主要的就是我们服务端知道了浏览器想要得到<code>index.html</code>的内容，并可以判断出是静态数据请求还是动态数据请求：</p>
<p><br></p>
<p>写个html文件<code>/page/login.html</code>👇</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">    &lt;script&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>script&gt;</span><br><span class="line">&lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp">&lt;body&gt;</span></span><br><span class="line"><span class="regexp">    &lt;h1&gt;hello man！&lt;/</span>h1&gt;</span><br><span class="line">    &lt;img src=<span class="string">"./cheng.png"</span> alt=<span class="string">""</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><strong>duntengServer.js</strong>👇</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> globalConfig = <span class="built_in">require</span>(<span class="string">'./config'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'新的连接已建立'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(request.url);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> urlObj = url.parse(request.url);</span><br><span class="line">    <span class="keyword">var</span> pathName = url.parse(request.url).pathname;</span><br><span class="line">    <span class="keyword">var</span> params = url.parse(request.url).query;</span><br><span class="line">    <span class="keyword">var</span> paramsObj = url.parse(request.url, <span class="literal">true</span>).query;</span><br><span class="line">    <span class="built_in">console</span>.log(urlObj);</span><br><span class="line">    <span class="built_in">console</span>.log(pathName);</span><br><span class="line">    <span class="built_in">console</span>.log(params);</span><br><span class="line">    <span class="built_in">console</span>.log(paramsObj);</span><br><span class="line">    <span class="built_in">console</span>.log(isStaticsRequest(pathName));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isStaticsRequest(pathName)) &#123;</span><br><span class="line">        <span class="comment">// 处理静态数据请求</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> dataFile = fs.readFileSync(globalConfig.page_path + pathName);</span><br><span class="line">            response.writeHead(<span class="number">200</span>);</span><br><span class="line">            response.write(dataFile)</span><br><span class="line">            response.end();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            response.writeHead(<span class="number">404</span>);</span><br><span class="line">            response.write(<span class="string">"&lt;html&gt;&lt;body&gt;&lt;h1&gt;404 NotFound&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"</span>);</span><br><span class="line">            response.end();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 处理动态数据请求</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'动态请求'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;).listen(globalConfig.port);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是静态数据请求还是动态数据请求</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isStaticsRequest</span>(<span class="params">pathName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; globalConfig.static_file_type.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> temp = globalConfig.static_file_type[i];</span><br><span class="line">        <span class="keyword">if</span> (pathName.indexOf(temp) == pathName.length - temp.length) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动duntengServer.js，浏览器访问&lt;<a href="http://127.0.0.1:12306/login.html" target="_blank" rel="noopener">http://127.0.0.1:12306/login.html</a></p>
<p>浏览器如下👇</p>
<p><img src="https://pic1.zhimg.com/v2-e26b850a27f3c42c88b6b5f91dd87c40_r.jpg" alt=""></p>
<p>在服务器终端打印出以下信息👇</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"> node duntengServer.js</span><br><span class="line">新的连接已建立</span><br><span class="line">/login.html</span><br><span class="line">Url &#123;</span><br><span class="line">  protocol: <span class="literal">null</span>,</span><br><span class="line">  slashes: <span class="literal">null</span>,</span><br><span class="line">  auth: <span class="literal">null</span>,</span><br><span class="line">  host: <span class="literal">null</span>,</span><br><span class="line">  port: <span class="literal">null</span>,</span><br><span class="line">  hostname: <span class="literal">null</span>,</span><br><span class="line">  hash: <span class="literal">null</span>,</span><br><span class="line">  search: <span class="literal">null</span>,</span><br><span class="line">  query: <span class="literal">null</span>,</span><br><span class="line">  pathname: <span class="string">'/login.html'</span>,</span><br><span class="line">  path: <span class="string">'/login.html'</span>,</span><br><span class="line">  href: <span class="string">'/login.html'</span> &#125;</span><br><span class="line">/login.html</span><br><span class="line"><span class="literal">null</span></span><br><span class="line">[<span class="built_in">Object</span>: <span class="literal">null</span> prototype] &#123;&#125;</span><br><span class="line"><span class="literal">true</span></span><br><span class="line">静态请求</span><br><span class="line">/login.html</span><br><span class="line">新的连接已建立</span><br><span class="line">/cheng.png</span><br><span class="line">Url &#123;</span><br><span class="line">  protocol: <span class="literal">null</span>,</span><br><span class="line">  slashes: <span class="literal">null</span>,</span><br><span class="line">  auth: <span class="literal">null</span>,</span><br><span class="line">  host: <span class="literal">null</span>,</span><br><span class="line">  port: <span class="literal">null</span>,</span><br><span class="line">  hostname: <span class="literal">null</span>,</span><br><span class="line">  hash: <span class="literal">null</span>,</span><br><span class="line">  search: <span class="literal">null</span>,</span><br><span class="line">  query: <span class="literal">null</span>,</span><br><span class="line">  pathname: <span class="string">'/cheng.png'</span>,</span><br><span class="line">  path: <span class="string">'/cheng.png'</span>,</span><br><span class="line">  href: <span class="string">'/cheng.png'</span> &#125;</span><br><span class="line">/cheng.png</span><br><span class="line"><span class="literal">null</span></span><br><span class="line">[<span class="built_in">Object</span>: <span class="literal">null</span> prototype] &#123;&#125;</span><br><span class="line"><span class="literal">true</span></span><br><span class="line">静态请求</span><br><span class="line">/cheng.png</span><br></pre></td></tr></table></figure>
<p>可见，每请求一次静态数据就会创建对应的http链接，这里一共建立了两个http请求链接，分别是对<code>login.html</code>和<code>cheng.png</code>的</p>
<p><br></p>
<h2 id="处理动态数据请求"><a href="#处理动态数据请求" class="headerlink" title="处理动态数据请求"></a>处理动态数据请求</h2><p>到这一步为止，就完成了对客户端请求静态数据的响应处理，接下来搞一下动态的数据请求处理。</p>
<p>这里以一个ajax请求为例子。</p>
<p><strong>page/login.js</strong>👇</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    xmlHttp = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    xmlHttp.open(<span class="string">"GET"</span>, <span class="string">"/getData"</span>, <span class="literal">true</span>);</span><br><span class="line">    xmlHttp.send(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    xmlHttp.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (xmlHttp.readyState == <span class="number">4</span> &amp;&amp; xmlHttp.status == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(xmlHttp.responseText);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">typeof</span> xmlHttp.responseText);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样<code>login.js</code>就触发了对<a href="http://127.0.0.1:12306/getData" target="_blank" rel="noopener">http://127.0.0.1:12306/getData</a>的请求，这个路径都不符合<code>server.conf</code>中对静态数据的限定，所以视为动态请求。</p>
<p>在<code>login.html</code>中引入<code>login.js</code>👇</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./login.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello man！<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./cheng.png"</span> <span class="attr">alt</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p><code>duntengServer.js</code>中处理动态数据请求，将其路径名称打印出来👇</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> globalConfig = <span class="built_in">require</span>(<span class="string">'./config'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'新的连接已建立'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(request.url);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> urlObj = url.parse(request.url);</span><br><span class="line">    <span class="keyword">var</span> pathName = url.parse(request.url).pathname;</span><br><span class="line">    <span class="keyword">var</span> params = url.parse(request.url).query;</span><br><span class="line">    <span class="keyword">var</span> paramsObj = url.parse(request.url, <span class="literal">true</span>).query;</span><br><span class="line">    <span class="built_in">console</span>.log(urlObj);</span><br><span class="line">    <span class="built_in">console</span>.log(pathName);</span><br><span class="line">    <span class="built_in">console</span>.log(params);</span><br><span class="line">    <span class="built_in">console</span>.log(paramsObj);</span><br><span class="line">    <span class="built_in">console</span>.log(isStaticsRequest(pathName));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isStaticsRequest(pathName)) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"静态请求"</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(pathName);</span><br><span class="line">        <span class="comment">// 处理静态数据请求</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> dataFile = fs.readFileSync(globalConfig.page_path + pathName);</span><br><span class="line">            response.writeHead(<span class="number">200</span>);</span><br><span class="line">            response.write(dataFile)</span><br><span class="line">            response.end();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            response.writeHead(<span class="number">404</span>);</span><br><span class="line">            response.write(<span class="string">"&lt;html&gt;&lt;body&gt;&lt;h1&gt;404 NotFound&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"</span>);</span><br><span class="line">            response.end();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 处理动态数据请求</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'动态请求'</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(pathName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;).listen(globalConfig.port);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是静态数据请求还是动态数据请求</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isStaticsRequest</span>(<span class="params">pathName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; globalConfig.static_file_type.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> temp = globalConfig.static_file_type[i];</span><br><span class="line">        <span class="keyword">if</span> (pathName.indexOf(temp) == pathName.length - temp.length) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动之，浏览器访问<a href="http://127.0.0.1:12306/login.html" target="_blank" rel="noopener">http://127.0.0.1:12306/login.html</a>，可以看到👇</p>
<p><img src="https://pic3.zhimg.com/v2-aaec8ec3106268c5e11d8e16f8c1a4aa_r.jpg" alt=""></p>
<p><img src="https://pic2.zhimg.com/v2-a123410cd6c292df40378871820c474d_r.jpg" alt=""></p>
<p>可以看到对动态请求的监测和处理是成功了。</p>
<h2 id="从duntengServer-js中抽离出业务处理代码"><a href="#从duntengServer-js中抽离出业务处理代码" class="headerlink" title="从duntengServer.js中抽离出业务处理代码"></a>从duntengServer.js中抽离出业务处理代码</h2><p>上文中客户端发起了数据请求，比如<code>login.html--&gt;login.js--&gt;ajax</code>我们直接在<code>duntengServer.js</code>中处理了针对它的业务处理（打印出了/getData的路径），<strong>但是</strong>这是不合适的，对于这种业务处理的代码应该交由<code>/web/loginController.js</code>来处理。所以应该在<code>/web/loginController.js</code>中写针对<code>login这一功能</code>的业务处理代码，然后在<code>duntengServer.js</code>中require这个<code>/web/loginController.js</code>。如下👇</p>
<p>📌<strong>/web/loginController.js</strong>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"666~"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    <span class="comment">// 或者是存储数据等其他什么操作，这里只以打印操作为例</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = getData;</span><br></pre></td></tr></table></figure>
<p>📌<strong>duntengServer.js</strong>：</p>
<p><img src="https://pic1.zhimg.com/v2-e2604cb1b573b9f6bbbb5baa6a011f7c_r.jpg" alt=""></p>
<p><img src="https://pic4.zhimg.com/v2-aec6bf41f5d6f24a4aa56b4734056c5f_r.jpg" alt=""></p>
<p><br></p>
<p>但是如果一个项目里面除了login，还有其他很多的业务操作，像上面这样子一个一个地往<code>duntengServer.js</code>里手动引入会很繁琐，所以要想办法自动引入👇</p>
<p><br></p>
<h2 id="进一步优化实现自动识别路径和处理方法的映射"><a href="#进一步优化实现自动识别路径和处理方法的映射" class="headerlink" title="进一步优化实现自动识别路径和处理方法的映射"></a>进一步优化实现自动识别路径和处理方法的映射</h2><p>项目分层架构</p>
<p><img src="https://pic3.zhimg.com/80/v2-c12a1ed050c3cb1a76ee6a9d67ff4a3a_hd.jpg" alt=""></p>
<p>📌创建一个<code>/loader.js</code>，它负责将<code>/web</code>下所有业务处理 js 文件中的路径与方法函数之间的映射存进一个Map中👇</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> globalConfig = <span class="built_in">require</span>(<span class="string">"./config"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pathMap = <span class="keyword">new</span> <span class="built_in">Map</span>();<span class="comment">//用于管理全局的路径请求和对应方法(操作)的映射</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> files = fs.readdirSync(globalConfig[<span class="string">'web_path'</span>]); <span class="comment">//读取出了web路径下的所有文件名</span></span><br><span class="line"><span class="comment">// console.log(files);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; files.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> temp = <span class="built_in">require</span>(<span class="string">'./'</span> + globalConfig[<span class="string">'web_path'</span>] + <span class="string">'/'</span> + files[i]);</span><br><span class="line">    <span class="keyword">if</span> (temp.path) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> [key, value] <span class="keyword">of</span> temp.path) &#123;</span><br><span class="line">            <span class="comment">// console.log("key为 " + key);</span></span><br><span class="line">            <span class="comment">// console.log("value为 " + value);</span></span><br><span class="line">            <span class="keyword">if</span> (pathMap.get(key) == <span class="literal">null</span>) &#123;</span><br><span class="line">                pathMap.set(key, value);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"重复设置了pathMap，key为"</span> + key + <span class="string">"的路径和方法的映射已存在，请检查你的代码是否针对"</span> + key + <span class="string">"路径设置了多个处理方法"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// console.log(pathMap);</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = pathMap;</span><br></pre></td></tr></table></figure>
<p>📌<strong>web/loginController.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    response.writeHead(<span class="number">200</span>);</span><br><span class="line">    response.write(<span class="string">"hey kong, can u hear me?"</span>);</span><br><span class="line">    response.end();</span><br><span class="line">&#125;</span><br><span class="line">path.set(<span class="string">"/getData"</span>, getData);</span><br><span class="line"><span class="built_in">module</span>.exports.path = path;</span><br></pre></td></tr></table></figure>
<p>📌<strong>web/test.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> path = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testA</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    response.writeHead(<span class="number">200</span>);</span><br><span class="line">    response.write(<span class="string">"This is testA"</span>);</span><br><span class="line">    response.end();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testB</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    response.writeHead(<span class="number">200</span>);</span><br><span class="line">    response.write(<span class="string">"This is testB"</span>);</span><br><span class="line">    response.end();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">path.set(<span class="string">"/testA"</span>, testA);</span><br><span class="line">path.set(<span class="string">"/testB"</span>, testB);</span><br><span class="line"><span class="built_in">module</span>.exports.path = path;</span><br></pre></td></tr></table></figure>
<p>📌<strong>duntengServer.js</strong></p>
<p><img src="https://pic4.zhimg.com/v2-dce9c3e212881c762a5138e7b071ab5f_r.jpg" alt=""></p>
<p><img src="https://pic1.zhimg.com/v2-1ac404b18f188fb7a4aeb3278872e8f8_r.jpg" alt=""></p>
<p>启动服务器duntengServer.js，浏览器访问<a href="http://127.0.0.1:12306/login.html" target="_blank" rel="noopener">http://127.0.0.1:12306/login.html</a>👇</p>
<p><img src="https://pic3.zhimg.com/v2-0271a7f2b65255a6271bd897ccc6e056_r.jpg" alt=""></p>
<p><img src="https://pic4.zhimg.com/v2-a9cc15570463bcd4f0990170e0e7dd2b_r.jpg" alt=""></p>
<p><img src="https://pic2.zhimg.com/v2-096a3a28f5252ad840ea67cf43d99ae9_r.jpg" alt=""></p>
<p><br>浏览器访问<a href="http://127.0.0.1:12306/testA" target="_blank" rel="noopener">http://127.0.0.1:12306/testA</a>和&lt;<a href="http://127.0.0.1:12306/testB" target="_blank" rel="noopener">http://127.0.0.1:12306/testB</a>  👇</p>
<p><img src="https://pic1.zhimg.com/v2-f2b1bfe8ff194a6a0529face2f7dc03c_r.jpg" alt=""></p>
<p><img src="https://pic4.zhimg.com/v2-e733e42fed98df821d04c6ecc97ee5a3_r.jpg" alt=""></p>
<p><br><br></p>
<h2 id="生成运行日志"><a href="#生成运行日志" class="headerlink" title="生成运行日志"></a>生成运行日志</h2><p>📌 <strong>log.js</strong>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> globalConfig = <span class="built_in">require</span>(<span class="string">"./config"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fileName = globalConfig.log_path + globalConfig.log_name;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> time = <span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString();</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    fs.appendFile(fileName, time + <span class="string">"  "</span> + data + <span class="string">"\n"</span>, &#123; <span class="attr">flag</span>: <span class="string">"a"</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = log;</span><br></pre></td></tr></table></figure>
<p>在<code>duntengServer.js</code>中引用<code>log.js</code>，在服务启动的时候调用log函数进行日志的更新写入。</p>
<p><br><br></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dunteng.github.io/[object Object]2019/10/01/MySQL基本的增删改查操作.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dunteng Lin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunteng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]2019/10/01/MySQL基本的增删改查操作.html" itemprop="url">MySQL基本的增删改查操作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-01T00:00:00+08:00">
                2019-10-01
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]2019/10/01/MySQL基本的增删改查操作.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/[object Object]2019/10/01/MySQL基本的增删改查操作.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://pic1.zhimg.com/v2-8dc902e921dfc2f2d189f2940dbbc3a7_1200x500.jpg" alt=""></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//增</span></span><br><span class="line">insert into student(name, age, stu_num, <span class="class"><span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">value</span> ('卡卡西',28,6600,1)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//改</span></span><br><span class="line">update student set name=<span class="string">'鸣人'</span> where id = <span class="number">1</span>;</span><br><span class="line">update student set name = <span class="string">'佐助'</span>, age=<span class="number">18</span>, stu_num=<span class="number">6631</span>, <span class="class"><span class="keyword">class</span></span>=<span class="number">1</span> where id = <span class="number">2</span>;</span><br><span class="line">update student</span><br><span class="line">set  id = <span class="number">3</span>, age=<span class="number">18</span>, stu_num=<span class="number">6632</span>, <span class="class"><span class="keyword">class</span></span>=<span class="number">1</span></span><br><span class="line">where name=<span class="string">'小樱'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查</span></span><br><span class="line">select * <span class="keyword">from</span> student;  <span class="comment">/*查询表中所有人*/</span></span><br><span class="line"></span><br><span class="line">select  name,age <span class="keyword">from</span> student;  <span class="comment">/*查询表中所有人的名字和年龄*/</span></span><br><span class="line"></span><br><span class="line">select * <span class="keyword">from</span> student where age = <span class="number">18</span>; <span class="comment">/*查询年龄为18的所有人*/</span></span><br><span class="line"></span><br><span class="line">select count(<span class="number">1</span>) <span class="keyword">from</span> student; <span class="comment">/*查询表中所有记录条数（在这里就是表中所有人总数）*/</span></span><br><span class="line"></span><br><span class="line">select count(<span class="number">1</span>) <span class="keyword">from</span> student where age=<span class="number">18</span>; <span class="comment">/*查询表中年龄为18的人数*/</span></span><br><span class="line"></span><br><span class="line">select sum(age) <span class="keyword">from</span> student; <span class="comment">/* 所有人的年龄加起来的总数*/</span></span><br><span class="line"></span><br><span class="line">select avg(age) <span class="keyword">from</span> student;<span class="comment">/*求所有人的平均年龄*/</span></span><br><span class="line"></span><br><span class="line">select  avg(age) <span class="keyword">as</span> avg_age <span class="keyword">from</span> student; <span class="comment">/*给平均数设置别名*/</span></span><br><span class="line"></span><br><span class="line">select <span class="class"><span class="keyword">class</span>, <span class="title">count</span>(1) <span class="title">from</span> <span class="title">student</span> <span class="title">group</span> <span class="title">by</span> <span class="title">class</span></span>; <span class="comment">/*查询每班各有多少人，使用了group by进行分组*/</span></span><br><span class="line"></span><br><span class="line">select name, <span class="class"><span class="keyword">class</span> <span class="title">from</span> <span class="title">student</span> <span class="title">where</span> <span class="title">age</span>!</span>=<span class="number">18</span> and <span class="class"><span class="keyword">class</span></span>=<span class="number">3</span>; <span class="comment">/* 多个条件使用and */</span></span><br><span class="line">select name, <span class="class"><span class="keyword">class</span> <span class="title">from</span> <span class="title">student</span> <span class="title">where</span> <span class="title">age</span></span>=<span class="number">18</span> or stu_num&gt;<span class="number">6640</span>; <span class="comment">/* 或操作使用or */</span></span><br><span class="line"></span><br><span class="line">select * <span class="keyword">from</span> student limit <span class="number">2</span>; <span class="comment">/* 只取前两条记录*/</span></span><br><span class="line"></span><br><span class="line">select * <span class="keyword">from</span> student limit <span class="number">5</span>,<span class="number">3</span>; <span class="comment">/* 前5条记录不看，从第6条记录看起，取出3条记录*/</span></span><br><span class="line"></span><br><span class="line">select * <span class="keyword">from</span> student order by id; <span class="comment">/* 以id进行正序排列 */</span></span><br><span class="line">select * <span class="keyword">from</span> student order by id desc ; <span class="comment">/* 倒序排列 */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//删</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> student;  <span class="comment">/*删除整个表。危险！！！*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> student where name=<span class="string">'卡卡西'</span>;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dunteng.github.io/[object Object]2019/09/30/net模块写微型node服务器.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dunteng Lin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunteng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]2019/09/30/net模块写微型node服务器.html" itemprop="url">写一个微型node服务器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-30T00:00:00+08:00">
                2019-09-30
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]2019/09/30/net模块写微型node服务器.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/[object Object]2019/09/30/net模块写微型node服务器.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p><a href="https://github.com/Dunteng/node.js/tree/master/net%E5%BE%AE%E5%9E%8B%E6%9C%8D%E5%8A%A1%E5%99%A8" target="_blank" rel="noopener">https://github.com/Dunteng/node.js/tree/master/net%E5%BE%AE%E5%9E%8B%E6%9C%8D%E5%8A%A1%E5%99%A8</a></p>
<p><br><br></p>
<h2 id="基础demo"><a href="#基础demo" class="headerlink" title="基础demo"></a>基础demo</h2><p>我们可以使用浏览器来对Server建立连接并发送请求。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//server.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">"net"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = net.createServer();</span><br><span class="line">server.listen(<span class="number">12306</span>, <span class="string">"127.0.0.1"</span>);</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">"listening"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"服务已启动"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">"connection"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">socket</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"有新的连接"</span>);</span><br><span class="line">    socket.on(<span class="string">"data"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data.toString());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><br>开启server服务，然后在浏览器访问<code>127.0.0.0:12306</code>，可以看到打印出了data，而这个data就是请求头👇</p>
<p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1571650335272.png" alt="1571650335272"></p>
<p><br></p>
<p>模拟获取请求头数据和设置响应头👇</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">"net"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = net.createServer();</span><br><span class="line">server.listen(<span class="number">12306</span>, <span class="string">"127.0.0.1"</span>);</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">"listening"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"服务已启动"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">"connection"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">socket</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"有新的连接"</span>);</span><br><span class="line">    socket.on(<span class="string">"data"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data.toString());</span><br><span class="line">        <span class="keyword">var</span> request = data.toString().split(<span class="string">"\r\n"</span>);</span><br><span class="line">        <span class="keyword">var</span> url = request[<span class="number">0</span>].split(<span class="string">" "</span>)[<span class="number">1</span>];</span><br><span class="line">        <span class="built_in">console</span>.log(url);</span><br><span class="line">        socket.write(<span class="string">"HTTP 200OK\r\nContent-type:text/html\r\nServer:DWS/1.1\r\n\r\n&lt;html&gt;&lt;body&gt;hello browser&lt;/body&gt;&lt;/html&gt;"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1571651223434.png" alt="1571651223434"></p>
<p><br></p>
<p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1571651233360.png" alt="1571651233360"></p>
<p><br></p>
<p>💡到了这一步，我们可以进一步实现平时看到的网站响应的效果：</p>
<p>​    新建一个<code>index.html</code>文件，我们通过浏览器访问<a href="http://127.0.0.1:12306/index" target="_blank" rel="noopener">http://127.0.0.1:12306/index</a>，然后服务端解析请求头截取到<code>index</code>字段，通过这个字段知道服务端要响应出<code>index.html</code>的数据。怎么获取到目标文件的内容，这就涉及到了读写文件的操作了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">"net"</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = net.createServer();</span><br><span class="line">server.listen(<span class="number">12306</span>, <span class="string">"127.0.0.1"</span>);</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'listening'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'服务启动了'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">socket</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'有新的连接建立了'</span>);</span><br><span class="line"></span><br><span class="line">    socket.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data.toString());</span><br><span class="line">        <span class="keyword">var</span> request = data.toString().split(<span class="string">'\r\n'</span>);</span><br><span class="line">        <span class="keyword">var</span> url = request[<span class="number">0</span>].split(<span class="string">" "</span>)[<span class="number">1</span>];</span><br><span class="line">        <span class="built_in">console</span>.log(url);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> dataFile = fs.readFileSync(__dirname + url);</span><br><span class="line">            <span class="comment">// console.log(dataFile.toString());</span></span><br><span class="line">            socket.write(<span class="string">"HTTP 200OK\r\nContent-type:text/html\r\nServer:DWS/1.1\r\n\r\n"</span>);</span><br><span class="line">            socket.write(dataFile)  <span class="comment">//socket分成两部写，避免dataFile被字符串化</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            socket.write(<span class="string">"HTTP 404NotFound\r\nContent-type:text/html\r\nServer:DWS/1.1\r\n\r\n&lt;html&gt;&lt;body&gt;&lt;h1&gt;&lt;/h1&gt;404 Not Found&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        socket.end();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><br>运行<code>node server.js</code>，在浏览器访问<a href="http://127.0.0.1:12306/index.html就可以显示出`index.html`中的页面，如果访问的页面不存在会显示404页面。" target="_blank" rel="noopener">http://127.0.0.1:12306/index.html就可以显示出`index.html`中的页面，如果访问的页面不存在会显示404页面。</a></p>
<p><br><br></p>
<h2 id="微型服务器的编写"><a href="#微型服务器的编写" class="headerlink" title="微型服务器的编写"></a>微型服务器的编写</h2><p>在此基础上进行配置文件的编写，从而构建一个node.js微型服务器👇</p>
<ul>
<li>server.conf   配置文件，在里面写入要打开的文件的路径，相对路径和绝对路径都可。</li>
<li>conf.js   处理配置信息，暴露出一个全局的配置</li>
<li>newserver.js  服务端代码</li>
</ul>
<p>运行<code>node newserver.js</code>服务器，在浏览器打开<a href="http://127.0.0.1:12306/index.html" target="_blank" rel="noopener">http://127.0.0.1:12306/index.html</a>即可成功访问。</p>
<p>代码实现见文首GitHub链接。</p>
<p><br><br></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dunteng.github.io/[object Object]2019/09/25/新linux学习.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dunteng Lin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunteng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]2019/09/25/新linux学习.html" itemprop="url">虚拟机安装centos7和node</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-25T00:00:00+08:00">
                2019-09-25
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]2019/09/25/新linux学习.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/[object Object]2019/09/25/新linux学习.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>【外部文章】：</p>
<ul>
<li>我的Linux基础整理网站👉<a href="https://rockdunteng.github.io/LinuxStudy/index.html" target="_blank" rel="noopener">rockdunteng</a></li>
</ul>
<h2 id="虚拟机安装centos7"><a href="#虚拟机安装centos7" class="headerlink" title="虚拟机安装centos7"></a>虚拟机安装centos7</h2><ul>
<li><p><a href="https://www.cnblogs.com/lynn-li/p/6077944.html" target="_blank" rel="noopener">参考文章</a></p>
</li>
<li><p>我安装的是迷你版，没有桌面系统，纯命令模式。</p>
</li>
<li><p>之后我们会搭建小型的集群</p>
<p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1560265774418.png" alt="1560265774418"></p>
<p><br>现实项目中的全栈过程👇</p>
<p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1571589448636.png" alt="1571589448636"></p>
<p><br>推荐的虚拟机内存配置：</p>
<ul>
<li>最好就是16G内存，随便配；但是老子是8G，往下看</li>
<li>proxy代理服务器：512</li>
<li>Service服务器： 1024</li>
<li>Cache缓存服务器： 1024</li>
<li>Database服务器： 1024</li>
<li>Release服务器： 1024/512</li>
</ul>
</li>
</ul>
<p><br><br></p>
<h2 id="桥接网络设置"><a href="#桥接网络设置" class="headerlink" title="桥接网络设置"></a>桥接网络设置</h2><ul>
<li><p>设置的是桥接网络，为了是不与宿主机共享同一网络。这时是无法上网的，需要进行下面的配置：</p>
<ul>
<li><p>进入路径<code>/etc/sysconfig/network-scripts</code>，修改<code>ifcfg-ens33</code>文件，将末行的<code>ONBOOT=no</code>改为<code>yes</code>。</p>
<p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1571577252621.png" alt="1571577252621"></p>
</li>
<li><p>重启系统<code>reboot</code>。然后尝试<code>ping</code>功能，发现可以<code>ping</code>通即可。</p>
</li>
<li><p>如果还是ping不通，见这两篇文章👉   <a href="https://blog.csdn.net/bob_666/article/details/81412242" target="_blank" rel="noopener">一</a>   <a href="https://jingyan.baidu.com/article/f7ff0bfc7859502e26bb1328.html" target="_blank" rel="noopener">二</a></p>
</li>
<li><p>这里我平时用的是校园网，是无法桥接成功的。所以我改用手机热点wifi，并把网卡换成相应的无线网卡。</p>
</li>
<li><p>注意，我用热点的时候网速很慢，当要下载东西的时候最好切换回nat模式连接网络。</p>
</li>
</ul>
</li>
</ul>
<p><br><br></p>
<h2 id="安装wget和node"><a href="#安装wget和node" class="headerlink" title="安装wget和node"></a>安装wget和node</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum install wget		//用于网络请求</span><br><span class="line"></span><br><span class="line">wget https://nodejs.org/dist/v10.16.0/node-v10.16.0-linux-x64.tar.xz    //安装node压缩包</span><br><span class="line"></span><br><span class="line">xz -d node-v10.16.0-linux-x64.tar.xz      //解压成node-v10.16.0-linux-x64.tar</span><br><span class="line"></span><br><span class="line">tar -xf node-v10.16.0-linux-x64.tar      //解压成node-v10.16.0-linux-x64文件夹</span><br></pre></td></tr></table></figure>
<p><br>安装成功之后在本路径下查看：</p>
<p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1560361705831.png" alt="1560361705831"></p>
<p><br>通过<code>ll</code>指令可以看到多了node的安装包，之后通过<code>xz -d</code>指令解压得到.tar<br>的压缩包，再通过<code>tar -xf</code>指令解压得到node-v10.16.0-linux-x64的文件夹。</p>
<p><br><br></p>
<h2 id="创建node软连接（快捷方式）"><a href="#创建node软连接（快捷方式）" class="headerlink" title="创建node软连接（快捷方式）"></a>创建node软连接（快捷方式）</h2><p>目前node安装在了root的用户目录下，没有放在<code>/usr/bin</code>下，所以需要创建一个软连接到<code>/usr/bin</code>下。</p>
<p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1560527054649.png" alt="1560527054649"></p>
<p><br>定位到/usr/bin路径下，这个文件夹下有很多可执行的程序。上面绿色的就是代表可执行程序，浅蓝色的是链接，连接到指定的程序，有点类似win下的快捷方式。</p>
<p>我们进入node/bin文件夹里面，可以看到有<code>node</code>，<code>npm</code>，<code>npx</code>等可执行程序，这就是我们之前常用到的node命令。</p>
<p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1560527879178.png" alt="1560527879178"></p>
<p>为了使得node指令在全局范围下都可以使用，我们需要把上述的node可执行程序放到/usr/bin/文件夹中。怎么实现呢？我们做个<strong>软连接</strong>而不是真的把文件放到那里面去。</p>
<p><br></p>
<ul>
<li><p>node</p>
<p>使用指令<code>ln -s ~/node-v10.16.0-linux-x64/bin/node /usr/bin/node</code>将原本node-xxx/bin/文件夹中的node可执行程序软连接到了/usr/bin/node文件夹中，可以看到在用户根目录路径下就可以使用node指令了</p>
<p> <img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1560528488411.png" alt="1560528488411"><br></p>
</li>
<li><p>npm和npx</p>
<p>同样地搞一下npm和npx</p>
<p>通过检查版本可以看到，这时已经可以在全局下使用node、npm、npx了：</p>
<p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1571587193826.png" alt="1571587193826"></p>
</li>
</ul>
<p>  <br>这时再到/usr/bin/路径下输入<code>ls</code>指令就能看到我们链接的三个程序，使用<code>shift+PgUp</code> 向前翻看,一般翻13页左右。<code>shift+PgDown</code>向后翻看,一般翻13页左右。</p>
<p>  <img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/blog/1560529922036.png" alt="1560529922036"></p>
<p>  <br></p>
<p><br></p>
<h2 id="FHS-文件系统层次化标准"><a href="#FHS-文件系统层次化标准" class="headerlink" title="FHS(文件系统层次化标准)"></a>FHS(文件系统层次化标准)</h2><p><img src="https://oscimg.oschina.net/oscnet/719336e7cbb111e832a03c95075d32701fa.jpg" alt=""></p>
<p><br></p>
<p>/home和/root的区别：实际上，linux与windows的分区都有主分区，扩展分区，逻辑分区，只是他们的目录结构不一样，windows为森林型目录结构，他可以有很多的跟，如C，D，E，F都是他的根目录，而linux中是一个树形机构，他只有一个根目录那就是 / ,然后在他下面有子目录/root  /home  /etc /bin 等，你可以将各个子目录单独挂载到一个分区，而其中的/root 相当于是linux超级权限用户root的家目录，而/home/XXX(用户名)这是普通用户的家目录，当新建一个普通用户时候，那么在/home 目录下就有一个对应的/home/XX 路径，用来存放用户的主目录</p>
<p><br><br></p>
<h2 id="使用xshell"><a href="#使用xshell" class="headerlink" title="使用xshell"></a>使用xshell</h2><p>虚拟机的终端不支持复制粘贴，不太方便，所以可以使用xshell远程连接上虚拟机，通过xshell来执行操作。</p>
<p><br><br></p>
<h2 id="node服务器初试"><a href="#node服务器初试" class="headerlink" title="node服务器初试"></a>node服务器初试</h2><p>找个目录，我随便在<code>/home/test</code>下新建了一个<code>test.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">	res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-Type"</span>:<span class="string">"text/plain"</span>&#125;);</span><br><span class="line">	res.end(<span class="string">"hello world"</span>);</span><br><span class="line">&#125;</span><br><span class="line">http.createServer(hello).listen(<span class="number">12306</span>,<span class="string">"192.168.171.134"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"hello world"</span>);</span><br></pre></td></tr></table></figure>
<p>【注意】：</p>
<ul>
<li>通过<code>ip addr</code>查看IP地址，然后用xshell远程连接之。</li>
<li>代码中的IP地址即为centos的IP地址，开启端口为12306</li>
<li>在<code>/home/test</code>下执行<code>node test.js</code>指令就开启了node服务器。</li>
<li>然后要<strong>关闭centos的防火墙</strong>。<code>systemctl disable firewalld</code>，然后<code>reboot</code>重启之。</li>
<li>这下子就可以在浏览器中访问到<code>http://192.168.171.134:12306/</code>了，页面显示<code>res.end</code>中的内容。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dunteng.github.io/[object Object]2019/09/01/Linux基础入门.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dunteng Lin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunteng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]2019/09/01/Linux基础入门.html" itemprop="url">Linux基础入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-01T00:00:00+08:00">
                2019-09-01
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]2019/09/01/Linux基础入门.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/[object Object]2019/09/01/Linux基础入门.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><br><br><br></p>
<p>点击此处跳转👉  <a href="https://rockdunteng.github.io/LinuxStudy/index.html" target="_blank" rel="noopener">Linux笔记</a></p>
<p><br><br><br></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dunteng.github.io/[object Object]2019/08/09/vue知识点.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dunteng Lin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunteng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]2019/08/09/vue知识点.html" itemprop="url">Vue基础笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-09T13:27:31+08:00">
                2019-08-09
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]2019/08/09/vue知识点.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/[object Object]2019/08/09/vue知识点.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p style="color:red">【复习本篇笔记时一边看源码】</p>

<p><a href="https://github.com/rockdunteng/rockdunteng.github.io/tree/master/note/vue/%E6%B8%A1%E4%B8%80%E6%96%B0Vue%E6%BA%90%E7%A0%81" target="_blank" rel="noopener">https://github.com/rockdunteng/rockdunteng.github.io/tree/master/note/vue/%E6%B8%A1%E4%B8%80%E6%96%B0Vue%E6%BA%90%E7%A0%81</a><br><br><br></p>
<h1 id="一、Vue前导"><a href="#一、Vue前导" class="headerlink" title="一、Vue前导"></a>一、Vue前导</h1><p>Vue的优点：</p>
<ol>
<li>减少dom操作，性能更好</li>
<li>视图、数据分离</li>
<li>维护成本低</li>
</ol>
<p>点击该<a href="https://rockdunteng.github.io/note/vue/vue%E7%9A%84%E4%BC%98%E7%82%B9.pdf" target="_blank" rel="noopener">pdf</a>查看详情</p>
<p><br><br><br></p>
<h1 id="二、数据绑定与视图渲染"><a href="#二、数据绑定与视图渲染" class="headerlink" title="二、数据绑定与视图渲染"></a>二、数据绑定与视图渲染</h1><p>使用“Mustache”语法 (双花括号)插值表达式渲染视图。</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564215958637.png" alt="1564215958637"></p>
<p><br><br></p>
<h2 id="数据要先存在，才能实现数据绑定"><a href="#数据要先存在，才能实现数据绑定" class="headerlink" title="数据要先存在，才能实现数据绑定"></a><strong>数据要先存在，才能实现数据绑定</strong></h2><p>在下图所示中，可以通过<code>vm.name</code>的方式进行数据的获取和修改，数据修改的同时，视图也随之改变，如本例中的<code>name</code>的值由jimmy变成了tony，视图立即随之改变。但是当<code>vm.obj.xx=12</code>时，虽然<code>vm.obj.xx</code>成功创建了，但是视图没有随之渲染。</p>
<p>因为在 Vue 中，<strong>数据要先存在，才能实现数据绑定，从而渲染视图</strong></p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564212932741.png" alt="1564212932741"></p>
<p><br><br></p>
<h2 id="通过索引的方式修改数组，或通过修改数组长度的方式修改数组，都无法重新渲染视图"><a href="#通过索引的方式修改数组，或通过修改数组长度的方式修改数组，都无法重新渲染视图" class="headerlink" title="通过索引的方式修改数组，或通过修改数组长度的方式修改数组，都无法重新渲染视图"></a>通过<strong>索引的方式</strong>修改数组，或通过<strong>修改数组长度的方式</strong>修改数组，都无法重新渲染视图</h2><p> <img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564213382860.png" alt="1564213382860"></p>
<p><br><br></p>
<h2 id="数组变异方法"><a href="#数组变异方法" class="headerlink" title="数组变异方法"></a>数组变异方法</h2><p>发现使用数组方法时，就会触发视图重新渲染。</p>
<p>Vue的数据绑定是通过<strong>数据劫持</strong>来实现的，在数据劫持的时候通过<strong>索引修改数组</strong>或者<strong>通过修改数组长度来修改数组</strong>是无法被感知的，Vue在设计的时候通过<strong>修改数组的一些方法</strong>，在这些方法里面添加了一个<strong>更新视图的方法的执行</strong>，所以当我们调用这些数组的方法的时候可以触发更新视图方法，从而更新视图。这些数组的方法在vue中被称为<strong>数组变异方法</strong>。这些方法已经不是原生的 js 方法了，是被 Vue 改写了，让它能有一个重新渲染视图的功能。</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564214165792.png" alt="1564214165792"></p>
<p><br><br></p>
<p>Vue 有以下7中变异方法</p>
<ul>
<li><code>push()</code>        往数组最后面添加一个元素，成功返回当前数组的长度 </li>
<li><code>pop()</code>             删除数组的最后一个元素，成功返回删除元素的值 </li>
<li><code>shift()</code>          删除数组的第一个元素，成功返回删除元素的值 </li>
<li><code>unshift()</code>      往数组最前面添加一个元素，成功返回当前数组的长度 </li>
<li><code>splice()</code>        有三个参数，第一个是想要删除的元素的下标（必选），第二个是想要删除的个数（必选），                     第三个是删除后想要在原位置替换的值（可选） </li>
<li><code>sort()</code>             使数组按照字符编码默认从小到大排序,成功返回排序后的数组 </li>
<li><code>reverse()</code>           将数组倒序，成功返回倒序后的数组 </li>
</ul>
<p><br><br></p>
<h2 id="set方法"><a href="#set方法" class="headerlink" title="$set方法"></a>$set方法</h2><p>$set方法可以<strong>解决对象中未存在数据的数据绑定问题</strong>。</p>
<p>可以实现视图的实时更新。</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564216195094.png" alt="1564216195094"></p>
<p><br><br></p>
<h2 id="el"><a href="#el" class="headerlink" title="$el"></a>$el</h2><p>Vue实例vm中有一个 $el 属性，它能指向挂载 Vue 的Dom结构。</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564217181273.png" alt="1564217181273"><br></p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564217272687.png" alt="1564217272687"></p>
<p><br>上图一共修改了 name 三次，修改了 age 两次，最后一行代码是打印 <code>$el.innerText</code>，但是这五次的数据修改是<strong>异步</strong>的，结果就是是先打印了一开始的 <code>$el.innerText</code>:</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564217455589.png" alt="1564217455589"></p>
<p><br>这样导致我们无法打印获取到数据更改后的<code>$el.innerText</code>，如何解决，看下面的 <code>$nextTick</code></p>
<p><br><br></p>
<h2 id="nextTick"><a href="#nextTick" class="headerlink" title="$nextTick"></a>$nextTick</h2><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564217936576.png" alt="1564217936576"></p>
<p>它会在数据都修改完成并且重新渲染到页面上之后才执行里面的函数。这样就能获取到数据更改后的dom。</p>
<p><br><br></p>
<h2 id="mount"><a href="#mount" class="headerlink" title="$mount"></a>$mount</h2><p>创建 Vue 实例的时候可以不写 <code>el: &#39;#app&#39;</code>, 使用 <code>$mount</code>也能实现同样的效果。</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564218209720.png" alt="1564218209720"></p>
<p><br><br></p>
<h2 id="refs"><a href="#refs" class="headerlink" title="$refs"></a>$refs</h2><p>在元素标签上使用<code>ref</code>来标记，然后通过<code>$refs</code>来获取到标记的引用：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567579888756.png" alt="1567579888756"></p>
<p><br>注意的是，不能重复标记相同名称，相同名称的 ref 只会覆盖为最后一个：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567580190773.png" alt="1567580190773"></p>
<p><br>但是，如果是用 v-for 的方式来循环标记，则不会发生覆盖，会得到一个数组：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567580308732.png" alt="1567580308732"></p>
<p>ref 除了可以标记 dom 元素，还可以标记组件。如果在普通的 DOM 元素上使用，引用指向的就是 DOM 元素；如果用在子组件上，引用就指向组件实例。下文讲组件传值时会讲到。</p>
<p> <br><br><br></p>
<h1 id="三、Vue-指令"><a href="#三、Vue-指令" class="headerlink" title="三、Vue 指令"></a>三、Vue 指令</h1><h2 id="v-pre、v-cloak和v-once指令"><a href="#v-pre、v-cloak和v-once指令" class="headerlink" title="v-pre、v-cloak和v-once指令"></a>v-pre、v-cloak和v-once指令</h2><h3 id="v-pre指令"><a href="#v-pre指令" class="headerlink" title="v-pre指令"></a>v-pre指令</h3><p>在模板中跳过vue的编译，直接输出原始值。就是在标签中加入v-pre就不会输出vue中的data值了。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-pre</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这时并不会输出我们的message值，而是直接在网页中显示<code></code><br></p>
<h3 id="v-cloak指令"><a href="#v-cloak指令" class="headerlink" title="v-cloak指令"></a>v-cloak指令</h3><p>在vue渲染完指定的整个DOM后才进行显示。它必须和CSS样式一起使用，</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[v-cloak]</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="selector-tag">div</span> <span class="selector-tag">v-cloak</span>&gt;</span><br><span class="line">  &#123;&#123; message &#125;&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="v-once指令"><a href="#v-once指令" class="headerlink" title="v-once指令"></a>v-once指令</h3><p>在第一次DOM时进行渲染，渲染完成后视为静态内容，跳出以后的渲染过程。</p>
<p><br></p>
<h2 id="其他常用指令"><a href="#其他常用指令" class="headerlink" title="其他常用指令"></a>其他常用指令</h2><p>还有 v-html、v-text、v-if、v-else-if、v-else、v-show等，具体见旧版笔记。</p>
<p><br><br></p>
<h2 id="xss攻击"><a href="#xss攻击" class="headerlink" title="xss攻击"></a>xss攻击</h2><p>讲到 v-html 的时候，提到了<strong>XSS攻击</strong>，了解一下。</p>
<p><a href="https://github.com/lynnic26/LynnNote/issues/1" target="_blank" rel="noopener">https://github.com/lynnic26/LynnNote/issues/1</a></p>
<p><br><br></p>
<h2 id="v-bind和v-on"><a href="#v-bind和v-on" class="headerlink" title="v-bind和v-on"></a>v-bind和v-on</h2><p><code>&lt;img v-bind:src=&quot;imgUrl&quot; alt=&quot;&quot;&gt;</code>中的<code>v-bind</code>可以简写为<code>&lt;img :src=&quot;imgUrl&quot; alt=&quot;&quot;&gt;</code></p>
<p><br><br></p>
<h3 id="绑定class"><a href="#绑定class" class="headerlink" title="绑定class"></a>绑定class</h3><ol>
<li><p>使用 <strong>:class</strong> 来绑定类名：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">style</span>&gt;</span><br><span class="line">    <span class="selector-class">.red</span> &#123;</span><br><span class="line">        <span class="attribute">color</span>: red</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;p :class=&apos;redClass&apos;&gt;peace!&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">   </span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var vm = new Vue(&#123;</span><br><span class="line">        data: &#123;</span><br><span class="line">            redClass: &apos;red&apos;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">   </span><br><span class="line">    vm.$mount(&apos;#app&apos;)</span><br><span class="line">   </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>这样 p 标签就添加上了一个名为 red 的类了。<br><br></p>
</li>
</ol>
<ol start="2">
<li><p>结合<strong>数组</strong>方式绑定类名：</p>
<p>如果想要给一个标签绑定多个类名，</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564384342505.png" alt="1564384342505"></p>
<p>正确方式是使用【数组】：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">:class</span>=<span class="string">"[redClass, bigClass]"</span>&gt;</span>peace!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>​    还可以在数组中进行判断运算：</p>
<p>​    <img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564385335421.png" alt="1564385335421"></p>
<p><br></p>
<ol start="3">
<li><p>结合<strong>对象</strong>绑定class：    </p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564386032576.png" alt="1564386032576"></p>
<p>也可以这样：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564386210997.png" alt="1564386210997"></p>
</li>
</ol>
<p><br><br></p>
<h3 id="绑定style"><a href="#绑定style" class="headerlink" title="绑定style"></a>绑定style</h3><p>将样式写进一个对象花括号里面，注意键值对中的值要用引号包起来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p :style=&quot;&#123;width:&apos;100px&apos;,height:&apos;200px&apos;,backgroundColor:&apos;red&apos;&#125;&quot;&gt;&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<p>也可以在data中写样式对象，然后用<code>:style</code>绑定，这样比较清晰：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564386818920.png" alt="1564386818920"></p>
<p>如果想要给一个标签绑定上多个样式对象，需要使用数组：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564387087174.png" alt="1564387087174"></p>
<p>注意一点是在一个标签内部，<code>style</code>的权重低于<code>:style</code>的权重，先执行style的样式，然后再执行<code>:style</code>的样式，遇到相同的backgroundColor<code>:style</code>的样式会覆盖<code>style</code>的。</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1564387434614.png" alt="1564387434614"></p>
<p>p 的背景颜色为red</p>
<p><br><br></p>
<h2 id="v-for"><a href="#v-for" class="headerlink" title="v-for"></a>v-for</h2><p><br><br></p>
<h2 id="v-model"><a href="#v-model" class="headerlink" title="v-model"></a>v-model</h2><p>实现双向数据绑定</p>
<p>可以实现 v-model 的表单元素：</p>
<ul>
<li>input text</li>
<li>input checkbox</li>
<li>input radio</li>
<li>textarea</li>
<li>select</li>
</ul>
<p>【这部分看一下源码】</p>
<p><br><br><br></p>
<h1 id="四、自定义键盘修饰符"><a href="#四、自定义键盘修饰符" class="headerlink" title="四、自定义键盘修饰符"></a>四、自定义键盘修饰符</h1><h3 id="2-x中自定义键盘修饰符"><a href="#2-x中自定义键盘修饰符" class="headerlink" title="2.x中自定义键盘修饰符"></a><a href="https://cn.vuejs.org/v2/guide/events.html#键值修饰符" target="_blank" rel="noopener">2.x中自定义键盘修饰符</a></h3><ol>
<li>通过<code>Vue.config.keyCodes.名称 = 按键值</code>来自定义案件修饰符的别名：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vue.config.keyCodes.f2 = 113;</span><br></pre></td></tr></table></figure>
<ol>
<li>使用自定义的按键修饰符：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;text&quot; v-model=&quot;name&quot; @keyup.f2=&quot;add&quot;&gt;</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<h1 id="五、directive自定义指令"><a href="#五、directive自定义指令" class="headerlink" title="五、directive自定义指令"></a><a href="https://cn.vuejs.org/v2/guide/custom-directive.html" target="_blank" rel="noopener">五、directive自定义指令</a></h1><ol>
<li>自定义全局和局部的 自定义指令：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">// 自定义全局指令 v-focus，为绑定的元素自动获取焦点：</span><br><span class="line"></span><br><span class="line">Vue.directive(&apos;focus&apos;, &#123;</span><br><span class="line"></span><br><span class="line">  inserted: function (el) &#123; // inserted 表示被绑定元素插入父节点时调用</span><br><span class="line"></span><br><span class="line">    el.focus();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 自定义局部指令 v-color 和 v-font-weight，为绑定的元素设置指定的字体颜色 和 字体粗细：</span><br><span class="line"></span><br><span class="line">  directives: &#123;</span><br><span class="line"></span><br><span class="line">    color: &#123; // 为元素设置指定的字体颜色</span><br><span class="line"></span><br><span class="line">      bind(el, binding) &#123;</span><br><span class="line"></span><br><span class="line">        el.style.color = binding.value;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    &apos;font-weight&apos;: function (el, binding2) &#123; // 自定义指令的简写形式，等同于定义了 bind 和 update 两个钩子函数</span><br><span class="line"></span><br><span class="line">      el.style.fontWeight = binding2.value;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>自定义指令的使用方式：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;text&quot; v-model=&quot;searchName&quot; v-focus v-color=&quot;&apos;red&apos;&quot; v-font-weight=&quot;900&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>【渡一案例见源码和视频】</p>
<p>F:\渡一前端课\新录制的vue课程资料\9. directive\vue.html</p>
<p><br><br><br></p>
<h1 id="六、filter过滤器"><a href="#六、filter过滤器" class="headerlink" title="六、filter过滤器"></a>六、filter过滤器</h1><p>概念：Vue.js 允许你自定义过滤器，<strong>可被用作一些常见的文本格式化</strong>。过滤器可以用在两个地方：<strong>mustache 插值和 v-bind 表达式</strong>。过滤器应该被添加在 JavaScript 表达式的尾部，由“管道”符指示；<br><br></p>
<h3 id="私有过滤器"><a href="#私有过滤器" class="headerlink" title="私有过滤器"></a>私有过滤器</h3><ol>
<li>HTML元素：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;td&gt;&#123;&#123;item.ctime | dataFormat(&apos;yyyy-mm-dd&apos;)&#125;&#125;&lt;/td&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>私有 <code>filters</code> 定义方式：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">filters: &#123; // 私有局部过滤器，只能在 当前 VM 对象所控制的 View 区域进行使用</span><br><span class="line"></span><br><span class="line">    dataFormat(input, pattern = &quot;&quot;) &#123; // 在参数列表中 通过 pattern=&quot;&quot; 来指定形参默认值，防止报错</span><br><span class="line"></span><br><span class="line">      var dt = new Date(input);</span><br><span class="line"></span><br><span class="line">      // 获取年月日</span><br><span class="line"></span><br><span class="line">      var y = dt.getFullYear();</span><br><span class="line"></span><br><span class="line">      var m = (dt.getMonth() + 1).toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line">      var d = dt.getDate().toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      // 如果 传递进来的字符串类型，转为小写之后，等于 yyyy-mm-dd，那么就返回 年-月-日</span><br><span class="line"></span><br><span class="line">      // 否则，就返回  年-月-日 时：分：秒</span><br><span class="line"></span><br><span class="line">      if (pattern.toLowerCase() === &apos;yyyy-mm-dd&apos;) &#123;</span><br><span class="line"></span><br><span class="line">        return `$&#123;y&#125;-$&#123;m&#125;-$&#123;d&#125;`;</span><br><span class="line"></span><br><span class="line">      &#125; else &#123;</span><br><span class="line"></span><br><span class="line">        // 获取时分秒</span><br><span class="line"></span><br><span class="line">        var hh = dt.getHours().toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line">        var mm = dt.getMinutes().toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line">        var ss = dt.getSeconds().toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        return `$&#123;y&#125;-$&#123;m&#125;-$&#123;d&#125; $&#123;hh&#125;:$&#123;mm&#125;:$&#123;ss&#125;`;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用ES6中的字符串新方法 String.prototype.padStart(maxLength, fillString=’’) 或 String.prototype.padEnd(maxLength, fillString=’’)来填充字符串；</p>
</blockquote>
<p><br><br></p>
<h3 id="全局过滤器"><a href="#全局过滤器" class="headerlink" title="全局过滤器"></a>全局过滤器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">// 定义一个全局过滤器</span><br><span class="line"></span><br><span class="line">Vue.filter(&apos;dataFormat&apos;, function (input, pattern = &apos;&apos;) &#123;</span><br><span class="line"></span><br><span class="line">  var dt = new Date(input);</span><br><span class="line"></span><br><span class="line">  // 获取年月日</span><br><span class="line"></span><br><span class="line">  var y = dt.getFullYear();</span><br><span class="line"></span><br><span class="line">  var m = (dt.getMonth() + 1).toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line">  var d = dt.getDate().toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // 如果 传递进来的字符串类型，转为小写之后，等于 yyyy-mm-dd，那么就返回 年-月-日</span><br><span class="line"></span><br><span class="line">  // 否则，就返回  年-月-日 时：分：秒</span><br><span class="line"></span><br><span class="line">  if (pattern.toLowerCase() === &apos;yyyy-mm-dd&apos;) &#123;</span><br><span class="line"></span><br><span class="line">    return `$&#123;y&#125;-$&#123;m&#125;-$&#123;d&#125;`;</span><br><span class="line"></span><br><span class="line">  &#125; else &#123;</span><br><span class="line"></span><br><span class="line">    // 获取时分秒</span><br><span class="line"></span><br><span class="line">    var hh = dt.getHours().toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line">    var mm = dt.getMinutes().toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line">    var ss = dt.getSeconds().toString().padStart(2, &apos;0&apos;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    return `$&#123;y&#125;-$&#123;m&#125;-$&#123;d&#125; $&#123;hh&#125;:$&#123;mm&#125;:$&#123;ss&#125;`;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：当有局部和全局两个名称相同的过滤器时候，会以就近原则进行调用，即：局部过滤器优先于全局过滤器被调用！</p>
</blockquote>
<p>【渡一案例见源码和视频】</p>
<p>F:\渡一前端课\新录制的vue课程资料\10. filter\vue.html</p>
<p><br><br><br></p>
<h1 id="七、el、-template、render"><a href="#七、el、-template、render" class="headerlink" title="七、el、 template、render"></a>七、el、 template、render</h1><p>挂载过程：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/挂载流程.jpg" alt=""></p>
<p>【渡一案例见源码和视频】</p>
<p>F:\渡一前端课\新录制的vue课程资料\11. el、template、render\vue.html</p>
<p><br><br><br></p>
<h1 id="八、vue实例的生命周期"><a href="#八、vue实例的生命周期" class="headerlink" title="八、vue实例的生命周期"></a><a href="https://cn.vuejs.org/v2/guide/instance.html#实例生命周期" target="_blank" rel="noopener">八、vue实例的生命周期</a></h1><p><a href="https://ws1.sinaimg.cn/large/006ttwEMly1g2hbe8i32jj31xe25qtku.jpg" target="_blank" rel="noopener">[查看大图]</a><img src="https://ws1.sinaimg.cn/large/006ttwEMly1g2hbe8i32jj31xe25qtku.jpg" alt=""></p>
<ul>
<li>什么是生命周期：从Vue实例创建、运行、到销毁期间，总是伴随着各种各样的事件，这些事件，统称为生命周期！</li>
<li><a href="https://cn.vuejs.org/v2/api/#选项-生命周期钩子" target="_blank" rel="noopener">生命周期钩子</a>：就是生命周期事件的别名而已；</li>
<li>生命周期钩子 = 生命周期函数 = 生命周期事件</li>
<li><p>主要的生命周期函数分类：</p>
</li>
<li><p>创建期间的生命周期函数：</p>
</li>
<li><p>beforeCreate：实例刚在内存中被创建出来，此时，还没有初始化好 data 和 methods 属性</p>
</li>
<li>created：实例已经在内存中创建OK，此时 data 和 methods 已经创建OK，此时还没有开始 编译模板</li>
<li>beforeMount：此时已经完成了模板的编译，但是还没有挂载到页面中</li>
<li><p>mounted：此时，已经将编译好的模板，挂载到了页面指定的容器中显示</p>
</li>
<li><p>运行期间的生命周期函数：</p>
</li>
<li><p>beforeUpdate：状态更新之前执行此函数， 此时 data 中的状态值是最新的，但是界面上显示的 数据还是旧的，因为此时还没有开始重新渲染DOM节点</p>
</li>
<li><p>updated：实例更新完毕之后调用此函数，此时 data 中的状态值 和 界面上显示的数据，都已经完成了更新，界面已经被重新渲染好了！</p>
</li>
<li><p>销毁期间的生命周期函数：</p>
</li>
<li><p>beforeDestroy：实例销毁之前调用。在这一步，实例仍然完全可用。</p>
</li>
<li>destroyed：Vue 实例销毁后调用。调用后，Vue 实例指示的所有东西都会解绑定，所有的事件监听器会被移除，所有的子实例也会被销毁。</li>
</ul>
<p><br><br><br></p>
<h1 id="九、计算属性computed和监听器watch"><a href="#九、计算属性computed和监听器watch" class="headerlink" title="九、计算属性computed和监听器watch"></a>九、计算属性computed和监听器watch</h1><p>模板内的表达式非常便利，但是设计它们的初衷是用于简单运算的。在模板中放入太多的逻辑会让模板过重且难以维护。 </p>
<p>当我想要拼接name，looks，和age时，使用模板表达式很麻烦。直接写入describe属性中有显得代码亢余。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv1"</span>&gt;</span>&#123;&#123;name&#125;&#125; &#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv2"</span>&gt;</span>&#123;&#123;name+' '+age&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv3"</span>&gt;</span>&#123;&#123;describe&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">        el: <span class="string">"#dv"</span>,</span><br><span class="line">        data: &#123;</span><br><span class="line">            name: <span class="string">"dunteng"</span>,</span><br><span class="line">            age: <span class="string">"18"</span>,</span><br><span class="line">            describe: <span class="string">"dunteng 18"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果：<img src="https://ws1.sinaimg.cn/large/006ttwEMgy1g2czp6tk1ej303o02dmwx.jpg" alt=""></p>
<p>以上三种方法都可以，但是并不灵活。</p>
<p>应该用methods中的方法来实现：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv1"</span>&gt;</span>&#123;&#123;name&#125;&#125; &#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv2"</span>&gt;</span>&#123;&#123;name+' '+age&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv3"</span>&gt;</span>&#123;&#123;describe()&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>   //括号不可丢1</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">        el: <span class="string">"#dv"</span>,</span><br><span class="line">        data: &#123;</span><br><span class="line">            name: <span class="string">"dunteng"</span>,</span><br><span class="line">            age: <span class="string">"18"</span>,</span><br><span class="line">            height: <span class="number">180</span>,</span><br><span class="line">            <span class="comment">// describe: "dunteng 18"  data中的变量命名和methods中的方法不可同名</span></span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            describe()&#123;</span><br><span class="line">            	<span class="built_in">console</span>.log(<span class="string">"方法describe被执行了"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.name+<span class="string">" "</span>+<span class="keyword">this</span>.age;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>函数返回了 name和age这两个属性，并且渲染到页面 </p>
<p>如此相比直接用模板语法来拼接确实简洁很多。</p>
<p><br><br></p>
<p>【这里需要知道】</p>
<p>在控制台上修改了这两个属性的其中一个之后，函数会被再执行一次，比如我在控制台输入<code>vm.name = &quot;hh&quot;</code>后， 页面上的<code>dunteng 18</code>会立即变成<code>hh 18</code>并再打印一次console语句。简而言之就是，<strong>当视图重新渲染了就会再执行一次该函数。</strong>另外当我们修改与describe方法无关的变量且该变量没有被渲染到试图上如height时，不会触发describe方法，但是一旦这个与describe方法无关的变量是有渲染到视图里的，则照样触发describe方法。</p>
<p><strong>因此我们修改属性影响视图渲染的同时，会涉及到重新加载无关的函数的问题，如此对性能十分不友好。</strong></p>
<p><br></p>
<p><strong>解决方法一：watch</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv3"</span>&gt;</span>&#123;&#123;describe&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">        el: <span class="string">"#dv"</span>,</span><br><span class="line">        data: &#123;</span><br><span class="line">            name: <span class="string">"dunteng"</span>,</span><br><span class="line">            age: <span class="string">"18"</span>,</span><br><span class="line">            height: <span class="number">180</span>,</span><br><span class="line">            describe: <span class="string">"dunteng 18"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        watch: &#123;</span><br><span class="line">            <span class="comment">// 监听name的变化</span></span><br><span class="line">            name()&#123;</span><br><span class="line">                <span class="keyword">this</span>.describe = <span class="keyword">this</span>.name + <span class="string">" "</span> +<span class="keyword">this</span>.age;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 监听age的变化</span></span><br><span class="line">            age()&#123;</span><br><span class="line">                <span class="keyword">this</span>.describe = <span class="keyword">this</span>.name + <span class="string">" "</span> +<span class="keyword">this</span>.age;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个方式虽然解决了问题，但是并不方便，代码冗余。</p>
<p><br></p>
<p><strong>解决方法二： computed</strong></p>
<p>这是最优的解决方法。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv3"</span>&gt;</span>&#123;&#123;describe&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">        el: <span class="string">"#dv"</span>,</span><br><span class="line">        data: &#123;</span><br><span class="line">            name: <span class="string">"dunteng"</span>,</span><br><span class="line">            age: <span class="string">"18"</span>,</span><br><span class="line">            height: <span class="number">180</span></span><br><span class="line">        &#125;,</span><br><span class="line">        computed: &#123;</span><br><span class="line">               describe()&#123;</span><br><span class="line">                   <span class="keyword">return</span> <span class="keyword">this</span>.name + <span class="string">" "</span> + <span class="keyword">this</span>.age;</span><br><span class="line">               &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>computed里面除了可以像上面那样写成方法（实际上并不是方法）的样子，还可以写成对象：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv3"</span>&gt;</span>&#123;&#123;describe&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">        el: <span class="string">"#dv"</span>,</span><br><span class="line">        data: &#123;</span><br><span class="line">            name: <span class="string">"dunteng"</span>,</span><br><span class="line">            age: <span class="string">"18"</span>,</span><br><span class="line">            height: <span class="number">180</span></span><br><span class="line">        &#125;,</span><br><span class="line">        computed: &#123;</span><br><span class="line">            <span class="comment">//    describe()&#123;</span></span><br><span class="line">            <span class="comment">//        return this.name + " " + this.age;</span></span><br><span class="line">            <span class="comment">//    &#125;</span></span><br><span class="line">            describe: &#123;</span><br><span class="line">            <span class="comment">//当我们获得这个describe的时候（渲染的时候）会执行get方法</span></span><br><span class="line">                get()&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">this</span>.name + <span class="string">" "</span> + <span class="keyword">this</span>.age;</span><br><span class="line">                &#125;,</span><br><span class="line">                set()&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">"describe被修改了"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p><br><br></p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/006ttwEMgy1g2d14c4gstj308c076jrd.jpg" alt=""></p>
<p><br><br>【注意】：上述例子中，当<code>vm.name</code>  和<code>vm.age</code>修改了的时候，因为有computed监听，所以在修改的同时页面的内容也相应地修改了。但是当<code>vm.describe</code>整个被修改的时候，页面时没有同步渲染更新的，所以还要如下操作：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv3"</span>&gt;</span>&#123;&#123;describe&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dv4"</span>&gt;</span>&#123;&#123;height&#125;&#125;cm<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">        el: <span class="string">"#dv"</span>,</span><br><span class="line">        data: &#123;</span><br><span class="line">            name: <span class="string">"dunteng"</span>,</span><br><span class="line">            age: <span class="string">"18"</span>,</span><br><span class="line">            height: <span class="number">180</span></span><br><span class="line">        &#125;,</span><br><span class="line">        computed: &#123;</span><br><span class="line">            <span class="comment">//    describe()&#123;</span></span><br><span class="line">            <span class="comment">//        return this.name + " " + this.age;</span></span><br><span class="line">            <span class="comment">//    &#125;</span></span><br><span class="line">            describe: &#123;</span><br><span class="line">                get()&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">this</span>.name + <span class="string">" "</span> + <span class="keyword">this</span>.age;</span><br><span class="line">                &#125;,</span><br><span class="line">                set(value)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">"describe被修改了"</span>);</span><br><span class="line">                    <span class="keyword">const</span> arr = value.split(<span class="string">" "</span>);</span><br><span class="line">                    <span class="built_in">console</span>.log(arr[<span class="number">0</span>]);</span><br><span class="line">                    <span class="built_in">console</span>.log(arr[<span class="number">1</span>]);</span><br><span class="line">                    <span class="keyword">this</span>.name = arr[<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">this</span>.age = arr[<span class="number">1</span>]; </span><br><span class="line">                    <span class="keyword">if</span>(arr[<span class="number">0</span>]==<span class="string">"大帅哥"</span>)&#123;</span><br><span class="line">                        <span class="keyword">this</span>.height = <span class="number">200</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>新版渡一代码</strong>：F:\渡一前端课\新录制的vue课程资料\13. 计算属性和侦听器\vue.html</p>
<p><strong>思否文章</strong>：<a href="https://segmentfault.com/a/1190000012948175" target="_blank" rel="noopener">https://segmentfault.com/a/1190000012948175</a></p>
<p><br><br><br></p>
<h1 id="十、组件"><a href="#十、组件" class="headerlink" title="十、组件"></a>十、组件</h1><h2 id="全局组件"><a href="#全局组件" class="headerlink" title="全局组件"></a>全局组件</h2><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567510618984.png" alt="1567510618984"></p>
<p>这样注册了一个全局组件，名为lin-dunteng，使用时直接标签化。</p>
<p>也可以写成小驼峰式：linDunteng，标签化为<code>&lt;lin-Dunteng&gt;&lt;lin-Dunteng&gt;</code>或者<code>&lt;lin-dunteng&gt;&lt;/lin-dunteng&gt;</code>，但是不能写成<code>&lt;linDunteng&gt;&lt;/linDunteng&gt;</code></p>
<p>也可以写成大驼峰式：LinDunteng，标签化为<code>&lt;lin-Dunteng&gt;&lt;lin-Dunteng&gt;</code>或者<code>&lt;lin-dunteng&gt;&lt;/lin-dunteng&gt;</code>或者<code>&lt;Lin-dunteng&gt;&lt;/Lin-dunteng&gt;</code>或者<code>&lt;Lin-Dunteng&gt;&lt;/Lin-Dunteng&gt;</code>, 但是不能写成<code>&lt;LinDunteng&gt;&lt;/LinDunteng&gt;</code></p>
<p>【提醒】不过以上情况是针对.html文件而言的，之后在.vue文件中就没这么多禁忌，相对比较自由宽泛。还有一点就是在.html文件中最好使用双标签，使用单标签可能会有些bug，但是在.vue文件中就没事</p>
<p>【问题】：为什么组件中的data要通过函数返回对象？</p>
<p>答：当一个组件被定义， data 必须声明为返回一个初始数据对象的函数，因为组件可能被用来创建多个实例。如果 data 仍然是一个纯粹的对象，则所有的实例将共享引用同一个数据对象！通过提供 data 函数，每次创建一个新实例后，我们能够调用 data 函数，从而返回初始数据的一个全新副本数据对象。</p>
<p>其实也很好理解，大概意思就是：</p>
<p>类比与引用数据类型。如果不用function return 每个组件的data都是内存的同一个地址，那一个数据改变其他也改变了，这当然就不是我们想要的。用function return 其实就相当于申明了新的变量，相互独立，自然就不会有这样的问题；js在赋值object对象时，是直接一个相同的内存地址。所以为了每个组件的data独立，采用了这种方式。<br>如果不是组件的话，正常data的写法可以直接写一个对象，比如data：{ msg ： ‘ 下载 ‘ }，但由于组件是会在多个地方引用<br>的，JS中直接共享对象会造成引用传递，也就是说修改了msg后所有按钮的msg都会跟着修改，所以这里用function来每次返回一个对象实例。</p>
<p><br><br></p>
<h2 id="局部组件"><a href="#局部组件" class="headerlink" title="局部组件"></a>局部组件</h2><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567511594805.png" alt="1567511594805"></p>
<p>该局部组件只能在相应的el中使用</p>
<p><br><br></p>
<h2 id="动态组件和插槽-v-slot"><a href="#动态组件和插槽-v-slot" class="headerlink" title="动态组件和插槽 v-slot"></a>动态组件和插槽 v-slot</h2><h3 id="动态组件"><a href="#动态组件" class="headerlink" title="动态组件"></a>动态组件</h3><p>关键为<code>&lt;component :is=&quot;comName&quot;&gt;&lt;/component&gt;</code>和<code>&lt;keep-alive&gt;&lt;/keep-alive&gt;</code></p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567668494678.png" alt="1567668494678"></p>
<p><br><br></p>
<h3 id="插槽"><a href="#插槽" class="headerlink" title="插槽"></a>插槽</h3><p><strong>【匿名插槽】</strong></p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567668892295.png" alt="1567668892295"></p>
<p><br><br></p>
<p><strong>【具名插槽】</strong></p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567669076852.png" alt="1567669076852"></p>
<p><br><br><strong>【作用域插槽】</strong></p>
<p>详见F:\渡一前端课\0我的学习\VUE\上课学习代码\Vue全家桶一\09动态组件与插槽\作用域插槽01.html</p>
<p>和F:\渡一前端课\0我的学习\VUE\上课学习代码\Vue全家桶一\09动态组件与插槽\作用域插槽02.html</p>
<p>和<a href="https://ke.qq.com/webcourse/index.html#cid=288781&amp;term_id=100342071&amp;taid=2943852189345805&amp;type=1024&amp;vid=l14309p5itq" target="_blank" rel="noopener">https://ke.qq.com/webcourse/index.html#cid=288781&amp;term_id=100342071&amp;taid=2943852189345805&amp;type=1024&amp;vid=l14309p5itq</a></p>
<p><br><br></p>
<h2 id="组件传值"><a href="#组件传值" class="headerlink" title="组件传值"></a>组件传值</h2><p>利用属性的方式传值</p>
<h3 id="组件传递普通的值"><a href="#组件传递普通的值" class="headerlink" title="组件传递普通的值"></a>组件传递普通的值</h3><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567512737130.png" alt="1567512737130"></p>
<p><br><br></p>
<h3 id="组件传递data中的值，父组件传值给子组件"><a href="#组件传递data中的值，父组件传值给子组件" class="headerlink" title="组件传递data中的值，父组件传值给子组件"></a>组件传递data中的值，父组件传值给子组件</h3><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567513134224.png" alt="1567513134224"></p>
<p>以上的<code>props</code>都是一个数组的形式，它还可以写成一个对象的形式，而且有多个属性，看下面的例子 ：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567514346664.png" alt="1567514346664"></p>
<p>数组和对象这两个引用类型，default需要写成一个函数的形式。</p>
<p>【一个小练习】：</p>
<p>F:\渡一前端课\新录制的vue课程资料\15. 组件数据传递&amp;属性校验</p>
<p><br><br></p>
<h3 id="多层父传子通信"><a href="#多层父传子通信" class="headerlink" title="多层父传子通信"></a>多层父传子通信</h3><p>【场景】： 父组件要传值给子组件和孙子组件（子组件的子组件）</p>
<p>####【方案一】两层的父传子通信。</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567519232543.png" alt="1567519232543"></p>
<p><br><br></p>
<h4 id="【方案二】利用-attrs-来传值"><a href="#【方案二】利用-attrs-来传值" class="headerlink" title="【方案二】利用 $attrs 来传值"></a>【方案二】利用 $attrs 来传值</h4><p>vm.$attrs 包含是组件中未被props注册的属性</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567573718978.png" alt="1567573718978"></p>
<p>$attrs–继承所有的父组件属性（除了prop注册传递的属性、class 和 style ），一般用在子组件的子元素上。</p>
<p>在本例中 <code>&lt;my-p :content=&#39;$attrs.content&#39;&gt;&lt;/my-p&gt;</code>得到应用。</p>
<p>【注意】如果$attrs继承了很多的属性，那么像上栗这样子一个一个在子组件标签中列出来很麻烦，可以直接使用</p>
<p><code>v-bind=&#39;$attrs&#39;</code>来一次性全部拿到$attrs中的全部属性。</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567574861249.png" alt="1567574861249"></p>
<p>但是我们发现，在html结构中，被props注册传递的属性不会出现，而未被props注册传递的属性会出现，如下图所示：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567574935531.png" alt="1567574935531"></p>
<p>如何去除呢？</p>
<p>使用<code>inheritAttrs：false</code>!</p>
<p>inheritAttrs：默认值true,继承所有的父组件属性（除props的特定绑定）作为普通的HTML特性应用在子组件的根元素上，如果你不希望组件的根元素继承特性设置inheritAttrs: false,但是class属性会继承（<strong>简单的说，inheritAttrs：true 继承除props之外的所有属性；inheritAttrs：false 只继承class属性</strong>）</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567575042562.png" alt="1567575042562"></p>
<p>像这样子写之后，就大功告成了。</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567575099573.png" alt="1567575099573"></p>
<p><br><br></p>
<h4 id="【方案三】利用-parent"><a href="#【方案三】利用-parent" class="headerlink" title="【方案三】利用 $parent"></a>【方案三】利用 $parent</h4><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567576385970.png" alt="1567576385970"></p>
<p>对于$children，是一个数组，因为可以有多个子组件。</p>
<p>但是这种方法官方不推荐使用，像孙子组件myP中这样多个$parent写起来很不友好。</p>
<p><br><br></p>
<h4 id="【方案四】利用provide和inject"><a href="#【方案四】利用provide和inject" class="headerlink" title="【方案四】利用provide和inject"></a>【方案四】利用provide和inject</h4><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567576901607.png" alt="1567576901607"></p>
<p>在组件中inject拿到的属性和数据是来自provide的，而非data中的。</p>
<p>虽然很方便却也是不太推荐使用的， 容易使得代码混乱，不知道属性是从何而来的。但是必须知道，面试的时候可以装逼。</p>
<p><br><br></p>
<h3 id="子组件向父组件传值"><a href="#子组件向父组件传值" class="headerlink" title="子组件向父组件传值"></a>子组件向父组件传值</h3><h4 id="【方案一】利用-children"><a href="#【方案一】利用-children" class="headerlink" title="【方案一】利用 $children"></a>【方案一】利用 $children</h4><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567579334058.png" alt="1567579334058"></p>
<p>但是这种方法官方不推荐使用。</p>
<p><br><br></p>
<h4 id="【方案二】-利用-refs"><a href="#【方案二】-利用-refs" class="headerlink" title="【方案二】 利用 $refs"></a>【方案二】 利用 $refs</h4><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567581936328.png" alt="1567581936328"></p>
<p>通过 $refs 获取到了子组件的数据和方法。</p>
<p><br><br></p>
<p>####【方案三】$emit</p>
<p>这是比较常用的方法</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567585452418.png" alt="1567585452418"></p>
<p>效果如下：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567585482438.png" alt="1567585482438"></p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567585581527.png" alt="1567585581527"></p>
<p><br><br></p>
<h3 id="兄弟组件之间的传值"><a href="#兄弟组件之间的传值" class="headerlink" title="兄弟组件之间的传值"></a>兄弟组件之间的传值</h3><h4 id="利用事件总线EventBus"><a href="#利用事件总线EventBus" class="headerlink" title="利用事件总线EventBus"></a>利用事件总线EventBus</h4><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567588110311.png" alt="1567588110311"></p>
<p>【具体实现方式】：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Eventbus=<span class="keyword">new</span> Vue();    </span><br><span class="line">Eventbus.$emit(事件名,数据);    </span><br><span class="line">Eventbus.$on(事件名,data =&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure>
<p><br><br></p>
<h3 id="组件双向数据通信"><a href="#组件双向数据通信" class="headerlink" title="组件双向数据通信"></a>组件双向数据通信</h3><p>暂未整理</p>
<p><br><br><br></p>
<h1 id="十一、Vue-cli-脚手架"><a href="#十一、Vue-cli-脚手架" class="headerlink" title="十一、Vue-cli 脚手架"></a>十一、Vue-cli 脚手架</h1><h2 id="安装初试"><a href="#安装初试" class="headerlink" title="安装初试"></a>安装初试</h2><p>npm install -g @vue/cli     安装脚手架，用于生成项目，使用指令<code>vue --version</code>查看是否安装成功<br>npm install -g @vue/cli-service-global   快速原型开发，可以直接通过<code>vue serve xxx.vue</code>的指令来编译.vue文件</p>
<p>如果之前已经安装过旧版本（非3.x）脚手架，需先卸载旧版本：<br>npm uninstall vue-cli -g</p>
<p>如果仍然需要使用旧版本的 vue init 功能，可以全局安装一个桥接工具：<br>npm install -g @vue/cli-init    拉取旧版本</p>
<p>插件名字：Vetur（由于vscode并不认识.vue文件，所以没有代码高亮，需要安装Vetur这个插件来弥补</p>
<p><code>vue create vue-app</code>创建一个vue项目文件夹，叫做vue-app，【注意这里的命令操作最好用cmd执行，git bash有些操作完成不了】。会提示选择一个预设的方案，有default和manually selectfeature，选择后者。然后会有一些配置需要你选择，按空格键进行选择和取消选择，这里只选择Babel。再然后选择<code>In package.json</code>选项，选<img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567834770585.png" alt="1567834770585"></p>
<ul>
<li>★ 同时注意使用<code>redirect</code>来重定向到具体的一个子路由路径上，否则一打开“community”路由的时候没有默认的选中子路由，只会显示空白不会显示出具体的子路由页面。</li>
</ul>
<ul>
<li><p>在一级路由.vue文件中继续使用<code>&lt;router-link&gt;</code>和<code>&lt;router-view&gt;</code></p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567834990024.png" alt="1567834990024"></p>
</li>
</ul>
<ul>
<li><p>关于首页路径和<code>router-link-active</code>的优化</p>
<p>在本例子中路由community的样式是加在<code>router-link-extra-active</code>上的，且匹配的是路径<code>/community</code>，因此路由community的子路由被点击时community的样式没有显现，因为此时的路径变成了<code>/community/xxx</code>没有完全匹配<code>/community</code>。</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567836335642.png" alt="1567836335642">因此要把样式加到<code>router-link-active</code>上。但是问题又来了，<code>router-link-active</code>匹配了两个路径<code>/</code>和<code>/community</code></p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567836265612.png" alt="1567836265612"></p>
<p>这样就应该把原本首页匹配的路径由根路径<code>/</code>换成<code>/home</code>。然后又有一个问题，就是我们访问<code>http://localhost:8080</code>的时候无法自动跳转到首页。所以还需要进行一步重定向：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567836714591.png" alt="1567836714591"></p>
<p>或者还可以这样子使用redirect ( )重定向：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567836792711.png" alt="1567836792711"></p>
</li>
<li><p>不存在的路径和优化</p>
<p>比如不存在该路径<code>http://localhost:8080/gjalhj</code>，对此要将这一切不存在路径同意跳转到某一指定页面</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567837033399.png" alt="1567837033399"></p>
<p>这里的<code>path: *</code>表示当以上的所有路径都没有匹配的时候，判断路径是否为<code>/</code>，是则重定向到<code>/home</code>，否则重定向到统一的指定页面。</p>
</li>
</ul>
<p><br><br></p>
<h2 id="router的push、replace和go"><a href="#router的push、replace和go" class="headerlink" title="$router的push、replace和go"></a>$router的push、replace和go</h2><ul>
<li><p>this.$router.push()</p>
<p>描述：跳转到不同的url，但这个方法回向history栈添加一个记录，点击后退会返回到上一个页面。</p>
<p>用法：<img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1568037236fa.jpg" alt=""></p>
</li>
</ul>
<ul>
<li><p>this.$router.replace()</p>
<p>描述：同样是跳转到指定的url，但是这个方法不会向history里面添加新的记录，点击返回，会跳转到上上一个页面。上一个记录是不存在的。</p>
</li>
<li><p>this.$router.go(n)</p>
<p>相对于当前页面向前或向后跳转多少个页面,类似 window.history.go(n)。n可为正数可为负数。正数返回上一个页面</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/20180315110305411.png" alt=""></p>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567838042925.png" alt="1567838042925"></p>
<p>-</p>
<p><br><br></p>
<h2 id="导航守卫和动态路由"><a href="#导航守卫和动态路由" class="headerlink" title="导航守卫和动态路由"></a><a href="https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E5%AF%BC%E8%88%AA%E5%AE%88%E5%8D%AB" target="_blank" rel="noopener">导航守卫</a>和动态路由</h2><p>【重要的一节课】F:\渡一前端课\新录制的vue课程资料\28. 导航守卫&amp;动态路由</p>
<h3 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h3><p>【方案一】使用params：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567850470296.png" alt="1567850470296"></p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567850528088.png" alt="1567850528088"></p>
<p>【方案二】使用query：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567851075014.png" alt="1567851075014"></p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567851012789.png" alt="1567851012789"></p>
<p><br><br></p>
<h3 id="组件内的守卫"><a href="#组件内的守卫" class="headerlink" title="组件内的守卫"></a>组件内的守卫</h3><p>你可以在路由组件内直接定义以下路由导航守卫：</p>
<ul>
<li><code>beforeRouteEnter</code></li>
<li><code>beforeRouteUpdate</code> (2.2 新增)</li>
<li><code>beforeRouteLeave</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Foo = &#123;</span><br><span class="line">  template: <span class="string">`...`</span>,</span><br><span class="line">  beforeRouteEnter (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">    <span class="comment">// 在渲染该组件的对应路由被 confirm 前调用</span></span><br><span class="line">    <span class="comment">// 不！能！获取组件实例 `this`</span></span><br><span class="line">    <span class="comment">// 因为当守卫执行前，组件实例还没被创建</span></span><br><span class="line">  &#125;,</span><br><span class="line">  beforeRouteUpdate (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">    <span class="comment">// 在当前路由改变，但是该组件被复用时调用</span></span><br><span class="line">    <span class="comment">// 举例来说，对于一个带有动态参数的路径 /foo/:id，在 /foo/1 和 /foo/2 之间跳转的时候，</span></span><br><span class="line">    <span class="comment">// 由于会渲染同样的 Foo 组件，因此组件实例会被复用。而这个钩子就会在这个情况下被调用。</span></span><br><span class="line">    <span class="comment">// 可以访问组件实例 `this`</span></span><br><span class="line">  &#125;,</span><br><span class="line">  beforeRouteLeave (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">    <span class="comment">// 导航离开该组件的对应路由时调用</span></span><br><span class="line">    <span class="comment">// 可以访问组件实例 `this`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>beforeRouteEnter</code> 守卫 <strong>不能</strong> 访问 <code>this</code>，因为守卫在导航确认前被调用,因此即将登场的新组件还没被创建。</p>
<p>不过，你可以通过传一个回调给 <code>next</code>来访问组件实例。在导航被确认的时候执行回调，并且把组件实例作为回调方法的参数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">beforeRouteEnter (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">  next(<span class="function"><span class="params">vm</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 通过 `vm` 访问组件实例</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意 <code>beforeRouteEnter</code> 是支持给 <code>next</code> 传递回调的唯一守卫。对于 <code>beforeRouteUpdate</code> 和 <code>beforeRouteLeave</code> 来说，<code>this</code> 已经可用了，所以<strong>不支持</strong>传递回调，因为没有必要了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">beforeRouteUpdate (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">  <span class="comment">// just use `this`</span></span><br><span class="line">  <span class="keyword">this</span>.name = to.params.name</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个离开守卫通常用来禁止用户在还未保存修改前突然离开。该导航可以通过 <code>next(false)</code> 来取消。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">beforeRouteLeave (to, <span class="keyword">from</span> , next) &#123;</span><br><span class="line">  <span class="keyword">const</span> answer = <span class="built_in">window</span>.confirm(<span class="string">'Do you really want to leave? you have unsaved changes!'</span>)</span><br><span class="line">  <span class="keyword">if</span> (answer) &#123;</span><br><span class="line">    next()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next(<span class="literal">false</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>【案例】实现一个功能</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567845124241.png" alt="1567845124241"></p>
<p>这就要用到导航守卫之<strong>beforeRouterLeave</strong></p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567845232834.png" alt="1567845232834"></p>
<p>相应的还有<strong>beforeRouteEnter</strong> ：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567850373975.png" alt="1567850373975"></p>
<p><strong>beforeRouteUpdate</strong>：</p>
<p>★ 这个看视频【F:\渡一前端课\新录制的vue课程资料\28. 导航守卫&amp;动态路由】</p>
<p><br><br></p>
<h3 id="路由独享守卫"><a href="#路由独享守卫" class="headerlink" title="路由独享守卫"></a>路由独享守卫</h3><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567926980649.png" alt="1567926980649"></p>
<p><br><br></p>
<h3 id="全局前置守卫"><a href="#全局前置守卫" class="headerlink" title="全局前置守卫"></a>全局前置守卫</h3><p>你可以使用 <code>router.beforeEach</code> 注册一个全局前置守卫：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123; ... &#125;)</span><br><span class="line"></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>当一个导航触发时，全局前置守卫按照创建顺序调用。守卫是异步解析执行，此时导航在所有守卫 resolve 完之前一直处于 <strong>等待中</strong>。</p>
<p>每个守卫方法接收三个参数：</p>
<ul>
<li><strong>to: Route</strong>: 即将要进入的目标 <a href="https://router.vuejs.org/zh/api/#%E8%B7%AF%E7%94%B1%E5%AF%B9%E8%B1%A1" target="_blank" rel="noopener">路由对象</a></li>
<li><strong>from: Route</strong>: 当前导航正要离开的路由</li>
<li><strong>next: Function</strong>: 一定要调用该方法来 <strong>resolve</strong> 这个钩子。执行效果依赖 <code>next</code> 方法的调用参数。<ul>
<li><strong>next()</strong>: 进行管道中的下一个钩子。如果全部钩子执行完了，则导航的状态就是 <strong>confirmed</strong> (确认的)。</li>
<li><strong>next(false)</strong>: 中断当前的导航。如果浏览器的 URL 改变了 (可能是用户手动或者浏览器后退按钮)，那么 URL 地址会重置到 <code>from</code> 路由对应的地址。</li>
<li><strong>next(‘/‘) 或者 next({ path: ‘/‘ })</strong>: 跳转到一个不同的地址。当前的导航被中断，然后进行一个新的导航。你可以向 <code>next</code> 传递任意位置对象，且允许设置诸如 <code>replace: true</code>、<code>name: &#39;home&#39;</code> 之类的选项以及任何用在 <a href="https://router.vuejs.org/zh/api/#to" target="_blank" rel="noopener"><code>router-link</code> 的 <code>to</code> prop</a> 或 <a href="https://router.vuejs.org/zh/api/#router-push" target="_blank" rel="noopener"><code>router.push</code></a> 中的选项。</li>
<li><strong>next(error)</strong>: (2.4.0+) 如果传入 <code>next</code> 的参数是一个 <code>Error</code> 实例，则导航会被终止且该错误会被传递给 <a href="https://router.vuejs.org/zh/api/#router-onerror" target="_blank" rel="noopener"><code>router.onError()</code></a> 注册过的回调。</li>
</ul>
</li>
</ul>
<p><strong>确保要调用 next 方法，否则钩子就不会被 resolved。</strong></p>
<p><br><br></p>
<h3 id="全局解析守卫"><a href="#全局解析守卫" class="headerlink" title="全局解析守卫"></a>全局解析守卫</h3><blockquote>
<p>2.5.0 新增</p>
</blockquote>
<p>在 2.5.0+ 你可以用 <code>router.beforeResolve</code> 注册一个全局守卫。这和 <code>router.beforeEach</code> 类似，区别是在导航被确认之前，<strong>同时在所有组件内守卫和异步路由组件被解析之后</strong>，解析守卫就被调用。</p>
<p><br><br></p>
<h3 id="全局后置钩子"><a href="#全局后置钩子" class="headerlink" title="全局后置钩子"></a>全局后置钩子</h3><p>你也可以注册全局后置钩子，然而和守卫不同的是，这些钩子不会接受 <code>next</code> 函数也不会改变导航本身：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">router.afterEach(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567928081876.png" alt="1567928081876"></p>
<p><br><br></p>
<h3 id="导航守卫小汇总"><a href="#导航守卫小汇总" class="headerlink" title="导航守卫小汇总"></a>导航守卫小汇总</h3><ol>
<li><strong>全局守卫</strong></li>
</ol>
<ul>
<li><p>beforeEach</p>
</li>
<li><p>beforeResolve</p>
</li>
<li><p>afterEach</p>
</li>
</ul>
<ol start="2">
<li><strong>路由独享守卫</strong></li>
</ol>
<ul>
<li>beforeEnter</li>
</ul>
<ol start="3">
<li><strong>组件内守卫</strong></li>
</ol>
<ul>
<li><p>beforeRouteLeave 当离开这个路径时执行</p>
</li>
<li><p>beforeRouteEnter </p>
</li>
<li><p>beforeRouteUpdate mounted</p>
</li>
</ul>
<p>   进入某一个路径时，执行顺序</p>
<p>- beforeEach -&gt; beforeEnter -&gt; beforeRouteEnter -&gt; beforeResolve -&gt; afterEach </p>
<p><br></p>
<h3 id="完整的导航解析流程"><a href="#完整的导航解析流程" class="headerlink" title="完整的导航解析流程"></a>完整的导航解析流程</h3><ol>
<li>导航被触发。</li>
<li>在失活的组件里调用离开守卫。</li>
<li>调用全局的 <code>beforeEach</code> 守卫。</li>
<li>在重用的组件里调用 <code>beforeRouteUpdate</code> 守卫 (2.2+)。</li>
<li>在路由配置里调用 <code>beforeEnter</code>。</li>
<li>解析异步路由组件。</li>
<li>在被激活的组件里调用 <code>beforeRouteEnter</code>。</li>
<li>调用全局的 <code>beforeResolve</code> 守卫 (2.5+)。</li>
<li>导航被确认。</li>
<li>调用全局的 <code>afterEach</code> 钩子。</li>
<li>触发 DOM 更新。</li>
<li>用创建好的实例调用 <code>beforeRouteEnter</code> 守卫中传给 <code>next</code> 的回调函数。</li>
</ol>
<p><br><br></p>
<h2 id="路由元信息"><a href="#路由元信息" class="headerlink" title="路由元信息"></a>路由元信息</h2><p>定义路由的时候可以配置 <code>meta</code> 字段：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/foo'</span>,</span><br><span class="line">      component: Foo,</span><br><span class="line">      children: [</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">'bar'</span>,</span><br><span class="line">          component: Bar,</span><br><span class="line">          <span class="comment">// a meta field</span></span><br><span class="line">          meta: &#123; <span class="attr">requiresAuth</span>: <span class="literal">true</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>那么如何访问这个 <code>meta</code> 字段呢？</p>
<p>首先，我们称呼 <code>routes</code> 配置中的每个路由对象为 <strong>路由记录</strong>。路由记录可以是嵌套的，因此，当一个路由匹配成功后，他可能匹配多个路由记录</p>
<p>例如，根据上面的路由配置，<code>/foo/bar</code> 这个 URL 将会匹配父路由记录以及子路由记录。</p>
<p>一个路由匹配到的所有路由记录会暴露为 <code>$route</code> 对象 (还有在导航守卫中的路由对象) 的 <code>$route.matched</code> 数组。因此，我们需要遍历 <code>$route.matched</code> 来检查路由记录中的 <code>meta</code> 字段。</p>
<p>下面例子展示在全局导航守卫中检查元字段：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (to.matched.some(<span class="function"><span class="params">record</span> =&gt;</span> record.meta.requiresAuth)) &#123;</span><br><span class="line">    <span class="comment">// this route requires auth, check if logged in</span></span><br><span class="line">    <span class="comment">// if not, redirect to login page.</span></span><br><span class="line">    <span class="keyword">if</span> (!auth.loggedIn()) &#123;</span><br><span class="line">      next(&#123;</span><br><span class="line">        path: <span class="string">'/login'</span>,</span><br><span class="line">        query: &#123; <span class="attr">redirect</span>: to.fullPath &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      next()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next() <span class="comment">// 确保一定要调用 next()</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>【案例】实现用户登录后才有查看内容权限，仍然基于上面的程序，要求用户登录后才可以查看“学员展示”和”社区“</p>
<p>★★★ F:\渡一前端课\新录制的vue课程资料\30. 路由元信息</p>
<p><br><br><br></p>
<h1 id="十三、Vuex"><a href="#十三、Vuex" class="headerlink" title="十三、Vuex"></a>十三、Vuex</h1><h2 id="state、getters、mutations、actions"><a href="#state、getters、mutations、actions" class="headerlink" title="state、getters、mutations、actions"></a>state、getters、mutations、actions</h2><p>详见我的完整笔记：</p>
<p><a href="https://github.com/Dunteng/learnVue/tree/master/%E5%AD%A6%E4%B9%A0Vuex#%E6%9C%AC%E6%96%87%E4%BB%A3%E7%A0%81" target="_blank" rel="noopener">https://github.com/Dunteng/learnVue/tree/master/%E5%AD%A6%E4%B9%A0Vuex#%E6%9C%AC%E6%96%87%E4%BB%A3%E7%A0%81</a></p>
<p><br><br></p>
<h2 id="vuex-module"><a href="#vuex-module" class="headerlink" title="vuex module"></a>vuex module</h2><p>【F:\渡一前端课\新录制的vue课程资料\33. vuex mutation&amp;action\src】</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567958712382.png" alt="1567958712382"></p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vue/1567958795682.png" alt="1567958795682"></p>
<p>注意到在此，使用的 vuex state都是存放关于 “学员展示” 模块的，一旦其他板块如 “课程学习” “社区” 等也需要用到 vuex ， 那么一大堆的数据都堆积到state中，这样就很庞大很杂乱，不好维护和管理，<strong>因此需要分模块用到 vuex module</strong>。</p>
<h3 style="color:red;">★★★★★ 看代码【F:\渡一前端课\新录制的vue课程资料\34. vuex module\src】</h3>

<p> <strong>modules</strong></p>
<ul>
<li><p>根据功能让vuex分出模块</p>
</li>
<li><p>state会放入到每一个模块下，getters、mutations、actions会直接放入到全局</p>
<p><strong>获取vuex中的数据（无namespaced）</strong></p>
</li>
<li><p>获取state : this.$store.state.moduleName.xxx</p>
</li>
<li><p>获取getters： this.$store.getters.xxx</p>
</li>
<li><p>获取mutations： this.$store.commit(‘xxx’)</p>
</li>
<li><p>获取actions： this.$store.dispatch(‘xxx’)</p>
</li>
<li><p>可以通过mapXXX 方式拿到getters、mutations、action，但是不能拿到state，如果想通过这种方式获取state，需要加命名空间：namespaced：true</p>
<p><strong>获取vuex中的数据（有namespaced）</strong></p>
</li>
<li><p>获取state : this.$store.state.moduleName.xxx</p>
</li>
<li><p>获取getters： this.$store[‘moduleName/getters’].xxx</p>
</li>
<li><p>获取mutations： this.$store.commit(‘moduleName/xxx’)</p>
</li>
<li><p>获取actions： this.$store.dispatch(‘moduleName/xxx’)</p>
</li>
<li><p>可以通过mapXXX: mapXXX(‘moduleName’, [‘xxx’])  mapXXX(‘moduleName’, {})</p>
</li>
</ul>
<p><br><br><br></p>
<h1 id="十四、跨域"><a href="#十四、跨域" class="headerlink" title="十四、跨域"></a>十四、跨域</h1><h1 id="十五、网络请求axios"><a href="#十五、网络请求axios" class="headerlink" title="十五、网络请求axios"></a>十五、网络请求axios</h1><p>参考：</p>
<ul>
<li><a href="https://www.kancloud.cn/yunye/axios/234845" target="_blank" rel="noopener">https://www.kancloud.cn/yunye/axios/234845</a></li>
<li>王红元老师的<a href="https://www.bilibili.com/video/av67171816/?p=146" target="_blank" rel="noopener">vue课程</a></li>
</ul>
<p>axios 是 Vue 作者尤雨溪推荐的官方 ajax 库。有一下主要功能特点：</p>
<ul>
<li>在浏览器中发送 XMLHttpRequest 请求</li>
<li>在 node.js 中发送 http 请求</li>
<li>支持 Promise API</li>
<li>拦截请求和响应</li>
<li>转化请求和响应数据</li>
</ul>
<p><br></p>
<p>先安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install axios --save</span><br></pre></td></tr></table></figure>
<p>再引入：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br></pre></td></tr></table></figure>
<p>发送请求：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">  url: <span class="string">"http://123.207.32.32:8000/home/multidata"</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>以上没有指定 GET 请求还是 POST 请求，只传了一个 url ，默认为 GET 请求。</p>
<p><br></p>
<h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><p>执行 <code>GET</code> 请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为给定 ID 的 user 创建请求</span></span><br><span class="line">axios.get(<span class="string">'/user?ID=12345'</span>)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(response);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可选地，上面的请求可以这样做</span></span><br><span class="line">axios.get(<span class="string">'/user'</span>, &#123;</span><br><span class="line">    params: &#123;</span><br><span class="line">      ID: <span class="number">12345</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(response);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p>执行 <code>POST</code> 请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">axios.post(<span class="string">'/user'</span>, &#123;</span><br><span class="line">    firstName: <span class="string">'Fred'</span>,</span><br><span class="line">    lastName: <span class="string">'Flintstone'</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(response);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p>执行多个<strong>并发请求</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserAccount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> axios.get(<span class="string">'/user/12345'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserPermissions</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> axios.get(<span class="string">'/user/12345/permissions'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">axios.all([getUserAccount(), getUserPermissions()])</span><br><span class="line">    .then(axios.spread(<span class="function">(<span class="params">res1, res2</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res1);</span><br><span class="line">    <span class="built_in">console</span>.log(res2);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/vue/1568962541144.png" alt="1568962541144"></p>
<p><br></p>
<h2 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a>全局配置</h2><p>看下面的例子</p>
<p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/vue/1568962967595.png" alt="1568962967595"></p>
<p>这里面的 baseURL 和 timeout 存在冗余，可以将其再全局配置中写好。事实上，在开发中可能很多参数都是固定的，这时候我们可以进行一些抽取，也可以利用axios的全局配置。</p>
<p><img src="https://raw.githubusercontent.com/rockdunteng/imageBed/master/note/vue/1568963218053.png" alt="1568963218053"></p>
<p>类似的还有</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">axios.defaults.headers.post[<span class="string">'Content-Type'</span>]=<span class="string">'application/x-www-form-urlencoded'</span></span><br></pre></td></tr></table></figure>
<p>还有其他配置选项，我就不一一列出来了。</p>
<p><br></p>
<h2 id="axios-的实例使用"><a href="#axios-的实例使用" class="headerlink" title="axios 的实例使用"></a>axios 的实例使用</h2><p>像上面的几个例子都是直接使用 axios ，但是有时候这样子直接使用 axios 是不合适的。</p>
<p>比如，我们的项目并非只是在 baseURL=“<a href="http://aaaa:8000”，而是还有多个" target="_blank" rel="noopener">http://aaaa:8000”，而是还有多个</a> baseURL，那么这时候如果直接用 axios 来配置 baseURL 和其他的相关配置，就实现不了了，所以可以使用 axios 的实例，使用实例就可以避免这样的问题。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个axios的实例 instance1</span></span><br><span class="line"><span class="keyword">const</span> instance1 = axios.create(&#123;</span><br><span class="line">  baseURL: <span class="string">'http://123.123.123.12:8000'</span>,</span><br><span class="line">  timeout: <span class="number">5000</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 使用instance1实例</span></span><br><span class="line">instance1(&#123;</span><br><span class="line">  url: <span class="string">'/home/multidata'</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个axios实例 instance2</span></span><br><span class="line"><span class="keyword">const</span> instance2 = axios.create(&#123;</span><br><span class="line">  baseURL: <span class="string">'http://456.123.123.12:8000'</span>,</span><br><span class="line">  timeout: <span class="number">5000</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 使用instance2实例</span></span><br><span class="line">instance2(&#123;</span><br><span class="line">  url: <span class="string">'/home/multidata'</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="axios-封装代码"><a href="#axios-封装代码" class="headerlink" title="axios 封装代码"></a>axios 封装代码</h2><p>假设项目中有十处组件要用到 axios 来请求数据，那么我们可能需要引入 axios 十次，如果有五十次要用到就要引入五十次。万一某天 axios 挂掉了或者不再维护了，那么我们的项目就要大改了，每次用到 axios 的地方都要重新编写，五十次就够呛了，大型项目的话直接扑街。</p>
<p>所以在实际开发中，一定要有意识的封装 axios 代码，比如我们在 <code>src/network/request.js</code>中对 axios 进行了封装，对外导出实例<code>request</code>，在进行数据请求的时候就可以使用封装好的<code>request</code>而不是直接使用 axios，这样一来，如果以后要更换技术或者修改，就不用每处地方都进行修改，只要该封装代码<code>request</code>就可以了。</p>
<p>下面开始进行封装：</p>
<h3 id="level-1"><a href="#level-1" class="headerlink" title="level 1"></a>level 1</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//   src/network/request.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">config, success, failure</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 创建axios的实例</span></span><br><span class="line">    <span class="keyword">const</span> instance = axios.create(&#123;</span><br><span class="line">        baseURL: <span class="string">' https://easy-mock.com/mock/5c88abff4c25252b7c484888/magazine'</span>,</span><br><span class="line">        timeout: <span class="number">5000</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送网络请求,使用回调函数来处理数据</span></span><br><span class="line">    instance(config).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        success(res)</span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        failure(err)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; request &#125; <span class="keyword">from</span> <span class="string">'./network/request'</span></span><br><span class="line"></span><br><span class="line">request(&#123;</span><br><span class="line">  url: <span class="string">'/home'</span></span><br><span class="line">&#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">  &#125;,</span><br><span class="line">  err =&gt; &#123;   </span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="level-2"><a href="#level-2" class="headerlink" title="level 2"></a>level 2</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 创建axios的实例</span></span><br><span class="line">    <span class="keyword">const</span> instance = axios.create(&#123;</span><br><span class="line">        baseURL: <span class="string">' https://easy-mock.com/mock/5c88abff4c25252b7c484888/magazine'</span>,</span><br><span class="line">        timeout: <span class="number">5000</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送真正的网络请求</span></span><br><span class="line">    instance(config.baseConfig).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        config.success(res)</span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        config.failure(err)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; request &#125; <span class="keyword">from</span> <span class="string">'./network/request'</span></span><br><span class="line"></span><br><span class="line">request(&#123;</span><br><span class="line">  baseConfig: &#123;</span><br><span class="line">    url: <span class="string">'/home'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">  &#125;,</span><br><span class="line">  failure: <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="level-3"><a href="#level-3" class="headerlink" title="level 3"></a>level 3</h3><p><strong>Promise化</strong>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 返回一个Promise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> instance = axios.create(&#123;</span><br><span class="line">            baseURL: <span class="string">' http://www.liulongbin.top:3005'</span>,</span><br><span class="line">            timeout: <span class="number">5000</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        instance(config).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            resolve(res)</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            reject(err)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<p>调用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; request &#125; <span class="keyword">from</span> <span class="string">'./network/request'</span></span><br><span class="line"></span><br><span class="line">request(&#123;</span><br><span class="line">  url: <span class="string">'/api/getlunbo'</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="level-4"><a href="#level-4" class="headerlink" title="level 4"></a>level 4</h3><p>上面封装成 Promise 的版本还不是最好的，事实上<code>instance(config)</code>所返回的就是一个 <strong>Promise</strong>，因此可以不必再去封装成 Promise ，直接将 <code>instance(config)</code>返回出来即可：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 返回一个Promise</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> instance = axios.create(&#123;</span><br><span class="line">        baseURL: <span class="string">' http://www.liulongbin.top:3005'</span>,</span><br><span class="line">        timeout: <span class="number">5000</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> instance(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; request &#125; <span class="keyword">from</span> <span class="string">'./network/request'</span></span><br><span class="line"></span><br><span class="line">request(&#123;</span><br><span class="line">  url: <span class="string">'/api/getlunbo'</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><br><br></p>
<h2 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h2><p>在请求或响应被 <code>then</code> 或 <code>catch</code> 处理前拦截它们。</p>
<p>一般有以下业务场景：</p>
<ul>
<li>当config中的一些信息不符合服务器要求，可以在发送请求之前拦截之并进行修改</li>
<li>每次发送网络请求时，在界面中触发加载动画，响应完成时关闭加载动画</li>
<li>某些网络请求（比如登录的token），必须携带一些特殊的信息</li>
<li>等等等</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加请求拦截器</span></span><br><span class="line">axios.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 在发送请求之前做些什么</span></span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 对请求错误做些什么</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加响应拦截器</span></span><br><span class="line">axios.interceptors.response.use(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 对响应数据做点什么</span></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 对响应错误做点什么</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p>如果你想在稍后移除拦截器，可以这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myInterceptor = axios.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="comment">/*...*/</span>&#125;);</span><br><span class="line">axios.interceptors.request.eject(myInterceptor);</span><br></pre></td></tr></table></figure>
<p>可以为自定义 axios 实例添加拦截器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> instance = axios.create();</span><br><span class="line">instance.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="comment">/*...*/</span>&#125;);</span><br></pre></td></tr></table></figure>
<hr>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 返回一个Promise</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> instance = axios.create(&#123;</span><br><span class="line">        baseURL: <span class="string">' http://www.liulongbin.top:3005'</span>,</span><br><span class="line">        timeout: <span class="number">5000</span></span><br><span class="line">    &#125;)</span><br><span class="line">    instance.interceptors.request.use(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(config);<span class="comment">//拦截config进行处理，这里将其打印出来，这里的config实际上就是上面的config</span></span><br><span class="line">        <span class="keyword">return</span> config  <span class="comment">//这里必须return config以取消拦截，否则之后无法响应成功</span></span><br><span class="line">    &#125;, err =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    instance.interceptors.response.use(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res);<span class="comment">//拦截res进行处理，这里将其打印出来</span></span><br><span class="line">        <span class="keyword">return</span> res.data<span class="comment">//这里必须return res.data以取消拦截，否则之后无法响应成功</span></span><br><span class="line">    &#125;, err =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> instance(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dunteng.github.io/[object Object]2019/08/08/vi—终端中的编辑器.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dunteng Lin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunteng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]2019/08/08/vi—终端中的编辑器.html" itemprop="url">vi编辑器教程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-08T00:00:00+08:00">
                2019-08-08
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]2019/08/08/vi—终端中的编辑器.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/[object Object]2019/08/08/vi—终端中的编辑器.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="vi-——-终端中的编辑器"><a href="#vi-——-终端中的编辑器" class="headerlink" title="vi —— 终端中的编辑器"></a><code>vi</code> —— 终端中的编辑器</h1><h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><ul>
<li><code>vi</code> 简介</li>
<li>打开和新建文件</li>
<li>三种工作模式</li>
<li>常用命令</li>
<li>分屏命令</li>
<li>常用命令速查图</li>
</ul>
<h2 id="01-vi-简介"><a href="#01-vi-简介" class="headerlink" title="01. vi 简介"></a>01. <code>vi</code> 简介</h2><h3 id="1-1-学习-vi-的目的"><a href="#1-1-学习-vi-的目的" class="headerlink" title="1.1 学习 vi 的目的"></a>1.1 学习 <code>vi</code> 的目的</h3><ul>
<li>在工作中，要对 <strong>服务器</strong> 上的文件进行 <strong>简单</strong> 的修改，可以使用 <code>ssh</code> 远程登录到服务器上，并且使用 <code>vi</code> 进行快速的编辑即可</li>
<li>常见需要修改的文件包括：<ul>
<li><strong>源程序</strong></li>
<li><strong>配置文件</strong>，例如 <code>ssh</code> 的配置文件 <code>~/.ssh/config</code></li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>在没有图形界面的环境下，要编辑文件，<code>vi</code> 是最佳选择！</li>
<li>每一个要使用 Linux 的程序员，都应该或多或少的学习一些 <code>vi</code> 的常用命令</li>
</ul>
</blockquote>
<h3 id="1-2-vi-和-vim"><a href="#1-2-vi-和-vim" class="headerlink" title="1.2 vi 和 vim"></a>1.2 vi 和 vim</h3><ul>
<li>在很多 <code>Linux</code> 发行版中，直接把 <code>vi</code> 做成 <code>vim</code> 的软连接</li>
</ul>
<h4 id="vi"><a href="#vi" class="headerlink" title="vi"></a>vi</h4><ul>
<li><code>vi</code> 是 <code>Visual interface</code> 的简称，是 <code>Linux</code> 中 <strong>最经典</strong> 的文本编辑器</li>
<li><code>vi</code> 的核心设计思想 —— <strong>让程序员的手指始终保持在键盘的核心区域，就能完成所有的编辑操作</strong></li>
</ul>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vi/001_vi%E9%94%AE%E7%9B%98.png" alt="001_vi键盘-w551"></p>
<ul>
<li><code>vi</code> 的特点：<ul>
<li><strong>没有图形界面</strong> 的 <strong>功能强大</strong> 的编辑器</li>
<li>只能是编辑 <strong>文本内容</strong>，不能对字体、段落进行排版</li>
<li><strong>不支持鼠标操作</strong></li>
<li><strong>没有菜单</strong></li>
<li><strong>只有命令</strong></li>
</ul>
</li>
<li><code>vi</code> 编辑器在 <strong>系统管理</strong>、<strong>服务器管理</strong> 编辑文件时，<strong>其功能永远不是图形界面的编辑器能比拟的</strong></li>
</ul>
<h4 id="vim"><a href="#vim" class="headerlink" title="vim"></a><code>vim</code></h4><p><strong>vim = vi improved</strong></p>
<ul>
<li><code>vim</code> 是从 <code>vi</code> 发展出来的一个文本编辑器，支持 <strong>代码补全</strong>、<strong>编译</strong> 及 <strong>错误跳转</strong> 等方便编程的功能特别丰富，在程序员中被广泛使用，被称为 <strong>编辑器之神</strong></li>
</ul>
<h4 id="查询软连接命令（知道）"><a href="#查询软连接命令（知道）" class="headerlink" title="查询软连接命令（知道）"></a>查询软连接命令（知道）</h4><ul>
<li>在很多 <code>Linux</code> 发行版中直接把 <code>vi</code> 做成 <code>vim</code> 的软连接</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找 vi 的运行文件</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">which</span> vi</span><br><span class="line">$ ls -l /usr/bin/vi</span><br><span class="line">$ ls -l /etc/alternatives/vi</span><br><span class="line">$ ls -l /usr/bin/vim.basic</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找 vim 的运行文件</span></span><br><span class="line">$ <span class="built_in">which</span> vim</span><br><span class="line">$ ls -l /usr/bin/vim</span><br><span class="line">$ ls -l /etc/alternatives/vim</span><br><span class="line">$ ls -l /usr/bin/vim.basic</span><br></pre></td></tr></table></figure>
<h2 id="02-打开和新建文件"><a href="#02-打开和新建文件" class="headerlink" title="02. 打开和新建文件"></a>02. 打开和新建文件</h2><ul>
<li>在终端中输入 <code>vi</code> <strong>在后面跟上文件名</strong> 即可</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi 文件名</span><br></pre></td></tr></table></figure>
<ul>
<li>如果文件已经存在，会直接打开该文件</li>
<li>如果文件不存在，会新建一个文件</li>
</ul>
<h3 id="2-1-打开文件并且定位行"><a href="#2-1-打开文件并且定位行" class="headerlink" title="2.1 打开文件并且定位行"></a>2.1 打开文件并且定位行</h3><ul>
<li>在日常工作中，有可能会遇到 <strong>打开一个文件，并定位到指定行</strong> 的情况</li>
<li><p>例如：在开发时，<strong>知道某一行代码有错误</strong>，可以 <strong>快速定位</strong> 到出错代码的位置</p>
</li>
<li><p>这个时候，可以使用以下命令打开文件</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi 文件名 +行数</span><br></pre></td></tr></table></figure>
<blockquote>
<p>提示：如果只带上 <code>+</code> 而不指定行号，会直接定位到文件末尾</p>
</blockquote>
<h3 id="2-2-异常处理"><a href="#2-2-异常处理" class="headerlink" title="2.2 异常处理"></a>2.2 异常处理</h3><ul>
<li>如果 <code>vi</code> 异常退出，在磁盘上可能会保存有 <strong>交换文件</strong></li>
<li>下次再使用 <code>vi</code> 编辑该文件时，会看到以下屏幕信息，按下字母 <code>d</code> 可以 <strong>删除交换文件</strong> 即可</li>
</ul>
<blockquote>
<p>提示：按下键盘时，注意关闭输入法</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vi/002_%E5%88%A0%E9%99%A4%E4%BA%A4%E6%8D%A2%E6%96%87%E4%BB%B6.png" alt="002_删除交换文件-w1048"></p>
<h2 id="03-三种工作模式"><a href="#03-三种工作模式" class="headerlink" title="03. 三种工作模式"></a>03. 三种工作模式</h2><ul>
<li><p><code>vi</code> 有三种基本工作模式：</p>
<ol>
<li><strong>命令模式</strong><ul>
<li><strong>打开文件首先进入命令模式</strong>，是使用 <code>vi</code> 的 <strong>入口</strong></li>
<li>通过 <strong>命令</strong> 对文件进行常规的编辑操作，例如：<strong>定位</strong>、<strong>翻页</strong>、<strong>复制</strong>、<strong>粘贴</strong>、<strong>删除</strong>……</li>
<li>在其他图形编辑器下，通过 <strong>快捷键</strong> 或者 <strong>鼠标</strong> 实现的操作，都在 <strong>命令模式</strong> 下实现</li>
</ul>
</li>
<li><strong>末行模式</strong> —— 执行 <strong>保存</strong>、<strong>退出</strong> 等操作 <ul>
<li>要退出 <code>vi</code> 返回到控制台，需要在末行模式下输入命令</li>
<li><strong>末行模式</strong> 是 <code>vi</code> 的 <strong>出口</strong></li>
</ul>
</li>
<li><strong>编辑模式</strong> —— 正常的编辑文字</li>
</ol>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vi/003_vi%E7%9A%84%E6%A8%A1%E5%BC%8F.png" alt="003_vi的模式-w500"></p>
<blockquote>
<p>提示：在 <code>Touch Bar</code> 的 Mac 电脑上 ，按 <code>ESC</code> 不方便，可以使用 <code>CTRL + [</code> 替代</p>
</blockquote>
<h3 id="末行模式命令"><a href="#末行模式命令" class="headerlink" title="末行模式命令"></a>末行模式命令</h3><table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">英文</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">w</td>
<td style="text-align:center">write</td>
<td>保存</td>
</tr>
<tr>
<td style="text-align:center">q</td>
<td style="text-align:center">quit</td>
<td>退出，如果没有保存，不允许退出</td>
</tr>
<tr>
<td style="text-align:center">q!</td>
<td style="text-align:center">quit</td>
<td>强行退出，不保存退出</td>
</tr>
<tr>
<td style="text-align:center">wq</td>
<td style="text-align:center">write &amp; quit</td>
<td>保存并退出</td>
</tr>
<tr>
<td style="text-align:center">x</td>
<td style="text-align:center"></td>
<td>保存并退出</td>
</tr>
</tbody>
</table>
<h2 id="04-常用命令"><a href="#04-常用命令" class="headerlink" title="04. 常用命令"></a>04. 常用命令</h2><h3 id="命令线路图"><a href="#命令线路图" class="headerlink" title="命令线路图"></a>命令线路图</h3><ol start="0">
<li>重复次数<ul>
<li>在命令模式下，<strong>先输入一个数字</strong>，<strong>再跟上一个命令</strong>，可以让该命令 <strong>重复执行指定次数</strong> </li>
</ul>
</li>
<li>移动和选择（<strong>多练</strong>）<ul>
<li><code>vi</code> 之所以快，关键在于 <strong>能够快速定位到要编辑的代码行</strong></li>
<li><strong>移动命令</strong> 能够 和 <strong>编辑操作</strong> 命令 <strong>组合使用</strong></li>
</ul>
</li>
<li>编辑操作<ul>
<li><strong>删除</strong>、<strong>复制</strong>、<strong>粘贴</strong>、<strong>替换</strong>、<strong>缩排</strong></li>
</ul>
</li>
<li>撤销和重复</li>
<li>查找替换</li>
<li>编辑</li>
</ol>
<h4 id="学习提示"><a href="#学习提示" class="headerlink" title="学习提示"></a>学习提示</h4><ol>
<li><code>vi</code> 的命令较多，<strong>不要期望一下子全部记住</strong>，个别命令忘记了，只是会影响编辑速度而已</li>
<li>在使用 <code>vi</code> 命令时，注意 <strong>关闭中文输入法</strong></li>
</ol>
<h3 id="4-1-移动（基本）"><a href="#4-1-移动（基本）" class="headerlink" title="4.1 移动（基本）"></a>4.1 移动（基本）</h3><ul>
<li>要熟练使用 <code>vi</code>，首先应该学会怎么在 <strong>命令模式</strong> 下样快速移动光标</li>
<li><strong>编辑操作命令</strong>，能够和 <strong>移动命令</strong> 结合在一起使用</li>
</ul>
<h4 id="1-上、下、左、右"><a href="#1-上、下、左、右" class="headerlink" title="1) 上、下、左、右"></a>1) 上、下、左、右</h4><table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th>功能</th>
<th style="text-align:center">手指</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">h</td>
<td>向左</td>
<td style="text-align:center">食指</td>
</tr>
<tr>
<td style="text-align:center">j</td>
<td>向下</td>
<td style="text-align:center">食指</td>
</tr>
<tr>
<td style="text-align:center">k</td>
<td>向上</td>
<td style="text-align:center">中指</td>
</tr>
<tr>
<td style="text-align:center">l</td>
<td>向右</td>
<td style="text-align:center">无名指</td>
</tr>
</tbody>
</table>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vi/005_%E7%A7%BB%E5%8A%A8%E5%85%89%E6%A0%87.png" alt="005_移动光标-w551"></p>
<h4 id="2-行内移动"><a href="#2-行内移动" class="headerlink" title="2) 行内移动"></a>2) 行内移动</h4><table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">英文</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">w</td>
<td style="text-align:center">word</td>
<td>向后移动一个单词</td>
</tr>
<tr>
<td style="text-align:center">b</td>
<td style="text-align:center">back</td>
<td>向前移动一个单词</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center"></td>
<td>行首</td>
</tr>
<tr>
<td style="text-align:center">^</td>
<td style="text-align:center"></td>
<td>行首，第一个不是空白字符的位置</td>
</tr>
<tr>
<td style="text-align:center">$</td>
<td style="text-align:center"></td>
<td>行尾</td>
</tr>
</tbody>
</table>
<h4 id="3-行数移动"><a href="#3-行数移动" class="headerlink" title="3) 行数移动"></a>3) 行数移动</h4><table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">英文</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">gg</td>
<td style="text-align:center">go</td>
<td>文件顶部</td>
</tr>
<tr>
<td style="text-align:center">G</td>
<td style="text-align:center">go</td>
<td>文件末尾</td>
</tr>
<tr>
<td style="text-align:center">数字gg</td>
<td style="text-align:center">go</td>
<td>移动到 数字 对应行数</td>
</tr>
<tr>
<td style="text-align:center">数字G</td>
<td style="text-align:center">go</td>
<td>移动到 数字 对应行数</td>
</tr>
<tr>
<td style="text-align:center">:数字</td>
<td style="text-align:center"></td>
<td>移动到 数字 对应行数</td>
</tr>
</tbody>
</table>
<h4 id="4-屏幕移动"><a href="#4-屏幕移动" class="headerlink" title="4) 屏幕移动"></a>4) 屏幕移动</h4><table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">英文</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Ctrl + b</td>
<td style="text-align:center">back</td>
<td>向上翻页</td>
</tr>
<tr>
<td style="text-align:center">Ctrl + f</td>
<td style="text-align:center">forward</td>
<td>向下翻页</td>
</tr>
<tr>
<td style="text-align:center">H</td>
<td style="text-align:center">Head</td>
<td>屏幕顶部</td>
</tr>
<tr>
<td style="text-align:center">M</td>
<td style="text-align:center">Middle</td>
<td>屏幕中间</td>
</tr>
<tr>
<td style="text-align:center">L</td>
<td style="text-align:center">Low</td>
<td>屏幕底部</td>
</tr>
</tbody>
</table>
<h3 id="4-2-移动（程序）"><a href="#4-2-移动（程序）" class="headerlink" title="4.2 移动（程序）"></a>4.2 移动（程序）</h3><h4 id="1-段落移动"><a href="#1-段落移动" class="headerlink" title="1) 段落移动"></a>1) 段落移动</h4><ul>
<li><code>vi</code> 中使用 空行 来区分段落</li>
<li>在程序开发时，通常 <strong>一段功能相关的代码会写在一起</strong> —— 之间没有空行</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">{</td>
<td>上一段</td>
</tr>
<tr>
<td style="text-align:center">}</td>
<td>下一段</td>
</tr>
</tbody>
</table>
<h4 id="2-括号切换"><a href="#2-括号切换" class="headerlink" title="2) 括号切换"></a>2) 括号切换</h4><ul>
<li>在程序世界中，<code>()</code>、<code>[]</code>、<code>{}</code> 使用频率很高，而且 <strong>都是成对出现的</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">%</td>
<td>括号匹配及切换</td>
</tr>
</tbody>
</table>
<h4 id="3-标记"><a href="#3-标记" class="headerlink" title="3) 标记"></a>3) 标记</h4><ul>
<li>在开发时，某一块代码可能<strong>需要稍后处理</strong>，例如：编辑、查看</li>
<li>此时先使用 <code>m</code> 增加一个标记，这样可以 <strong>在需要时快速地跳转回来</strong> 或者 <strong>执行其他编辑操作</strong></li>
<li><strong>标记名称</strong> 可以是 <code>a~z</code> 或者 <code>A~Z</code> 之间的任意 <strong>一个</strong> 字母</li>
<li>添加了标记的 <strong>行如果被删除</strong>，<strong>标记同时被删除</strong></li>
<li>如果 <strong>在其他行添加了相同名称的标记</strong>，<strong>之前添加的标记也会被替换掉</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">英文</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">mx</td>
<td style="text-align:center">mark</td>
<td>添加标记 x，x 是 a~z 或者 A~Z 之间的任意一个字母</td>
</tr>
<tr>
<td style="text-align:center">‘x</td>
<td style="text-align:center"></td>
<td>直接定位到标记 x 所在位置</td>
</tr>
</tbody>
</table>
<h3 id="4-3-选中文本（可视模式）"><a href="#4-3-选中文本（可视模式）" class="headerlink" title="4.3 选中文本（可视模式）"></a>4.3 选中文本（可视模式）</h3><ul>
<li>学习 <code>复制</code> 命令前，应该先学会 <strong>怎么样选中 要复制的代码</strong></li>
<li>在 <code>vi</code> 中要选择文本，需要先使用 <code>Visual</code> 命令切换到 <strong>可视模式</strong></li>
<li><code>vi</code> 中提供了 <strong>三种</strong> 可视模式，可以方便程序员选择 <strong>选中文本的方式</strong></li>
<li>按 <code>ESC</code> 可以放弃选中，返回到 <strong>命令模式</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th>模式</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">v</td>
<td>可视模式</td>
<td>从光标位置开始按照正常模式选择文本</td>
</tr>
<tr>
<td style="text-align:center">V</td>
<td>可视行模式</td>
<td>选中光标经过的完整行</td>
</tr>
<tr>
<td style="text-align:center">Ctrl + v</td>
<td>可视块模式</td>
<td>垂直方向选中文本</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>可视模式</strong>下，可以和 <strong>移动命令</strong> 连用，例如：<code>ggVG</code> 能够选中所有内容</li>
</ul>
<h3 id="4-4-撤销和恢复撤销"><a href="#4-4-撤销和恢复撤销" class="headerlink" title="4.4 撤销和恢复撤销"></a>4.4 撤销和恢复撤销</h3><ul>
<li>在学习编辑命令之前，先要知道怎样撤销之前一次 <strong>错误的</strong> 编辑动作！</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">英文</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">u</td>
<td style="text-align:center">undo</td>
<td>撤销上次命令</td>
</tr>
<tr>
<td style="text-align:center">CTRL + r</td>
<td style="text-align:center">redo</td>
<td>恢复撤销的命令</td>
</tr>
</tbody>
</table>
<h3 id="4-5-删除文本"><a href="#4-5-删除文本" class="headerlink" title="4.5 删除文本"></a>4.5 删除文本</h3><table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">英文</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">x</td>
<td style="text-align:center">cut</td>
<td>删除光标所在字符，或者选中文字</td>
</tr>
<tr>
<td style="text-align:center">d(移动命令)</td>
<td style="text-align:center">delete</td>
<td>删除移动命令对应的内容</td>
</tr>
<tr>
<td style="text-align:center">dd</td>
<td style="text-align:center">delete</td>
<td>删除光标所在行，可以 ndd 复制多行</td>
</tr>
<tr>
<td style="text-align:center">D</td>
<td style="text-align:center">delete</td>
<td>删除至行尾</td>
</tr>
</tbody>
</table>
<blockquote>
<p>提示：如果使用 <strong>可视模式</strong> 已经选中了一段文本，那么无论使用 <code>d</code> 还是 <code>x</code>，都可以删除选中文本</p>
</blockquote>
<ul>
<li>删除命令可以和 <strong>移动命令</strong> 连用，以下是常见的组合命令：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* dw        # 从光标位置删除到单词末尾</span><br><span class="line">* d0        # 从光标位置删除到一行的起始位置</span><br><span class="line">* d&#125;        # 从光标位置删除到段落结尾</span><br><span class="line">* ndd       # 从光标位置向下连续删除 n 行</span><br><span class="line">* d代码行G   # 从光标所在行 删除到 指定代码行 之间的所有代码</span><br><span class="line">* d&apos;a       # 从光标所在行 删除到 标记a 之间的所有代码</span><br></pre></td></tr></table></figure>
<h3 id="4-6-复制、粘贴"><a href="#4-6-复制、粘贴" class="headerlink" title="4.6 复制、粘贴"></a>4.6 复制、粘贴</h3><ul>
<li><code>vi</code> 中提供有一个 <strong>被复制文本的缓冲区</strong><ul>
<li><strong>复制</strong> 命令会将选中的文字保存在缓冲区 </li>
<li><strong>删除</strong> 命令删除的文字会被保存在缓冲区</li>
<li>在需要的位置，使用 <strong>粘贴</strong> 命令可以将缓冲区的文字插入到光标所在位置</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">英文</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">y(移动命令)</td>
<td style="text-align:center">copy</td>
<td>复制</td>
</tr>
<tr>
<td style="text-align:center">yy</td>
<td style="text-align:center">copy</td>
<td>复制一行，可以 nyy 复制多行</td>
</tr>
<tr>
<td style="text-align:center">p</td>
<td style="text-align:center">paste</td>
<td>粘贴</td>
</tr>
</tbody>
</table>
<p><strong>提示</strong></p>
<ul>
<li>命令 <code>d</code>、<code>x</code> 类似于图形界面的 <strong>剪切操作</strong> —— <code>CTRL + X</code></li>
<li>命令 <code>y</code> 类似于图形界面的 <strong>复制操作</strong> —— <code>CTRL + C</code></li>
<li>命令 <code>p</code> 类似于图形界面的 <strong>粘贴操作</strong> —— <code>CTRL + V</code></li>
<li><code>vi</code> 中的 <strong>文本缓冲区同样只有一个</strong>，如果后续做过 <strong>复制、剪切</strong> 操作，之前缓冲区中的内容会被替换</li>
</ul>
<p><strong>注意</strong></p>
<ul>
<li><code>vi</code> 中的 <strong>文本缓冲区</strong> 和系统的 <strong>剪贴板</strong> 不是同一个</li>
<li>所以在其他软件中使用 <code>CTRL + C</code> 复制的内容，不能在 <code>vi</code> 中通过 <code>P</code> 命令粘贴</li>
<li>可以在 <strong>编辑模式</strong> 下使用 <strong>鼠标右键粘贴</strong></li>
</ul>
<h3 id="4-7-替换"><a href="#4-7-替换" class="headerlink" title="4.7 替换"></a>4.7 替换</h3><table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">英文</th>
<th>功能</th>
<th>工作模式</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">r</td>
<td style="text-align:center">replace</td>
<td>替换当前字符</td>
<td>命令模式</td>
</tr>
<tr>
<td style="text-align:center">R</td>
<td style="text-align:center">replace</td>
<td>替换当前行光标后的字符</td>
<td>替换模式</td>
</tr>
</tbody>
</table>
<ul>
<li><code>R</code> 命令可以进入 <strong>替换模式</strong>，替换完成后，按下 <code>ESC</code> 可以回到 <strong>命令模式</strong></li>
<li><strong>替换命令</strong> 的作用就是不用进入 <strong>编辑模式</strong>，对文件进行 <strong>轻量级的修改</strong></li>
</ul>
<h3 id="4-8-缩排和重复执行"><a href="#4-8-缩排和重复执行" class="headerlink" title="4.8 缩排和重复执行"></a>4.8 缩排和重复执行</h3><table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">&gt;&gt;</td>
<td>向右增加缩进</td>
</tr>
<tr>
<td style="text-align:center">&lt;&lt;</td>
<td>向左减少缩进</td>
</tr>
<tr>
<td style="text-align:center">.</td>
<td>重复上次命令</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>缩排命令</strong> 在开发程序时，<strong>统一增加代码的缩进</strong> 比较有用！<ul>
<li>一次性 <strong>在选中代码前增加 4 个空格</strong>，就叫做 <strong>增加缩进</strong></li>
<li>一次性 <strong>在选中代码前删除 4 个空格</strong>，就叫做 <strong>减少缩进</strong></li>
</ul>
</li>
<li>在 <strong>可视模式</strong> 下，缩排命令只需要使用 <strong>一个</strong> <code>&gt;</code> 或者 <code>&lt;</code> </li>
</ul>
<blockquote>
<p>在程序中，<strong>缩进</strong> 通常用来表示代码的归属关系</p>
<ul>
<li>前面空格越少，代码的级别越高</li>
<li>前面空格越多，代码的级别越低</li>
</ul>
</blockquote>
<h3 id="4-9-查找"><a href="#4-9-查找" class="headerlink" title="4.9 查找"></a>4.9 查找</h3><h4 id="常规查找"><a href="#常规查找" class="headerlink" title="常规查找"></a>常规查找</h4><table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">/str</td>
<td>查找 str</td>
</tr>
</tbody>
</table>
<ul>
<li>查找到指定内容之后，使用 <code>Next</code> 查找下一个出现的位置：<ul>
<li><code>n</code>: 查找下一个</li>
<li><code>N</code>: 查找上一个</li>
</ul>
</li>
<li>如果不想看到高亮显示，可以随便查找一个文件中不存在的内容即可</li>
</ul>
<h4 id="单词快速匹配"><a href="#单词快速匹配" class="headerlink" title="单词快速匹配"></a>单词快速匹配</h4><table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">*</td>
<td>向后查找当前光标所在单词</td>
</tr>
<tr>
<td style="text-align:center">#</td>
<td>向前查找当前光标所在单词</td>
</tr>
</tbody>
</table>
<ul>
<li>在开发中，通过单词快速匹配，可以快速看到这个单词在其他什么位置使用过</li>
</ul>
<h3 id="4-10-查找并替换"><a href="#4-10-查找并替换" class="headerlink" title="4.10 查找并替换"></a>4.10 查找并替换</h3><ul>
<li>在 <code>vi</code> 中查找和替换命令需要在 <strong>末行模式</strong> 下执行</li>
<li>记忆命令格式：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s///g</span><br></pre></td></tr></table></figure>
<h4 id="1-全局替换"><a href="#1-全局替换" class="headerlink" title="1) 全局替换"></a>1) 全局替换</h4><ul>
<li><strong>一次性</strong>替换文件中的 <strong>所有出现的旧文本</strong></li>
<li>命令格式如下：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s/旧文本/新文本/g</span><br></pre></td></tr></table></figure>
<h4 id="2-可视区域替换"><a href="#2-可视区域替换" class="headerlink" title="2) 可视区域替换"></a>2) 可视区域替换</h4><ul>
<li><strong>先选中</strong> 要替换文字的 <strong>范围</strong></li>
<li>命令格式如下：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:s/旧文本/新文本/g</span><br></pre></td></tr></table></figure>
<h4 id="3-确认替换"><a href="#3-确认替换" class="headerlink" title="3) 确认替换"></a>3) 确认替换</h4><ul>
<li>如果把末尾的 <code>g</code> 改成 <code>gc</code> 在替换的时候，会有提示！<strong>推荐使用！</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s/旧文本/新文本/gc</span><br></pre></td></tr></table></figure>
<ol>
<li><code>y</code> - <code>yes</code> 替换</li>
<li><code>n</code> - <code>no</code> 不替换</li>
<li><code>a</code> - <code>all</code> 替换所有</li>
<li><code>q</code> - <code>quit</code> 退出替换</li>
<li><code>l</code> - <code>last</code> 最后一个，并把光标移动到行首</li>
<li><code>^E</code> 向下滚屏</li>
<li><code>^Y</code> 向上滚屏</li>
</ol>
<h3 id="4-11-插入命令"><a href="#4-11-插入命令" class="headerlink" title="4.11 插入命令"></a>4.11 插入命令</h3><ul>
<li>在 <code>vi</code> 中除了常用的 <code>i</code> 进入 <strong>编辑模式</strong> 外，还提供了以下命令同样可以进入编辑模式：</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">英文</th>
<th>功能</th>
<th style="text-align:center">常用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">i</td>
<td style="text-align:center">insert</td>
<td>在当前字符前插入文本</td>
<td style="text-align:center">常用</td>
</tr>
<tr>
<td style="text-align:center">I</td>
<td style="text-align:center">insert</td>
<td>在行首插入文本</td>
<td style="text-align:center">较常用</td>
</tr>
<tr>
<td style="text-align:center">a</td>
<td style="text-align:center">append</td>
<td>在当前字符后添加文本</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">A</td>
<td style="text-align:center">append</td>
<td>在行末添加文本</td>
<td style="text-align:center">较常用</td>
</tr>
<tr>
<td style="text-align:center">o</td>
<td style="text-align:center"></td>
<td>在当前行后面插入一空行</td>
<td style="text-align:center">常用</td>
</tr>
<tr>
<td style="text-align:center">O</td>
<td style="text-align:center"></td>
<td>在当前行前面插入一空行</td>
<td style="text-align:center">常用</td>
</tr>
</tbody>
</table>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vi/004_%E6%8F%92%E5%85%A5%E5%91%BD%E4%BB%A4.png" alt="004_插入命令-w400"></p>
<h4 id="演练-1-——-编辑命令和数字连用"><a href="#演练-1-——-编辑命令和数字连用" class="headerlink" title="演练 1 —— 编辑命令和数字连用"></a>演练 1 —— 编辑命令和数字连用</h4><ul>
<li>在开发中，可能会遇到连续输入 <code>N</code> 个同样的字符</li>
</ul>
<blockquote>
<p>在 <code>Python</code> 中有简单的方法，但是其他语言中通常需要自己输入</p>
</blockquote>
<ul>
<li>例如：<code>**********</code> 连续 10 个星号</li>
</ul>
<p>要实现这个效果可以在 <strong>命令模式</strong> 下</p>
<ol>
<li>输入 <code>10</code>，表示要重复 10 次</li>
<li>输入 <code>i</code> 进入 <strong>编辑模式</strong></li>
<li>输入 <code>*</code> 也就是重复的文字</li>
<li>按下 <code>ESC</code> 返回到 <strong>命令模式</strong>，返回之后 <code>vi</code> 就会把第 <code>2、3</code> 两步的操作重复 <code>10</code> 次</li>
</ol>
<blockquote>
<p>提示：正常开发时，在 <strong>进入编辑模式之前，不要按数字</strong></p>
</blockquote>
<h4 id="演练-2-——-利用-可视块-给多行代码增加注释"><a href="#演练-2-——-利用-可视块-给多行代码增加注释" class="headerlink" title="演练 2 —— 利用 可视块 给多行代码增加注释"></a>演练 2 —— 利用 可视块 给多行代码增加注释</h4><ul>
<li>在开发中，可能会遇到一次性给多行代码 <strong>增加注释</strong> 的情况</li>
</ul>
<blockquote>
<p>在 <code>Python</code> 中，要给代码增加注释，可以在代码前增加一个 <code>#</code></p>
</blockquote>
<p>要实现这个效果可以在 <strong>命令模式</strong> 下</p>
<ol>
<li>移动到要添加注释的 <strong>第 1 行代码</strong>，按 <code>^</code> 来到行首</li>
<li>按 <code>CTRL + v</code> 进入 <strong>可视块</strong> 模式</li>
<li>使用 <code>j</code> 向下连续选中要添加的代码行</li>
<li>输入 <code>I</code> 进入 <strong>编辑模式</strong>，并在 <strong>行首插入</strong>，注意：一定要使用 <strong>I</strong></li>
<li>输入 <code>#</code> 也就是注释符号</li>
<li>按下 <code>ESC</code> 返回到 <strong>命令模式</strong>，返回之后 <code>vi</code> 会在之前选中的每一行代码 <strong>前</strong> 插入 <code>#</code></li>
</ol>
<h2 id="05-分屏命令"><a href="#05-分屏命令" class="headerlink" title="05. 分屏命令"></a>05. 分屏命令</h2><ul>
<li>属于 <code>vi</code> 的高级命令 —— 可以 <strong>同时编辑和查看多个文件</strong></li>
</ul>
<h3 id="5-1-末行命令扩展"><a href="#5-1-末行命令扩展" class="headerlink" title="5.1 末行命令扩展"></a>5.1 末行命令扩展</h3><p><strong>末行命令</strong> 主要是针对文件进行操作的：<strong>保存</strong>、<strong>退出</strong>、<strong>保存&amp;退出</strong>、<strong>搜索&amp;替换</strong>、<strong>另存</strong>、<strong>新建</strong>、<strong>浏览文件</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">英文</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">:e .</td>
<td style="text-align:center">edit</td>
<td>会打开内置的文件浏览器，浏览要当前目录下的文件</td>
</tr>
<tr>
<td style="text-align:center">:n 文件名</td>
<td style="text-align:center">new</td>
<td>新建文件</td>
</tr>
<tr>
<td style="text-align:center">:w 文件名</td>
<td style="text-align:center">write</td>
<td>另存为，但是仍然编辑当前文件，并不会切换文件</td>
</tr>
</tbody>
</table>
<blockquote>
<p>提示：切换文件之前，必须保证当前这个文件已经被保存！</p>
</blockquote>
<ul>
<li>已经学习过的 <strong>末行命令</strong>：</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">英文</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">:w</td>
<td style="text-align:center">write</td>
<td>保存</td>
</tr>
<tr>
<td style="text-align:center">:q</td>
<td style="text-align:center">quit</td>
<td>退出，如果没有保存，不允许退出</td>
</tr>
<tr>
<td style="text-align:center">:q!</td>
<td style="text-align:center">quit</td>
<td>强行退出，不保存退出</td>
</tr>
<tr>
<td style="text-align:center">:wq</td>
<td style="text-align:center">write &amp; quit</td>
<td>保存并退出</td>
</tr>
<tr>
<td style="text-align:center">:x</td>
<td style="text-align:center"></td>
<td>保存并退出</td>
</tr>
<tr>
<td style="text-align:center">:%s///gc</td>
<td style="text-align:center"></td>
<td>确认搜索并替换</td>
</tr>
</tbody>
</table>
<blockquote>
<p>在实际开发中，可以使用 <code>w</code> 命令 <strong>阶段性的备份代码</strong></p>
</blockquote>
<h3 id="5-2-分屏命令"><a href="#5-2-分屏命令" class="headerlink" title="5.2 分屏命令"></a>5.2 分屏命令</h3><ul>
<li>使用 <strong>分屏命令</strong>，可以 <strong>同时编辑和查看多个文件</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">英文</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">:sp [文件名]</td>
<td style="text-align:center">split</td>
<td>横向增加分屏</td>
</tr>
<tr>
<td style="text-align:center">:vsp [文件名]</td>
<td style="text-align:center">vertical split</td>
<td>纵向增加分屏</td>
</tr>
</tbody>
</table>
<h4 id="1-切换分屏窗口"><a href="#1-切换分屏窗口" class="headerlink" title="1) 切换分屏窗口"></a>1) 切换分屏窗口</h4><blockquote>
<p>分屏窗口都是基于 <code>CTRL + W</code> 这个快捷键的，<code>w</code> 对应的英文单词是 <code>window</code></p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">英文</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">w</td>
<td style="text-align:center">window</td>
<td>切换到下一个窗口</td>
</tr>
<tr>
<td style="text-align:center">r</td>
<td style="text-align:center">reverse</td>
<td>互换窗口</td>
</tr>
<tr>
<td style="text-align:center">c</td>
<td style="text-align:center">close</td>
<td>关闭当前窗口，但是不能关闭最后一个窗口</td>
</tr>
<tr>
<td style="text-align:center">q</td>
<td style="text-align:center">quit</td>
<td>退出当前窗口，如果是最后一个窗口，则关闭 vi</td>
</tr>
<tr>
<td style="text-align:center">o</td>
<td style="text-align:center">other</td>
<td>关闭其他窗口</td>
</tr>
</tbody>
</table>
<h4 id="2-调整窗口大小"><a href="#2-调整窗口大小" class="headerlink" title="2) 调整窗口大小"></a>2) 调整窗口大小</h4><blockquote>
<p>分屏窗口都是基于 <code>CTRL + W</code> 这个快捷键的，<code>w</code> 对应的英文单词是 <code>window</code></p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">英文</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">+</td>
<td style="text-align:center"></td>
<td>增加窗口高度</td>
</tr>
<tr>
<td style="text-align:center">-</td>
<td style="text-align:center"></td>
<td>减少窗口高度</td>
</tr>
<tr>
<td style="text-align:center">&gt;</td>
<td style="text-align:center"></td>
<td>增加窗口宽度</td>
</tr>
<tr>
<td style="text-align:center">&lt;</td>
<td style="text-align:center"></td>
<td>减少窗口宽度</td>
</tr>
<tr>
<td style="text-align:center">=</td>
<td style="text-align:center"></td>
<td>等分窗口大小</td>
</tr>
</tbody>
</table>
<blockquote>
<p>调整窗口宽高的命令可以和数字连用，例如：<code>5 CTRL + W +</code> 连续 5 次增加高度</p>
</blockquote>
<h2 id="06-常用命令速查图"><a href="#06-常用命令速查图" class="headerlink" title="06. 常用命令速查图"></a>06. 常用命令速查图</h2><p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vi/vim.png" alt="vi"></p>
<h3 id="vimrc"><a href="#vimrc" class="headerlink" title="vimrc"></a>vimrc</h3><ul>
<li><code>vimrc</code> 是 <code>vim</code> 的配置文件，可以设置 vim 的配置，包括：<strong>热键</strong>、<strong>配色</strong>、<strong>语法高亮</strong>、<strong>插件</strong> 等</li>
<li><code>Linux</code> 中 <code>vimrc</code> 有两个位置，<strong>家目录下的配置文件优先级更高</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/vim/vimrc</span><br><span class="line">~/.vimrc</span><br></pre></td></tr></table></figure>
<ul>
<li>常用的插件有：<ul>
<li>代码补全</li>
<li>代码折叠</li>
<li>搜索</li>
<li>Git 集成</li>
<li>……</li>
</ul>
</li>
<li>网上有很多高手已经配置好的针对 <code>python</code> 开发的 <code>vimrc</code> 文件，可以下载过来直接使用，或者等大家多 <code>Linux</code> 比较熟悉后，再行学习！</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dunteng.github.io/[object Object]2019/06/05/02Vue音乐播放器.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dunteng Lin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunteng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]2019/06/05/02Vue音乐播放器.html" itemprop="url">Vue音乐播放器(二)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-05T00:00:00+08:00">
                2019-06-05
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]2019/06/05/02Vue音乐播放器.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/[object Object]2019/06/05/02Vue音乐播放器.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="推荐页面开发"><a href="#推荐页面开发" class="headerlink" title="推荐页面开发"></a>推荐页面开发</h1><h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><p><a href="https://github.com/Dunteng/Vue-Music-WebApp/tree/v3/vue-music" target="_blank" rel="noopener">完成轮播图时</a></p>
<p><a href="https://github.com/Dunteng/Vue-Music-WebApp/tree/v4/vue-music" target="_blank" rel="noopener">完成歌单列表时</a></p>
<p><br><br></p>
<h2 id="better-scroll插件"><a href="#better-scroll插件" class="headerlink" title="better-scroll插件"></a>better-scroll插件</h2><p><a href="https://github.com/ustbhuangyi/better-scroll/blob/master/README_zh-CN.md" target="_blank" rel="noopener">中文文档</a></p>
<p><a href="https://ustbhuangyi.github.io/better-scroll/#/" target="_blank" rel="noopener">1.x Docs</a></p>
<p><a href="https://better-scroll.github.io/docs/en-US/" target="_blank" rel="noopener">2.x Docs</a></p>
<p>之后的轮播图组件和列表滚动组件都会用到这个插件。这个插件还挺牛逼的，9400+stars。</p>
<p><br><br></p>
<h2 id="QQ音乐的api"><a href="#QQ音乐的api" class="headerlink" title="QQ音乐的api"></a>QQ音乐的api</h2><ul>
<li><p>jsonp用到的：</p>
<p><a href="https://c.y.qq.com/musichall/fcgi-bin/fcg_yqqhomepagerecommend.fcg" target="_blank" rel="noopener">https://c.y.qq.com/musichall/fcgi-bin/fcg_yqqhomepagerecommend.fcg</a></p>
</li>
<li><p>axios/Ajax用到的：</p>
<p>在webpack.dev.conf.js中配置，见下文</p>
</li>
</ul>
<p><br><br></p>
<h2 id="【重点难点一】recommend页面jsonp相关文件的编写"><a href="#【重点难点一】recommend页面jsonp相关文件的编写" class="headerlink" title="【重点难点一】recommend页面jsonp相关文件的编写"></a>【重点难点一】recommend页面jsonp相关文件的编写</h2><h3 id="src-common-js-jsonp-js-promise封装"><a href="#src-common-js-jsonp-js-promise封装" class="headerlink" title="src/common/js/jsonp.js  promise封装"></a>src/common/js/jsonp.js  promise封装</h3><p>本项目该部分使用jsonp技术获取数据，解决跨域问题。</p>
<p>这里使用一个封装好的<a href="https://github.com/webmodules/jsonp" target="_blank" rel="noopener">jsonp插件</a>。这是它的API :</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1560407149676.png" alt="1560407149676"></p>
<p>利用这个插件里面提供的api进行<strong>Promise</strong>的改写—-&gt; jsonp.js的创建。</p>
<p>先<code>npm i jsonp</code>进行jsonp插件的安装。</p>
<p>之后会经常用到它，把他放在js文件夹下，然后编写src/common/js/jsonp.js:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> originJsonp <span class="keyword">from</span> <span class="string">'jsonp'</span></span><br><span class="line"><span class="comment">/* jsonp2这个函数的三个参数，url是一个干净的不带参数的url地址，data表示随同url传过去的参数，</span></span><br><span class="line"><span class="comment">  因为jsonp这个插件要求的url是不支持object类型的的data参数的，所以我们需要先将data里面的数据拼接到url上。</span></span><br><span class="line"><span class="comment">  第三个参数option对应jsonp插件api里的opts参数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">jsonp2</span>(<span class="params">url, data, option</span>) </span>&#123;</span><br><span class="line">  url += (url.indexOf(<span class="string">'?'</span>) &lt; <span class="number">0</span> ? <span class="string">'?'</span> : <span class="string">'&amp;'</span>) + param(data)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    originJsonp(url, option, (err, data) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">        resolve(data)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        reject(err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">param</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> url = <span class="string">''</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> data) &#123;</span><br><span class="line">    <span class="keyword">let</span> value = data[k] !== <span class="literal">undefined</span> ? data[k] : <span class="string">''</span></span><br><span class="line">    url += <span class="string">'&amp;'</span> + k + <span class="string">'='</span> + <span class="built_in">encodeURIComponent</span>(value)<span class="comment">/* encodeURIComponent(value)进行字符转义，如encodeURIComponent('百度')转为"%E7%99%BE%E5%BA%A6" */</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> url ? url.substring(<span class="number">1</span>) : <span class="string">''</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>我们把请求api数据相关的js放在<code>src/api</code>目录下</p>
<p><br></p>
<h3 id="src-api-config-js"><a href="#src-api-config-js" class="headerlink" title="src/api/config.js"></a>src/api/config.js</h3><p>这部分主要就是模拟qq音乐api的参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> commonParams = &#123;</span><br><span class="line">  g_tk: <span class="number">5381</span>,</span><br><span class="line">  inCharset: <span class="string">'utf-8'</span>,</span><br><span class="line">  outCharset: <span class="string">'utf-8'</span>,</span><br><span class="line">  notice: <span class="number">0</span>,</span><br><span class="line">  format: <span class="string">'jsonp'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> options = &#123;</span><br><span class="line">  param: <span class="string">'jsonpCallback'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ERR_OK = <span class="number">0</span>  <span class="comment">/* 语义化一下 */</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="src-api-recommend-js"><a href="#src-api-recommend-js" class="headerlink" title="src/api/recommend.js:"></a>src/api/recommend.js:</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jsonp <span class="keyword">from</span> <span class="string">'common/js/jsonp'</span></span><br><span class="line"><span class="keyword">import</span> &#123;commonParams, options&#125; <span class="keyword">from</span> <span class="string">'./config'</span></span><br><span class="line"><span class="comment">// import axios from 'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getRecommend</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> url = <span class="string">'https://c.y.qq.com/musichall/fcgi-bin/fcg_yqqhomepagerecommend.fcg'</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> data = <span class="built_in">Object</span>.assign(&#123;&#125;, commonParams, &#123;</span><br><span class="line">    platform: <span class="string">'h5'</span>,</span><br><span class="line">    uin: <span class="number">0</span>,</span><br><span class="line">    needNewCode: <span class="number">1</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> jsonp(url, data, options)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="webpack-base-conf-js"><a href="#webpack-base-conf-js" class="headerlink" title="webpack.base.conf.js"></a>webpack.base.conf.js</h3><p>添加多两个别名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">alias: &#123;</span><br><span class="line">  &apos;@&apos;: resolve(&apos;src&apos;),</span><br><span class="line">  &apos;common&apos;: resolve(&apos;src/common&apos;),</span><br><span class="line">  &apos;components&apos;: resolve(&apos;src/components&apos;),</span><br><span class="line">  &apos;base&apos;: resolve(&apos;src/base&apos;),</span><br><span class="line">  &apos;api&apos;: resolve(&apos;src/api&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="recommend-vue"><a href="#recommend-vue" class="headerlink" title="recommend.vue"></a>recommend.vue</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;recommend&quot; ref=&quot;recommend&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/ecmascript-6&quot;&gt;</span><br><span class="line">  import &#123;getRecommend&#125; from &apos;api/recommend&apos;</span><br><span class="line">  import &#123;ERR_OK&#125; from &apos;api/config&apos;</span><br><span class="line"></span><br><span class="line">  export default &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        recommends: [],</span><br><span class="line">        discList: []</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line">      this._getRecommend()</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      _getRecommend() &#123;</span><br><span class="line">        getRecommend().then((res) =&gt; &#123;</span><br><span class="line">          if (res.code === ERR_OK) &#123;</span><br><span class="line">            this.recommends = res.data.slider</span><br><span class="line">            console.log(res);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang=&quot;stylus&quot; rel=&quot;stylesheet/stylus&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>看一下这时候有没有抓取到数据：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1560411184376.png" alt="1560411184376"></p>
<p><br><br></p>
<h2 id="轮播图组件"><a href="#轮播图组件" class="headerlink" title="轮播图组件"></a>轮播图组件</h2><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><p>这里用到一个插件<a href="https://github.com/ustbhuangyi/better-scroll" target="_blank" rel="noopener">better-scroll</a></p>
<p><a href="https://ustbhuangyi.github.io/better-scroll/doc/zh-hans/#better-scroll%20%E6%98%AF%E4%BB%80%E4%B9%88" target="_blank" rel="noopener">better-scroll文档</a></p>
<p><br><br></p>
<h3 id="插播一个小技巧：抽出一个“添加类名”组件dom-js"><a href="#插播一个小技巧：抽出一个“添加类名”组件dom-js" class="headerlink" title="插播一个小技巧：抽出一个“添加类名”组件dom.js"></a>插播一个小技巧：抽出一个“添加类名”组件dom.js</h3><p>在轮播图组件的编写过程中，编写 _setSliderWidth() 方法的代码中，要遍历某个节点的子节点，给它加上一个类名，这是一个常见的操作。比起直接在 _setSliderWidth() 里面实现，最好的方法是把该操作抽离成为一个js文件。</p>
<p>于是新建了src/common/js/dom.js，在里面实现了添加类名的操作并暴露出去：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * dom操作相关的代码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">hasClass</span>(<span class="params">el, className</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'(^|\\s)'</span> + className + <span class="string">'(\\s|$)'</span>)</span><br><span class="line">    <span class="keyword">return</span> reg.test(el.className)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addClass</span>(<span class="params">el, className</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (hasClass(el, className)) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> newClass = el.className.split(<span class="string">' '</span>)</span><br><span class="line">    newClass.push(className)</span><br><span class="line">    el.className = newClass.join(<span class="string">' '</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而这个dom.js以后就专门来存放常见的dom操作。</p>
<p><br><br></p>
<h3 id="踩坑记录"><a href="#踩坑记录" class="headerlink" title="踩坑记录"></a>踩坑记录</h3><ol>
<li><p>recommend.vue中引用slider组件，而slider.vue中的 <code>_setSliderWidth()</code>方法里面循环渲染dom节点。但是我一开始的recommend.vue的代码中没有实现判断是否成功获取到了数据并渲染了节点，因为获取的是真实数据存在异步过程，如果没有加上这句<code>v-if=&quot;recommends.length&quot;</code>的话，可能存在recommend.vue页面还没有成功获取数据渲染节点，而引用slider组件导致slider中 <code>_setSliderWidth()</code>方法里面循环渲染dom节点出错，最终导致页面报销的状况。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;recommend&quot; ref=&quot;recommend&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;recommend-content&quot;&gt;</span><br><span class="line">        &lt;div v-if=&quot;recommends.length&quot; class=&quot;slider-wrapper&quot;&gt;&lt;!-- 注意这里用了v-if来确保只有当成功获取到数据后才将slider组件添加上，从而保证slider中的循环渲染成功 --&gt;</span><br><span class="line">            &lt;slider&gt;</span><br><span class="line">                &lt;div v-for=&quot;item in recommends&quot; :key=&quot;item.id&quot;&gt;</span><br><span class="line">                    &lt;a :href=&quot;item.linkUrl&quot;&gt;</span><br><span class="line">                        &lt;img :src=&quot;item.picUrl&quot; alt=&quot;&quot;&gt;</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/slider&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p><br></p>
</li>
<li><p>better-scroll默认会复制轮播图的首尾两张图（这里说成“图”不太准确，姑且这么说），因此通过api获得的轮播图图片只有5张，但是在使用better-scroll的时候生成了7个节点。相应的在slider.vue的<code>_setSliderWidth</code>中要设置增加两张图的宽度：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">_setSliderWidth(isResize) &#123;</span><br><span class="line">  <span class="keyword">this</span>.children = <span class="keyword">this</span>.$refs.sliderGroup.children;</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">let</span> width = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> sliderWidth = <span class="keyword">this</span>.$refs.slider.clientWidth;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.children.length; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> child = <span class="keyword">this</span>.children[i];</span><br><span class="line">    addClass(child, <span class="string">"slider-item"</span>);</span><br><span class="line">   </span><br><span class="line">    child.style.width = sliderWidth + <span class="string">"px"</span>;</span><br><span class="line">    width += sliderWidth;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.loop &amp;&amp; !isResize) &#123;</span><br><span class="line">    width += <span class="number">2</span> * sliderWidth; <span class="comment">/* 加多左右两个轮播图的宽度，为了实现无缝流畅滚动，不会噌的一下跳过去 */</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.$refs.sliderGroup.style.width = width + <span class="string">"px"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
</li>
<li><p>有个<strong>bug</strong></p>
<p>无法实现自动的无缝轮播，轮播到最后一张的时候就不动了，必须手动划一下才能无缝轮播。暂未解决，怀疑是better-scroll的问题。目前的妥协是最后一张直接跳转到第一张，就很难看。。。</p>
<p><br></p>
</li>
<li><p>实现窗口改变的时候自适应</p>
<p>在mounted钩子函数中监听一下窗口的改变事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/* 监听窗口改变事件 */</span></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'resize'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.slider) &#123;<span class="comment">/* 如果slider还未初始化，直接退出 */</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>._setSliderWidth()</span><br><span class="line">  <span class="keyword">this</span>.slider.refresh()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><br></p>
</li>
<li><p>优化：减少重复的数据请求</p>
<p>打开项目的时候轮播图会发起数据请求，但是当从首页推荐页切换路由到其他页面，再从其他页面切换回轮播图所在的首页推荐页面时，它又重新刷新发起了数据请求，这是没必要的，而且降低了性能。</p>
<p>可以使用<code>&lt;keepalive&gt;</code>标签将<code>&lt;router-view&gt;</code>包裹起来，将其dom缓存到内存中。这就避免了上述的情况。</p>
<p><br></p>
</li>
<li><p>优化：beforeDestroy清除计时器释放内存</p>
<p>路由切换的时候会触发vue的destroy，那么最好时把slider的计算器清除了以释放内存</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">beforeDestroy() &#123;</span><br><span class="line">  clearTimeout(this.timer)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><br><br></p>
<h2 id="【重点难点二】axios与后端接口代理"><a href="#【重点难点二】axios与后端接口代理" class="headerlink" title="【重点难点二】axios与后端接口代理"></a>【重点难点二】axios与后端接口代理</h2><p>先安装axios依赖</p>
<h3 id="修改代理"><a href="#修改代理" class="headerlink" title="修改代理"></a>修改代理</h3><p>在使用QQ音乐推荐页歌单列表的api时，发现无法通过ajax获取到。关键点是QQ音乐设置了请求头中的Host和Referer进行了限制：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1561392420142.png" alt="1561392420142"></p>
<p>因此需要解决这个跨域的问题。方法是<strong>修改代理</strong>。</p>
<p><br></p>
<h3 id="修改webpack-dev-conf-js"><a href="#修改webpack-dev-conf-js" class="headerlink" title="修改webpack.dev.conf.js"></a>修改webpack.dev.conf.js</h3><p><a href="https://github.com/ustbhuangyi/vue-music/issues/82" target="_blank" rel="noopener">【相关参考】</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">  devServer: &#123;</span><br><span class="line">    before(app) &#123;</span><br><span class="line">      app.get(<span class="string">'/api/getDiscList'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> url = <span class="string">'https://c.y.qq.com/splcloud/fcgi-bin/fcg_get_diss_by_tag.fcg'</span></span><br><span class="line">        axios.get(url, &#123;</span><br><span class="line">          headers: &#123;</span><br><span class="line">            referer: <span class="string">'https://c.y.qq.com/'</span>,</span><br><span class="line">            host: <span class="string">'c.y.qq.com'</span></span><br><span class="line">          &#125;,</span><br><span class="line">          params: req.query</span><br><span class="line">        &#125;).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">          res.json(response.data)</span><br><span class="line">        &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(e)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      </span><br><span class="line">      ...</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="src-api-recommend-js-1"><a href="#src-api-recommend-js-1" class="headerlink" title="src/api/recommend.js"></a>src/api/recommend.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jsonp <span class="keyword">from</span> <span class="string">'common/js/jsonp'</span></span><br><span class="line"><span class="keyword">import</span> &#123; commonParams, options &#125; <span class="keyword">from</span> <span class="string">'./config'</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getRecommend</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">'https://c.y.qq.com/musichall/fcgi-bin/fcg_yqqhomepagerecommend.fcg'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> data = <span class="built_in">Object</span>.assign(&#123;&#125;, commonParams, &#123;</span><br><span class="line">        platform: <span class="string">'h5'</span>,</span><br><span class="line">        uin: <span class="number">0</span>,</span><br><span class="line">        needNewCode: <span class="number">1</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jsonp(url, data, options)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getDiscList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">'/api/getDiscList'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> data = <span class="built_in">Object</span>.assign(&#123;&#125;, commonParams, &#123;</span><br><span class="line">        platform: <span class="string">'yqq'</span>,</span><br><span class="line">        hostUin: <span class="number">0</span>,</span><br><span class="line">        sin: <span class="number">0</span>,</span><br><span class="line">        ein: <span class="number">29</span>,</span><br><span class="line">        sortId: <span class="number">5</span>,</span><br><span class="line">        needNewCode: <span class="number">0</span>,</span><br><span class="line">        categoryId: <span class="number">10000000</span>,</span><br><span class="line">        rnd: <span class="built_in">Math</span>.random(),</span><br><span class="line">        format: <span class="string">'json'</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> axios.get(url, &#123;</span><br><span class="line">        params: data</span><br><span class="line">    &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(res.data)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在recommend.vue中调用getDiscList()方法就能成功获取到数据了。</p>
<p><br></p>
<p>这时候启动项目，可以在chrome Network中看到发送了Ajax请求并成功获得了数据：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1560566255358.png" alt="1560566255358"></p>
<p><br><br></p>
<h2 id="歌单列表组件开发"><a href="#歌单列表组件开发" class="headerlink" title="歌单列表组件开发"></a>歌单列表组件开发</h2><p>通过上一步改变qq音乐api的接口代理，在recommend.vue调用getDiscList方法获取到数据，并渲染到页面上。</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1560578229727.png" alt="1560578229727"></p>
<p>但是到这一步为止，页面尚无法上下滑动。还是需要better-scroll组件来创建一个歌单列表滚动组件。</p>
<p><br></p>
<h3 id="src-base-scroll-scroll-vue"><a href="#src-base-scroll-scroll-vue" class="headerlink" title="src/base/scroll/scroll.vue"></a>src/base/scroll/scroll.vue</h3><p>创建/src/base/scroll/scroll.vue:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div ref=&quot;wrapper&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/ecmascript-6&quot;&gt;</span><br><span class="line">  import BScroll from &apos;better-scroll&apos;</span><br><span class="line"></span><br><span class="line">  export default &#123;</span><br><span class="line">    props: &#123;</span><br><span class="line">      probeType: &#123;</span><br><span class="line">        type: Number,</span><br><span class="line">        default: 1</span><br><span class="line">      &#125;,</span><br><span class="line">      click: &#123;</span><br><span class="line">        type: Boolean,</span><br><span class="line">        default: true</span><br><span class="line">      &#125;,</span><br><span class="line">      data: &#123;</span><br><span class="line">        type: Array,</span><br><span class="line">        default: null</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted() &#123;</span><br><span class="line">      setTimeout(() =&gt; &#123;</span><br><span class="line">        this._initScroll()</span><br><span class="line">      &#125;, 20)</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      _initScroll() &#123;</span><br><span class="line">        if (!this.$refs.wrapper) &#123;</span><br><span class="line">          return</span><br><span class="line">        &#125;</span><br><span class="line">        this.scroll = new BScroll(this.$refs.wrapper, &#123;</span><br><span class="line">          probeType: this.probeType,</span><br><span class="line">          click: this.click</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      enable() &#123;</span><br><span class="line">        this.scroll &amp;&amp; this.scroll.enable()/* better-scroll的api，启用 better-scroll, 默认 开启 */</span><br><span class="line">      &#125;,</span><br><span class="line">      disable() &#123;</span><br><span class="line">        this.scroll &amp;&amp; this.scroll.disable()/* better-scroll的api，禁用 better-scroll，DOM 事件（如 touchstart、touchmove、touchend）的回调函数不再响应。 */</span><br><span class="line">      &#125;,</span><br><span class="line">      refresh() &#123;</span><br><span class="line">        this.scroll &amp;&amp; this.scroll.refresh()/* 重新计算 better-scroll，当 DOM 结构发生变化的时候务必要调用确保滚动的效果正常。 */</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    watch: &#123;</span><br><span class="line">      data() &#123;  /* 监听数据改变立即刷新 */</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">          this.refresh()</span><br><span class="line">        &#125;, 20)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang=&quot;stylus&quot; rel=&quot;stylesheet/stylus&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="src-components-recommend-recommend-vue"><a href="#src-components-recommend-recommend-vue" class="headerlink" title="src/components/recommend/recommend.vue"></a>src/components/recommend/recommend.vue</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;recommend&quot; ref=&quot;recommend&quot;&gt;</span><br><span class="line">    &lt;scroll ref=&quot;scroll&quot; class=&quot;recommend-content&quot; :data=&apos;discList&apos;&gt;&lt;!-- 注意这里的:data如果没有加的话依旧是不能上下滑动的，因为scroll是在mounted时候初始化，由于数据获取存在异步性，可能mounted的时候尚未取到数据，整个列表dom的高度是没有被撑开的以至于better-scroll无法正确初始化。所以需要传入一个discList数据（discList有说明数据已经获取到了）触发scroll的watch里面的refresh --&gt;</span><br><span class="line">      &lt;div&gt; &lt;!-- 注意，better-scroll的scroll标签下只能是一个div包裹全部，如果这个div不把轮播图和列表都包裹起来的话，效果是只有歌单列表滚动，轮播图是固定的，那就糟了 --&gt;</span><br><span class="line">      &lt;div v-if=&quot;recommends.length&quot; class=&quot;slider-wrapper&quot;&gt;</span><br><span class="line">        &lt;!-- 注意这里用了v-if来确保只有当成功获取到数据后才将slider组件添加上，从而保证slider中的循环渲染成功 --&gt;</span><br><span class="line">        &lt;slider&gt;</span><br><span class="line">          &lt;div v-for=&quot;item in recommends&quot; :key=&quot;item.id&quot;&gt;</span><br><span class="line">            &lt;a :href=&quot;item.linkUrl&quot;&gt;</span><br><span class="line">              &lt;img  @load=&quot;loadImage&quot; :src=&quot;item.picUrl&quot;&gt;&lt;!-- 通过@load事件监听图片加载完成了没有，一旦获加载完就refresh scroll --&gt;</span><br><span class="line">            &lt;/a&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/slider&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;recommend-list&quot;&gt;</span><br><span class="line">        &lt;h1 class=&quot;list-title&quot;&gt;热门歌单推荐&lt;/h1&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">          &lt;li class=&quot;item&quot; v-for=&quot;item in discList&quot; :key=&quot;item.dissid&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;icon&quot;&gt;</span><br><span class="line">              &lt;img :src=&quot;item.imgurl&quot; width=&quot;60&quot; height=&quot;60&quot; alt&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;text&quot;&gt;</span><br><span class="line">                &lt;h2 class=&quot;name&quot; v-html=&quot;item.creator.name&quot;&gt;&lt;/h2&gt;</span><br><span class="line">                &lt;p class=&quot;desc&quot; v-html=&quot;item.dissname&quot;&gt;&lt;/p&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/scroll&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="这里遇到的坑"><a href="#这里遇到的坑" class="headerlink" title="这里遇到的坑"></a>这里遇到的坑</h3><ol>
<li><p>在上述recommend.vue中提到scroll标签中:data如果没有加的话依旧是不能上下滑动的，因为scroll是在mounted时候初始化，由于数据获取存在异步性，可能mounted的时候尚未取到数据，整个列表dom的高度是没有被撑开的。所以需要传入一个discList数据（discList有说明数据已经获取到了）触发scroll的refresh</p>
</li>
<li><p>那为什么传discList就行？传recommends行不行？答案是不行的。虽然他们都是异步获取数据，但是discList获取的速度比recommends的获取速度慢。如果传入的是recommends，虽然recommends已经获取到了，轮播图的高度也已经撑开了，但是下方的列表discList还没有完全获取到，所以scroll在初始化的时候页面的高度计算是有误的。</p>
</li>
<li><p>还有一个问题，拿到recommends就万事大吉了吗？不是。</p>
<p>对于discList歌单列表，里面的列表项是给定宽高的，所以一拿到discList就能确定宽高撑开dom。但是recommend部分的轮播图图片是没有给定宽高的，是按照百分比来设置的宽高，所以即使获得了recommends的数据，但是由于图片是通过链接引入的，这又是一个异步的过程，所以不能保证拿到了recommends的数据就能立刻加载出图片撑起宽高，在此完成之前就初始化scroll还是会出问题的。所以，可以给img标签监听load事件，一旦load就refresh scroll。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">loadImage() &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.checkloaded) &#123; <span class="comment">/* 无中生有搞个checkloaded变量来监测加载完成与否，一开始默认为undefined，只要有一张加载成功就改值为true，不用每张图都触发这个方法，加载得到一张图就可以确定宽高了 */</span></span><br><span class="line">    <span class="keyword">this</span>.checkloaded = <span class="literal">true</span> </span><br><span class="line">    <span class="keyword">this</span>.$refs.scroll.refresh()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>使用checkloaded也是<strong>常见的一种优化</strong>。</p>
<p><br></p>
<h3 id="这里总结一下better-scroll的渲染原理吧"><a href="#这里总结一下better-scroll的渲染原理吧" class="headerlink" title="这里总结一下better-scroll的渲染原理吧"></a>这里总结一下better-scroll的渲染原理吧</h3><p>它根据初始化的时机或者refresh的时机，那个时候scroll的父元素的高度和子元素的高度之差，算到scroll可以滚动的位置，所以我们去实例化或者refresh这个scroll的时候一定要保证dom是渲染完成的，才能正确计算他们的高度。一旦我们有数据变化引起dom变化或者其他dom结构变化，一定要重新refresh这个scroll。</p>
<p><br><br></p>
<h2 id="懒加载vue-lazyload"><a href="#懒加载vue-lazyload" class="headerlink" title="懒加载vue-lazyload"></a>懒加载vue-lazyload</h2><h3 id="vue-lazyload"><a href="#vue-lazyload" class="headerlink" title="vue-lazyload"></a><a href="https://github.com/hilongjw/vue-lazyload" target="_blank" rel="noopener">vue-lazyload</a></h3><p><br></p>
<h3 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a>代码编写</h3><ol>
<li><p>main.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> VueLazyLoad <span class="keyword">from</span> <span class="string">'vue-lazyload'</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueLazyLoad, &#123;</span><br><span class="line">    loading: <span class="built_in">require</span>(<span class="string">'./common/image/default-ldt.png'</span>)  <span class="comment">//loading时显示的图片</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>将recommend.vue中<code>img</code>标签的<code>:src</code>属性替换成<code>v-lazy</code>计即可</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1561427554510.png" alt="1561427554510"></p>
</li>
</ol>
<p><br></p>
<h2 id="loading组件"><a href="#loading组件" class="headerlink" title="loading组件"></a>loading组件</h2><p>效果：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuemusic/1561428758666.png" alt="1561428758666"></p>
<p><br></p>
<p>要搞个这个东西，提升用户体验。</p>
<h3 id="src-base-loading-vue"><a href="#src-base-loading-vue" class="headerlink" title="src/base/loading.vue"></a>src/base/loading.vue</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;loading&quot;&gt;</span><br><span class="line">    &lt;img width=&quot;24&quot; height=&quot;24&quot; src=&quot;./loading.gif&quot;&gt;</span><br><span class="line">    &lt;p class=&quot;desc&quot;&gt;&#123;&#123;title&#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script type=&quot;text/ecmascript-6&quot;&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    props: &#123;</span><br><span class="line">      title: &#123;</span><br><span class="line">        type: String,</span><br><span class="line">        default: &apos;正在载入...&apos;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped lang=&quot;stylus&quot; rel=&quot;stylesheet/stylus&quot;&gt;</span><br><span class="line">  @import &quot;~common/stylus/variable&quot;</span><br><span class="line"></span><br><span class="line">  .loading</span><br><span class="line">    width: 100%</span><br><span class="line">    text-align: center</span><br><span class="line">    .desc</span><br><span class="line">      line-height: 20px</span><br><span class="line">      font-size: $font-size-small</span><br><span class="line">      color: $color-text-l</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>然后在recommend.vue中引用并嵌入即可。</p>
<p><br><br></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dunteng.github.io/[object Object]2019/06/03/Vuex笔记.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dunteng Lin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunteng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]2019/06/03/Vuex笔记.html" itemprop="url">Vuex笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-03T00:00:00+08:00">
                2019-06-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]2019/06/03/Vuex笔记.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/[object Object]2019/06/03/Vuex笔记.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我这篇文章也放在我的GitHub上，里面还有相应的代码。建议移步<a href="https://github.com/Dunteng/learnVue/tree/master/%E5%AD%A6%E4%B9%A0Vuex#%E6%9C%AC%E6%96%87%E4%BB%A3%E7%A0%81" target="_blank" rel="noopener">GitHub</a>阅读本文章。</p>
<h1 id="本文代码"><a href="#本文代码" class="headerlink" title="本文代码"></a>本文代码</h1><ul>
<li>前导~state部分的全部代码： <a href="https://github.com/Dunteng/learnVue/tree/v1/%E5%AD%A6%E4%B9%A0Vuex/app" target="_blank" rel="noopener">点击</a></li>
<li>应用（一）代码： <a href="https://github.com/Dunteng/learnVue/tree/v2/%E5%AD%A6%E4%B9%A0Vuex/app" target="_blank" rel="noopener">点击</a></li>
<li>getters 应用（二）代码： <a href="https://github.com/Dunteng/learnVue/tree/v3/%E5%AD%A6%E4%B9%A0Vuex/app" target="_blank" rel="noopener">点击</a></li>
<li>mutations 应用（三）代码：<a href="https://github.com/Dunteng/learnVue/tree/v4/%E5%AD%A6%E4%B9%A0Vuex/app" target="_blank" rel="noopener">点击</a></li>
<li>actions 应用（四）代码：<a href="https://github.com/Dunteng/learnVue/tree/v5/%E5%AD%A6%E4%B9%A0Vuex/app" target="_blank" rel="noopener">点击</a></li>
</ul>
<p><br><br></p>
<h1 id="前导"><a href="#前导" class="headerlink" title="前导"></a>前导</h1><p>结合代码案例学习，本文的知识点会依附在这个代码里讲解，下面先来看一下这个代码的介绍，主要就是一个父组件Index.vue，两个子组件AddStudent.vue和StudentList.vue，之间有组件通讯。</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562291573640.png" alt="1562291573640"></p>
<p><br></p>
<h2 id="父组件-Index-vue"><a href="#父组件-Index-vue" class="headerlink" title="父组件 Index.vue"></a>父组件 Index.vue</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;index&quot;&gt;</span><br><span class="line">    rock!我是index.vue</span><br><span class="line">    &lt;add-student @add=&quot;add&quot;&gt;&lt;/add-student&gt;</span><br><span class="line">    &lt;student-list :student=&quot;student&quot;&gt;&lt;/student-list&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import AddStudent from &quot;../components/AddStudent&quot;;</span><br><span class="line">import StudentList from &quot;../components/StudentList&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      student: []</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    add(name) &#123;</span><br><span class="line">      this.student.push(name);</span><br><span class="line">      console.log(this.student);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    AddStudent,</span><br><span class="line">    StudentList</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.index &#123;</span><br><span class="line">  background-color: rgb(72, 138, 182);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="子组件-AddStudent-vue"><a href="#子组件-AddStudent-vue" class="headerlink" title="子组件 AddStudent.vue"></a>子组件 AddStudent.vue</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;AddStudent&quot;&gt;</span><br><span class="line">    &lt;h4&gt;我是addStudent&lt;/h4&gt;</span><br><span class="line">    &lt;span&gt;添加学生&lt;/span&gt;</span><br><span class="line">    &lt;input id=&quot;input&quot; type=&quot;text&quot; v-model=&quot;name&quot; /&gt;</span><br><span class="line">    &lt;button @click=&quot;add&quot;&gt;添加&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      name: &quot;&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    add() &#123;</span><br><span class="line">      this.$emit(&quot;add&quot;, this.name);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.AddStudent &#123;</span><br><span class="line">  border: 2px solid green;</span><br><span class="line">  background-color: green;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="子组件-Student-List-vue"><a href="#子组件-Student-List-vue" class="headerlink" title="子组件 Student List.vue"></a>子组件 Student List.vue</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;StudentList&quot;&gt;</span><br><span class="line">    &lt;h4&gt;我是StudentList&lt;/h4&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li v-for=&quot;(item, index) in student&quot; :key=&quot;index+item&quot;&gt;&#123;&#123;item&#125;&#125;&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;&#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  props: [&quot;student&quot;]</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.StudentList &#123;</span><br><span class="line">  border: 2px solid red;</span><br><span class="line">  background-color: red;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p><br><br></p>
<h1 id="state"><a href="#state" class="headerlink" title="state"></a>state</h1><h2 id="store-js"><a href="#store-js" class="headerlink" title="store.js"></a>store.js</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    name: <span class="string">'dunteng'</span>,</span><br><span class="line">    age: <span class="number">20</span>,</span><br><span class="line">    look: <span class="string">'handsome'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="store-state-xxx"><a href="#store-state-xxx" class="headerlink" title="$store.state.xxx"></a>$store.state.xxx</h2><p>vuex 里的 state 相当于一个公共数据池。</p>
<p>在 AddStudent.vue 中通过如下方式可以获取到：</p>
<ol>
<li><p>使用 $store.state.name 获取到</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562292413010.png" alt="1562292413010"></p>
<p>然后我修改一下add方法使得点击button按钮后修改 $store.state.name ，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">add() &#123;</span><br><span class="line">  <span class="comment">// this.$emit("add", this.name);</span></span><br><span class="line">  <span class="keyword">this</span>.$store.state.name += <span class="string">" lin"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是<code></code>显示的部分并没有成功修改只有<code></code>才有被修改，这是因为<code>storeName</code>是在data中被定义的，之后<code>$store.state.name</code>和它是没关系的，影响不到。所以应该用<code>computed</code>来获取 state 的数据。</p>
</li>
<li><p>computed 获取 this.$store.state.name</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562292792863.png" alt="1562292792863"></p>
<p>这样，只要 state 里的数据发生改变，通过 computed 获取到的就能相应其改变。</p>
</li>
</ol>
<p><br></p>
<h2 id="mapState"><a href="#mapState" class="headerlink" title="mapState"></a>mapState</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>像上述那样拿到 state 中的 name ，继续获取到 state 中的其他数据：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562293651685.png" alt="1562293651685"></p>
<p>如果同时另一个组件也要同样的这些数据，那么就要在 StudentList 组件中重复上述的操作，这样是可行的，但是如果还有七八九十个组件也要这些数据，那么这样的操作很繁琐，冗余很大。</p>
<p>这就需要用到 <strong>mapState方法</strong> 了。这个方法的返回是一个<strong>对象</strong>，对象的每个key对应的value都是一个函数，有一点点像下面这个：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562294928788.png" alt="1562294928788"></p>
<p><br></p>
<h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><p>先引入才能使用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;mapState&#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br></pre></td></tr></table></figure>
<p>然后结合 computed ，将 state 中的数据作为参数传入，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">computed: mapState([<span class="string">"name"</span>, <span class="string">"age"</span>, <span class="string">"look"</span>]),</span><br></pre></td></tr></table></figure>
<p>而在当前组件中获得的数据名称和 state 中的一样。</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562295563445.png" alt="1562295563445"></p>
<p>但是结果只显示了 age 和 look ，没有显示 name ，因为在 data 中定义了一个 name 属性，而 data 的优先级比 computed 高，所以无法正常获取到。</p>
<p>所以需要我们在使用 mapState 的时候重命名，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">computed: mapState(&#123;</span><br><span class="line">  mapStateName: <span class="function"><span class="params">state</span> =&gt;</span> state.name,</span><br><span class="line">  mapStateAge: <span class="function"><span class="params">state</span> =&gt;</span> state.age,</span><br><span class="line">  mapStateOther: <span class="function"><span class="params">()</span> =&gt;</span> <span class="string">"你好吗"</span> <span class="comment">//我们甚至可以定义与state无关的变量</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>
<p>但是除了 mapState ，我们在 computed 中也需要定义其他的计算属性，咋整？</p>
<p>像下面这样写是会报错的！</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562297668974.png" alt="1562297668974"></p>
<p>上面说了 mapState 返回的是一个<strong>对象</strong>，所以我们可以使用扩展运算符，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  ...mapState(&#123;</span><br><span class="line">    mapStateName: <span class="function"><span class="params">state</span> =&gt;</span> state.name,</span><br><span class="line">    mapStateAge: <span class="function"><span class="params">state</span> =&gt;</span> state.age,</span><br><span class="line">    mapStateOther: <span class="function"><span class="params">()</span> =&gt;</span> <span class="string">"你好吗"</span></span><br><span class="line">  &#125;),</span><br><span class="line">  a()&#123;</span><br><span class="line">    retrun <span class="keyword">this</span>.$store.state.age+<span class="number">666</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="应用（一）"><a href="#应用（一）" class="headerlink" title="应用（一）"></a>应用（一）</h2><p><a href="https://github.com/Dunteng/learnVue/tree/v2/%E5%AD%A6%E4%B9%A0Vuex/app" target="_blank" rel="noopener">【代码】</a></p>
<p>原案例中的两个子组件之间的传值是通过父组件来实现的，下面我们利用 vuex 的 state 来存储他们的公共资源。</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562307401416.png" alt="1562307401416"></p>
<p><br></p>
<h3 id="父组件-Index-vue-1"><a href="#父组件-Index-vue-1" class="headerlink" title="父组件 Index.vue"></a>父组件 Index.vue</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;index&quot;&gt;</span><br><span class="line">    rock!我是index.vue</span><br><span class="line">    &lt;add-student&gt;&lt;/add-student&gt;</span><br><span class="line">    &lt;student-list&gt;&lt;/student-list&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import AddStudent from &quot;../components/AddStudent&quot;;</span><br><span class="line">import StudentList from &quot;../components/StudentList&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;&#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;&#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    AddStudent,</span><br><span class="line">    StudentList</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.index &#123;</span><br><span class="line">  background-color: rgb(72, 138, 182);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="子组件-AddStudent-vue-1"><a href="#子组件-AddStudent-vue-1" class="headerlink" title="子组件 AddStudent.vue"></a>子组件 AddStudent.vue</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;AddStudent&quot;&gt;</span><br><span class="line">    &lt;h4&gt;我是addStudent&lt;/h4&gt;</span><br><span class="line">    &lt;span&gt;添加学生&lt;/span&gt;</span><br><span class="line">    &lt;input id=&quot;input&quot; type=&quot;text&quot; v-model=&quot;name&quot; /&gt;</span><br><span class="line">    &lt;button @click=&quot;add&quot;&gt;添加&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; mapState &#125; from &quot;vuex&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      name: &quot;&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    add() &#123;</span><br><span class="line">      // this.$emit(&quot;add&quot;, this.name);</span><br><span class="line">      this.$store.state.studentlist.push(this.name);</span><br><span class="line">      console.log(this.$store.state.studentlist);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.AddStudent &#123;</span><br><span class="line">  border: 2px solid green;</span><br><span class="line">  background-color: green;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="子组件-StudentList-vue"><a href="#子组件-StudentList-vue" class="headerlink" title="子组件 StudentList.vue"></a>子组件 StudentList.vue</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;StudentList&quot;&gt;</span><br><span class="line">    &lt;h4&gt;我是StudentList&lt;/h4&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li v-for=&quot;(item, index) in studentlist&quot; :key=&quot;index+item&quot;&gt;&#123;&#123;item&#125;&#125;&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; mapState &#125; from &quot;vuex&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;&#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    ...mapState([&quot;studentlist&quot;]) //记得加引号。。。</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.StudentList &#123;</span><br><span class="line">  border: 2px solid red;</span><br><span class="line">  background-color: red;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p><br><br></p>
<h1 id="getters"><a href="#getters" class="headerlink" title="getters"></a>getters</h1><h2 id="应用（二）"><a href="#应用（二）" class="headerlink" title="应用（二）"></a>应用（二）</h2><p>在应用（一）的基础上，要求输出：</p>
<blockquote>
<p>索引为0的： **姓名</p>
<p>索引为1和2的：姓名**</p>
<p>索引大于2的：++姓名++</p>
</blockquote>
<p>效果图：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562335007899.png" alt="1562335007899"></p>
<p><br></p>
<h3 id="不用getters的方案"><a href="#不用getters的方案" class="headerlink" title="不用getters的方案"></a>不用getters的方案</h3><p>在 StudentList.vue中的 <strong>computed</strong> 中进行数据处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  <span class="comment">// ...mapState(["studentlist"]) //记得加引号。。。</span></span><br><span class="line">  studentlist() &#123;</span><br><span class="line">    <span class="keyword">var</span> list = [];</span><br><span class="line">    <span class="keyword">this</span>.$store.state.studentlist.forEach(<span class="function">(<span class="params">element, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">        element = <span class="string">"**"</span> + element;</span><br><span class="line">        list.push(element);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index == <span class="number">1</span> || index == <span class="number">2</span>) &#123;</span><br><span class="line">        element = element + <span class="string">"**"</span>;</span><br><span class="line">        list.push(element);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        element = <span class="string">"++"</span> + element + <span class="string">"++"</span>;</span><br><span class="line">        list.push(element);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="使用getters的方案"><a href="#使用getters的方案" class="headerlink" title="使用getters的方案"></a>使用getters的方案</h3><p>现在 store.js 中写 getters 代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">getters: &#123;</span><br><span class="line">  <span class="comment">//相当于计算属性</span></span><br><span class="line">  newstudentlist(state) &#123;</span><br><span class="line">    <span class="keyword">return</span> state.studentlist.map(<span class="function">(<span class="params">ele, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'**'</span> + ele</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index &lt; <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ele + <span class="string">'**'</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'++'</span> + ele + <span class="string">'++'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>在 StudentList 中直接使用 newstudentlist：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;StudentList&quot;&gt;</span><br><span class="line">    &lt;h4&gt;我是StudentList&lt;/h4&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li v-for=&quot;(item, index) in newstudentlist&quot; :key=&quot;index+item&quot;&gt;&#123;&#123;item&#125;&#125;&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; mapState &#125; from &quot;vuex&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;&#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    newstudentlist() &#123;</span><br><span class="line">      return this.$store.getters.newstudentlist;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="mapGetters"><a href="#mapGetters" class="headerlink" title="mapGetters"></a>mapGetters</h3><p>和 mapState 类似的便捷方法</p>
<p>StudentList 中先引入 mapGetters ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapState, mapGetters &#125; <span class="keyword">from</span> <span class="string">"vuex"</span>;</span><br><span class="line">。。。</span><br><span class="line">  computed: &#123;</span><br><span class="line">    <span class="comment">// newstudentlist() &#123;</span></span><br><span class="line">    <span class="comment">//   return this.$store.getters.newstudentlist;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    ...mapGetters([<span class="string">"newstudentlist"</span>])</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>也可以使用对象的方式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapState, mapGetters &#125; <span class="keyword">from</span> <span class="string">"vuex"</span>;</span><br><span class="line">。。。</span><br><span class="line">  computed: &#123;</span><br><span class="line">    <span class="comment">// newstudentlist() &#123;</span></span><br><span class="line">    <span class="comment">//   return this.$store.getters.newstudentlist;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//...mapGetters(["newstudentlist"])</span></span><br><span class="line">    </span><br><span class="line">    ...mapGetters(&#123;</span><br><span class="line">      newstudentlist: <span class="string">"newstudentlist"</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="补充一点：getters自身可以作为参数传入getters属性的方法中"><a href="#补充一点：getters自身可以作为参数传入getters属性的方法中" class="headerlink" title="补充一点：getters自身可以作为参数传入getters属性的方法中"></a>补充一点：getters自身可以作为参数传入getters属性的方法中</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">getters: &#123;</span><br><span class="line">  <span class="comment">//相当于计算属性</span></span><br><span class="line">  newstudentlist(state, getters) &#123;<span class="comment">//传入了getters作为参数</span></span><br><span class="line">    <span class="keyword">return</span> state.studentlist.map(<span class="function">(<span class="params">ele, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'**'</span> + ele + getters.aaa<span class="comment">//使用了getters中的aaa</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index &lt; <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ele + <span class="string">'**'</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'++'</span> + ele + <span class="string">'++'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  aaa() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">666</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p><br><br></p>
<h1 id="mutations"><a href="#mutations" class="headerlink" title="mutations"></a>mutations</h1><h2 id="关于严格模式"><a href="#关于严格模式" class="headerlink" title="关于严格模式"></a>关于严格模式</h2><p>上述应用程序代码写的是不规范的，当我们开启严格模式时就会报警告了。</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562337035921.png" alt="1562337035921"></p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562337084677.png" alt="1562337084677"></p>
<p>报错信息提示不要在 <strong>mutation</strong> 处理程序之外对vuex存储状态<strong>state</strong>进行更改。而我们恰恰就在 Addstudent.vue 的 add 方法中对 $store.state.studentlist 进行了更改：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562337274020.png" alt="1562337274020"></p>
<p>【记住：凡是要修改 <strong>state</strong> 的都要通过 <strong>mutation</strong> 来修改。 】</p>
<p><br></p>
<h2 id="应用（三）"><a href="#应用（三）" class="headerlink" title="应用（三）"></a>应用（三）</h2><p><a href="https://github.com/Dunteng/learnVue/tree/v4/%E5%AD%A6%E4%B9%A0Vuex/app" target="_blank" rel="noopener">【这部分代码】</a></p>
<p>先在 store.js 中编写 mutations ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mutations: &#123;</span><br><span class="line">  changeStudent(state, param) &#123;</span><br><span class="line">    state.studentlist.push(param)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>第二个参数接受传入的外部参数。</p>
<p>在 AddStudent.vue 中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  add() &#123;</span><br><span class="line">    <span class="keyword">this</span>.$store.commit(<span class="string">"changeStudent"</span>, <span class="keyword">this</span>.name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意写法，对象是 $store ，使用了 <strong>commit</strong>。</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/dfagaha.GIF" alt="dfagaha"></p>
<p><br></p>
<p>在 mutation 属性中智能传递两个参数，如果我们想传递多个参数，可以把参数写进一个对象，然后这个对象作为参数写入 mutation 中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mutations: &#123;</span><br><span class="line">  changeStudent(state, &#123; name, number &#125;) &#123;<span class="comment">//这里注意对象参数里面的元素命名形参和实参必须保持一致</span></span><br><span class="line">    state.studentlist.push(name + number)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>在 AddStudent.vue 中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  add() &#123;</span><br><span class="line">    <span class="keyword">this</span>.$store.commit(<span class="string">"changeStudent"</span>, &#123; <span class="attr">name</span>: <span class="keyword">this</span>.name, <span class="attr">number</span>: <span class="number">12</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>【注意：注意对象参数里面的元素命名形参和实参必须保持一致】</p>
<p><br></p>
<h2 id="mapMutations"><a href="#mapMutations" class="headerlink" title="mapMutations"></a>mapMutations</h2><p>和 mapGetters 一样， mutations 也有便捷操作。</p>
<p>在 AddStudent.vue 中，先引入 mapMutations</p>
<p>然后在 methods 定义：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  add() &#123;</span><br><span class="line">    <span class="comment">// this.$emit("add", this.name);</span></span><br><span class="line">    <span class="comment">// this.$store.state.studentlist.push(this.name);</span></span><br><span class="line">    <span class="comment">// console.log(this.$store.state.studentlist);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// this.$store.commit("changeStudent", &#123; name: this.name, number: 12 &#125;);//mutations</span></span><br><span class="line">    </span><br><span class="line">  &#125;,</span><br><span class="line">  ...mapMutations([<span class="string">'changeStudent'</span>])    <span class="comment">//mutations里的方法叫什么这里就填什么</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样在 AddStudent.vue 中就有了 changeStudent 这一方法，直接使用即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;AddStudent&quot;&gt;</span><br><span class="line">    &lt;h4&gt;我是addStudent&lt;/h4&gt;</span><br><span class="line">    &lt;span&gt;添加学生&lt;/span&gt;</span><br><span class="line">    &lt;input id=&quot;input&quot; type=&quot;text&quot; v-model=&quot;name&quot; /&gt;</span><br><span class="line">    &lt;!-- &lt;button @click=&quot;add&quot;&gt;添加&lt;/button&gt; --&gt;</span><br><span class="line">    &lt;button @click=&quot;changeStudent(&#123;name,number:18&#125;)&quot;&gt;添加&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<p>如果想要<strong>重命名</strong>，如下操作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  add() &#123;</span><br><span class="line">    <span class="comment">// this.$emit("add", this.name);</span></span><br><span class="line">    <span class="comment">// this.$store.state.studentlist.push(this.name);</span></span><br><span class="line">    <span class="comment">// console.log(this.$store.state.studentlist);</span></span><br><span class="line">    <span class="comment">// this.$store.commit("changeStudent", &#123; name: this.name, number: 12 &#125;);//mutations</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...mapMutations(['changeStudent'])    //mutations里的方法叫什么这里就填什么</span></span><br><span class="line">  ...mapMutations(&#123;</span><br><span class="line">    newChangeStudent: <span class="string">"changeStudent"</span> <span class="comment">//重命名</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在标签里触发这个 newChangeStudent 即可。</p>
<p><br><br></p>
<h1 id="actions"><a href="#actions" class="headerlink" title="actions"></a>actions</h1><h2 id="异步操作下的情况"><a href="#异步操作下的情况" class="headerlink" title="异步操作下的情况"></a>异步操作下的情况</h2><p>我们尝试在 mutations 中模拟一下异步操作，实现点击后过了1秒再执行 mutations 中的动作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mutations: &#123;</span><br><span class="line">  changeStudent(state, &#123; name, number &#125;) &#123;<span class="comment">//这里注意对象参数里面的元素命名形参和实参必须保持一致</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      state.studentlist.push(name + number)</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>然后发现控制台报错：</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/1562376986538.png" alt="1562376986538"></p>
<p>还是之前见过的报错信息，提示不要在 <strong>mutation</strong> 处理程序之外对vuex存储状态<strong>state</strong>进行更改。而我们在 mutations 里面的 setTimeout 下对 state 进行了修改，作用域不在 mutations 下，因此报错。</p>
<p>还有一点非常糟糕的是：如果我们这样写了，在点击按钮的时候用极端的时间点击了很多次，当后来我们想要调试的时候，回不到正确的 state 。我们通过 vue Devtool 调试，当我想要看第三次点击时的 state 时，结果左边跳到了初试的 state 状态，因为我的第三次点击时，第一次点击还不到1秒，state 还尚未被修改！如下图所示</p>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/faga.GIF" alt="faga"></p>
<p>于是我们可以使用 vuex 中的异步操作 <strong>actions</strong>。</p>
<p>mutations 是用来执行修改 state 中数据的操作，actions 也是，但是特别的是，actions 专门用来进行<strong>异步</strong>的修改操作。<br></p>
<h2 id="应用（四）"><a href="#应用（四）" class="headerlink" title="应用（四）"></a>应用（四）</h2><p>在 store.js 中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mutations: &#123;</span><br><span class="line">  changeStudent(state, &#123; name, number &#125;) &#123;<span class="comment">//这里注意对象参数里面的元素命名形参和实参必须保持一致</span></span><br><span class="line">    state.studentlist.push(name + number)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">actions: &#123;</span><br><span class="line">  changeStudent(ctx, &#123; name, number &#125;) &#123;</span><br><span class="line">    <span class="comment">//这个参数ctx是上下文对象，相当于当前的$store</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      ctx.commit(<span class="string">'changeStudent'</span>, &#123; name, number &#125;)<span class="comment">//这里调用了mutations 中的changeStudent方法</span></span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 AddStudent.vue 中，通过 <strong>dispatch</strong> 来触发 actions ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  add() &#123;</span><br><span class="line">    <span class="comment">// this.$emit("add", this.name);</span></span><br><span class="line">    <span class="comment">// this.$store.state.studentlist.push(this.name);</span></span><br><span class="line">    <span class="comment">// console.log(this.$store.state.studentlist);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// this.$store.commit("changeStudent", &#123; name: this.name, number: 12 &#125;);//mutations</span></span><br><span class="line">    <span class="keyword">this</span>.$store.dispatch(<span class="string">'changeStudent'</span>,&#123;<span class="attr">name</span>:<span class="keyword">this</span>.name,<span class="attr">number</span>:<span class="number">12</span>&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Dunteng/images/master/BlogImages/illustration/vuex/dfagaga.GIF" alt="dfagaga"></p>
<p>在这个例子中，使用了 actions ，每次点击按钮的时候它都不是立即就执行 changeStudent 方法，而是每次都等候1秒再执行了，这就和用 mutations 内部 setTimeout 不一样，不是楞头地立即执行，导致 state 混乱。<br></p>
<h2 id="mapActions"><a href="#mapActions" class="headerlink" title="mapActions"></a>mapActions</h2><p>同样的，actions 也有便捷操作。mapActions 返回的也是一个对象，里面都是函数。</p>
<p>在 AddStudent.vue 的 methods 中创建 mapActions：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  ...mapActions([<span class="string">"changeStudent"</span>])<span class="comment">//actions里面的方法叫什么这里就写什么</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样 AddStudent.vue 中就有了 changeStudent 这样一个方法，可以像普通方法那样使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;AddStudent&quot;&gt;</span><br><span class="line">    &lt;h4&gt;我是addStudent&lt;/h4&gt;</span><br><span class="line">    &lt;span&gt;添加学生&lt;/span&gt;</span><br><span class="line">    &lt;input id=&quot;input&quot; type=&quot;text&quot; v-model=&quot;name&quot; /&gt;</span><br><span class="line">    &lt;button @click=&quot;changeStudent(&#123;name,number:6&#125;)&quot;&gt;添加&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<p>如果要<strong>重命名</strong>，如下操作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  ...mapActions(&#123;</span><br><span class="line">    newChangeStudent: <span class="string">"changeStudent"</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在标签中触发 newChangeStudent 方法即可。</p>
<p><br></p>
<p><br></p>
<h1 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h1><p>未完待续</p>
<p><br><br></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="Dunteng Lin">
            
              <p class="site-author-name" itemprop="name">Dunteng Lin</p>
              <p class="site-description motion-element" itemprop="description">都会好的  总会有的</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">61</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/dunteng" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:yourname@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://instagram.com/dunteng_lin" target="_blank" title="Instagram">
                      
                        <i class="fa fa-fw fa-instagram"></i></a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Dunteng Lin</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: true,
        appId: 'J29bT1MHDnsDl0O48fRK6u7D-gzGzoHsz',
        appKey: '2ftsHD4VBWJQVASwv65waJNL',
        placeholder: 'ヾﾉ≧∀≦)o快来评论一下吧!',
        avatar:'retro',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('-1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
